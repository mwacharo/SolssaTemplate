import{E as A,r as d,i as f,j as S,k as j,l as T,d as v,e as E,u as p,o as _,a as r,F as k,b as R,g as M,y as N,t as g}from"./app-BfTUaguK.js";import{u as B}from"./servicesStore-OHhTdJ9J.js";import{u as z}from"./condition-CT4Q-IzH.js";import{u as L}from"./conditionTypeStore-bhdeqhHa.js";const P=A("vendorServices",()=>{const b=d(!1),s=d(null),u=d([]),y=d([]),l=d({}),c=d(!1),w=async t=>{s.value=t,b.value=!0,await m(t)},x=()=>{b.value=!1,s.value=null,u.value=[],l.value={}},m=async t=>{if(t){c.value=!0;try{const e=await f.get(`/api/v1/vendors/${t}/services`);u.value=e.data,u.value.forEach(a=>{l.value[a.id]={},a.service.conditions.forEach(n=>{l.value[a.id][n.id]={custom_rate:n.custom_rate||null,rate_type:n.custom_rate_type||n.rate_type}})})}catch(e){throw console.error("Failed to load vendor services:",e),e}finally{c.value=!1}}};return{isModalOpen:b,selectedVendorId:s,vendorServices:u,availableServices:y,overrides:l,loading:c,openModal:w,closeModal:x,loadVendorServices:m,loadAvailableServices:async()=>{try{const t=await f.get("/api/v1/services");y.value=t.data}catch(t){throw console.error("Failed to load services:",t),t}},assignService:async t=>{if(!(!t||!s.value))try{return await f.post(`/api/v1/vendors/${s.value}/services`,{service_id:t,vendor_id:s.value}),await m(s.value),!0}catch(e){throw console.error("Failed to assign service:",e),e}},removeService:async t=>{if(s.value)try{return await f.delete(`/api/v1/vendors/${s.value}/services/${t}`),await m(s.value),!0}catch(e){throw console.error("Failed to remove service:",e),e}},saveOverride:async(t,e)=>{var n;const a=(n=l.value[t])==null?void 0:n[e];if(!a||a.custom_rate===null||a.custom_rate==="")throw new Error("Please enter a rate");try{return await f.post(`/api/v1/vendors/${s.value}/services/${t}/rates`,{service_condition_id:e,custom_rate:a.custom_rate,rate_type:a.rate_type}),!0}catch(h){throw console.error("Failed to save override:",h),h}},updateOverride:(t,e,a,n)=>{l.value[t]||(l.value[t]={}),l.value[t][e]||(l.value[t][e]={custom_rate:null,rate_type:"fixed"}),l.value[t][e][a]=n}}}),U={class:"bg-white w-4/5 max-h-[90vh] overflow-auto rounded p-6"},D={class:"flex justify-between mb-4"},q={key:0,class:"text-center py-8"},G={class:"flex gap-2 mb-6"},H={class:"flex gap-2 mb-6"},J=["disabled"],K={key:0,class:"text-center py-8 text-gray-500"},Q={class:"flex justify-between mb-3"},W={class:"font-semibold text-lg"},X=["onClick"],Y={class:"overflow-x-auto"},Z={class:"w-full text-sm"},I={class:"p-2"},ee={class:"p-2 text-center"},te={class:"p-2 text-center"},re={class:"p-2"},se=["value","onInput"],oe={class:"p-2 text-center"},ae=["onClick"],ie={__name:"VendorServices",setup(b){const s=P(),u=B(),y=z(),l=L();S(()=>y.conditions),S(()=>u.services),S(()=>l.conditionTypes);const c=d("");d(""),d(""),d("");const w=i=>y.conditions.filter(o=>o.service_id===i),x=(i,o)=>{var t;return((t=i.service_rates)==null?void 0:t.find(e=>e.service_condition_id===o))??null},m=async()=>{if(c.value)try{await s.assignService(c.value),c.value="",alert("Service assigned successfully!")}catch{alert("Failed to assign service")}},C=async i=>{if(confirm("Are you sure you want to remove this service?"))try{await s.removeService(i),alert("Service removed successfully!")}catch{alert("Failed to remove service")}},V=(i,o,t,e)=>{s.updateOverride(i,o,t,e)},O=async(i,o)=>{try{await s.saveOverride(i,o),alert("Rate override saved successfully!")}catch(t){alert(t.message||"Failed to save rate override")}};return j(async()=>{try{await u.fetchServices()}catch(i){console.error("Error loading services:",i)}try{await l.fetchAll(),console.log("Condition types loaded:",l.conditionTypes);try{await y.fetchConditions(),console.log("Conditions loaded:",y.conditions)}catch(i){console.error("Error loading conditions:",i)}}catch(i){console.error("Error loading condition types:",i)}}),(i,o)=>{const t=T("v-autocomplete");return p(s).isModalOpen?(_(),v("div",{key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:o[2]||(o[2]=N(e=>p(s).closeModal(),["self"]))},[r("div",U,[r("div",D,[o[3]||(o[3]=r("h2",{class:"text-xl font-bold"},"Vendor Services",-1)),r("button",{onClick:o[0]||(o[0]=e=>p(s).closeModal()),class:"text-gray-500 hover:text-gray-700 text-2xl leading-none"}," âœ• ")]),p(s).loading?(_(),v("div",q,o[4]||(o[4]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),r("p",{class:"mt-2 text-gray-600"},"Loading...",-1)]))):(_(),v(k,{key:1},[r("div",G,[R(t,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),label:"Select Service",items:p(u).services,"item-title":"service_name","item-value":"id",dense:"",clearable:"",class:"w-full"},null,8,["modelValue","items"])]),r("div",H,[r("button",{onClick:m,disabled:!c.value,class:"bg-blue-600 text-white px-4 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap"}," Assign ",8,J)]),p(s).vendorServices.length===0?(_(),v("div",K," No services assigned yet ")):E("",!0),(_(!0),v(k,null,M(p(s).vendorServices,e=>(_(),v("div",{key:e.id,class:"border rounded mb-6 p-4"},[r("div",Q,[r("h3",W,g(e.service.service_name),1),r("button",{onClick:a=>C(e.id),class:"text-red-600 text-sm hover:text-red-800"}," Remove ",8,X)]),r("div",Y,[r("table",Z,[o[5]||(o[5]=r("thead",null,[r("tr",{class:"bg-gray-100"},[r("th",{class:"p-2 text-left"},"Condition"),r("th",{class:"p-2 text-center"},"Rate Type"),r("th",{class:"p-2 text-center"},"Value"),r("th",{class:"p-2 text-center"},"Override"),r("th",{class:"p-2 text-center"},"Action")])],-1)),r("tbody",null,[(_(!0),v(k,null,M(w(e.service_id),a=>{var n,h,F;return _(),v("tr",{key:a.id,class:"border-t hover:bg-gray-50"},[r("td",I,g(a.condition_type.name),1),r("td",ee,g(a.rate_type),1),r("td",te,g(a.value),1),r("td",re,[r("input",{type:"number",step:"0.01",value:((n=x(e,a.id))==null?void 0:n.custom_rate)??((F=(h=p(s).overrides[e.id])==null?void 0:h[a.id])==null?void 0:F.custom_rate),onInput:$=>V(e.id,a.id,"custom_rate",$.target.value),class:"border p-1 w-24 rounded text-center",placeholder:"custom rate"},null,40,se)]),r("td",oe,[r("button",{onClick:$=>O(e.id,a.id),class:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700"},g(x(e,a.id)?"Update":"Save"),9,ae)])])}),128))])])])]))),128))],64))])])):E("",!0)}}},ue=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{ue as V,ie as _,P as u};
