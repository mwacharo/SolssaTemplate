import{E as ue,r as A,j as U,i as F,k as We,s as be,l as y,c as O,o as z,w as s,b as o,a as _,f as h,t as R,e as Q,p as Je,q as Ke,d as X,F as Pe,g as xe}from"./app-CNFlxoFw.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Xe=ue("permissions",()=>{const i=A([]),g=A(!1),d=A(null),p=A([]),w="/api/v1/admin",V=U(()=>i.value.length),$=U(()=>u=>i.value.find(a=>a&&a.id===u)),E=U(()=>u=>u?i.value.filter(a=>a&&a.name&&a.name.toLowerCase().includes(u.toLowerCase())||a&&a.description&&a.description.toLowerCase().includes(u.toLowerCase())):i.value),S=async()=>{var u,a;try{g.value=!0,d.value=null;const m=await F.get(`${w}/permissions`);return i.value=m.data.data||m.data||[],m.data}catch(m){throw d.value=((a=(u=m.response)==null?void 0:u.data)==null?void 0:a.message)||m.message,console.error("Error fetching permissions:",m),m}finally{g.value=!1}},N=async u=>{var a,m;try{g.value=!0,d.value=null;const c=await F.post(`${w}/permissions`,u),x=c.data.data||c.data;return x&&x.id&&i.value.push(x),x}catch(c){throw d.value=((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.message)||c.message,console.error("Error creating permission:",c),c}finally{g.value=!1}},j=async(u,a)=>{var m,c;try{g.value=!0,d.value=null;const x=await F.put(`${w}/permissions/${u}`,a),b=x.data.data||x.data;if(b&&b.id){const I=i.value.findIndex(r=>r&&r.id===u);I!==-1&&(i.value[I]=b)}return b}catch(x){throw d.value=((c=(m=x.response)==null?void 0:m.data)==null?void 0:c.message)||x.message,console.error("Error updating permission:",x),x}finally{g.value=!1}},C=async u=>{var a,m;try{return g.value=!0,d.value=null,await F.delete(`${w}/permissions/${u}`),i.value=i.value.filter(c=>c&&c.id!==u),!0}catch(c){throw d.value=((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.message)||c.message,console.error("Error deleting permission:",c),c}finally{g.value=!1}},M=async(u,a,m=!0)=>{var c,x;try{g.value=!0,d.value=null;const b=m?"assign-permission":"remove-permission",I=await F.post(`${w}/users/${u}/${b}`,{permission_id:a});if(console.log("[DEBUG] User Permissions API Response:",JSON.stringify(I.data,null,2)),m){if(Array.isArray(p.value)||(p.value=[]),!p.value.find(n=>n&&n.id===a||n&&n.name===a)){const n=i.value.find(f=>f&&f.id===a||f&&f.name===a);n&&p.value.push(n)}}else p.value=p.value.filter(r=>r&&r.id!==a&&r.name!==a);return I.data}catch(b){throw d.value=((x=(c=b.response)==null?void 0:c.data)==null?void 0:x.message)||b.message,console.error(`Error ${m?"assigning":"removing"} permission:`,b),b}finally{g.value=!1}};return{userDirectPermissions:p,permissions:i,loading:g,error:d,permissionsCount:V,getPermissionById:$,searchPermissions:E,fetchUserDirectPermissions:async u=>{var a,m;try{g.value=!0,d.value=null;const c=await F.get(`${w}/users/${u}/permissions`);return p.value=c.data.data||c.data||[],console.log("[DEBUG] userDirectPermissions:",JSON.stringify(p.value,null,2)),p.value}catch(c){throw d.value=((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.message)||c.message,console.error("Error fetching user direct permissions:",c),c}finally{g.value=!1}},fetchPermissions:S,createPermission:N,updatePermission:j,deletePermission:C,assignPermissionToUser:M,removePermissionFromUser:async(u,a)=>M(u,a,!1),resetState:()=>{i.value=[],p.value=[],g.value=!1,d.value=null},clearError:()=>{d.value=null}}}),Ye=ue("roles",()=>{const i=A([]),g=A(!1),d=A(null),p="/api/v1/admin",w=U(()=>i.value.filter(r=>r.active)),V=U(()=>i.value.length),$=U(()=>i.value.reduce((r,n)=>r+(n.users_count||0),0)),E=U(()=>r=>i.value.find(n=>n.id===r)),S=U(()=>r=>r?i.value.filter(n=>n.name.toLowerCase().includes(r.toLowerCase())||n.description.toLowerCase().includes(r.toLowerCase())):i.value),N=U(()=>i.value.map(r=>r.name)),j=r=>{var n;return(n=i.value.find(f=>f.id===r))==null?void 0:n.name},C=r=>{var f,P;const n=((P=(f=r.response)==null?void 0:f.data)==null?void 0:P.message)||r.message||"An error occurred";return d.value=n,console.error("API Error:",r),n},M=async()=>{try{g.value=!0,d.value=null;const r=await F.get(`${p}/roles`);return i.value=r.data.data||r.data,i.value}catch(r){throw C(r),r}finally{g.value=!1}},G=async r=>{try{g.value=!0,d.value=null;const n=await F.post(`${p}/roles`,r),f=n.data.data||n.data;return i.value.push(f),f}catch(n){throw C(n),n}finally{g.value=!1}},B=async(r,n)=>{try{g.value=!0,d.value=null;const f=await F.put(`${p}/roles/${r}`,n),P=f.data.data||f.data,H=i.value.findIndex(Z=>Z.id===r);return H!==-1&&(i.value[H]=P),P}catch(f){throw C(f),f}finally{g.value=!1}};return{roles:i,loading:g,error:d,activeRoles:w,rolesCount:V,totalUsers:$,getRoleById:E,searchRoles:S,roleNames:N,getRoleName:j,fetchRoles:M,createRole:G,updateRole:B,deleteRole:async r=>{var n;try{return g.value=!0,d.value=null,await F.delete(`${p}/roles/${r}`),i.value=i.value.filter(f=>f.id!==r),!0}catch(f){const P=C(f);throw((n=f.response)==null?void 0:n.status)===422||P.includes("users")?new Error("Cannot delete role with assigned users"):f}finally{g.value=!1}},toggleRoleStatus:async r=>{try{const n=E.value(r);n&&await B(r,{active:!n.active})}catch(n){throw C(n),n}},duplicateRole:async r=>{try{const n=E.value(r);if(n){const f={name:`${n.name} (Copy)`,description:n.description,permissions:[...n.permissions||[]],color:n.color,icon:n.icon,active:!0};return await G(f)}}catch(n){throw C(n),n}},assignRoleToUser:async(r,n)=>{try{g.value=!0,d.value=null;const f=await F.post(`${p}/users/${r}/assign-role`,{role_id:n}),P=E.value(n);return P&&(P.users_count=(P.users_count||0)+1),f.data}catch(f){throw C(f),f}finally{g.value=!1}},removeRoleFromUser:async(r,n)=>{try{g.value=!0,d.value=null;const f=await F.post(`${p}/users/${r}/remove-role`,{role_id:n}),P=E.value(n);return P&&P.users_count>0&&(P.users_count=P.users_count-1),f.data}catch(f){throw C(f),f}finally{g.value=!1}},fetchRolesWithUsers:async()=>{try{g.value=!0,d.value=null;const r=await F.get(`${p}/roles?with_users=true`);return i.value=r.data.data||r.data,i.value}catch(r){throw C(r),r}finally{g.value=!1}},bulkUpdateRoles:async r=>{try{g.value=!0,d.value=null;const n=r.map(({id:P,data:H})=>F.put(`${p}/roles/${P}`,H)),f=await Promise.all(n);return f.forEach((P,H)=>{const Z=P.data.data||P.data,W=i.value.findIndex(ae=>ae.id===r[H].id);W!==-1&&(i.value[W]=Z)}),f.map(P=>P.data)}catch(n){throw C(n),n}finally{g.value=!1}},init:async()=>{try{await M()}catch(r){console.warn("Failed to initialize roles store:",r)}},clearStore:()=>{i.value=[],d.value=null,g.value=!1}}}),Ze=ue("audit",()=>{const i=A([]),g=A(!1),d=A(null),p=A({action:null,startDate:null,endDate:null}),w=U(()=>{const u=new Date(Date.now()-864e5);return i.value.filter(a=>new Date(a.timestamp)>u).length}),V=U(()=>u=>({"Created Role":"success","Updated Role":"info","Deleted Role":"error","Created User":"success","Updated User":"info","Deleted User":"error","Created Permission":"success","Updated Permission":"warning","Deleted Permission":"error","Role Created":"success","Role Updated":"info","Role Deleted":"error","Permission Updated":"warning","User Assigned":"primary","User Suspended":"error"})[u]||"grey"),$=U(()=>u=>({"Created Role":"mdi-plus-circle","Updated Role":"mdi-pencil-circle","Deleted Role":"mdi-delete-circle","Created User":"mdi-account-plus","Updated User":"mdi-account-edit","Deleted User":"mdi-account-remove","Created Permission":"mdi-key-plus","Updated Permission":"mdi-key-change","Deleted Permission":"mdi-key-remove","Role Created":"mdi-plus-circle","Role Updated":"mdi-pencil-circle","Role Deleted":"mdi-delete-circle","Permission Updated":"mdi-key-change","User Assigned":"mdi-account-plus","User Suspended":"mdi-account-cancel"})[u]||"mdi-information"),E=U(()=>{let u=[...i.value];if(p.value.action&&(u=u.filter(a=>a.action===p.value.action)),p.value.startDate&&p.value.endDate){const a=new Date(p.value.startDate),m=new Date(p.value.endDate);u=u.filter(c=>{const x=new Date(c.timestamp);return x>=a&&x<=m})}return u.sort((a,m)=>new Date(m.timestamp)-new Date(a.timestamp))}),S=U(()=>[...new Set(i.value.map(a=>a.action))].sort()),N=async(u={})=>{try{g.value=!0,d.value=null;const a=new URLSearchParams,m={...p.value,...u};m.action&&a.append("action",m.action),m.startDate&&a.append("start_date",m.startDate),m.endDate&&a.append("end_date",m.endDate);const c=a.toString(),x=`/api/v1/admin/audit-logs${c?`?${c}`:""}`,b=await fetch(x,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!b.ok)throw new Error(`Failed to fetch audit logs: ${b.statusText}`);const I=await b.json();i.value=I}catch(a){throw d.value=a.message,console.error("Error fetching audit logs:",a),a}finally{g.value=!1}},j=u=>{p.value={...p.value,...u}},C=()=>{p.value={action:null,startDate:null,endDate:null}},M=async()=>{await N()};return{auditLogs:i,loading:g,error:d,filters:p,recentChangesCount:w,getAuditColor:V,getAuditIcon:$,filteredAuditLogs:E,uniqueActions:S,fetchAuditLogs:N,setFilters:j,clearFilters:C,refreshLogs:M,logAction:async(u,a,m={})=>{try{console.warn("logAction is deprecated. Backend actions should be logged automatically via Spatie Activity Log"),await M()}catch(c){throw d.value=c.message,c}},getLogsByDateRange:(u,a)=>i.value.filter(m=>{const c=new Date(m.timestamp);return c>=new Date(u)&&c<=new Date(a)}),getLogsByAction:u=>i.value.filter(a=>a.action===u),getLogsByUser:u=>i.value.filter(a=>a.user.name===u)}}),et={class:"d-flex align-center"},tt={class:"text-h6 font-weight-bold"},st={class:"text-body-2 opacity-80"},at={class:"pa-6"},ot={class:"d-flex align-center mb-3"},rt={class:"font-weight-medium"},nt={class:"text-caption text-medium-emphasis"},lt={class:"text-body-2 mb-3"},it={class:"text-subtitle-2 font-weight-medium mb-2"},ut={key:0,class:"text-center py-4 text-medium-emphasis"},dt={class:"mb-4"},ct={class:"d-flex align-center"},mt={class:"font-weight-medium"},vt={class:"text-body-2"},pt={class:"d-flex align-center gap-1"},ft={key:0},_t={key:1},gt={class:"text-center py-8"},yt={class:"d-flex align-center justify-space-between mb-2"},ht={class:"d-flex align-center"},wt={class:"text-body-2 font-weight-medium"},bt={class:"text-caption text-medium-emphasis"},Pt={class:"d-flex align-center justify-space-between"},xt={class:"d-flex align-center"},Ut={class:"text-caption"},Dt={key:1,class:"text-center py-8"},Rt={__name:"UserPermissionDialog",props:{modelValue:Boolean,user:{type:Object,default:()=>({})}},emits:["update:modelValue","save","error"],setup(i,{emit:g}){const d=i,p=g,w=Xe(),V=Ye(),$=Ze(),E=A("roles"),S=A(null),N=A(""),j=A(""),C=A(!1),M=A(!1),G=A([{title:"Permission Name",key:"name",align:"start",sortable:!0,width:"35%"},{title:"Description",key:"description",align:"start",sortable:!1,width:"45%"},{title:"Has Permission",key:"hasPermission",align:"center",sortable:!1,width:"20%"}]),B=t=>t?(t==null?void 0:t.id)||(t==null?void 0:t.name)||t:null,Y=t=>({"Role Changed":"info",role_changed:"info","Permission Granted":"success",permission_granted:"success","Permission Revoked":"warning",permission_revoked:"warning","User Created":"primary",user_created:"primary","User Updated":"info",user_updated:"info","User Suspended":"error",user_suspended:"error"})[t]||"grey",se=t=>({"Role Changed":"mdi-account-switch",role_changed:"mdi-account-switch","Permission Granted":"mdi-key-plus",permission_granted:"mdi-key-plus","Permission Revoked":"mdi-key-minus",permission_revoked:"mdi-key-minus","User Created":"mdi-account-plus",user_created:"mdi-account-plus","User Updated":"mdi-account-edit",user_updated:"mdi-account-edit","User Suspended":"mdi-account-cancel",user_suspended:"mdi-account-cancel"})[t]||"mdi-information",u=(t,e)=>{console.error(e,t),p("error",e)},a=U(()=>w.loading||V.loading||$.loading),m=U(()=>w.error||V.error||$.error),c=U(()=>Array.isArray(V.roles)?V.roles:[]),x=U(()=>{var t,e,v;return((t=d.user)==null?void 0:t.role_id)||((v=(e=d.user)==null?void 0:e.role)==null?void 0:v.id)||null}),b=U(()=>!S.value||!c.value.length?null:c.value.find(t=>t.id===S.value)||null),I=U(()=>{var t;return(t=b.value)!=null&&t.permissions?Array.isArray(b.value.permissions)?b.value.permissions:[]:[]}),r=U(()=>Array.isArray(w.permissions)?w.permissions:[]),n=U(()=>{const t=I.value||[],e=Array.isArray(w.userDirectPermissions)?w.userDirectPermissions:[];return[...t,...e].filter((k,L,D)=>{if(!k)return!1;const q=B(k);return q?D.findIndex(J=>J&&B(J)===q)===L:!1})}),f=U(()=>{if(!j.value)return r.value;const t=j.value.toLowerCase();return r.value.filter(e=>{if(!e)return!1;const v=e.name||"",k=e.description||"";return v.toLowerCase().includes(t)||k.toLowerCase().includes(t)})}),P=U(()=>Array.isArray($.auditLogs)?$.auditLogs.filter(t=>{var e,v;return t&&(t.auditable_id===((e=d.user)==null?void 0:e.id)||t.subject_id===((v=d.user)==null?void 0:v.id))})||[]:[]),H=U(()=>!0),Z=U(()=>S.value!==x.value||M.value),W=()=>{C.value||(p("update:modelValue",!1),ae())},ae=()=>{E.value="roles",S.value=x.value,N.value="",j.value="",M.value=!1,de()},de=()=>{w.clearError&&w.clearError(),V.clearError&&V.clearError(),$.clearError&&$.clearError()},Ue=async()=>{var t;if(!((t=d.user)!=null&&t.id)||!S.value){p("error","User ID and role selection are required");return}try{C.value=!0;const e=await axios.post(`/api/v1/admin/users/${d.user.id}/assign-role`,{role_id:S.value});p("save",e.data),W()}catch(e){u(e,"Error saving user permissions")}finally{C.value=!1}},De=t=>{var k,L;const e=c.value.find(D=>D.id===x.value),v=c.value.find(D=>D.id===t);if(e&&v){const D=((k=e.permissions)==null?void 0:k.length)||0,q=((L=v.permissions)==null?void 0:L.length)||0;D!==q?N.value=`This role change will ${q<D?"reduce":"grant additional"} permissions from ${D} to ${q}.${q<D?" Some access may be revoked.":""}`:N.value=""}},re=t=>{if(!t)return!1;const e=B(t);return e?n.value.some(v=>v&&B(v)===e):!1},ne=t=>{if(!t)return!1;const e=B(t);return e?I.value.some(v=>v&&B(v)===e):!1},Re=t=>{if(!t)return!1;const e=B(t);return e?(Array.isArray(w.userDirectPermissions)?w.userDirectPermissions:[]).some(k=>k&&B(k)===e):!1},Ce=()=>{var t;return((t=b.value)==null?void 0:t.icon)||"mdi-account"},ke=t=>{if(!t)return"Unknown";try{return new Date(t).toLocaleString()}catch{return"Invalid Date"}},ce=t=>t?(typeof t=="string"?t:t.name||"Unknown Permission").replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()):"Unknown Permission",Ae=t=>{console.log("View change details:",t)},$e=async(t,e)=>{var L;if(!((L=d.user)!=null&&L.id)||!t){p("error","User ID and permission are required");return}if(ne(t)){p("error","Cannot modify role-based permissions. Change user role instead.");return}const v=B(t);if(!v){p("error","Invalid permission data");return}const k=Re(t);try{if(await w.assignPermissionToUser(d.user.id,v,!k),$.logPermissionChange)try{await $.logPermissionChange({user_id:d.user.id,permission_id:v,action:k?"permission_revoked":"permission_granted",description:`Direct permission ${k?"revoked from":"granted to"} user`})}catch(D){console.warn("Failed to log permission change:",D)}M.value=!0,p("save",{type:"permission_change",user:d.user,permission:t})}catch(D){u(D,`Failed to ${k?"revoke":"grant"} permission`)}};return We(async()=>{try{const t=[];V.fetchRoles&&t.push(V.fetchRoles()),w.fetchPermissions&&t.push(w.fetchPermissions()),await Promise.all(t)}catch(t){u(t,"Failed to load roles and permissions")}}),be(()=>d.user,async t=>{if(t!=null&&t.id){S.value=x.value;try{w.fetchUserDirectPermissions&&await w.fetchUserDirectPermissions(t.id)}catch(e){console.error("Error loading user direct permissions:",e)}}else S.value=null,w.userDirectPermissions=[]},{immediate:!0}),be(()=>d.modelValue,async t=>{var e;if(t&&((e=d.user)!=null&&e.id)){ae();const v=[];$.fetchAuditLogs&&v.push($.fetchAuditLogs({user_id:d.user.id})),w.fetchUserDirectPermissions&&v.push(w.fetchUserDirectPermissions(d.user.id)),(await Promise.allSettled(v)).forEach((L,D)=>{L.status==="rejected"&&console.error(`Error loading ${D===0?"audit logs":"direct permissions"}:`,L.reason)})}}),(t,e)=>{const v=y("v-icon"),k=y("v-img"),L=y("v-avatar"),D=y("v-btn"),q=y("v-card-title"),J=y("v-tab"),Se=y("v-tabs"),me=y("v-divider"),Ee=y("v-progress-circular"),Le=y("v-overlay"),ve=y("v-alert"),pe=y("v-list-item-title"),Ve=y("v-list-item-subtitle"),fe=y("v-list-item"),Be=y("v-select"),Ie=y("v-alert-title"),ee=y("v-card-text"),oe=y("v-card"),_e=y("v-col"),ge=y("v-checkbox"),ze=y("v-list"),Fe=y("v-row"),le=y("v-window-item"),Ne=y("v-text-field"),ie=y("v-chip"),je=y("v-data-table"),Me=y("v-timeline-item"),Te=y("v-timeline"),qe=y("v-window"),He=y("v-spacer"),Oe=y("v-card-actions"),Ge=y("v-dialog");return z(),O(Ge,{"model-value":i.modelValue,"onUpdate:modelValue":e[4]||(e[4]=l=>t.$emit("update:modelValue",l)),"max-width":"900px",persistent:"",scrollable:""},{default:s(()=>[o(oe,null,{default:s(()=>[o(q,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:s(()=>{var l,T;return[_("div",et,[o(L,{size:"40",class:"mr-3"},{default:s(()=>{var te,K;return[o(k,{src:((te=i.user)==null?void 0:te.avatar)||"/default-avatar.png",alt:((K=i.user)==null?void 0:K.name)||"User"},{placeholder:s(()=>[o(v,null,{default:s(()=>e[5]||(e[5]=[h("mdi-account")])),_:1,__:[5]})]),_:1},8,["src","alt"])]}),_:1}),_("div",null,[_("div",tt,R(((l=i.user)==null?void 0:l.name)||"Unknown User"),1),_("div",st,R(((T=i.user)==null?void 0:T.email)||"No email"),1)])]),o(D,{icon:"mdi-close",variant:"text",color:"white",onClick:W})]}),_:1}),o(ee,{class:"pa-0"},{default:s(()=>[o(Se,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),"bg-color":"transparent",class:"px-4 pt-2"},{default:s(()=>[o(J,{value:"roles"},{default:s(()=>[o(v,{start:""},{default:s(()=>e[6]||(e[6]=[h("mdi-account-group")])),_:1,__:[6]}),e[7]||(e[7]=h(" Current Roles "))]),_:1,__:[7]}),o(J,{value:"permissions"},{default:s(()=>[o(v,{start:""},{default:s(()=>e[8]||(e[8]=[h("mdi-key")])),_:1,__:[8]}),e[9]||(e[9]=h(" All Permissions "))]),_:1,__:[9]}),o(J,{value:"history"},{default:s(()=>[o(v,{start:""},{default:s(()=>e[10]||(e[10]=[h("mdi-history")])),_:1,__:[10]}),e[11]||(e[11]=h(" Change History "))]),_:1,__:[11]})]),_:1},8,["modelValue"]),o(me),o(Le,{"model-value":a.value,contained:"",class:"d-flex align-center justify-center"},{default:s(()=>[o(Ee,{indeterminate:"",size:"64",color:"primary"})]),_:1},8,["model-value"]),m.value?(z(),O(ve,{key:0,type:"error",variant:"tonal",closable:"",class:"ma-4","onClick:close":de},{default:s(()=>[h(R(m.value),1)]),_:1})):Q("",!0),_("div",at,[o(qe,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=l=>E.value=l)},{default:s(()=>[o(le,{value:"roles"},{default:s(()=>[e[19]||(e[19]=_("div",{class:"mb-4"},[_("h3",{class:"text-h6 font-weight-medium mb-2"},"Assigned Roles"),_("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Manage the roles assigned to this user ")],-1)),o(Fe,null,{default:s(()=>[o(_e,{cols:"12",md:"6"},{default:s(()=>[o(oe,{elevation:"1",class:"h-100"},{default:s(()=>[o(q,{class:"text-subtitle-1 font-weight-medium"},{default:s(()=>e[12]||(e[12]=[h(" Current Role Assignment ")])),_:1,__:[12]}),o(ee,null,{default:s(()=>[o(Be,{modelValue:S.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>S.value=l),De],items:c.value,"item-title":"name","item-value":"id",label:"Primary Role",variant:"outlined","prepend-icon":Ce(),loading:a.value,disabled:!H.value},{item:s(({props:l,item:T})=>[o(fe,Je(Ke(l)),{prepend:s(()=>[o(L,{color:T.raw.color||"primary",size:"32"},{default:s(()=>[o(v,{color:"white",size:"16"},{default:s(()=>[h(R(T.raw.icon||"mdi-account"),1)]),_:2},1024)]),_:2},1032,["color"])]),default:s(()=>[o(pe,null,{default:s(()=>[h(R(T.raw.name),1)]),_:2},1024),o(Ve,null,{default:s(()=>[h(R(T.raw.description||"No description"),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","prepend-icon","loading","disabled"]),N.value?(z(),O(ve,{key:0,type:"warning",variant:"tonal",class:"mt-3"},{default:s(()=>[o(Ie,null,{default:s(()=>e[13]||(e[13]=[h("Role Change Warning")])),_:1,__:[13]}),h(" "+R(N.value),1)]),_:1})):Q("",!0)]),_:1})]),_:1})]),_:1}),o(_e,{cols:"12",md:"6"},{default:s(()=>[o(oe,{elevation:"1",class:"h-100"},{default:s(()=>[o(q,{class:"text-subtitle-1 font-weight-medium"},{default:s(()=>e[14]||(e[14]=[h(" Role Information ")])),_:1,__:[14]}),b.value?(z(),O(ee,{key:0},{default:s(()=>[_("div",ot,[o(L,{color:b.value.color||"primary",size:"40",class:"mr-3"},{default:s(()=>[o(v,{color:"white"},{default:s(()=>[h(R(b.value.icon||"mdi-account"),1)]),_:1})]),_:1},8,["color"]),_("div",null,[_("div",rt,R(b.value.name),1),_("div",nt,R(b.value.users_count||0)+" users with this role ",1)])]),_("p",lt,R(b.value.description||"No description available"),1),_("div",null,[_("div",it," Included Permissions ("+R(I.value.length)+") ",1),o(ze,{density:"compact","max-height":"200",class:"overflow-y-auto"},{default:s(()=>[(z(!0),X(Pe,null,xe(I.value,l=>(z(),O(fe,{key:l.id||l.name,class:"px-0"},{prepend:s(()=>[o(ge,{"model-value":!0,disabled:!0,density:"compact","hide-details":"",color:"primary",class:"mr-2"})]),default:s(()=>[o(pe,null,{default:s(()=>[h(R(ce(l.name||l)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),I.value.length===0?(z(),X("div",ut,[o(v,null,{default:s(()=>e[15]||(e[15]=[h("mdi-key-off")])),_:1,__:[15]}),e[16]||(e[16]=_("div",{class:"text-caption"},"No permissions assigned",-1))])):Q("",!0)])]),_:1})):(z(),O(ee,{key:1,class:"text-center py-8 text-medium-emphasis"},{default:s(()=>[o(v,{size:"48"},{default:s(()=>e[17]||(e[17]=[h("mdi-account-question")])),_:1,__:[17]}),e[18]||(e[18]=_("div",{class:"text-body-2 mt-2"},"Select a role to view details",-1))]),_:1,__:[18]}))]),_:1})]),_:1})]),_:1})]),_:1,__:[19]}),o(le,{value:"permissions"},{default:s(()=>[e[25]||(e[25]=_("div",{class:"mb-4"},[_("h3",{class:"text-h6 font-weight-medium mb-2"},"User Permissions"),_("p",{class:"text-body-2 text-medium-emphasis"}," Manage user permissions by checking or unchecking the boxes below ")],-1)),_("div",dt,[o(Ne,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=l=>j.value=l),placeholder:"Search permissions...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{"max-width":"400px"}},null,8,["modelValue"])]),o(je,{headers:G.value,items:f.value,search:j.value,class:"elevation-1","item-key":"id",loading:a.value,"loading-text":"Loading permissions..."},{"item.name":s(({item:l})=>[_("div",ct,[o(v,{color:l.color||"primary",size:"small",class:"mr-2"},{default:s(()=>[h(R(l.icon||"mdi-key"),1)]),_:2},1032,["color"]),_("span",mt,R(ce(l.name)),1)])]),"item.description":s(({item:l})=>[_("span",vt,R(l.description||"No description available"),1)]),"item.hasPermission":s(({item:l})=>[o(ge,{"model-value":re(l),"onUpdate:modelValue":T=>$e(l,T),disabled:a.value||ne(l),color:"success","hide-details":""},{label:s(()=>[_("div",pt,[ne(l)&&re(l)?(z(),X("span",ft,[o(ie,{size:"x-small",color:"info",variant:"outlined"},{default:s(()=>e[20]||(e[20]=[h(" From Role ")])),_:1,__:[20]})])):re(l)?(z(),X("span",_t,[o(ie,{size:"x-small",color:"success",variant:"outlined"},{default:s(()=>e[21]||(e[21]=[h(" Direct ")])),_:1,__:[21]})])):Q("",!0)])]),_:2},1032,["model-value","onUpdate:modelValue","disabled"])]),"no-data":s(()=>[_("div",gt,[o(v,{size:"48",color:"grey-lighten-2"},{default:s(()=>e[22]||(e[22]=[h("mdi-database-off")])),_:1,__:[22]}),e[23]||(e[23]=_("div",{class:"text-h6 mt-2 text-medium-emphasis"},"No Permissions Found",-1)),e[24]||(e[24]=_("div",{class:"text-body-2 text-medium-emphasis"}," No permissions match your search criteria ",-1))])]),_:1},8,["headers","items","search","loading"])]),_:1,__:[25]}),o(le,{value:"history"},{default:s(()=>[e[31]||(e[31]=_("div",{class:"mb-4"},[_("h3",{class:"text-h6 font-weight-medium mb-2"},"Permission Change History"),_("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Track all role and permission changes for this user ")],-1)),P.value.length>0?(z(),O(Te,{key:0,side:"end",density:"compact"},{default:s(()=>[(z(!0),X(Pe,null,xe(P.value,l=>(z(),O(Me,{key:l.id,"dot-color":Y(l.action||l.type),size:"small"},{icon:s(()=>[o(v,{size:"12"},{default:s(()=>[h(R(se(l.action||l.type)),1)]),_:2},1024)]),default:s(()=>[o(oe,{elevation:"1",class:"mb-3"},{default:s(()=>[o(ee,{class:"py-3"},{default:s(()=>{var T,te;return[_("div",yt,[_("div",ht,[o(ie,{color:Y(l.action||l.type),size:"x-small",variant:"tonal",class:"mr-2"},{default:s(()=>[h(R(l.action||l.type),1)]),_:2},1032,["color"]),_("span",wt,R(l.description||`${l.action} performed`),1)]),_("span",bt,R(ke(l.created_at||l.timestamp)),1)]),_("div",Pt,[_("div",xt,[e[27]||(e[27]=_("span",{class:"text-caption text-medium-emphasis"},"Changed by:",-1)),o(L,{size:"20",class:"mx-2"},{default:s(()=>{var K,ye,he,we;return[o(k,{src:((K=l.user)==null?void 0:K.avatar)||((ye=l.changedBy)==null?void 0:ye.avatar)||"/default-avatar.png",alt:((he=l.user)==null?void 0:he.name)||((we=l.changedBy)==null?void 0:we.name)||"System"},{placeholder:s(()=>[o(v,{size:"12"},{default:s(()=>e[26]||(e[26]=[h("mdi-account")])),_:1,__:[26]})]),_:2},1032,["src","alt"])]}),_:2},1024),_("span",Ut,R(((T=l.user)==null?void 0:T.name)||((te=l.changedBy)==null?void 0:te.name)||"System"),1)]),o(D,{variant:"text",size:"x-small",onClick:K=>Ae(l)},{default:s(()=>e[28]||(e[28]=[h(" Details ")])),_:2,__:[28]},1032,["onClick"])])]}),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1})):Q("",!0),P.value.length===0?(z(),X("div",Dt,[o(v,{size:"48",color:"medium-emphasis"},{default:s(()=>e[29]||(e[29]=[h("mdi-history")])),_:1,__:[29]}),e[30]||(e[30]=_("div",{class:"text-body-1 text-medium-emphasis mt-2"}," No permission changes recorded for this user ",-1))])):Q("",!0)]),_:1,__:[31]})]),_:1},8,["modelValue"])])]),_:1}),o(me),o(Oe,{class:"pa-4"},{default:s(()=>[o(He),o(D,{variant:"outlined",onClick:W,disabled:C.value},{default:s(()=>e[32]||(e[32]=[h(" Cancel ")])),_:1,__:[32]},8,["disabled"]),o(D,{color:"primary",onClick:Ue,loading:C.value,disabled:!Z.value},{default:s(()=>e[33]||(e[33]=[h(" Save Changes ")])),_:1,__:[33]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ct=Qe(Rt,[["__scopeId","data-v-b8d51a31"]]),$t=Object.freeze(Object.defineProperty({__proto__:null,default:Ct},Symbol.toStringTag,{value:"Module"}));export{Ct as U,Ye as a,Ze as b,$t as c,Xe as u};
