import{E,r as c,i as b,j as k,k as M,l as A,d as u,e as F,u as p,o as y,a as t,F as C,b as j,g as $,y as T,t as w}from"./app-OPKBOKwT.js";import{u as N}from"./servicesStore-DcSZL5Yt.js";import{u as R}from"./condition-Dc6sGMKL.js";import{u as B}from"./conditionTypeStore-BqP5UQ7V.js";const z=E("vendorServices",()=>{const x=c(!1),s=c(null),d=c([]),_=c([]),l=c({}),f=c(!1),v=async e=>{s.value=e,x.value=!0,await m(e)},S=()=>{x.value=!1,s.value=null,d.value=[],l.value={}},m=async e=>{if(e){f.value=!0;try{const r=await b.get(`/api/v1/vendors/${e}/services`);d.value=r.data,d.value.forEach(i=>{l.value[i.id]={},i.service.conditions.forEach(n=>{l.value[i.id][n.id]={custom_rate:n.custom_rate||null,rate_type:n.custom_rate_type||n.rate_type}})})}catch(r){throw console.error("Failed to load vendor services:",r),r}finally{f.value=!1}}};return{isModalOpen:x,selectedVendorId:s,vendorServices:d,availableServices:_,overrides:l,loading:f,openModal:v,closeModal:S,loadVendorServices:m,loadAvailableServices:async()=>{try{const e=await b.get("/api/v1/services");_.value=e.data}catch(e){throw console.error("Failed to load services:",e),e}},assignService:async e=>{if(!(!e||!s.value))try{return await b.post(`/api/v1/vendors/${s.value}/services`,{service_id:e,vendor_id:s.value}),await m(s.value),!0}catch(r){throw console.error("Failed to assign service:",r),r}},removeService:async e=>{if(s.value)try{return await b.delete(`/api/v1/vendors/${s.value}/services/${e}`),await m(s.value),!0}catch(r){throw console.error("Failed to remove service:",r),r}},saveOverride:async(e,r)=>{var n;const i=(n=l.value[e])==null?void 0:n[r];if(!i||i.custom_rate===null||i.custom_rate==="")throw new Error("Please enter a rate");try{return await b.post(`/api/v1/vendors/${s.value}/services/${e}/rates`,{service_condition_id:r,custom_rate:i.custom_rate,rate_type:i.rate_type}),!0}catch(g){throw console.error("Failed to save override:",g),g}},updateOverride:(e,r,i,n)=>{l.value[e]||(l.value[e]={}),l.value[e][r]||(l.value[e][r]={custom_rate:null,rate_type:"fixed"}),l.value[e][r][i]=n}}}),L={class:"bg-white w-4/5 max-h-[90vh] overflow-auto rounded p-6"},P={class:"flex justify-between mb-4"},D={key:0,class:"text-center py-8"},U={class:"flex gap-2 mb-6"},q={class:"flex gap-2 mb-6"},G=["disabled"],H={key:0,class:"text-center py-8 text-gray-500"},J={class:"flex justify-between mb-3"},K={class:"font-semibold text-lg"},Q=["onClick"],W={class:"overflow-x-auto"},X={class:"w-full text-sm"},Y={class:"p-2"},Z={class:"p-2 text-center"},I={class:"text-gray-500 text-xs ml-1"},ee={class:"p-2 text-center"},te={class:"text-gray-500 text-xs ml-1"},re={class:"p-2"},se=["value","onInput"],oe={class:"p-2 text-center"},ae=["onClick"],le={__name:"VendorServices",setup(x){const s=z(),d=N(),_=R(),l=B(),f=k(()=>_.conditions);k(()=>d.services),k(()=>l.conditionTypes);const v=c("");c(""),c(""),c("");const S=async()=>{if(v.value)try{await s.assignService(v.value),v.value="",alert("Service assigned successfully!")}catch{alert("Failed to assign service")}},m=async a=>{if(confirm("Are you sure you want to remove this service?"))try{await s.removeService(a),alert("Service removed successfully!")}catch{alert("Failed to remove service")}},V=(a,o,h,e)=>{s.updateOverride(a,o,h,e)},O=async(a,o)=>{try{await s.saveOverride(a,o),alert("Rate override saved successfully!")}catch(h){alert(h.message||"Failed to save rate override")}};return M(async()=>{try{await d.fetchServices()}catch(a){console.error("Error loading services:",a)}try{await s.fetchVendorServices()}catch(a){console.error("Error loading vendor services:",a)}try{await l.fetchAll(),console.log("Condition types loaded:",l.conditionTypes);try{await _.fetchConditions(),console.log("Conditions loaded:",_.conditions)}catch(a){console.error("Error loading conditions:",a)}}catch(a){console.error("Error loading condition types:",a)}}),(a,o)=>{const h=A("v-autocomplete");return p(s).isModalOpen?(y(),u("div",{key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:o[2]||(o[2]=T(e=>p(s).closeModal(),["self"]))},[t("div",L,[t("div",P,[o[3]||(o[3]=t("h2",{class:"text-xl font-bold"},"Vendor Services",-1)),t("button",{onClick:o[0]||(o[0]=e=>p(s).closeModal()),class:"text-gray-500 hover:text-gray-700 text-2xl leading-none"}," âœ• ")]),p(s).loading?(y(),u("div",D,o[4]||(o[4]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Loading...",-1)]))):(y(),u(C,{key:1},[t("div",U,[j(h,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=e=>v.value=e),label:"Select Service",items:p(d).services,"item-title":"service_name","item-value":"id",dense:"",clearable:"",class:"w-full"},null,8,["modelValue","items"])]),t("div",q,[t("button",{onClick:S,disabled:!v.value,class:"bg-blue-600 text-white px-4 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap"}," Assign ",8,G)]),p(s).vendorServices.length===0?(y(),u("div",H," No services assigned yet ")):F("",!0),(y(!0),u(C,null,$(p(s).vendorServices,e=>(y(),u("div",{key:e.id,class:"border rounded mb-6 p-4"},[t("div",J,[t("h3",K,w(e.service.service_name),1),t("button",{onClick:r=>m(e.id),class:"text-red-600 text-sm hover:text-red-800"}," Remove ",8,Q)]),t("div",W,[t("table",X,[o[5]||(o[5]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2 text-left"},"Condition"),t("th",{class:"p-2 text-center"},"Rate Type"),t("th",{class:"p-2 text-center"},"Value"),t("th",{class:"p-2 text-center"},"Override"),t("th",{class:"p-2 text-center"},"Action")])],-1)),t("tbody",null,[(y(!0),u(C,null,$(f.value,r=>{var i,n;return y(),u("tr",{key:r.id,class:"border-t hover:bg-gray-50"},[t("td",Y,w(r.condition_type.name),1),t("td",Z,[t("span",I," ("+w(r.rate_type)+") ",1)]),t("td",ee,[t("span",te," ("+w(r.value)+") ",1)]),t("td",re,[t("input",{type:"number",step:"0.01",value:(n=(i=p(s).overrides[e.id])==null?void 0:i[r.id])==null?void 0:n.custom_rate,onInput:g=>V(e.id,r.id,"custom_rate",g.target.value),class:"border p-1 w-24 rounded text-center",placeholder:"override value"},null,40,se)]),t("td",oe,[t("button",{onClick:g=>O(e.id,r.id),class:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700"}," Save ",8,ae)])])}),128))])])])]))),128))],64))])])):F("",!0)}}},ve=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{ve as V,le as _,z as u};
