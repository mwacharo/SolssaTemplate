import{E as xe,r as s,P as $e,j as y,i as n}from"./app-C_yBjHfN.js";const Ue=xe("orders",()=>{const p=s(""),g=s(""),E=$e({deliveryPerson:"",callCentreAgent:"",status:"",notes:"",zone:"",city:""}),u=s([]),i=s({orders:!1,options:!1,creating:!1,updating:!1,deleting:!1}),d=s(null),Y=s([]),z=s(!1),f=s(!1),h=s(null),w=s(null),P=s(!1),S=s(!1),_=s(null),O=s(null),A=s(null),F=s(null),C=s(null),D=s(null),b=s(null),m=s(null),v=s([]),R=s(""),ee=s([]),L=s([]),U=s([]),q=s([]),M=s([]),V=s([]),Z=s([]),G=s([]),H=s([]),I=s([]),J=s([]),ae=s([]),te=s([]),K=s([]),T=s({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),se=y(()=>e=>u.value.find(a=>a.id===e)),le=y(()=>u.value.filter(e=>e.status===1)),oe=y(()=>u.value.filter(e=>e.status===0)),re=y(()=>u.value.filter(e=>e.status===2)),ne=y(()=>u.value.reduce((e,a)=>e+parseFloat(a.total_price||0),0)),ie=y(()=>{let e=0;return _.value&&e++,O.value&&e++,A.value&&e++,F.value&&e++,C.value&&e++,D.value&&e++,b.value&&e++,m.value&&e++,v.value&&v.value.length>0&&e++,R.value&&e++,e}),ce=y(()=>({status:_.value,product:O.value,zone:A.value,agent:F.value,rider:C.value,vendor:D.value,city:b.value,category:m.value,dateRange:v.value,search:R.value})),B=async(e={})=>{var a,l;i.value.orders=!0,d.value=null;try{const t=new URLSearchParams;e.page&&t.append("page",e.page),e.per_page&&t.append("per_page",e.per_page),e.status&&t.append("status",e.status),e.vendor_id&&t.append("vendor_id",e.vendor_id),e.city&&t.append("city",e.city),e.agent_id&&t.append("agent_id",e.agent_id),e.rider_id&&t.append("rider_id",e.rider_id),e.zone_id&&t.append("zone_id",e.zone_id),e.product_id&&t.append("product_id",e.product_id),e.category_id&&t.append("category_id",e.category_id),e.search&&t.append("search",e.search),e.created_from&&t.append("created_from",e.created_from),e.created_to&&t.append("created_to",e.created_to);const r=(await n.get(`/api/v1/orders?${t.toString()}`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!r.success)throw new Error(r.message||"Failed to fetch orders");S.value=!1;const c=r.data;return u.value=c.data||[],T.value={current_page:c.current_page||1,last_page:c.last_page||1,per_page:c.per_page||15,total:c.total||0,from:c.from||0,to:c.to||0},c}catch(t){throw d.value=((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||t.message||"Failed to fetch orders",t}finally{i.value.orders=!1}},k=s([]),ue=async e=>{var a,l;if(!(!e||e.length===0))try{const t=await n.post("/api/v1/bulk-print-waybills",{order_ids:e},{headers:{Accept:"application/json","Content-Type":"application/json"},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=o,r.setAttribute("download","waybills.pdf"),document.body.appendChild(r),r.click(),r.remove()}catch(t){throw d.value=((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||t.message||"Failed to print waybill",t}},N=async e=>{i.value.orders=!0,d.value=null;try{const a=await Q(e);return w.value=a,h.value=e,a}catch(a){throw d.value=a.message||"Failed to load order",a}finally{i.value.orders=!1}},de=async e=>{var a,l;i.value.creating=!0,d.value=null;try{const o=(await n.post("/api/v1/orders",e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to create order");return u.value.unshift(o.data),T.value.total+=1,o.data}catch(t){throw d.value=((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||t.message||"Failed to create order",t}finally{i.value.creating=!1}},x=async(e,a)=>{var l,t;i.value.updating=!0,d.value=null;try{const r=(await n.put(`/api/v1/orders/${e}`,a,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!r.success)throw new Error(r.message||"Failed to update order");const c=u.value.findIndex($=>$.id===e);return c!==-1&&(u.value[c]=r.data),h.value===e&&(w.value=r.data),r.data}catch(o){throw d.value=((t=(l=o.response)==null?void 0:l.data)==null?void 0:t.message)||o.message||"Failed to update order",o}finally{i.value.updating=!1}},ve=async e=>{var a,l;i.value.deleting=!0,d.value=null;try{const o=(await n.delete(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to delete order");const r=u.value.findIndex(c=>c.id===e);r!==-1&&(u.value.splice(r,1),T.value.total-=1)}catch(t){throw d.value=((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||t.message||"Failed to delete order",t}finally{i.value.deleting=!1}},Q=async e=>{var a,l;try{const o=(await n.get(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to fetch order details");return o.data}catch(t){const o=((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||t.message||"Failed to fetch order details";throw new Error(o)}},pe=async(e,a)=>x(e,{customer:a}),ge=async(e,a)=>x(e,{order_items:a}),W=async(e=null)=>{if(i.value.options){console.log("Options already loading, skipping...");return}i.value.options=!0;try{console.log("Fetching dropdown options...");const a=[n.get("/api/v1/statuses").catch(()=>({data:{data:[]}})),n.get("/api/v1/categories").catch(()=>({data:{data:[]}})),n.get("/api/v1/cities").catch(()=>({data:{data:[]}})),n.get("/api/v1/zones").catch(()=>({data:{data:[]}})),n.get("/api/v1/agents").catch(()=>({data:{data:[]}})),n.get("/api/v1/riders").catch(()=>({data:{data:[]}})),n.get("/api/v1/vendors").catch(()=>({data:{data:[]}})),n.get("/api/v1/countries").catch(()=>({data:{data:[]}})),n.get("/api/v1/warehouses").catch(()=>({data:{data:[]}})),n.get("/api/v1/clients").catch(()=>({data:{data:[]}}))];e?a.push(n.get(`/api/v1/vendors/${e}/products`).catch(()=>({data:{success:!1,data:[]}}))):a.push(n.get("/api/v1/products").catch(()=>({data:{success:!1,data:[]}})));const l=j=>!j||!j.data?[]:Array.isArray(j.data)?j.data:Array.isArray(j.data.data)?j.data.data:[],[t,o,r,c,$,ze,Se,Te,Ee,Pe,Be]=await Promise.all(a);K.value=l(t),U.value=l(o),q.value=l(r),M.value=l(c),V.value=l($),Z.value=l(ze),G.value=l(Se),J.value=l(Te),I.value=l(Ee),H.value=l(Pe),L.value=l(Be),console.log("Dropdown options loaded successfully")}catch(a){throw console.error("Failed to fetch dropdown options:",a),a}finally{i.value.options=!1}},fe=async e=>{if(h.value=e,S.value=!1,z.value=!0,e){const a=await N(e);return w.value=a,a}},ye=()=>{z.value=!0,h.value=null,w.value=null,S.value=!0},he=()=>{z.value=!1,h.value=null,w.value=null},we=()=>{_.value=null,O.value=null,A.value=null,F.value=null,C.value=null,D.value=null,b.value=null,m.value=null,v.value=[],R.value=""},_e=async()=>{const e={};_.value&&(e.status=_.value),O.value&&(e.product_id=O.value),A.value&&(e.zone_id=A.value),F.value&&(e.agent_id=F.value),C.value&&(e.rider_id=C.value),D.value&&(e.vendor_id=D.value),b.value&&(e.city=b.value),m.value&&(e.category_id=m.value),R.value&&(e.search=R.value),v.value&&v.value.length===2&&(e.created_from=v.value[0],e.created_to=v.value[1]),e.page=1,await B(e)},Oe=async()=>{if(!P.value)try{await Promise.all([W(),B({page:1})]),P.value=!0}catch(e){console.error("Failed to initialize order store:",e)}},Ae=(e=[])=>{console.debug("openAssignDeliveryDialog called with:",e),k.value=e,p.value="assignDelivery",g.value="Assign Delivery Person",f.value=!0,console.debug("Bulk action dialog opened. State:",{selectedOrders:k.value,dialogType:p.value,dialogTitle:g.value,bulkActionDialog:f.value})},Fe=(e=[])=>{k.value=e,p.value="assignCallCentre",g.value="Assign Call Centre Agent",f.value=!0},Ce=(e=[])=>{k.value=e,p.value="status",g.value="Change Status",f.value=!0},De=(e=[])=>{k.value=e,p.value="delete",g.value="Delete Orders",f.value=!0},X=()=>{f.value=!1,p.value="",g.value="",k.value=[],Object.keys(E).forEach(e=>{E[e]=""})},be=async e=>{i.value.updating=!0;try{const{type:a,data:l,orders:t}=e;switch(a){case"assignDelivery":await me(t,l.deliveryPerson);break;case"assignCallCentre":await Re(t,l.callCentreAgent);break;case"status":await ke(t,l);break;case"delete":await je(t);break}X()}catch(a){console.error("Bulk action failed:",a)}finally{i.value.updating=!1}},me=async(e,a)=>{console.log("Assigning delivery person:",a,"to orders:",e)},Re=async(e,a)=>{console.log("Assigning call centre agent:",a,"to orders:",e)},ke=async(e,a)=>{console.log("Updating status for orders:",e,"with data:",a)},je=async e=>{console.log("Deleting orders:",e)};return{orders:u,loading:i,error:d,notifications:Y,dialog:z,bulkActionDialog:f,selectedOrderId:h,selectedOrder:w,initialized:P,isCreateMode:S,orderFilterStatus:_,orderFilterProduct:O,orderFilterZone:A,orderFilterAgent:F,orderFilterRider:C,orderFilterVendor:D,orderFilterCity:b,orderFilterCategory:m,orderDateRange:v,orderSearch:R,orderStatusOptions:ee,productOptions:L,categoryOptions:U,cityOptions:q,zoneOptions:M,agentOptions:V,riderOptions:Z,vendorOptions:G,clientOptions:H,warehouseOptions:I,countryOptions:J,deliveryStatusOptions:ae,userOptions:te,statusOptions:K,pagination:T,getOrderById:se,confirmedOrders:le,pendingOrders:oe,cancelledOrders:re,totalRevenue:ne,activeFilterCount:ie,currentFilters:ce,printOrders:ue,fetchOrders:B,loadOrder:N,createOrder:de,updateOrder:x,updateOrderCustomer:pe,updateOrderItems:ge,deleteOrder:ve,getOrderDetails:Q,fetchDropdownOptions:W,openDialog:fe,openCreateDialog:ye,openAssignDeliveryDialog:Ae,openAssignCallCentreDialog:Fe,openBulkStatusDialog:Ce,dialogType:p,dialogTitle:g,bulkActionForm:E,openDeleteDialog:De,closeBulkActionDialog:X,handleBulkAction:be,closeDialog:he,clearAllFilters:we,applyFilters:_e,initialize:Oe}});export{Ue as u};
