import{r as n,j as x,k as q,d as s,o as i,b as K,a,u as E,v as L,a3 as C,c as R,y as P,A as r,B as v,e as m,f as c,n as b,t as p,F as S,g as $,C as B,D as j,w as F,T as H,a5 as G}from"./app-Ctd-Rhr6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"page-container"},Q={class:"form-wrapper"},X={class:"form-group"},Z={class:"form-grid"},ee={class:"form-group"},ae={class:"input-icon-wrapper"},oe={key:0,class:"error-message"},te={class:"form-group"},de={class:"input-icon-wrapper"},le={class:"form-group"},ie={class:"input-icon-wrapper"},se={key:0,class:"error-message"},re={key:1,class:"suggestions-dropdown"},ne=["onMousedown"],ue={class:"form-grid"},ve={class:"form-group"},pe={key:0,class:"error-message"},ce={class:"form-group"},me={class:"form-grid"},ye={class:"form-group"},fe=["min"],ge={key:0,class:"error-message"},he={key:1,class:"helper-text"},be={class:"form-group"},we={class:"checkbox-container"},ke={class:"checkbox-label"},Me={class:"form-group"},_e={class:"char-counter"},Ne=["disabled"],xe={key:0},Ke={key:1,class:"loading-state"},Ce={class:"spinner",viewBox:"0 0 24 24",style:{width:"1rem",height:"1rem","margin-right":"0.5rem","vertical-align":"middle"}},Pe={class:"modal-reference"},Se={__name:"OnlineForm",props:{order_no:{type:String}},setup(V){const y=V,o=n({orderNo:y.order_no,phone:"",altPhone:"",address:"",city:"",delivery_date:"",deliveryTime:"",landmark:"",requestCallback:!1,notes:""});x(()=>{var d,h;if(!g||!g.value)return null;const t=g.value;!o.value.orderNo&&t.order_no?o.value.orderNo=t.order_no:o.value.orderNo=t.order_no||o.value.orderNo;const e=(d=t.customer)==null?void 0:d.phone;if(e&&!o.value.phone&&(o.value.phone=normalizeKenyanPhone(e)),!o.value.altPhone&&((h=t.customer)!=null&&h.alt_phone)&&(o.value.altPhone=normalizeKenyanPhone(t.customer.alt_phone)),!o.value.address){const u=t.shipping_address||t.pickup_address||(Array.isArray(t.addresses)&&t.addresses.length?t.addresses[0]:null);u&&typeof u=="object"?o.value.address=u.full_address||u.address||`${u.street||""} ${u.area||""}`.trim()||"":o.value.address=u||""}return!o.value.delivery_date&&t.delivery_date&&(o.value.delivery_date=t.delivery_date.split("T")[0]),o.value.city||(o.value.city=t.shipping_address&&t.shipping_address.city||t.addresses&&t.addresses[0]&&t.addresses[0].city||t.warehouse&&(t.warehouse.city||t.warehouse.city_name)||""),o.value.landmark||(o.value.landmark=t.customer_notes||""),o.value.notes||(o.value.notes=t.customer_notes||""),!0});const l=n({phone:"",address:"",city:"",delivery_date:""}),f=n(!1),w=n(!1),k=n([]),M=n(!1),g=n(null),D=n(!0),_=n(null),T=x(()=>{const t=new Date;return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}),O=()=>{const t=/^(?:254|\+254|0)([71])[0-9]{8}$/;return o.value.phone?t.test(o.value.phone.replace(/\s/g,""))?(l.value.phone="",!0):(l.value.phone="Please enter a valid Kenyan phone number",!1):(l.value.phone="Phone number is required",!1)},U=()=>o.value.city?(l.value.city="",!0):(l.value.city="Please select your town/city",!1),A=()=>{const t=new Date(o.value.delivery_date),e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),o.value.delivery_date?t<e?(l.value.delivery_date="Delivery date must be from tomorrow onwards",!1):(l.value.delivery_date="",!0):(l.value.delivery_date="Please select a delivery date",!1)},I=t=>{o.value.address=t,k.value=[],M.value=!1},W=()=>{setTimeout(()=>{M.value=!1},200)},z=async()=>{if(!o.value.phone||o.value.phone.trim().length<7){alert("Please enter a valid phone number."),console.warn("âš ï¸ Invalid phone number:",o.value.phone);return}if(!o.value.address||o.value.address.trim().length<3){alert("Please enter your delivery address."),console.warn("âš ï¸ Invalid address:",o.value.address);return}if(!o.value.city||o.value.city.trim().length<2){alert("Please enter your city."),console.warn("âš ï¸ Invalid city:",o.value.city);return}if(o.value.delivery_date&&isNaN(Date.parse(o.value.delivery_date))){alert("Please enter a valid delivery date."),console.warn("âš ï¸ Invalid delivery date:",o.value.delivery_date);return}f.value=!0;const t=`/api/form/${y.order_no}`;console.log("ðŸš€ Submitting form to:",t),console.log("ðŸ§¾ Payload:",JSON.stringify(o.value,null,2));try{const{data:e}=await axios.post(t,o.value);console.log("ðŸ“¦ Response data:",e),e.success?(console.log("âœ… Submission successful. Server returned:",e.data),w.value=!0,alert(`Order ${e.data.order_no||y.order_no} updated successfully!`)):(console.error("âŒ Server responded with an error:",e),alert(e.message||"Submission failed. Please try again."))}catch(e){console.error("ðŸ’¥ Submission error:",e)}finally{f.value=!1,console.log("ðŸ Submission complete")}},N=()=>{w.value=!1};return q(async()=>{try{const e=await(await fetch(`/api/v1/orders/${y.order_no}`)).json();e.success?g.value=e.data:_.value=e.message||"Order not found."}catch(t){console.error(t),_.value="Error fetching order. Please try again."}finally{D.value=!1}}),(t,e)=>(i(),s(S,null,[K(E(L),{title:"Update Delivery Information"}),a("div",Y,[a("div",Q,[e[35]||(e[35]=C('<header class="header" data-v-d1a50ded><div class="logo-container" data-v-d1a50ded><svg class="logo-icon" width="40" height="40" viewBox="0 0 40 40" fill="none" data-v-d1a50ded><rect x="5" y="8" width="30" height="24" rx="2" stroke="currentColor" stroke-width="2" data-v-d1a50ded></rect><circle cx="15" cy="32" r="3" fill="currentColor" data-v-d1a50ded></circle><circle cx="25" cy="32" r="3" fill="currentColor" data-v-d1a50ded></circle><path d="M10 20h20" stroke="currentColor" stroke-width="2" data-v-d1a50ded></path></svg><div class="logo-text" data-v-d1a50ded><h1 class="logo-title" data-v-d1a50ded>CRM</h1><p class="logo-tagline" data-v-d1a50ded>We tailor your Coat</p></div></div></header>',1)),a("form",{onSubmit:P(z,["prevent"]),class:"main-form"},[e[30]||(e[30]=a("h2",{class:"form-title"},"Order Confirmation",-1)),a("div",X,[e[12]||(e[12]=a("label",{for:"orderNo",class:"form-label"},"Order Number",-1)),r(a("input",{type:"text",id:"orderNo","onUpdate:modelValue":e[0]||(e[0]=d=>o.value.orderNo=d),readonly:"",class:"form-input input-readonly"},null,512),[[v,o.value.orderNo]])]),a("div",Z,[a("div",ee,[e[14]||(e[14]=a("label",{for:"phone",class:"form-label"},[c(" Phone Number "),a("span",{class:"required"},"*")],-1)),a("div",ae,[e[13]||(e[13]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),r(a("input",{type:"tel",id:"phone","onUpdate:modelValue":e[1]||(e[1]=d=>o.value.phone=d),placeholder:"e.g., 0712345678",onBlur:O,class:b(["form-input","input-with-icon",{"input-error":l.value.phone}])},null,34),[[v,o.value.phone]])]),l.value.phone?(i(),s("span",oe,p(l.value.phone),1)):m("",!0)]),a("div",te,[e[16]||(e[16]=a("label",{for:"altPhone",class:"form-label"},"Alternative Phone (Optional)",-1)),a("div",de,[e[15]||(e[15]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),r(a("input",{type:"tel",id:"altPhone","onUpdate:modelValue":e[2]||(e[2]=d=>o.value.altPhone=d),placeholder:"e.g., 0723456789",class:"form-input input-with-icon"},null,512),[[v,o.value.altPhone]])])])]),a("div",le,[e[18]||(e[18]=a("label",{for:"address",class:"form-label"},[c(" Update Address "),a("span",{class:"required"},"*")],-1)),a("div",ie,[e[17]||(e[17]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"})],-1)),r(a("input",{type:"text",id:"address","onUpdate:modelValue":e[3]||(e[3]=d=>o.value.address=d),placeholder:"Enter building, street, area",onInput:e[4]||(e[4]=(...d)=>t.showAddressSuggestions&&t.showAddressSuggestions(...d)),onBlur:W,class:b(["form-input","input-with-icon",{"input-error":l.value.address}])},null,34),[[v,o.value.address]])]),l.value.address?(i(),s("span",se,p(l.value.address),1)):m("",!0),M.value&&k.value.length>0?(i(),s("div",re,[(i(!0),s(S,null,$(k.value,(d,h)=>(i(),s("div",{key:h,onMousedown:u=>I(d),class:"suggestion-item"},p(d),41,ne))),128))])):m("",!0)]),a("div",ue,[a("div",ve,[e[20]||(e[20]=a("label",{for:"city",class:"form-label"},[c(" Town/City "),a("span",{class:"required"},"*")],-1)),r(a("select",{id:"city","onUpdate:modelValue":e[5]||(e[5]=d=>o.value.city=d),onChange:U,class:b(["form-input",{"input-error":l.value.city}])},e[19]||(e[19]=[C('<option value="Nairobi" data-v-d1a50ded> Nairobi (Nairobi City County) </option><option value="Mombasa" data-v-d1a50ded>Mombasa</option><option value="Kwale" data-v-d1a50ded>Kwale</option><option value="Kilifi" data-v-d1a50ded>Kilifi</option><option value="Malindi" data-v-d1a50ded>Malindi</option><option value="Lamu" data-v-d1a50ded>Lamu</option><option value="Voi" data-v-d1a50ded>Voi</option><option value="Wundanyi" data-v-d1a50ded>Wundanyi</option><option value="Kisumu" data-v-d1a50ded>Kisumu</option><option value="Kakamega" data-v-d1a50ded>Kakamega</option><option value="Busia" data-v-d1a50ded>Busia</option><option value="Bungoma" data-v-d1a50ded>Bungoma</option><option value="Vihiga" data-v-d1a50ded>Vihiga</option><option value="Siaya" data-v-d1a50ded>Siaya</option><option value="Kisii" data-v-d1a50ded>Kisii</option><option value="Nyamira" data-v-d1a50ded>Nyamira</option><option value="Homa Bay" data-v-d1a50ded>Homa Bay</option><option value="Migori" data-v-d1a50ded>Migori</option><option value="Kuria" data-v-d1a50ded>Kuria</option><option value="Nakuru" data-v-d1a50ded>Nakuru</option><option value="Eldoret" data-v-d1a50ded> Eldoret (Uasin Gishu) </option><option value="Kericho" data-v-d1a50ded>Kericho</option><option value="Bomet" data-v-d1a50ded>Bomet</option><option value="Narok" data-v-d1a50ded>Narok</option><option value="Naivasha" data-v-d1a50ded>Naivasha</option><option value="Nanyuki" data-v-d1a50ded>Nanyuki</option><option value="Nyeri" data-v-d1a50ded>Nyeri</option><option value="Nyahururu" data-v-d1a50ded>Nyahururu</option><option value="Kitale" data-v-d1a50ded>Kitale (Trans Nzoia)</option><option value="Kapsabet" data-v-d1a50ded>Kapsabet</option><option value="Iten" data-v-d1a50ded>Iten</option><option value="Lodwar" data-v-d1a50ded>Lodwar</option><option value="Maralal" data-v-d1a50ded>Maralal</option><option value="Kabarnet" data-v-d1a50ded>Kabarnet</option><option value="Thika" data-v-d1a50ded>Thika</option><option value="Kiambu" data-v-d1a50ded>Kiambu</option><option value="Murang&#39;a" data-v-d1a50ded>Murang&#39;a</option><option value="Karuri" data-v-d1a50ded>Karuri</option><option value="Embu" data-v-d1a50ded>Embu</option><option value="Meru" data-v-d1a50ded>Meru</option><option value="Isiolo" data-v-d1a50ded>Isiolo</option><option value="Maua" data-v-d1a50ded>Maua</option><option value="Machakos" data-v-d1a50ded>Machakos</option><option value="Kitui" data-v-d1a50ded>Kitui</option><option value="Mwingi" data-v-d1a50ded>Mwingi</option><option value="Garissa" data-v-d1a50ded>Garissa</option><option value="Wajir" data-v-d1a50ded>Wajir</option><option value="Mandera" data-v-d1a50ded>Mandera</option><option value="Moyale" data-v-d1a50ded>Moyale</option><option value="Marsabit" data-v-d1a50ded>Marsabit</option><option value="Lokichoggio" data-v-d1a50ded>Lokichoggio</option><option value="Kapenguria" data-v-d1a50ded>Kapenguria</option><option value="Ruiru" data-v-d1a50ded>Ruiru</option><option value="Ongata Rongai" data-v-d1a50ded>Ongata Rongai</option><option value="Juia" data-v-d1a50ded>Juia</option><option value="Kikuyu" data-v-d1a50ded>Kikuyu</option><option value="Webuye" data-v-d1a50ded>Webuye</option><option value="Kerugoya" data-v-d1a50ded>Kerugoya</option><option value="Diani Beach" data-v-d1a50ded>Diani Beach</option><option value="Watamu" data-v-d1a50ded>Watamu</option>',60)]),34),[[B,o.value.city]]),l.value.city?(i(),s("span",pe,p(l.value.city),1)):m("",!0)]),a("div",ce,[e[21]||(e[21]=a("label",{for:"landmark",class:"form-label"},"Landmark/Building",-1)),r(a("input",{type:"text",id:"landmark","onUpdate:modelValue":e[6]||(e[6]=d=>o.value.landmark=d),placeholder:"e.g., Near Nakumatt",class:"form-input"},null,512),[[v,o.value.landmark]]),e[22]||(e[22]=a("span",{class:"helper-text"},"Help us find you easily",-1))])]),a("div",me,[a("div",ye,[e[23]||(e[23]=a("label",{for:"delivery_date",class:"form-label"},[c(" Delivery Date "),a("span",{class:"required"},"*")],-1)),r(a("input",{type:"date",id:"delivery_date","onUpdate:modelValue":e[7]||(e[7]=d=>o.value.delivery_date=d),min:T.value,onChange:A,class:b(["form-input",{"input-error":l.value.delivery_date}])},null,42,fe),[[v,o.value.delivery_date]]),l.value.delivery_date?(i(),s("span",ge,p(l.value.delivery_date),1)):(i(),s("span",he,"From tomorrow onwards"))]),a("div",be,[e[25]||(e[25]=a("label",{for:"deliveryTime",class:"form-label"},"Preferred Time",-1)),r(a("select",{id:"deliveryTime","onUpdate:modelValue":e[8]||(e[8]=d=>o.value.deliveryTime=d),class:"form-input"},e[24]||(e[24]=[a("option",{value:""},"Any time",-1),a("option",{value:"morning"}," Morning (8 AM - 12 PM) ",-1),a("option",{value:"afternoon"}," Afternoon (12 PM - 4 PM) ",-1),a("option",{value:"evening"}," Evening (4 PM - 7 PM) ",-1)]),512),[[B,o.value.deliveryTime]])])]),a("div",we,[a("label",ke,[r(a("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=d=>o.value.requestCallback=d),class:"checkbox-input"},null,512),[[j,o.value.requestCallback]]),e[26]||(e[26]=a("span",{class:"checkbox-content"},[a("strong",{class:"checkbox-title"},"Request a callback from our delivery team"),a("small",{class:"checkbox-subtitle"},"We'll call you to confirm the delivery details")],-1))])]),a("div",Me,[e[27]||(e[27]=a("label",{for:"notes",class:"form-label"},"Notes",-1)),r(a("textarea",{id:"notes","onUpdate:modelValue":e[10]||(e[10]=d=>o.value.notes=d),rows:"4",placeholder:"Your message here...",maxlength:"500",class:"form-textarea"},null,512),[[v,o.value.notes]]),a("div",_e,p(o.value.notes.length)+"/500 ",1)]),a("button",{type:"submit",class:"submit-button",disabled:f.value,style:{"background-color":"#2563eb",color:"white",padding:"0.75rem 1.5rem","border-radius":"0.5rem",border:"none","font-weight":"600"}},[f.value?(i(),s("span",Ke,[(i(),s("svg",Ce,e[28]||(e[28]=[a("circle",{class:"spinner-track",cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none"},null,-1),a("path",{class:"spinner-head",fill:"white",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))),e[29]||(e[29]=c(" Submitting... "))])):(i(),s("span",xe,"Submit"))],8,Ne),e[31]||(e[31]=a("p",{class:"help-text"},[c(" Need help? Call us at "),a("a",{href:"tel:+254700000000",class:"help-link"},"+254 700 000 000")],-1))],32),(i(),R(G,{to:"body"},[K(H,{name:"modal"},{default:F(()=>[w.value?(i(),s("div",{key:0,class:"modal-overlay",onClick:N},[a("div",{class:"modal-content",onClick:e[11]||(e[11]=P(()=>{},["stop"]))},[e[32]||(e[32]=a("div",{class:"success-icon-wrapper"},[a("svg",{class:"success-icon",width:"60",height:"60",viewBox:"0 0 60 60",fill:"none"},[a("circle",{cx:"30",cy:"30",r:"28",stroke:"#10b981","stroke-width":"4"}),a("path",{d:"M20 30l8 8 12-16",stroke:"#10b981","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[33]||(e[33]=a("h3",{class:"modal-title"},"Success!",-1)),e[34]||(e[34]=a("p",{class:"modal-text"}," We've received your updated delivery information. Our team will contact you soon. ",-1)),a("p",Pe," Reference: "+p(o.value.orderNo),1),a("button",{onClick:N,class:"modal-button"}," Close ")])])):m("",!0)]),_:1})]))])])],64))}},De=J(Se,[["__scopeId","data-v-d1a50ded"]]);export{De as default};
