import{E,r as u,i as b,j as V,k as A,l as j,d as _,e as $,u as v,o as y,a as t,F as O,b as T,g as M,y as R,t as f}from"./app-Cuu9_Ou2.js";import{u as B}from"./servicesStore-D4-MZmCC.js";import{u as N}from"./condition-CFxzJLcr.js";import{u as P}from"./conditionTypeStore-BeyjtTHw.js";const z=E("vendorServices",()=>{const x=u(!1),r=u(null),p=u([]),w=u([]),l=u({}),d=u(!1),k=async e=>{r.value=e,x.value=!0,await m(e)},C=()=>{x.value=!1,r.value=null,p.value=[],l.value={}},m=async e=>{if(e){d.value=!0;try{const a=await b.get(`/api/v1/vendors/${e}/services`);p.value=a.data,p.value.forEach(n=>{l.value[n.id]={},n.service.conditions.forEach(c=>{l.value[n.id][c.id]={custom_rate:c.custom_rate||null,rate_type:c.custom_rate_type||c.rate_type}})})}catch(a){throw console.error("Failed to load vendor services:",a),a}finally{d.value=!1}}};return{isModalOpen:x,selectedVendorId:r,vendorServices:p,availableServices:w,overrides:l,loading:d,openModal:k,closeModal:C,loadVendorServices:m,loadAvailableServices:async()=>{try{const e=await b.get("/api/v1/services");w.value=e.data}catch(e){throw console.error("Failed to load services:",e),e}},assignService:async e=>{if(!(!e||!r.value))try{return await b.post(`/api/v1/vendors/${r.value}/services`,{service_id:e,vendor_id:r.value}),await m(r.value),!0}catch(a){throw console.error("Failed to assign service:",a),a}},removeService:async e=>{if(r.value)try{return await b.delete(`/api/v1/vendors/${r.value}/services/${e}`),await m(r.value),!0}catch(a){throw console.error("Failed to remove service:",a),a}},saveOverride:async(e,a)=>{var c;const n=(c=l.value[e])==null?void 0:c[a];if(!n||n.custom_rate===null||n.custom_rate==="")throw new Error("Please enter a rate");try{return await b.post(`/api/v1/vendors/${r.value}/services/${e}/rates`,{service_condition_id:a,custom_rate:n.custom_rate,rate_type:n.rate_type}),!0}catch(g){throw console.error("Failed to save override:",g),g}},updateOverride:(e,a,n,c)=>{l.value[e]||(l.value[e]={}),l.value[e][a]||(l.value[e][a]={custom_rate:null,rate_type:"fixed"}),l.value[e][a][n]=c}}}),L={class:"bg-white w-4/5 max-h-[90vh] overflow-auto rounded p-6"},D={class:"flex justify-between mb-4"},U={key:0,class:"text-center py-8"},q={class:"flex gap-2 mb-6"},G={class:"flex gap-2 mb-6"},H=["disabled"],J={key:0,class:"text-center py-8 text-gray-500"},K={class:"flex justify-between mb-3"},Q={class:"font-semibold text-lg"},W=["onClick"],X={class:"overflow-x-auto"},Y={class:"w-full text-sm"},Z={class:"p-2"},I={class:"p-2 text-center"},ee={class:"font-medium"},te={class:"text-gray-500 text-xs ml-1"},re={class:"p-2"},se=["value","onInput"],ae={class:"p-2"},oe=["value","onChange"],le={class:"p-2 text-center"},ie=["onClick"],ne={__name:"VendorServices",setup(x){const r=z(),p=B(),w=N(),l=P();V(()=>w.conditions),V(()=>p.services),V(()=>l.conditionTypes);const d=u("");u(""),u(""),u("");const k=async()=>{if(d.value)try{await r.assignService(d.value),d.value="",alert("Service assigned successfully!")}catch{alert("Failed to assign service")}},C=async i=>{if(confirm("Are you sure you want to remove this service?"))try{await r.removeService(i),alert("Service removed successfully!")}catch{alert("Failed to remove service")}},m=(i,s,h,o)=>{r.updateOverride(i,s,h,o)},F=async(i,s)=>{try{await r.saveOverride(i,s),alert("Rate override saved successfully!")}catch(h){alert(h.message||"Failed to save rate override")}};return A(async()=>{try{await p.fetchServices()}catch(i){console.error("Error loading services:",i)}try{await r.fetchVendorServices()}catch(i){console.error("Error loading vendor services:",i)}try{await l.fetchAll(),console.log("Condition types loaded:",l.conditionTypes)}catch(i){console.error("Error loading condition types:",i)}}),(i,s)=>{const h=j("v-autocomplete");return v(r).isModalOpen?(y(),_("div",{key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:s[2]||(s[2]=R(o=>v(r).closeModal(),["self"]))},[t("div",L,[t("div",D,[s[3]||(s[3]=t("h2",{class:"text-xl font-bold"},"Vendor Services",-1)),t("button",{onClick:s[0]||(s[0]=o=>v(r).closeModal()),class:"text-gray-500 hover:text-gray-700 text-2xl leading-none"}," âœ• ")]),v(r).loading?(y(),_("div",U,s[4]||(s[4]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Loading...",-1)]))):(y(),_(O,{key:1},[t("div",q,[T(h,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=o=>d.value=o),label:"Select Service",items:v(p).services,"item-title":"service_name","item-value":"id",dense:"",clearable:"",class:"w-full"},null,8,["modelValue","items"])]),t("div",G,[t("button",{onClick:k,disabled:!d.value,class:"bg-blue-600 text-white px-4 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap"}," Assign ",8,H)]),v(r).vendorServices.length===0?(y(),_("div",J," No services assigned yet ")):$("",!0),(y(!0),_(O,null,M(v(r).vendorServices,o=>(y(),_("div",{key:o.id,class:"border rounded mb-6 p-4"},[t("div",K,[t("h3",Q,f(o.service.service_name),1),t("button",{onClick:e=>C(o.id),class:"text-red-600 text-sm hover:text-red-800"}," Remove ",8,W)]),t("div",X,[t("table",Y,[s[6]||(s[6]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2 text-left"},"Condition"),t("th",{class:"p-2 text-center"},"Base Rate"),t("th",{class:"p-2 text-center"},"Override"),t("th",{class:"p-2 text-center"},"Type"),t("th",{class:"p-2 text-center"},"Action")])],-1)),t("tbody",null,[(y(!0),_(O,null,M(o.service.conditions,e=>{var a,n,c,g;return y(),_("tr",{key:e.id,class:"border-t hover:bg-gray-50"},[t("td",Z,f(e.min_value)+" - "+f(e.max_value)+" "+f(e.unit),1),t("td",I,[t("span",ee,f(e.rate),1),t("span",te," ("+f(e.rate_type)+") ",1)]),t("td",re,[t("input",{type:"number",step:"0.01",value:(n=(a=v(r).overrides[o.id])==null?void 0:a[e.id])==null?void 0:n.custom_rate,onInput:S=>m(o.id,e.id,"custom_rate",S.target.value),class:"border p-1 w-24 rounded text-center",placeholder:"Rate"},null,40,se)]),t("td",ae,[t("select",{value:(g=(c=v(r).overrides[o.id])==null?void 0:c[e.id])==null?void 0:g.rate_type,onChange:S=>m(o.id,e.id,"rate_type",S.target.value),class:"border p-1 rounded"},s[5]||(s[5]=[t("option",{value:"fixed"},"Fixed",-1),t("option",{value:"percentage"}," Percentage ",-1)]),40,oe)]),t("td",le,[t("button",{onClick:S=>F(o.id,e.id),class:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700"}," Save ",8,ie)])])}),128))])])])]))),128))],64))])])):$("",!0)}}},pe=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{pe as V,ne as _,z as u};
