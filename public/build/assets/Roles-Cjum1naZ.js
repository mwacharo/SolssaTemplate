import{_ as Ne}from"./AppLayout-5v2Shzdc.js";import{n as _}from"./toast-C55c9FUg.js";import{i as b,r as i,j as oe,k as Te,l as o,c as D,o as y,w as n,b as l,a as v,f as s,d as Q,e as Be,F as X,g as Y,t as m,z as se}from"./app-oghUaOhr.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CpqIRTB_.js";import"./africastalking-sJAXWtpj.js";import"./IncomingCallDialog-CpKXFFKx.js";/* empty css                                                                           */const qe={class:"d-flex align-center"},Oe={class:"text-h6"},je={class:"text-h6"},We={class:"mb-4"},He={class:"permission-groups",style:{"max-height":"400px","overflow-y":"auto"}},Je={class:"d-flex align-center w-100"},Qe={class:"mb-2"},Xe={class:"text-caption text-medium-emphasis"},Ye={__name:"Roles",setup(Ze){b.defaults.withCredentials=!0,b.defaults.headers.common.Accept="application/json";const p=i([]),P=i(!1),V=i(!1),I=i(!1),w=i(null),A=i(null),U=i(!1),E=i(!1),F=i(!1),x=i({name:""}),N=i(!1),k=i(null),f=i(null),c=i([]),g=i(null),C=i(""),Z=i(["User Management","Content Management"]),R=i(null),K=i("all"),L=i({search:"",status:""}),ie=[{title:"Role Name",value:"name",sortable:!0},{title:"Permissions",value:"permissions",sortable:!1},{title:"Actions",value:"actions",sortable:!1,width:"120px"}],ee={required:a=>!!a||"This field is required",minLength:a=>a&&a.length>=2||"Minimum 2 characters required"},le=[{name:"Basic Operations",icon:"mdi-cog",permissions:[{key:"create",name:"Create",description:"Create new records"},{key:"read",name:"Read",description:"View and read records"},{key:"update",name:"Update",description:"Modify existing records"},{key:"delete",name:"Delete",description:"Remove records"}]},{name:"User Management",icon:"mdi-account-multiple",permissions:[{key:"manage_users",name:"Manage Users",description:"Full user management capabilities"}]},{name:"System Administration",icon:"mdi-shield-crown",permissions:[{key:"system_config",name:"System Configuration",description:"Configure system settings"}]},{name:"Reports & Analytics",icon:"mdi-chart-line",permissions:[{key:"reports",name:"Reports",description:"Access and generate reports"}]}],T=oe(()=>k.value!==null),re=oe(()=>C.value?le.map(a=>({...a,permissions:a.permissions.filter(e=>e.name.toLowerCase().includes(C.value.toLowerCase())||e.description.toLowerCase().includes(C.value.toLowerCase())||e.key.toLowerCase().includes(C.value.toLowerCase()))})).filter(a=>a.permissions.length>0):le);async function ne(){P.value=!0;try{const{data:a}=await b.get("/api/v1/admin/roles");p.value=a}catch(a){console.error("Error fetching roles:",a),_.error("Failed to load roles","error")}finally{P.value=!1}}async function ue(){V.value=!0;try{const{data:a}=await b.post("/api/v1/admin/roles",{name:x.value.name,permissions:[]});p.value.push(a),_.success("Role created successfully","success"),S()}catch(a){console.error("Error creating role:",a),_.error("Failed to create role","error")}finally{V.value=!1}}async function de(){V.value=!0,w.value=k.value;try{const{data:a}=await b.put(`/api/v1/admin/roles/${k.value}`,{name:x.value.name}),e=p.value.findIndex(r=>r.id===k.value);e!==-1&&(p.value[e]=a),_.success("Role updated successfully","success"),S(),await ne()}catch(a){console.error("Error updating role:",a),_("Failed to update role","error")}finally{V.value=!1,w.value=null}}async function ce(){if(f.value){I.value=!0,w.value=f.value.id;try{const{data:a}=await b.put(`/api/v1/admin/roles/${f.value.id}`,{name:f.value.name,permissions:c.value}),e=p.value.findIndex(r=>r.id===f.value.id);e!==-1&&(p.value[e]=a),_.success("Permissions updated successfully","success"),B()}catch(a){console.error("Error updating permissions:",a),_.error("Failed to update permissions","error")}finally{I.value=!1,w.value=null}}}async function me(){if(g.value){A.value=g.value.id;try{await b.delete(`/api/v1/admin/roles/${g.value.id}`),p.value=p.value.filter(a=>a.id!==g.value.id),_.success("Role deleted successfully","success"),F.value=!1,g.value=null}catch(a){console.error("Error deleting role:",a),_.error("Failed to delete role","error")}finally{A.value=null}}}function ve(){x.value={name:""},k.value=null,U.value=!0,se(()=>{R.value&&R.value.resetValidation()})}function pe(a){x.value={name:a.name},k.value=a.id,U.value=!0,se(()=>{R.value&&R.value.resetValidation()})}function ae(a){f.value=a,c.value=[...a.permissions||[]],E.value=!0}function S(){U.value=!1,x.value={name:""},k.value=null}function B(){E.value=!1,f.value=null,c.value=[],C.value=""}function _e(a){g.value=a,F.value=!0}function fe(a,e){if(e)c.value.includes(a)||c.value.push(a);else{const r=c.value.indexOf(a);r>-1&&c.value.splice(r,1)}}function ge(a){a.permissions.forEach(e=>{c.value.includes(e.key)||c.value.push(e.key)})}function ye(a){a.permissions.forEach(e=>{const r=c.value.indexOf(e.key);r>-1&&c.value.splice(r,1)})}function xe(a){return a.permissions.filter(e=>c.value.includes(e.key)).length}function ke(){R.value.validate()&&(T.value?de():ue())}function Ce(a){return a.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return Te(()=>{ne()}),(a,e)=>{const r=o("v-col"),u=o("v-btn"),G=o("v-row"),te=o("v-icon"),$=o("v-card-title"),q=o("v-text-field"),be=o("v-select"),z=o("v-card-text"),M=o("v-card"),O=o("v-tab"),Ve=o("v-tabs"),we=o("v-skeleton-loader"),j=o("v-chip"),Re=o("v-chip-group"),he=o("v-data-table"),Ue=o("v-container"),h=o("v-spacer"),W=o("v-divider"),Fe=o("v-form"),H=o("v-card-actions"),J=o("v-dialog"),De=o("v-expansion-panel-title"),Pe=o("v-checkbox"),Ae=o("v-list-item-title"),Ee=o("v-list-item-subtitle"),Le=o("v-list-item"),Se=o("v-list"),$e=o("v-expansion-panel-text"),ze=o("v-expansion-panel"),Me=o("v-expansion-panels");return y(),D(Ne,null,{default:n(()=>[l(Ue,null,{default:n(()=>[l(G,{class:"mb-4 align-center"},{default:n(()=>[l(r,null,{default:n(()=>e[11]||(e[11]=[v("h2",{class:"text-h4"},"Roles Management",-1)])),_:1,__:[11]}),l(r,{class:"text-right"},{default:n(()=>[l(u,{color:"primary",onClick:ve,loading:P.value,"prepend-icon":"mdi-plus"},{default:n(()=>e[12]||(e[12]=[s(" Create Role ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1}),l(M,{class:"mb-4",variant:"outlined"},{default:n(()=>[l($,{class:"text-subtitle-1 pb-2"},{default:n(()=>[l(te,{left:""},{default:n(()=>e[13]||(e[13]=[s("mdi-filter")])),_:1,__:[13]}),e[14]||(e[14]=s(" Filters "))]),_:1,__:[14]}),l(z,null,{default:n(()=>[l(G,null,{default:n(()=>[l(r,{cols:"12",md:"4"},{default:n(()=>[l(q,{modelValue:L.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>L.value.search=t),label:"Search roles...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:a.debouncedSearch,hint:"Search by name","persistent-hint":""},null,8,["modelValue","onInput"])]),_:1}),l(r,{cols:"12",md:"3"},{default:n(()=>[l(be,{modelValue:L.value.status,"onUpdate:modelValue":[e[1]||(e[1]=t=>L.value.status=t),a.applyFilters],items:a.statusFilterOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(r,{cols:"12",md:"2",class:"d-flex align-center"},{default:n(()=>[l(u,{variant:"outlined",onClick:a.clearFilters,disabled:!a.hasActiveFilters},{default:n(()=>e[15]||(e[15]=[s(" Clear Filters ")])),_:1,__:[15]},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(G,{class:"mb-4"},{default:n(()=>[l(r,null,{default:n(()=>[l(Ve,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=t=>K.value=t),"background-color":"transparent",grow:"","slider-color":"primary"},{default:n(()=>[l(O,{value:"all"},{default:n(()=>e[16]||(e[16]=[s("All Roles")])),_:1,__:[16]}),l(O,{value:"with_permissions"},{default:n(()=>e[17]||(e[17]=[s("With Permissions")])),_:1,__:[17]}),l(O,{value:"without_permissions"},{default:n(()=>e[18]||(e[18]=[s("Without Permissions")])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(he,{headers:ie,items:p.value,loading:P.value,"item-key":"id",class:"elevation-1"},{loading:n(()=>[l(we,{type:"table-row@5"})]),"item.permissions":n(({item:t})=>[v("div",qe,[l(Re,null,{default:n(()=>[(y(!0),Q(X,null,Y((t.permissions||[]).slice(0,3),d=>(y(),D(j,{key:d,size:"small",color:"primary",variant:"tonal"},{default:n(()=>[s(m(Ce(d)),1)]),_:2},1024))),128)),t.permissions&&t.permissions.length>3?(y(),D(j,{key:0,size:"small",variant:"outlined",onClick:d=>ae(t),style:{cursor:"pointer"}},{default:n(()=>[s(" +"+m(t.permissions.length-3)+" more ",1)]),_:2},1032,["onClick"])):Be("",!0)]),_:2},1024)])]),"item.actions":n(({item:t})=>[l(u,{icon:"mdi-shield-edit",size:"small",variant:"text",onClick:d=>ae(t),loading:w.value===t.id},null,8,["onClick","loading"]),l(u,{icon:"mdi-pencil",size:"small",variant:"text",onClick:d=>pe(t),loading:w.value===t.id},null,8,["onClick","loading"]),l(u,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:d=>_e(t),loading:A.value===t.id},null,8,["onClick","loading"])]),_:1},8,["items","loading"])]),_:1}),l(J,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=t=>U.value=t),"max-width":"500px",persistent:""},{default:n(()=>[l(M,null,{default:n(()=>[l($,{class:"d-flex align-center"},{default:n(()=>[v("span",Oe,m(T.value?"Edit Role":"Create Role"),1),l(h),l(u,{icon:"mdi-close",variant:"text",onClick:S})]),_:1}),l(W),l(z,{class:"pb-0"},{default:n(()=>[l(Fe,{ref_key:"roleForm",ref:R,modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=t=>N.value=t)},{default:n(()=>[l(q,{modelValue:x.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value.name=t),label:"Role Name",rules:[ee.required,ee.minLength],loading:V.value,variant:"outlined",class:"mb-4"},null,8,["modelValue","rules","loading"])]),_:1},8,["modelValue"])]),_:1}),l(H,null,{default:n(()=>[l(h),l(u,{variant:"outlined",onClick:S},{default:n(()=>e[19]||(e[19]=[s("Cancel")])),_:1,__:[19]}),l(u,{color:"primary",disabled:!N.value,loading:V.value,onClick:ke},{default:n(()=>[s(m(T.value?"Update":"Create"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=t=>E.value=t),"max-width":"600px",persistent:""},{default:n(()=>[l(M,null,{default:n(()=>[l($,{class:"d-flex align-center"},{default:n(()=>{var t;return[v("span",je,"Manage Permissions - "+m((t=f.value)==null?void 0:t.name),1),l(h),l(u,{icon:"mdi-close",variant:"text",onClick:B})]}),_:1}),l(W),l(z,null,{default:n(()=>[v("div",We,[l(q,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t),label:"Search permissions...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),v("div",He,[l(Me,{modelValue:Z.value,"onUpdate:modelValue":e[7]||(e[7]=t=>Z.value=t),multiple:""},{default:n(()=>[(y(!0),Q(X,null,Y(re.value,t=>(y(),D(ze,{key:t.name,value:t.name},{default:n(()=>[l(De,null,{default:n(()=>[v("div",Je,[l(te,{icon:t.icon,class:"mr-2"},null,8,["icon"]),v("span",null,m(t.name),1),l(h),l(j,{size:"x-small",variant:"tonal"},{default:n(()=>[s(m(xe(t))+"/"+m(t.permissions.length),1)]),_:2},1024)])]),_:2},1024),l($e,null,{default:n(()=>[v("div",Qe,[l(u,{size:"small",variant:"outlined",onClick:d=>ge(t),class:"mr-2"},{default:n(()=>e[20]||(e[20]=[s(" Select All ")])),_:2,__:[20]},1032,["onClick"]),l(u,{size:"small",variant:"outlined",onClick:d=>ye(t)},{default:n(()=>e[21]||(e[21]=[s(" Deselect All ")])),_:2,__:[21]},1032,["onClick"])]),l(Se,null,{default:n(()=>[(y(!0),Q(X,null,Y(t.permissions,d=>(y(),D(Le,{key:d.key,class:"px-0"},{prepend:n(()=>[l(Pe,{"model-value":c.value.includes(d.key),"onUpdate:modelValue":Ie=>fe(d.key,Ie),color:"primary"},null,8,["model-value","onUpdate:modelValue"])]),default:n(()=>[l(Ae,null,{default:n(()=>[s(m(d.name),1)]),_:2},1024),l(Ee,null,{default:n(()=>[s(m(d.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),l(W),l(H,null,{default:n(()=>[v("div",Xe,m(c.value.length)+" permissions selected ",1),l(h),l(u,{variant:"outlined",onClick:B},{default:n(()=>e[22]||(e[22]=[s("Cancel")])),_:1,__:[22]}),l(u,{color:"primary",loading:I.value,onClick:ce},{default:n(()=>e[23]||(e[23]=[s(" Update Permissions ")])),_:1,__:[23]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=t=>F.value=t),"max-width":"400px"},{default:n(()=>[l(M,null,{default:n(()=>[l($,{class:"text-h6"},{default:n(()=>e[24]||(e[24]=[s("Confirm Delete")])),_:1,__:[24]}),l(z,null,{default:n(()=>{var t;return[s(' Are you sure you want to delete the role "'+m((t=g.value)==null?void 0:t.name)+'"? This action cannot be undone. ',1)]}),_:1}),l(H,null,{default:n(()=>{var t;return[l(h),l(u,{variant:"outlined",onClick:e[9]||(e[9]=d=>F.value=!1)},{default:n(()=>e[25]||(e[25]=[s("Cancel")])),_:1,__:[25]}),l(u,{color:"error",loading:A.value===((t=g.value)==null?void 0:t.id),onClick:me},{default:n(()=>e[26]||(e[26]=[s(" Delete ")])),_:1,__:[26]},8,["loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},il=Ge(Ye,[["__scopeId","data-v-df0ff9d3"]]);export{il as default};
