import{E as fe,r,j as f,i as l}from"./app-gl8GMY4q.js";const Re=fe("orders",()=>{const u=r([]),i=r({orders:!1,options:!1,creating:!1,updating:!1,deleting:!1}),d=r(null),J=r([]),C=r(!1),g=r(null),h=r(null),S=r(!1),D=r(!1),y=r(null),_=r(null),w=r(null),O=r(null),F=r(null),R=r(null),z=r(null),m=r(null),v=r([]),A=r(""),K=r([]),$=r([]),T=r([]),q=r([]),I=r([]),k=r([]),B=r([]),L=r([]),M=r([]),U=r([]),V=r([]),N=r([]),Q=r([]),Z=r([]),j=r({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),W=f(()=>e=>u.value.find(t=>t.id===e)),X=f(()=>u.value.filter(e=>e.status===1)),Y=f(()=>u.value.filter(e=>e.status===0)),ee=f(()=>u.value.filter(e=>e.status===2)),te=f(()=>u.value.reduce((e,t)=>e+parseFloat(t.total_price||0),0)),ae=f(()=>{let e=0;return y.value&&e++,_.value&&e++,w.value&&e++,O.value&&e++,F.value&&e++,R.value&&e++,z.value&&e++,m.value&&e++,v.value&&v.value.length>0&&e++,A.value&&e++,e}),re=f(()=>({status:y.value,product:_.value,zone:w.value,agent:O.value,rider:F.value,vendor:R.value,city:z.value,category:m.value,dateRange:v.value,search:A.value})),E=async(e={})=>{var t,s;i.value.orders=!0,d.value=null;try{const a=new URLSearchParams;e.page&&a.append("page",e.page),e.per_page&&a.append("per_page",e.per_page),e.status&&a.append("status",e.status),e.vendor_id&&a.append("vendor_id",e.vendor_id),e.city&&a.append("city",e.city),e.agent_id&&a.append("agent_id",e.agent_id),e.rider_id&&a.append("rider_id",e.rider_id),e.zone_id&&a.append("zone_id",e.zone_id),e.product_id&&a.append("product_id",e.product_id),e.category_id&&a.append("category_id",e.category_id),e.search&&a.append("search",e.search),e.created_from&&a.append("created_from",e.created_from),e.created_to&&a.append("created_to",e.created_to);const c=(await l.get(`/api/v1/orders?${a.toString()}`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!c.success)throw new Error(c.message||"Failed to fetch orders");D.value=!1;const n=c.data;return u.value=n.data||[],j.value={current_page:n.current_page||1,last_page:n.last_page||1,per_page:n.per_page||15,total:n.total||0,from:n.from||0,to:n.to||0},n}catch(a){throw d.value=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to fetch orders",a}finally{i.value.orders=!1}},b=async e=>{i.value.orders=!0,d.value=null;try{const t=await G(e);return h.value=t,g.value=e,t}catch(t){throw d.value=t.message||"Failed to load order",t}finally{i.value.orders=!1}},se=async e=>{var t,s;i.value.creating=!0,d.value=null;try{const o=(await l.post("/api/v1/orders",e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to create order");return u.value.unshift(o.data),j.value.total+=1,o.data}catch(a){throw d.value=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to create order",a}finally{i.value.creating=!1}},x=async(e,t)=>{var s,a;i.value.updating=!0,d.value=null;try{const c=(await l.put(`/api/v1/orders/${e}`,t,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!c.success)throw new Error(c.message||"Failed to update order");const n=u.value.findIndex(P=>P.id===e);return n!==-1&&(u.value[n]=c.data),g.value===e&&(h.value=c.data),c.data}catch(o){throw d.value=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.message)||o.message||"Failed to update order",o}finally{i.value.updating=!1}},oe=async e=>{var t,s;i.value.deleting=!0,d.value=null;try{const o=(await l.delete(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to delete order");const c=u.value.findIndex(n=>n.id===e);c!==-1&&(u.value.splice(c,1),j.value.total-=1)}catch(a){throw d.value=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to delete order",a}finally{i.value.deleting=!1}},G=async e=>{var t,s;try{const o=(await l.get(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to fetch order details");return o.data}catch(a){const o=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to fetch order details";throw new Error(o)}},le=async(e,t)=>x(e,{customer:t}),ne=async(e,t)=>x(e,{order_items:t}),H=async(e=null)=>{if(i.value.options){console.log("Options already loading, skipping...");return}i.value.options=!0;try{console.log("Fetching dropdown options...");const t=[l.get("/api/v1/statuses").catch(()=>({data:{data:[]}})),l.get("/api/v1/categories").catch(()=>({data:{data:[]}})),l.get("/api/v1/cities").catch(()=>({data:{data:[]}})),l.get("/api/v1/zones").catch(()=>({data:{data:[]}})),l.get("/api/v1/agents").catch(()=>({data:{data:[]}})),l.get("/api/v1/riders").catch(()=>({data:{data:[]}})),l.get("/api/v1/vendors").catch(()=>({data:{data:[]}})),l.get("/api/v1/countries").catch(()=>({data:{data:[]}})),l.get("/api/v1/warehouses").catch(()=>({data:{data:[]}})),l.get("/api/v1/clients").catch(()=>({data:{data:[]}}))];e?t.push(l.get(`/api/v1/vendors/${e}/products`).catch(p=>({data:{success:!1,data:[]}}))):t.push(l.get("/api/v1/products").catch(p=>({data:{success:!1,data:[]}})));const s=p=>!p||!p.data?[]:Array.isArray(p.data)?p.data:Array.isArray(p.data.data)?p.data.data:[],[a,o,c,n,P,ie,ce,ue,de,ve,pe]=await Promise.all(t);Z.value=s(a),T.value=s(o),q.value=s(c),I.value=s(n),k.value=s(P),B.value=s(ie),L.value=s(ce),V.value=s(ue),U.value=s(de),M.value=s(ve),$.value=s(pe),console.log("Dropdown options loaded successfully")}catch(t){throw console.error("Failed to fetch dropdown options:",t),t}finally{i.value.options=!1}};return{orders:u,loading:i,error:d,notifications:J,dialog:C,selectedOrderId:g,selectedOrder:h,initialized:S,isCreateMode:D,orderFilterStatus:y,orderFilterProduct:_,orderFilterZone:w,orderFilterAgent:O,orderFilterRider:F,orderFilterVendor:R,orderFilterCity:z,orderFilterCategory:m,orderDateRange:v,orderSearch:A,orderStatusOptions:K,productOptions:$,categoryOptions:T,cityOptions:q,zoneOptions:I,agentOptions:k,riderOptions:B,vendorOptions:L,clientOptions:M,warehouseOptions:U,countryOptions:V,deliveryStatusOptions:N,userOptions:Q,statusOptions:Z,pagination:j,getOrderById:W,confirmedOrders:X,pendingOrders:Y,cancelledOrders:ee,totalRevenue:te,activeFilterCount:ae,currentFilters:re,fetchOrders:E,loadOrder:b,createOrder:se,updateOrder:x,updateOrderCustomer:le,updateOrderItems:ne,deleteOrder:oe,getOrderDetails:G,fetchDropdownOptions:H,openDialog:async e=>{if(g.value=e,D.value=!1,C.value=!0,e){const t=await b(e);return h.value=t,t}},openCreateDialog:()=>{C.value=!0,g.value=null,h.value=null,D.value=!0},closeDialog:()=>{C.value=!1,g.value=null,h.value=null},clearAllFilters:()=>{y.value=null,_.value=null,w.value=null,O.value=null,F.value=null,R.value=null,z.value=null,m.value=null,v.value=[],A.value=""},applyFilters:async()=>{const e={};y.value&&(e.status=y.value),_.value&&(e.product_id=_.value),w.value&&(e.zone_id=w.value),O.value&&(e.agent_id=O.value),F.value&&(e.rider_id=F.value),R.value&&(e.vendor_id=R.value),z.value&&(e.city=z.value),m.value&&(e.category_id=m.value),A.value&&(e.search=A.value),v.value&&v.value.length===2&&(e.created_from=v.value[0],e.created_to=v.value[1]),e.page=1,await E(e)},initialize:async()=>{if(!S.value)try{await Promise.all([H(),E({page:1})]),S.value=!0}catch(e){console.error("Failed to initialize order store:",e)}}}});export{Re as u};
