import{r as d,j as P,k as E,d as n,o as r,b as N,a as o,u as $,v as F,a2 as M,c as R,y as S,A as i,B as v,e as m,f as c,n as b,t as p,F as V,g as j,C as D,D as H,w as L,T as W,a4 as J}from"./app-yuzyHxXr.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"page-container"},Q={class:"form-wrapper"},X={class:"form-group"},Z={class:"form-grid"},ee={class:"form-group"},oe={class:"input-icon-wrapper"},ae={key:0,class:"error-message"},te={class:"form-group"},se={class:"input-icon-wrapper"},le={class:"form-group"},re={class:"input-icon-wrapper"},ne={key:0,class:"error-message"},ie={key:1,class:"suggestions-dropdown"},de=["onMousedown"],ue={class:"form-grid"},ve={class:"form-group"},pe={key:0,class:"error-message"},ce={class:"form-group"},me={class:"form-grid"},fe={class:"form-group"},ye=["min"],he={key:0,class:"error-message"},ge={key:1,class:"helper-text"},be={class:"form-group"},we={class:"checkbox-container"},ke={class:"checkbox-label"},_e={class:"form-group"},xe={class:"char-counter"},Ce=["disabled"],Pe={key:0},Ne={key:1,class:"loading-state"},Me={class:"spinner",viewBox:"0 0 24 24",style:{width:"1rem",height:"1rem","margin-right":"0.5rem","vertical-align":"middle"}},Se={class:"modal-reference"},Ve={__name:"OnlineForm",props:{order_no:{type:String}},setup(T){const f=T,a=d({orderNo:f.order_no,phone:"",altPhone:"",address:"",city:"",delivery_date:"",deliveryTime:"",landmark:"",requestCallback:!1,notes:""});P(()=>{var s,g;if(!h||!h.value)return null;const t=h.value;!a.value.orderNo&&t.order_no?a.value.orderNo=t.order_no:a.value.orderNo=t.order_no||a.value.orderNo;const e=(s=t.customer)==null?void 0:s.phone;if(e&&!a.value.phone&&(a.value.phone=normalizeKenyanPhone(e)),!a.value.altPhone&&((g=t.customer)!=null&&g.alt_phone)&&(a.value.altPhone=normalizeKenyanPhone(t.customer.alt_phone)),!a.value.address){const u=t.shipping_address||t.pickup_address||(Array.isArray(t.addresses)&&t.addresses.length?t.addresses[0]:null);u&&typeof u=="object"?a.value.address=u.full_address||u.address||`${u.street||""} ${u.area||""}`.trim()||"":a.value.address=u||""}return!a.value.delivery_date&&t.delivery_date&&(a.value.delivery_date=t.delivery_date.split("T")[0]),a.value.city||(a.value.city=t.shipping_address&&t.shipping_address.city||t.addresses&&t.addresses[0]&&t.addresses[0].city||t.warehouse&&(t.warehouse.city||t.warehouse.city_name)||""),a.value.landmark||(a.value.landmark=t.customer_notes||""),a.value.notes||(a.value.notes=t.customer_notes||""),!0});const l=d({phone:"",address:"",city:"",delivery_date:""}),y=d(!1),w=d(!1),k=d([]),_=d(!1),h=d(null),B=d(!0),x=d(null),O=P(()=>{const t=new Date;return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}),A=()=>{const t=/^(?:254|\+254|0)([71])[0-9]{8}$/;return a.value.phone?t.test(a.value.phone.replace(/\s/g,""))?(l.value.phone="",!0):(l.value.phone="Please enter a valid Kenyan phone number",!1):(l.value.phone="Phone number is required",!1)},U=()=>a.value.city?(l.value.city="",!0):(l.value.city="Please select your town/city",!1),q=()=>{const t=new Date(a.value.delivery_date),e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),a.value.delivery_date?t<e?(l.value.delivery_date="Delivery date must be from tomorrow onwards",!1):(l.value.delivery_date="",!0):(l.value.delivery_date="Please select a delivery date",!1)},z=t=>{a.value.address=t,k.value=[],_.value=!1},K=()=>{setTimeout(()=>{_.value=!1},200)},I=async()=>{if(!a.value.phone||a.value.phone.trim().length<7){alert("Please enter a valid phone number."),console.warn("âš ï¸ Invalid phone number:",a.value.phone);return}if(!a.value.address||a.value.address.trim().length<3){alert("Please enter your delivery address."),console.warn("âš ï¸ Invalid address:",a.value.address);return}if(!a.value.city||a.value.city.trim().length<2){alert("Please enter your city."),console.warn("âš ï¸ Invalid city:",a.value.city);return}if(a.value.delivery_date&&isNaN(Date.parse(a.value.delivery_date))){alert("Please enter a valid delivery date."),console.warn("âš ï¸ Invalid delivery date:",a.value.delivery_date);return}y.value=!0;const t=`/api/form/${f.order_no}`;console.log("ðŸš€ Submitting form to:",t),console.log("ðŸ§¾ Payload:",JSON.stringify(a.value,null,2));try{const{data:e}=await axios.post(t,a.value);console.log("ðŸ“¦ Response data:",e),e.success?(console.log("âœ… Submission successful. Server returned:",e.data),w.value=!0,alert(`Order ${e.data.order_no||f.order_no} updated successfully!`)):(console.error("âŒ Server responded with an error:",e),alert(e.message||"Submission failed. Please try again."))}catch(e){console.error("ðŸ’¥ Submission error:",e)}finally{y.value=!1,console.log("ðŸ Submission complete")}},C=()=>{w.value=!1};return E(async()=>{try{const e=await(await fetch(`/api/v1/orders/${f.order_no}`)).json();e.success?h.value=e.data:x.value=e.message||"Order not found."}catch(t){console.error(t),x.value="Error fetching order. Please try again."}finally{B.value=!1}}),(t,e)=>(r(),n(V,null,[N($(F),{title:"Update Delivery Information"}),o("div",G,[o("div",Q,[e[35]||(e[35]=M('<header class="header" data-v-0d818309><div class="logo-container" data-v-0d818309><svg class="logo-icon" width="40" height="40" viewBox="0 0 40 40" fill="none" data-v-0d818309><rect x="5" y="8" width="30" height="24" rx="2" stroke="currentColor" stroke-width="2" data-v-0d818309></rect><circle cx="15" cy="32" r="3" fill="currentColor" data-v-0d818309></circle><circle cx="25" cy="32" r="3" fill="currentColor" data-v-0d818309></circle><path d="M10 20h20" stroke="currentColor" stroke-width="2" data-v-0d818309></path></svg><div class="logo-text" data-v-0d818309><h1 class="logo-title" data-v-0d818309>CRM</h1><p class="logo-tagline" data-v-0d818309>We tailor your Coat</p></div></div></header>',1)),o("form",{onSubmit:S(I,["prevent"]),class:"main-form"},[e[30]||(e[30]=o("h2",{class:"form-title"},"Order Confirmation",-1)),o("div",X,[e[12]||(e[12]=o("label",{for:"orderNo",class:"form-label"},"Order Number",-1)),i(o("input",{type:"text",id:"orderNo","onUpdate:modelValue":e[0]||(e[0]=s=>a.value.orderNo=s),readonly:"",class:"form-input input-readonly"},null,512),[[v,a.value.orderNo]])]),o("div",Z,[o("div",ee,[e[14]||(e[14]=o("label",{for:"phone",class:"form-label"},[c(" Phone Number "),o("span",{class:"required"},"*")],-1)),o("div",oe,[e[13]||(e[13]=o("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),i(o("input",{type:"tel",id:"phone","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.phone=s),placeholder:"e.g., 0712345678",onBlur:A,class:b(["form-input","input-with-icon",{"input-error":l.value.phone}])},null,34),[[v,a.value.phone]])]),l.value.phone?(r(),n("span",ae,p(l.value.phone),1)):m("",!0)]),o("div",te,[e[16]||(e[16]=o("label",{for:"altPhone",class:"form-label"},"Alternative Phone (Optional)",-1)),o("div",se,[e[15]||(e[15]=o("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),i(o("input",{type:"tel",id:"altPhone","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.altPhone=s),placeholder:"e.g., 0723456789",class:"form-input input-with-icon"},null,512),[[v,a.value.altPhone]])])])]),o("div",le,[e[18]||(e[18]=o("label",{for:"address",class:"form-label"},[c(" Update Address "),o("span",{class:"required"},"*")],-1)),o("div",re,[e[17]||(e[17]=o("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{"fill-rule":"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"})],-1)),i(o("input",{type:"text",id:"address","onUpdate:modelValue":e[3]||(e[3]=s=>a.value.address=s),placeholder:"Enter building, street, area",onInput:e[4]||(e[4]=(...s)=>t.showAddressSuggestions&&t.showAddressSuggestions(...s)),onBlur:K,class:b(["form-input","input-with-icon",{"input-error":l.value.address}])},null,34),[[v,a.value.address]])]),l.value.address?(r(),n("span",ne,p(l.value.address),1)):m("",!0),_.value&&k.value.length>0?(r(),n("div",ie,[(r(!0),n(V,null,j(k.value,(s,g)=>(r(),n("div",{key:g,onMousedown:u=>z(s),class:"suggestion-item"},p(s),41,de))),128))])):m("",!0)]),o("div",ue,[o("div",ve,[e[20]||(e[20]=o("label",{for:"city",class:"form-label"},[c(" Town/City "),o("span",{class:"required"},"*")],-1)),i(o("select",{id:"city","onUpdate:modelValue":e[5]||(e[5]=s=>a.value.city=s),onChange:U,class:b(["form-input",{"input-error":l.value.city}])},e[19]||(e[19]=[M('<option value="" data-v-0d818309>Select town/city</option><option value="Nairobi" data-v-0d818309>Nairobi</option><option value="Mombasa" data-v-0d818309>Mombasa</option><option value="Kisumu" data-v-0d818309>Kisumu</option><option value="Nakuru" data-v-0d818309>Nakuru</option><option value="Eldoret" data-v-0d818309>Eldoret</option><option value="Thika" data-v-0d818309>Thika</option><option value="Malindi" data-v-0d818309>Malindi</option><option value="Kitale" data-v-0d818309>Kitale</option><option value="Busia" data-v-0d818309>Busia</option><option value="Kakamega" data-v-0d818309>Kakamega</option><option value="Other" data-v-0d818309>Other</option>',12)]),34),[[D,a.value.city]]),l.value.city?(r(),n("span",pe,p(l.value.city),1)):m("",!0)]),o("div",ce,[e[21]||(e[21]=o("label",{for:"landmark",class:"form-label"},"Landmark/Building",-1)),i(o("input",{type:"text",id:"landmark","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.landmark=s),placeholder:"e.g., Near Nakumatt",class:"form-input"},null,512),[[v,a.value.landmark]]),e[22]||(e[22]=o("span",{class:"helper-text"},"Help us find you easily",-1))])]),o("div",me,[o("div",fe,[e[23]||(e[23]=o("label",{for:"delivery_date",class:"form-label"},[c(" Delivery Date "),o("span",{class:"required"},"*")],-1)),i(o("input",{type:"date",id:"delivery_date","onUpdate:modelValue":e[7]||(e[7]=s=>a.value.delivery_date=s),min:O.value,onChange:q,class:b(["form-input",{"input-error":l.value.delivery_date}])},null,42,ye),[[v,a.value.delivery_date]]),l.value.delivery_date?(r(),n("span",he,p(l.value.delivery_date),1)):(r(),n("span",ge,"From tomorrow onwards"))]),o("div",be,[e[25]||(e[25]=o("label",{for:"deliveryTime",class:"form-label"},"Preferred Time",-1)),i(o("select",{id:"deliveryTime","onUpdate:modelValue":e[8]||(e[8]=s=>a.value.deliveryTime=s),class:"form-input"},e[24]||(e[24]=[o("option",{value:""},"Any time",-1),o("option",{value:"morning"},"Morning (8 AM - 12 PM)",-1),o("option",{value:"afternoon"},"Afternoon (12 PM - 4 PM)",-1),o("option",{value:"evening"},"Evening (4 PM - 7 PM)",-1)]),512),[[D,a.value.deliveryTime]])])]),o("div",we,[o("label",ke,[i(o("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>a.value.requestCallback=s),class:"checkbox-input"},null,512),[[H,a.value.requestCallback]]),e[26]||(e[26]=o("span",{class:"checkbox-content"},[o("strong",{class:"checkbox-title"},"Request a callback from our delivery team"),o("small",{class:"checkbox-subtitle"},"We'll call you to confirm the delivery details")],-1))])]),o("div",_e,[e[27]||(e[27]=o("label",{for:"notes",class:"form-label"},"Notes",-1)),i(o("textarea",{id:"notes","onUpdate:modelValue":e[10]||(e[10]=s=>a.value.notes=s),rows:"4",placeholder:"Your message here...",maxlength:"500",class:"form-textarea"},null,512),[[v,a.value.notes]]),o("div",xe,p(a.value.notes.length)+"/500",1)]),o("button",{type:"submit",class:"submit-button",disabled:y.value,style:{"background-color":"#2563eb",color:"white",padding:"0.75rem 1.5rem","border-radius":"0.5rem",border:"none","font-weight":"600"}},[y.value?(r(),n("span",Ne,[(r(),n("svg",Me,e[28]||(e[28]=[o("circle",{class:"spinner-track",cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none"},null,-1),o("path",{class:"spinner-head",fill:"white",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))),e[29]||(e[29]=c(" Submitting... "))])):(r(),n("span",Pe,"Submit"))],8,Ce),e[31]||(e[31]=o("p",{class:"help-text"},[c(" Need help? Call us at "),o("a",{href:"tel:+254700000000",class:"help-link"},"+254 700 000 000")],-1))],32),(r(),R(J,{to:"body"},[N(W,{name:"modal"},{default:L(()=>[w.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:C},[o("div",{class:"modal-content",onClick:e[11]||(e[11]=S(()=>{},["stop"]))},[e[32]||(e[32]=o("div",{class:"success-icon-wrapper"},[o("svg",{class:"success-icon",width:"60",height:"60",viewBox:"0 0 60 60",fill:"none"},[o("circle",{cx:"30",cy:"30",r:"28",stroke:"#10b981","stroke-width":"4"}),o("path",{d:"M20 30l8 8 12-16",stroke:"#10b981","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[33]||(e[33]=o("h3",{class:"modal-title"},"Success!",-1)),e[34]||(e[34]=o("p",{class:"modal-text"},"We've received your updated delivery information. Our team will contact you soon. ",-1)),o("p",Se,"Reference: "+p(a.value.orderNo),1),o("button",{onClick:C,class:"modal-button"},"Close")])])):m("",!0)]),_:1})]))])])],64))}},Be=Y(Ve,[["__scopeId","data-v-0d818309"]]);export{Be as default};
