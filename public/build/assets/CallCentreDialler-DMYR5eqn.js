import{E as vt,r as c,j as U,Q as _t,s as ft,l as m,c as ve,o as k,w as l,b as t,a as d,f as s,t as y,u as z,d as A,e as ae,F as He,g as je,p as Qe,q as Ye}from"./app-BODwDjre.js";import{u as gt}from"./orderStore-BHWQNBCk.js";import{u as yt}from"./callCenter-C7JYYd8l.js";import{u as bt}from"./whatsappStore-CIn4uSqF.js";import{u as Ct}from"./webrtc-uE6SfFw6.js";import{u as wt}from"./auth-xYEfAvze.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xt=vt("callCentreDialler",()=>{const w=c(null),oe=c(!1),ne=c("call"),f=c({active:!1,calling:!1,muted:!1,onHold:!1,duration:0,startTime:null,recordCall:!0,autoLog:!0}),O=c([]),H=c(null),g=c({type:"whatsapp",selectedTemplate:null,sending:!1,content:"",subject:"",attachments:[]}),X=c([{id:1,name:"Order Confirmation",description:"Confirm order details",content:"Dear {customer_name}, your order #{order_no} has been confirmed and will be delivered on {delivery_date}.",type:"all"},{id:2,name:"Delivery Update",description:"Update on delivery status",content:"Hi {customer_name}, your order #{order_no} is out for delivery and will arrive on {delivery_date}.",type:"all"},{id:3,name:"Payment Reminder",description:"Remind about pending payment",content:"Hello {customer_name}, please complete payment of KSH {total_price} for order #{order_no}. Thank you!",type:"all"},{id:4,name:"Order Cancellation",description:"Notify order cancellation",content:"Dear {customer_name}, we regret to inform you that order #{order_no} has been cancelled. Please contact us for more details.",type:"all"},{id:5,name:"Feedback Request",description:"Request customer feedback",content:"Hi {customer_name}, thank you for your order #{order_no}. We would love to hear your feedback!",type:"all"}]),q=c({updating:!1,formData:{status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}),_e=c([{id:1,name:"Pending",color:"orange",description:"Order awaiting confirmation"},{id:2,name:"Confirmed",color:"green",description:"Order confirmed by customer"},{id:3,name:"Processing",color:"blue",description:"Order being prepared"},{id:4,name:"Shipped",color:"purple",description:"Order dispatched for delivery"},{id:5,name:"Delivered",color:"teal",description:"Order delivered to customer"},{id:6,name:"Follow Up",color:"amber",description:"Requires follow up"},{id:7,name:"Cancelled",color:"red",description:"Order cancelled"},{id:8,name:"On Hold",color:"grey",description:"Order temporarily on hold"}]),R=c([{id:1,name:"Standard",status_id:1,description:"Standard processing"},{id:2,name:"Expedited",status_id:2,description:"Fast-track processing"},{id:3,name:"Follow Up",status_id:6,description:"Requires callback",requiresRecall:!0},{id:4,name:"Customer Request",status_id:8,description:"Customer requested hold"},{id:5,name:"Payment Issue",status_id:6,description:"Payment verification needed",requiresRecall:!0}]),N=c([]),B=c({saving:!1,formData:{type:"General",content:"",pinned:!1}}),P=c([{value:"General",text:"General Note",color:"blue-grey"},{value:"Call Summary",text:"Call Summary",color:"blue"},{value:"Customer Request",text:"Customer Request",color:"purple"},{value:"Issue",text:"Issue/Problem",color:"red"},{value:"Follow Up",text:"Follow Up Required",color:"orange"},{value:"Payment",text:"Payment Related",color:"green"}]),I=c([]),F=c([]),$=c({order:!1,statuses:!1,notes:!1}),j=U(()=>w.value?w.value.customer||w.value.customer_address||w.value.shipping_address||{}:null),Ve=U(()=>q.value.formData.status_id?R.value.filter(o=>o.status_id===q.value.formData.status_id):[]),G=U(()=>{const o=R.value.find(u=>u.id===q.value.formData.status_category_id);return(o==null?void 0:o.requiresRecall)||!1}),S=U(()=>{const o=f.value.duration,u=Math.floor(o/60),v=o%60;return`${String(u).padStart(2,"0")}:${String(v).padStart(2,"0")}`}),r=U(()=>I.value.filter(o=>o.pinned)),W=U(()=>I.value.filter(o=>!o.pinned)),se=(o,u=null)=>{console.log("Opening call dialog for phone number:",o),u&&(w.value=u),oe.value=!0};function ee(){oe.value=!1,ne.value="call",ze(),f.value.active&&le()}function Q(o){ne.value=o}function te(){var o;if(!((o=j.value)!=null&&o.phone)){b("No phone number available","error");return}f.value.calling=!0,setTimeout(()=>{f.value.calling=!1,f.value.active=!0,f.value.startTime=Date.now(),Y(),b("Call connected successfully","success")},2e3)}function Y(){H.value=setInterval(()=>{f.value.active&&f.value.duration++},1e3)}function re(){H.value&&(clearInterval(H.value),H.value=null)}function K(){f.value.muted=!f.value.muted,b(f.value.muted?"Microphone muted":"Microphone unmuted","info")}function fe(){f.value.onHold=!f.value.onHold,b(f.value.onHold?"Call on hold":"Call resumed","info")}function le(){var u,v,a;const o=f.value.duration;O.value.unshift({id:Date.now(),order_id:(u=w.value)==null?void 0:u.id,customer_name:(v=j.value)==null?void 0:v.full_name,phone:(a=j.value)==null?void 0:a.phone,type:"outgoing",duration:S.value,timestamp:new Date().toISOString(),recorded:f.value.recordCall,notes:f.value.autoLog?"Auto-logged call":null}),f.value.active=!1,f.value.calling=!1,f.value.muted=!1,f.value.onHold=!1,f.value.duration=0,f.value.startTime=null,re(),b("Call ended","info"),f.value.autoLog&&De(o)}async function De(o){const u={id:Date.now(),type:"Call Summary",content:`Called customer. Duration: ${Fe(o)}. ${f.value.recordCall?"Call was recorded.":""}`,pinned:!1,created_at:new Date().toISOString(),user_name:"Current User",auto_generated:!0};I.value.unshift(u)}function L(o){g.value.type=o,g.value.attachments=[]}function ie(o){const u=X.value.find(v=>v.id===o);u&&(g.value.content=ue(u.content),g.value.type==="email"&&(g.value.subject=u.name),g.value.selectedTemplate=o)}function ue(o){return!w.value||!j.value?o:o.replace(/{customer_name}/g,j.value.full_name||"Customer").replace(/{order_no}/g,w.value.order_no||"N/A").replace(/{delivery_date}/g,Se(w.value.delivery_date)||"N/A").replace(/{total_price}/g,w.value.total_price||"0.00")}function ge(o){g.value.content+=o}function de(o){g.value.attachments.push(o)}function he(o){g.value.attachments.splice(o,1)}async function Te(){var o;if(!g.value.content.trim())return b("Please enter a message","error"),!1;g.value.sending=!0;try{await new Promise(v=>setTimeout(v,1500));const u={id:Date.now(),order_id:(o=w.value)==null?void 0:o.id,type:g.value.type,content:g.value.content,subject:g.value.subject,sent_at:new Date().toISOString(),status:"sent"};return b(`${g.value.type.toUpperCase()} sent successfully`,"success"),Ce(),!0}catch{return b("Failed to send message","error"),!1}finally{g.value.sending=!1}}async function ke(){var u;const o=q.value.formData;if(!o.status_id||!o.status_notes)return b("Please fill in all required fields","error"),!1;if(G.value&&!o.recall_date)return b("Recall date is required for this status","error"),!1;q.value.updating=!0;try{await new Promise(e=>setTimeout(e,1500));const v=_e.value.find(e=>e.id===o.status_id),a={id:Date.now(),order_id:(u=w.value)==null?void 0:u.id,status_id:o.status_id,status_name:v.name,status_category_id:o.status_category_id,notes:o.status_notes,recall_date:o.recall_date,created_at:new Date().toISOString(),user:"Current User",color:v.color};return N.value.unshift(a),w.value&&(w.value.status=v.name,w.value.latest_status=a),b("Status updated successfully","success"),o.notifyCustomer&&await Ue(o.notificationMethod,a),we(),!0}catch{return b("Failed to update status","error"),!1}finally{q.value.updating=!1}}async function Ue(o,u){console.log(`Sending ${o} notification for status update:`,u)}async function ye(){var u;const o=B.value.formData;if(!o.content.trim())return b("Please enter note content","error"),!1;B.value.saving=!0;try{await new Promise(a=>setTimeout(a,1e3));const v={id:Date.now(),order_id:(u=w.value)==null?void 0:u.id,type:o.type,content:o.content,pinned:o.pinned,created_at:new Date().toISOString(),user_name:"Current User"};return I.value.unshift(v),b("Note saved successfully","success"),Z(),!0}catch{return b("Failed to save note","error"),!1}finally{B.value.saving=!1}}async function Oe(o){const u=I.value.findIndex(v=>v.id===o);u!==-1&&(I.value.splice(u,1),b("Note deleted","success"))}async function be(o){const u=I.value.find(v=>v.id===o);u&&(u.pinned=!u.pinned,b(u.pinned?"Note pinned":"Note unpinned","success"))}async function Pe(o){$.value.order=!0;try{await h(o),await Me(o),await Ne(o)}catch(u){console.error("Error loading order data:",u),b("Failed to load order data","error")}finally{$.value.order=!1}}async function h(o){$.value.statuses=!0;try{await new Promise(u=>setTimeout(u,500)),N.value=[{id:1,status_name:"Order Placed",notes:"Customer placed order online",created_at:new Date(Date.now()-864e5).toISOString(),user:"System",color:"blue"},{id:2,status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:new Date(Date.now()-828e5).toISOString(),user:"John Doe",color:"green"}]}finally{$.value.statuses=!1}}async function Me(o){$.value.notes=!0;try{await new Promise(u=>setTimeout(u,500)),I.value=[{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:new Date(Date.now()-36e5).toISOString(),user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:new Date(Date.now()-18e5).toISOString(),user_name:"Jane Smith"}]}finally{$.value.notes=!1}}async function Ne(o){await new Promise(u=>setTimeout(u,500)),O.value=[{id:1,type:"outgoing",duration:"5:23",timestamp:new Date(Date.now()-72e5).toISOString()},{id:2,type:"incoming",duration:"3:45",timestamp:new Date(Date.now()-864e5).toISOString()}]}function ze(){Ce(),we(),Z()}function Ce(){g.value.content="",g.value.subject="",g.value.attachments=[],g.value.selectedTemplate=null}function we(){q.value.formData={status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}function Z(){B.value.formData={type:"General",content:"",pinned:!1}}function b(o,u="info"){const v={id:Date.now(),message:o,type:u,timestamp:new Date().toISOString()};F.value.push(v),setTimeout(()=>{const a=F.value.findIndex(e=>e.id===v.id);a!==-1&&F.value.splice(a,1)},5e3)}function Se(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function Ie(o){return o?new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Fe(o){const u=Math.floor(o/60),v=o%60;return`${u}m ${v}s`}return{activeOrder:w,dialogOpen:oe,activeTab:ne,callState:f,callHistory:O,messageState:g,messageTemplates:X,statusState:q,statusOptions:_e,statusCategories:R,statusHistory:N,notesState:B,noteTypes:P,notes:I,notifications:F,loading:$,customer:j,filteredStatusCategories:Ve,shouldShowRecallDate:G,formattedCallDuration:S,pinnedNotes:r,unpinnedNotes:W,openDialog:se,closeDialog:ee,setActiveTab:Q,initiateCall:te,toggleMute:K,holdCall:fe,endCall:le,setMessageType:L,loadTemplate:ie,insertVariable:ge,addAttachment:de,removeAttachment:he,sendMessage:Te,updateOrderStatus:ke,saveNote:ye,deleteNote:Oe,toggleNotePin:be,loadOrderData:Pe,addNotification:b,formatDate:Se,formatDateTime:Ie,replaceVariables:ue}}),Vt={class:"d-flex align-center w-100"},Dt={class:"flex-grow-1"},ht={class:"text-caption text-grey-lighten-1"},Tt={class:"pa-4"},kt={class:"info-row"},Ut={class:"info-row"},Ot={key:0,class:"info-row"},Pt={class:"text-truncate"},Mt={class:"mb-6"},Nt={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},zt={class:"mt-4"},It={key:0,class:"text-center"},Ft={key:1,class:"call-controls text-center"},qt={class:"call-status mb-4"},At={class:"text-caption text-grey"},Rt={class:"d-flex justify-center gap-3"},$t={class:"mb-3"},Ht={class:"preview-content"},jt={class:"text-body-2"},Gt={key:0,class:"text-caption"},Lt={key:0,class:"ml-8 mb-3"},Et={class:"text-subtitle-1 font-weight-medium mb-3"},Jt={class:"text-body-2 font-weight-medium"},Bt={class:"text-caption text-grey"},Wt={class:"text-caption text-grey"},Qt={key:0},Yt={__name:"CallCentreDialler",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","status-updated","note-added"],setup(w,{emit:oe}){const ne=wt(),f=U(()=>{var a;return(a=ne.user)==null?void 0:a.id}),O=w,H=Ct(),g=oe,X={required:a=>!!a||"This field is required",phone:a=>a?/^[\d\s\-\+\(\)]+$/.test(a)||"Invalid phone number format":!0},q=U({get:()=>O.modelValue,set:a=>g("update:modelValue",a)}),_e=U(()=>N.statusOptions),R=xt(),N=gt(),B=yt(),P=bt();P.onTemplateSelect;const I=a=>{r.value.order_items.splice(a,1),F()};N.statusOptions.find(a=>a.id===r.value.status_id);const F=()=>{const a=ie();r.value.total_price=a,r.value.sub_total=a},$=()=>{r.value.order_items||(r.value.order_items=[]),r.value.order_items.push({product_id:null,product:{},sku:"",quantity:1,unit_price:0,editable:!0}),F()},j=U({get:()=>O.modelValue,set:a=>g("update:modelValue",a)}),Ve=a=>{g("update:modelValue",a),a||R.closeDialog()},G=c("call"),S=_t(O,"order"),r=c({id:null,customer:{id:null,full_name:"",phone:"",phone_number:"",email:"",city_id:null,zone_id:null,address:""},order_items:[],shipping_charges:0,total_price:0,sub_total:0,order_no:"",status_id:null,status_category_id:null,status_notes:"",recall_date:""}),W=c(!1),se=c(!1),ee=c("00:00"),Q=c(!1),te=c({phone:"",recordCall:!0,autoLog:!0}),Y=c("whatsapp");c(null);const re=c(!1),K=c(""),fe=U({get:()=>P.messageText||R.messageText,set:a=>{P.messageText=a,R.messageText=a}}),le=c(!1);c(!1);const De=c({type:"General",content:"",pinned:!1}),L=c({show:!1,message:"",color:"success"}),ie=()=>!r.value.order_items||r.value.order_items.length===0?"0.00":r.value.order_items.reduce((e,i)=>e+Number(i.quantity||0)*Number(i.unit_price||0),0).toFixed(2),ue=c([]);c(["General","Call Summary","Customer Request","Issue","Follow Up"]);const ge=c([{id:1,type:"outgoing",duration:"5:23",timestamp:"2 hours ago"},{id:2,type:"incoming",duration:"3:45",timestamp:"Yesterday"}]),de=c([{status_name:"Order Placed",notes:"Customer placed order online",created_at:"2024-01-15T10:30:00",user:"System",color:"blue"},{status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:"2024-01-15T10:35:00",user:"John Doe",color:"green"}]);c([{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:"2024-01-15T14:20:00",user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:"2024-01-15T14:25:00",user_name:"Jane Smith"}]);const he=U(()=>r.value.status_id?ue.value.filter(a=>a.status_id===r.value.status_id):[]),Te=U(()=>{const a=ue.value.find(e=>e.id===r.value.status_category_id);return(a==null?void 0:a.name)==="Follow Up"}),ke=U(()=>{var e,i,C;let a=K.value.content||"Your message will appear here...";return a=a.replace("{customer_name}",o.value.full_name||"Customer"),a=a.replace("{order_no}",((e=O.order)==null?void 0:e.order_no)||"N/A"),a=a.replace("{delivery_date}",Oe((i=O.order)==null?void 0:i.delivery_date)||"N/A"),a=a.replace("{total_price}",((C=O.order)==null?void 0:C.total_price)||"0.00"),a});ft(()=>O.order,a=>{var e,i,C,T;a&&(r.value={...a,customer:{...a.customer},order_items:((e=a.order_items)==null?void 0:e.map(p=>({...p,product:{...p.product}})))||[],shipping_charges:a.shipping_charges||0,total_price:a.total_price||0,sub_total:a.sub_total||0},te.value.phone=((i=a.customer)==null?void 0:i.phone)||((C=a.customer)==null?void 0:C.phone_number)||"",((T=a.order_statuses)==null?void 0:T.length)>0&&(de.value=a.order_statuses.map(p=>{var x,M,D;return{status_name:((x=p.status)==null?void 0:x.name)||"Unknown",notes:p.status_notes||"No notes",created_at:p.created_at,user:((M=p.user)==null?void 0:M.name)||"System",color:ye((D=p.status)==null?void 0:D.name)}})))},{immediate:!0,deep:!0});const Ue=(a,e)=>{const i=N.productOptions.find(C=>C.id===e);i&&(a.product={...i},a.product_id=e,a.sku=i.sku,(!a.unit_price||a.unit_price===0)&&(a.unit_price=i.price||0),F())},ye=a=>({Pending:"orange",Confirmed:"green",Processing:"blue",Shipped:"purple",Delivered:"teal",Cancelled:"red","Follow Up":"amber"})[a]||"grey",Oe=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",be=a=>a?new Date(a).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Pe=async a=>{try{await navigator.clipboard.writeText(a),h("Phone number copied to clipboard","success")}catch{h("Failed to copy","error")}},h=(a,e="success")=>{L.value={show:!0,message:a,color:e}},Me=a=>{se.value=!0,B.callClient(a),console.log("Initiating call to:",a),setTimeout(()=>{se.value=!1,W.value=!0,Ne(),h("Call connected","success")},2e3)},Ne=()=>{let a=0;const e=setInterval(()=>{if(!W.value){clearInterval(e);return}a++;const i=Math.floor(a/60),C=a%60;ee.value=`${String(i).padStart(2,"0")}:${String(C).padStart(2,"0")}`},1e3)},ze=()=>{Q.value=!Q.value,h(Q.value?"Microphone muted":"Microphone unmuted","info")},Ce=()=>{h("Call on hold","info")},we=()=>{W.value=!1,H.afClient.hangup(),ee.value="00:00",h("Call ended","info"),ge.value.unshift({id:Date.now(),type:"outgoing",duration:ee.value,timestamp:"Just now"})},Z=a=>{const e=document.querySelector("textarea");if(e){const i=e.selectionStart,C=e.selectionEnd,T=K.value.content;K.value.content=T.substring(0,i)+a+T.substring(C)}else K.value.content+=a},b=async()=>{var a,e,i,C,T,p;re.value=!0;try{const x={id:o.value.id||((a=S.value.customer)==null?void 0:a.id),name:o.value.full_name||((e=S.value.customer)==null?void 0:e.full_name),phone:o.value.phone||((i=S.value.customer)==null?void 0:i.phone_number),orderId:S.value.id,orderData:S.value,orderOid:S.value.order_no};console.log("ðŸ“¤ Sending message with context:",x);const M=await P.sendSingleMessage(f.value,x,R.messageText,(C=P.selectedTemplate)==null?void 0:C.id);if(M&&M.success)h(`${Y.value.toUpperCase()} sent successfully`,"success"),R.messageText="",P.selectedTemplate=null;else{console.warn("Send message returned unexpected result:",M);const D=M&&(M.message||M.error)||"Failed to send message";h(D,"error")}}catch(x){console.error("âŒ Send message error:",x),h(((p=(T=x==null?void 0:x.response)==null?void 0:T.data)==null?void 0:p.message)||(x==null?void 0:x.message)||"Failed to send message","error")}finally{re.value=!1}},Se=async()=>{le.value=!0,setTimeout(()=>{le.value=!1,h("Status updated successfully","success");const a=_e.value.find(e=>e.id===r.value.status_id);de.value.unshift({status_name:a.name,notes:r.value.status_notes,created_at:new Date().toISOString(),user:"Current User",color:a.color}),g("status-updated",r.value),r.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"}},1500)},Ie=()=>{h("Opening order history...","info")},Fe=()=>{h("Opening customer orders...","info")},o=U(()=>{var a,e,i,C;return((a=r.value)==null?void 0:a.customer)||((e=O.order)==null?void 0:e.customer)||((i=O.order)==null?void 0:i.customer_address)||((C=O.order)==null?void 0:C.shipping_address)||{}}),u=async()=>{try{const a=r.value.id,{id:e,...i}=r.value;await N.updateOrder(a,i),h("Order updated and marked as complete","success"),v()}catch(a){console.error("Failed to update order:",a),h("Failed to update order","error")}},v=()=>{q.value=!1,G.value="call",W.value=!1,K.value={subject:"",content:"",attachments:[]},r.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"},De.value={type:"General",content:"",pinned:!1}};return(a,e)=>{const i=m("v-icon"),C=m("v-avatar"),T=m("v-chip"),p=m("v-btn"),x=m("v-card-title"),M=m("v-divider"),D=m("v-text-field"),xe=m("v-autocomplete"),E=m("v-card-text"),J=m("v-card"),Ke=m("v-table"),me=m("v-col"),Ge=m("v-row"),qe=m("v-tab"),Ze=m("v-tabs"),Le=m("v-list-item-title"),Ee=m("v-list-item-subtitle"),Ae=m("v-list-item"),Xe=m("v-list"),Re=m("v-window-item"),et=m("v-btn-toggle"),Je=m("v-textarea"),tt=m("v-chip-group"),lt=m("v-alert"),Be=m("v-select"),at=m("v-checkbox"),$e=m("v-radio"),ot=m("v-radio-group"),nt=m("v-expand-transition"),st=m("v-form"),rt=m("v-timeline-item"),it=m("v-timeline"),ut=m("v-window"),dt=m("v-spacer"),mt=m("v-card-actions"),ct=m("v-snackbar"),pt=m("v-dialog");return k(),ve(pt,{"model-value":j.value,"onUpdate:modelValue":Ve,"max-width":"1200px",persistent:"",scrollable:""},{default:l(()=>[t(J,{class:"call-center-dialog"},{default:l(()=>[t(x,{class:"dialog-header pa-4"},{default:l(()=>{var n,V,_;return[d("div",Vt,[t(C,{color:"primary",size:"48",class:"mr-3"},{default:l(()=>[t(i,{color:"white",size:"28"},{default:l(()=>e[32]||(e[32]=[s("mdi-headset")])),_:1,__:[32]})]),_:1}),d("div",Dt,[e[33]||(e[33]=d("div",{class:"text-h5 font-weight-bold"},"CallCenter",-1)),d("div",ht," Order #"+y(((n=S.value)==null?void 0:n.order_no)||"N/A")+" - "+y(((V=o.value)==null?void 0:V.full_name)||"Unknown Customer"),1)]),t(T,{color:ye((_=S.value)==null?void 0:_.status),variant:"flat",class:"mr-2"},{default:l(()=>{var ce,pe,We;return[s(y(((We=(pe=(ce=S.value)==null?void 0:ce.latest_status)==null?void 0:pe.status)==null?void 0:We.name)||"Pending"),1)]}),_:1},8,["color"]),t(T,{color:z(H).connectionStatusColor,small:"",class:"white--text px-2"},{default:l(()=>[t(i,{left:"",small:""},{default:l(()=>e[34]||(e[34]=[s("mdi-circle")])),_:1,__:[34]}),s(" "+y(z(H).connectionStatusText),1)]),_:1},8,["color"]),t(p,{icon:"",variant:"text",onClick:v},{default:l(()=>[t(i,null,{default:l(()=>e[35]||(e[35]=[s("mdi-close")])),_:1,__:[35]})]),_:1})])]}),_:1}),t(M),t(E,{class:"pa-0",style:{height:"70vh"}},{default:l(()=>[t(Ge,{"no-gutters":"",style:{height:"100%"}},{default:l(()=>[t(me,{cols:"12",md:"6",class:"left-panel"},{default:l(()=>[d("div",Tt,[t(J,{variant:"outlined",class:"mb-4"},{default:l(()=>[t(x,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[t(i,{size:"small",class:"mr-2"},{default:l(()=>e[36]||(e[36]=[s("mdi-account")])),_:1,__:[36]}),e[37]||(e[37]=s(" Customer Information "))]),_:1,__:[37]}),t(E,{class:"pa-3"},{default:l(()=>{var n,V;return[d("div",kt,[t(D,{"prepend-inner-icon":"mdi-account",modelValue:r.value.customer.full_name,"onUpdate:modelValue":e[0]||(e[0]=_=>r.value.customer.full_name=_),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[X.required],placeholder:"N/A"},null,8,["modelValue","rules"])]),d("div",Ut,[t(D,{"prepend-inner-icon":"mdi-phone",modelValue:r.value.customer.phone,"onUpdate:modelValue":e[1]||(e[1]=_=>r.value.customer.phone=_),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[X.phone],placeholder:"N/A"},null,8,["modelValue","rules"]),t(p,{icon:"",size:"x-small",variant:"text",onClick:e[2]||(e[2]=_=>Pe(r.value.customer.phone)),class:"ml-1"},{default:l(()=>[t(i,{size:"14"},{default:l(()=>e[38]||(e[38]=[s("mdi-content-copy")])),_:1,__:[38]})]),_:1})]),(n=r.value)!=null&&n.customer.email?(k(),A("div",Ot,[t(i,{size:"20",class:"mr-2"},{default:l(()=>e[39]||(e[39]=[s("mdi-email")])),_:1,__:[39]}),d("span",Pt,y((V=r.value)==null?void 0:V.customer.email),1)])):ae("",!0),t(xe,{modelValue:r.value.customer.city_id,"onUpdate:modelValue":e[3]||(e[3]=_=>r.value.customer.city_id=_),items:z(N).cityOptions,"item-title":"name","item-value":"id",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[X.required],clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items","rules"]),t(xe,{modelValue:r.value.customer.zone_id,"onUpdate:modelValue":e[4]||(e[4]=_=>r.value.customer.zone_id=_),items:z(N).zoneOptions,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items"]),t(D,{modelValue:r.value.customer.address,"onUpdate:modelValue":e[5]||(e[5]=_=>r.value.customer.address=_),label:"Address","prepend-inner-icon":"mdi-map-marker",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"]),t(D,{modelValue:r.value.customer_notes,"onUpdate:modelValue":e[6]||(e[6]=_=>r.value.customer_notes=_),label:"Customer Notes","prepend-inner-icon":"mdi-note-text",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"])]}),_:1})]),_:1}),d("div",Mt,[d("h3",Nt,[t(i,{class:"mr-1",size:"small"},{default:l(()=>e[40]||(e[40]=[s("mdi-package-variant")])),_:1,__:[40]}),e[41]||(e[41]=s(" Order Items "))]),t(Ke,{density:"comfortable",class:"mb-2"},{default:l(()=>[e[42]||(e[42]=d("thead",null,[d("tr",null,[d("th",{style:{width:"30%"}},"Product"),d("th",{style:{width:"15%"}},"Quantity"),d("th",{style:{width:"30%"}}," Unit Price "),d("th",{style:{width:"15%"}},"Total"),d("th",{style:{width:"10%"}})])],-1)),d("tbody",null,[(k(!0),A(He,null,je(r.value.order_items||[],(n,V)=>(k(),A("tr",{key:n.id||V},[d("td",null,[t(xe,{modelValue:n.product_id,"onUpdate:modelValue":[_=>n.product_id=_,_=>Ue(n,_)],items:z(N).productOptions,"item-title":"product_name","item-value":"id",placeholder:"Product name",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),d("td",null,[t(D,{modelValue:n.quantity,"onUpdate:modelValue":[_=>n.quantity=_,e[7]||(e[7]=_=>F())],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,[t(D,{modelValue:n.unit_price,"onUpdate:modelValue":[_=>n.unit_price=_,e[8]||(e[8]=_=>F())],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,y((n.quantity*n.unit_price).toFixed(2)),1),d("td",null,[t(p,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:_=>I(V)},null,8,["onClick"])])]))),128))])]),_:1,__:[42]}),t(p,{color:"primary",variant:"text","prepend-icon":"mdi-plus",onClick:$,class:"mt-2"},{default:l(()=>e[43]||(e[43]=[s(" Add Item ")])),_:1,__:[43]})]),d("div",zt,[t(Ge,null,{default:l(()=>[t(me,{cols:"12",md:"4"},{default:l(()=>[t(D,{"model-value":ie(),"onUpdate:modelValue":e[9]||(e[9]=n=>S.value.total_price=n),label:"Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1}),t(me,{cols:"12",md:"4"},{default:l(()=>[t(D,{modelValue:S.value.shipping_charges,"onUpdate:modelValue":[e[10]||(e[10]=n=>S.value.shipping_charges=n),e[11]||(e[11]=n=>F())],label:"Shipping Charges",type:"number",min:"0",step:"0.01",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(me,{cols:"12",md:"4"},{default:l(()=>[t(D,{"model-value":(parseFloat(ie())+parseFloat(S.value.shipping_charges||0)).toFixed(2),label:"Grand Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),t(J,{variant:"outlined"},{default:l(()=>[t(x,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[t(i,{size:"small",class:"mr-2"},{default:l(()=>e[44]||(e[44]=[s("mdi-lightning-bolt")])),_:1,__:[44]}),e[45]||(e[45]=s(" Quick Actions "))]),_:1,__:[45]}),t(E,{class:"pa-2"},{default:l(()=>[t(p,{block:"",variant:"outlined",color:"primary",size:"small",class:"mb-2",onClick:Ie},{default:l(()=>[t(i,{size:"18",class:"mr-2"},{default:l(()=>e[46]||(e[46]=[s("mdi-history")])),_:1,__:[46]}),e[47]||(e[47]=s(" Order History "))]),_:1,__:[47]}),t(p,{block:"",variant:"outlined",color:"orange",size:"small",onClick:Fe},{default:l(()=>[t(i,{size:"18",class:"mr-2"},{default:l(()=>e[48]||(e[48]=[s("mdi-cart")])),_:1,__:[48]}),e[49]||(e[49]=s(" Customer Orders "))]),_:1,__:[49]})]),_:1})]),_:1})])]),_:1}),t(M,{vertical:""}),t(me,{cols:"12",md:"6",class:"right-panel"},{default:l(()=>[t(Ze,{modelValue:G.value,"onUpdate:modelValue":e[12]||(e[12]=n=>G.value=n),"bg-color":"blue-grey-lighten-5",height:"48"},{default:l(()=>[t(qe,{value:"call"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[50]||(e[50]=[s("mdi-phone")])),_:1,__:[50]}),e[51]||(e[51]=s(" Call "))]),_:1,__:[51]}),t(qe,{value:"message"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[52]||(e[52]=[s("mdi-message")])),_:1,__:[52]}),e[53]||(e[53]=s(" Message "))]),_:1,__:[53]}),t(qe,{value:"status"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[54]||(e[54]=[s("mdi-update")])),_:1,__:[54]}),e[55]||(e[55]=s(" Update Status "))]),_:1,__:[55]})]),_:1},8,["modelValue"]),t(ut,{modelValue:G.value,"onUpdate:modelValue":e[29]||(e[29]=n=>G.value=n),class:"tab-content"},{default:l(()=>[t(Re,{value:"call",class:"pa-4"},{default:l(()=>[t(J,{variant:"outlined",class:"mb-4"},{default:l(()=>[t(E,null,{default:l(()=>[e[62]||(e[62]=d("div",{class:"text-h6 mb-4"}," Make a Call ",-1)),t(D,{modelValue:te.value.phone,"onUpdate:modelValue":e[13]||(e[13]=n=>te.value.phone=n),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",readonly:"",class:"mb-3"},null,8,["modelValue"]),W.value?(k(),A("div",Ft,[d("div",qt,[t(C,{color:"green",size:"80",class:"pulse-animation"},{default:l(()=>[t(i,{size:"40",color:"white"},{default:l(()=>e[58]||(e[58]=[s("mdi-phone-in-talk")])),_:1,__:[58]})]),_:1}),e[59]||(e[59]=d("div",{class:"text-h6 mt-3"}," Call in Progress ",-1)),d("div",At,y(ee.value),1)]),d("div",Rt,[t(p,{icon:"",size:"large",color:Q.value?"error":"grey",variant:"outlined",onClick:ze},{default:l(()=>[t(i,null,{default:l(()=>[s(y(Q.value?"mdi-microphone-off":"mdi-microphone"),1)]),_:1})]),_:1},8,["color"]),t(p,{icon:"",size:"large",color:"grey",variant:"outlined",onClick:Ce},{default:l(()=>[t(i,null,{default:l(()=>e[60]||(e[60]=[s("mdi-pause")])),_:1,__:[60]})]),_:1}),t(p,{icon:"",size:"large",color:"red",variant:"flat",onClick:we},{default:l(()=>[t(i,null,{default:l(()=>e[61]||(e[61]=[s("mdi-phone-hangup")])),_:1,__:[61]})]),_:1})])])):(k(),A("div",It,[t(p,{color:"green",size:"x-large",rounded:"pill",elevation:"4",onClick:e[14]||(e[14]=n=>Me(te.value.phone)),loading:se.value,class:"call-button"},{default:l(()=>[t(i,{size:"32",class:"mr-2"},{default:l(()=>e[56]||(e[56]=[s("mdi-phone")])),_:1,__:[56]}),e[57]||(e[57]=s(" Call Customer "))]),_:1,__:[57]},8,["loading"])]))]),_:1,__:[62]})]),_:1}),t(J,{variant:"outlined"},{default:l(()=>[t(x,{class:"text-subtitle-1"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[63]||(e[63]=[s("mdi-history")])),_:1,__:[63]}),e[64]||(e[64]=s(" Recent Calls "))]),_:1,__:[64]}),t(E,null,{default:l(()=>[t(Xe,{density:"compact"},{default:l(()=>[(k(!0),A(He,null,je(ge.value,n=>(k(),ve(Ae,{key:n.id,class:"mb-1"},{prepend:l(()=>[t(i,{color:n.type==="incoming"?"blue":"green"},{default:l(()=>[s(y(n.type==="incoming"?"mdi-phone-incoming":"mdi-phone-outgoing"),1)]),_:2},1032,["color"])]),append:l(()=>[t(p,{icon:"",size:"x-small",variant:"text"},{default:l(()=>[t(i,null,{default:l(()=>e[65]||(e[65]=[s("mdi-play")])),_:1,__:[65]})]),_:1})]),default:l(()=>[t(Le,null,{default:l(()=>[s(y(n.duration),1)]),_:2},1024),t(Ee,null,{default:l(()=>[s(y(n.timestamp),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(Re,{value:"message",class:"pa-4"},{default:l(()=>[t(J,{variant:"outlined"},{default:l(()=>[t(E,null,{item:l(({props:n,item:V})=>[t(Ae,Qe(Ye(n)),{prepend:l(()=>[t(i,null,{default:l(()=>e[70]||(e[70]=[s("mdi-file-document-outline")])),_:1,__:[70]})]),default:l(()=>[t(Le,null,{default:l(()=>[s(y(V.raw.name),1)]),_:2},1024),t(Ee,null,{default:l(()=>[s(y(V.raw.description),1)]),_:2},1024)]),_:2},1040)]),default:l(()=>[e[78]||(e[78]=d("div",{class:"text-h6 mb-4"}," Send Message ",-1)),t(et,{modelValue:Y.value,"onUpdate:modelValue":e[15]||(e[15]=n=>Y.value=n),mandatory:"",divided:"",variant:"outlined",class:"mb-4"},{default:l(()=>[t(p,{value:"whatsapp"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[66]||(e[66]=[s("mdi-whatsapp")])),_:1,__:[66]}),e[67]||(e[67]=s(" WhatsApp "))]),_:1,__:[67]}),t(p,{value:"sms"},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[68]||(e[68]=[s("mdi-message-text")])),_:1,__:[68]}),e[69]||(e[69]=s(" SMS "))]),_:1,__:[69]})]),_:1},8,["modelValue"]),t(xe,{modelValue:z(P).selectedTemplate,"onUpdate:modelValue":[e[16]||(e[16]=n=>z(P).selectedTemplate=n),z(P).onTemplateSelect],items:z(P).allTemplates,"item-title":"name","item-value":"id",label:"Select Template","return-object":"",disabled:z(P).loading.templates,loading:z(P).loading.templates,clearable:"",class:"mt-3","hide-no-data":"",dense:""},null,8,["modelValue","items","disabled","loading","onUpdate:modelValue"]),t(Je,{modelValue:fe.value,"onUpdate:modelValue":e[17]||(e[17]=n=>fe.value=n),label:"Message",variant:"outlined",rows:"8",counter:"",maxlength:Y.value==="sms"?160:1e3,class:"mb-3"},null,8,["modelValue","maxlength"]),d("div",$t,[e[75]||(e[75]=d("div",{class:"text-caption text-grey mb-2"}," Insert Variables: ",-1)),t(tt,null,{default:l(()=>[t(T,{size:"small",onClick:e[18]||(e[18]=n=>Z("{customer_name}"))},{default:l(()=>e[71]||(e[71]=[s(" Customer Name ")])),_:1,__:[71]}),t(T,{size:"small",onClick:e[19]||(e[19]=n=>Z("{order_no}"))},{default:l(()=>e[72]||(e[72]=[s(" Order Number ")])),_:1,__:[72]}),t(T,{size:"small",onClick:e[20]||(e[20]=n=>Z("{delivery_date}"))},{default:l(()=>e[73]||(e[73]=[s(" Delivery Date ")])),_:1,__:[73]}),t(T,{size:"small",onClick:e[21]||(e[21]=n=>Z("{total_price}"))},{default:l(()=>e[74]||(e[74]=[s(" Total Price ")])),_:1,__:[74]})]),_:1})]),t(J,{variant:"tonal",color:"blue-grey-lighten-5",class:"mb-3"},{default:l(()=>[t(E,{class:"text-body-2"},{default:l(()=>[e[76]||(e[76]=d("div",{class:"font-weight-bold mb-2"}," Preview: ",-1)),d("div",Ht,y(ke.value),1)]),_:1,__:[76]})]),_:1}),t(p,{block:"",color:"primary",size:"large",loading:re.value,onClick:b},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[77]||(e[77]=[s("mdi-send")])),_:1,__:[77]}),s(" Send "+y(Y.value.toUpperCase()),1)]),_:1},8,["loading"])]),_:1,__:[78]})]),_:1})]),_:1}),t(Re,{value:"status",class:"pa-4"},{default:l(()=>[t(J,{variant:"outlined"},{default:l(()=>[t(E,null,{default:l(()=>[e[85]||(e[85]=d("div",{class:"text-h6 mb-4"}," Update Order Status ",-1)),t(st,{ref_key:"orderEdit",ref:r},{default:l(()=>[t(lt,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:l(()=>{var n,V,_,ce,pe;return[d("div",jt,[e[79]||(e[79]=d("strong",null,"Current Status:",-1)),s(" "+y(((_=(V=(n=S.value)==null?void 0:n.latest_status)==null?void 0:V.status)==null?void 0:_.name)||"Pending"),1)]),(pe=(ce=S.value)==null?void 0:ce.latest_status)!=null&&pe.created_at?(k(),A("div",Gt," Updated "+y(be(S.value.latest_status.created_at)),1)):ae("",!0)]}),_:1}),t(Be,{modelValue:r.value.status_id,"onUpdate:modelValue":e[22]||(e[22]=n=>r.value.status_id=n),items:z(N).statusOptions,"item-title":"name","item-value":"id",label:"New Status",variant:"outlined",density:"comfortable",rules:[n=>!!n||"Status is required"],class:"mb-3"},{item:l(({props:n,item:V})=>[t(Ae,Qe(Ye(n)),{prepend:l(()=>[t(i,{color:V.raw.color},{default:l(()=>e[80]||(e[80]=[s("mdi-circle")])),_:2,__:[80]},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),r.value.status_id===2?(k(),ve(D,{key:0,modelValue:r.value.delivery_date,"onUpdate:modelValue":e[23]||(e[23]=n=>r.value.delivery_date=n),label:"Delivery Date",type:"date",variant:"outlined",density:"comfortable",rules:[n=>!!n||"Delivery date is required"],class:"mb-3"},null,8,["modelValue","rules"])):ae("",!0),t(Be,{modelValue:r.value.status_category_id,"onUpdate:modelValue":e[24]||(e[24]=n=>r.value.status_category_id=n),items:he.value,"item-title":"name","item-value":"id",label:"Status Category",variant:"outlined",density:"comfortable",disabled:!r.value.status_id,class:"mb-3"},null,8,["modelValue","items","disabled"]),Te.value?(k(),ve(D,{key:1,modelValue:r.value.recall_date,"onUpdate:modelValue":e[25]||(e[25]=n=>r.value.recall_date=n),label:"Recall Date & Time",type:"datetime-local",variant:"outlined",density:"comfortable",rules:[n=>!!n||"Recall date is required"],class:"mb-3"},null,8,["modelValue","rules"])):ae("",!0),t(Je,{modelValue:r.value.status_notes,"onUpdate:modelValue":e[26]||(e[26]=n=>r.value.status_notes=n),label:"Status Notes",variant:"outlined",rows:"4",hint:"Add any relevant information about this status change",class:"mb-3"},null,8,["modelValue"]),t(at,{modelValue:r.value.notifyCustomer,"onUpdate:modelValue":e[27]||(e[27]=n=>r.value.notifyCustomer=n),label:"Notify customer of status change",density:"compact",class:"mb-3"},null,8,["modelValue"]),t(nt,null,{default:l(()=>[r.value.notifyCustomer?(k(),A("div",Lt,[t(ot,{modelValue:r.value.notificationMethod,"onUpdate:modelValue":e[28]||(e[28]=n=>r.value.notificationMethod=n),density:"compact",inline:""},{default:l(()=>[t($e,{label:"SMS",value:"sms"}),t($e,{label:"WhatsApp",value:"whatsapp"}),t($e,{label:"Email",value:"email"})]),_:1},8,["modelValue"])])):ae("",!0)]),_:1}),t(p,{block:"",color:"primary",size:"large",loading:le.value,onClick:Se},{default:l(()=>[t(i,{class:"mr-2"},{default:l(()=>e[81]||(e[81]=[s("mdi-update")])),_:1,__:[81]}),e[82]||(e[82]=s(" Update Status "))]),_:1,__:[82]},8,["loading"])]),_:1},512),t(M,{class:"my-4"}),d("div",Et,[t(i,{class:"mr-2"},{default:l(()=>e[83]||(e[83]=[s("mdi-timeline")])),_:1,__:[83]}),e[84]||(e[84]=s(" Status History "))]),t(it,{density:"compact",side:"end",align:"start"},{default:l(()=>[(k(!0),A(He,null,je(de.value,(n,V)=>(k(),ve(rt,{key:V,"dot-color":n.color,size:"small"},{default:l(()=>[d("div",Jt,y(n.status_name),1),d("div",Bt,y(n.notes),1),d("div",Wt,[s(y(be(n.created_at))+" ",1),n.user?(k(),A("span",Qt," by "+y(n.user),1)):ae("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})]),_:1,__:[85]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(M),t(mt,{class:"pa-4"},{default:l(()=>[t(p,{variant:"outlined",onClick:v},{default:l(()=>e[86]||(e[86]=[s(" Close ")])),_:1,__:[86]}),t(dt),t(p,{color:"success",variant:"flat","prepend-icon":"mdi-check-circle",onClick:u},{default:l(()=>e[87]||(e[87]=[s(" Mark Complete & Close ")])),_:1,__:[87]})]),_:1})]),_:1}),t(ct,{modelValue:L.value.show,"onUpdate:modelValue":e[31]||(e[31]=n=>L.value.show=n),color:L.value.color,timeout:3e3},{actions:l(()=>[t(p,{variant:"text",onClick:e[30]||(e[30]=n=>L.value.show=!1)},{default:l(()=>e[88]||(e[88]=[s(" Close ")])),_:1,__:[88]})]),default:l(()=>[s(y(L.value.message)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["model-value"])}}},Kt=St(Yt,[["__scopeId","data-v-b35940cd"]]),nl=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"}));export{Kt as C,nl as a,xt as u};
