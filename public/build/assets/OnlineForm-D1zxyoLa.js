import{r as d,j as N,k as L,d as n,o as r,b as P,a,u as $,v as F,a2 as M,c as j,y as S,A as i,B as v,e as y,f as m,n as k,t as p,F as D,g as W,C as V,D as H,w as J,T as Y,a4 as G}from"./app-D6iZLtu0.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"page-container"},Z={class:"form-wrapper"},ee={class:"form-group"},ae={class:"form-grid"},oe={class:"form-group"},se={class:"input-icon-wrapper"},te={key:0,class:"error-message"},le={class:"form-group"},re={class:"input-icon-wrapper"},ne={class:"form-group"},ie={class:"input-icon-wrapper"},de={key:0,class:"error-message"},ue={key:1,class:"suggestions-dropdown"},ve=["onMousedown"],pe={class:"form-grid"},ce={class:"form-group"},me={key:0,class:"error-message"},fe={class:"form-group"},ye={class:"form-grid"},he={class:"form-group"},ge=["min"],be={key:0,class:"error-message"},we={key:1,class:"helper-text"},ke={class:"form-group"},_e={class:"checkbox-container"},xe={class:"checkbox-label"},Ce={class:"form-group"},Ne={class:"char-counter"},Pe=["disabled"],Me={key:0},Se={key:1,class:"loading-state"},De={class:"spinner",viewBox:"0 0 24 24",style:{width:"1rem",height:"1rem","margin-right":"0.5rem","vertical-align":"middle"}},Ve={class:"modal-reference"},Te={__name:"OnlineForm",props:{order_no:{type:String}},setup(T){const h=T,o=d({orderNo:h.order_no,phone:"",altPhone:"",address:"",city:"",delivery_date:"",deliveryTime:"",landmark:"",requestCallback:!1,notes:""});N(()=>{var t,w;if(!b||!b.value)return null;const s=b.value;!o.value.orderNo&&s.order_no?o.value.orderNo=s.order_no:o.value.orderNo=s.order_no||o.value.orderNo;const e=(t=s.customer)==null?void 0:t.phone;if(e&&!o.value.phone&&(o.value.phone=normalizeKenyanPhone(e)),!o.value.altPhone&&((w=s.customer)!=null&&w.alt_phone)&&(o.value.altPhone=normalizeKenyanPhone(s.customer.alt_phone)),!o.value.address){const u=s.shipping_address||s.pickup_address||(Array.isArray(s.addresses)&&s.addresses.length?s.addresses[0]:null);u&&typeof u=="object"?o.value.address=u.full_address||u.address||`${u.street||""} ${u.area||""}`.trim()||"":o.value.address=u||""}return!o.value.delivery_date&&s.delivery_date&&(o.value.delivery_date=s.delivery_date.split("T")[0]),o.value.city||(o.value.city=s.shipping_address&&s.shipping_address.city||s.addresses&&s.addresses[0]&&s.addresses[0].city||s.warehouse&&(s.warehouse.city||s.warehouse.city_name)||""),o.value.landmark||(o.value.landmark=s.customer_notes||""),o.value.notes||(o.value.notes=s.customer_notes||""),!0});const l=d({phone:"",address:"",city:"",delivery_date:""}),g=d(!1),_=d(!1),c=d([]),f=d(!1),b=d(null),B=d(!0),x=d(null),K=["Nairobi CBD","Westlands","Kilimani","Parklands","Karen","Lavington","Kileleshwa","Ngong Road","Mombasa Road","Thika Road","Kasarani","Mombasa","Kisumu","Nakuru","Eldoret","Thika","Busia","Kakamega"],O=N(()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]}),U=()=>{const s=/^(?:254|\+254|0)([71])[0-9]{8}$/;return o.value.phone?s.test(o.value.phone.replace(/\s/g,""))?(l.value.phone="",!0):(l.value.phone="Please enter a valid Kenyan phone number",!1):(l.value.phone="Phone number is required",!1)},A=()=>o.value.city?(l.value.city="",!0):(l.value.city="Please select your town/city",!1),q=()=>{const s=new Date(o.value.delivery_date),e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),o.value.delivery_date?s<e?(l.value.delivery_date="Delivery date must be from tomorrow onwards",!1):(l.value.delivery_date="",!0):(l.value.delivery_date="Please select a delivery date",!1)},z=()=>{const s=o.value.address.toLowerCase();s.length>2?(c.value=K.filter(e=>e.toLowerCase().includes(s)).slice(0,5),f.value=c.value.length>0):(c.value=[],f.value=!1)},E=s=>{o.value.address=s,c.value=[],f.value=!1},I=()=>{setTimeout(()=>{f.value=!1},200)},R=async()=>{if(!o.value.phone||o.value.phone.trim().length<7){alert("Please enter a valid phone number."),console.warn("âš ï¸ Invalid phone number:",o.value.phone);return}if(!o.value.address||o.value.address.trim().length<3){alert("Please enter your delivery address."),console.warn("âš ï¸ Invalid address:",o.value.address);return}if(!o.value.city||o.value.city.trim().length<2){alert("Please enter your city."),console.warn("âš ï¸ Invalid city:",o.value.city);return}if(o.value.delivery_date&&isNaN(Date.parse(o.value.delivery_date))){alert("Please enter a valid delivery date."),console.warn("âš ï¸ Invalid delivery date:",o.value.delivery_date);return}g.value=!0;const s=`/api/form/${h.order_no}`;console.log("ðŸš€ Submitting form to:",s),console.log("ðŸ§¾ Payload:",JSON.stringify(o.value,null,2));try{const{data:e}=await axios.post(s,o.value);console.log("ðŸ“¦ Response data:",e),e.success?(console.log("âœ… Submission successful. Server returned:",e.data),_.value=!0,alert(`Order ${e.data.order_no||h.order_no} updated successfully!`)):(console.error("âŒ Server responded with an error:",e),alert(e.message||"Submission failed. Please try again."))}catch(e){console.error("ðŸ’¥ Submission error:",e)}finally{g.value=!1,console.log("ðŸ Submission complete")}},C=()=>{_.value=!1};return L(async()=>{try{const e=await(await fetch(`/api/v1/orders/${h.order_no}`)).json();e.success?b.value=e.data:x.value=e.message||"Order not found."}catch(s){console.error(s),x.value="Error fetching order. Please try again."}finally{B.value=!1}}),(s,e)=>(r(),n(D,null,[P($(F),{title:"Update Delivery Information"}),a("div",X,[a("div",Z,[e[34]||(e[34]=M('<header class="header" data-v-a57706be><div class="logo-container" data-v-a57706be><svg class="logo-icon" width="40" height="40" viewBox="0 0 40 40" fill="none" data-v-a57706be><rect x="5" y="8" width="30" height="24" rx="2" stroke="currentColor" stroke-width="2" data-v-a57706be></rect><circle cx="15" cy="32" r="3" fill="currentColor" data-v-a57706be></circle><circle cx="25" cy="32" r="3" fill="currentColor" data-v-a57706be></circle><path d="M10 20h20" stroke="currentColor" stroke-width="2" data-v-a57706be></path></svg><div class="logo-text" data-v-a57706be><h1 class="logo-title" data-v-a57706be>CRM</h1><p class="logo-tagline" data-v-a57706be>We tailor your Coat</p></div></div></header>',1)),a("form",{onSubmit:S(R,["prevent"]),class:"main-form"},[e[29]||(e[29]=a("h2",{class:"form-title"},"Order Confirmation",-1)),a("div",ee,[e[11]||(e[11]=a("label",{for:"orderNo",class:"form-label"},"Order Number",-1)),i(a("input",{type:"text",id:"orderNo","onUpdate:modelValue":e[0]||(e[0]=t=>o.value.orderNo=t),readonly:"",class:"form-input input-readonly"},null,512),[[v,o.value.orderNo]])]),a("div",ae,[a("div",oe,[e[13]||(e[13]=a("label",{for:"phone",class:"form-label"},[m(" Phone Number "),a("span",{class:"required"},"*")],-1)),a("div",se,[e[12]||(e[12]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),i(a("input",{type:"tel",id:"phone","onUpdate:modelValue":e[1]||(e[1]=t=>o.value.phone=t),placeholder:"e.g., 0712345678",onBlur:U,class:k(["form-input","input-with-icon",{"input-error":l.value.phone}])},null,34),[[v,o.value.phone]])]),l.value.phone?(r(),n("span",te,p(l.value.phone),1)):y("",!0)]),a("div",le,[e[15]||(e[15]=a("label",{for:"altPhone",class:"form-label"},"Alternative Phone (Optional)",-1)),a("div",re,[e[14]||(e[14]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})],-1)),i(a("input",{type:"tel",id:"altPhone","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.altPhone=t),placeholder:"e.g., 0723456789",class:"form-input input-with-icon"},null,512),[[v,o.value.altPhone]])])])]),a("div",ne,[e[17]||(e[17]=a("label",{for:"address",class:"form-label"},[m(" Update Address "),a("span",{class:"required"},"*")],-1)),a("div",ie,[e[16]||(e[16]=a("svg",{class:"input-icon",width:"18",height:"18",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"})],-1)),i(a("input",{type:"text",id:"address","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.address=t),placeholder:"Enter building, street, area",onInput:z,onBlur:I,class:k(["form-input","input-with-icon",{"input-error":l.value.address}])},null,34),[[v,o.value.address]])]),l.value.address?(r(),n("span",de,p(l.value.address),1)):y("",!0),f.value&&c.value.length>0?(r(),n("div",ue,[(r(!0),n(D,null,W(c.value,(t,w)=>(r(),n("div",{key:w,onMousedown:u=>E(t),class:"suggestion-item"},p(t),41,ve))),128))])):y("",!0)]),a("div",pe,[a("div",ce,[e[19]||(e[19]=a("label",{for:"city",class:"form-label"},[m(" Town/City "),a("span",{class:"required"},"*")],-1)),i(a("select",{id:"city","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.city=t),onChange:A,class:k(["form-input",{"input-error":l.value.city}])},e[18]||(e[18]=[M('<option value="" data-v-a57706be>Select town/city</option><option value="Nairobi" data-v-a57706be>Nairobi</option><option value="Mombasa" data-v-a57706be>Mombasa</option><option value="Kisumu" data-v-a57706be>Kisumu</option><option value="Nakuru" data-v-a57706be>Nakuru</option><option value="Eldoret" data-v-a57706be>Eldoret</option><option value="Thika" data-v-a57706be>Thika</option><option value="Malindi" data-v-a57706be>Malindi</option><option value="Kitale" data-v-a57706be>Kitale</option><option value="Busia" data-v-a57706be>Busia</option><option value="Kakamega" data-v-a57706be>Kakamega</option><option value="Other" data-v-a57706be>Other</option>',12)]),34),[[V,o.value.city]]),l.value.city?(r(),n("span",me,p(l.value.city),1)):y("",!0)]),a("div",fe,[e[20]||(e[20]=a("label",{for:"landmark",class:"form-label"},"Landmark/Building",-1)),i(a("input",{type:"text",id:"landmark","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.landmark=t),placeholder:"e.g., Near Nakumatt",class:"form-input"},null,512),[[v,o.value.landmark]]),e[21]||(e[21]=a("span",{class:"helper-text"},"Help us find you easily",-1))])]),a("div",ye,[a("div",he,[e[22]||(e[22]=a("label",{for:"delivery_date",class:"form-label"},[m(" Delivery Date "),a("span",{class:"required"},"*")],-1)),i(a("input",{type:"date",id:"delivery_date","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.delivery_date=t),min:O.value,onChange:q,class:k(["form-input",{"input-error":l.value.delivery_date}])},null,42,ge),[[v,o.value.delivery_date]]),l.value.delivery_date?(r(),n("span",be,p(l.value.delivery_date),1)):(r(),n("span",we,"From tomorrow onwards"))]),a("div",ke,[e[24]||(e[24]=a("label",{for:"deliveryTime",class:"form-label"},"Preferred Time",-1)),i(a("select",{id:"deliveryTime","onUpdate:modelValue":e[7]||(e[7]=t=>o.value.deliveryTime=t),class:"form-input"},e[23]||(e[23]=[a("option",{value:""},"Any time",-1),a("option",{value:"morning"},"Morning (8 AM - 12 PM)",-1),a("option",{value:"afternoon"},"Afternoon (12 PM - 4 PM)",-1),a("option",{value:"evening"},"Evening (4 PM - 7 PM)",-1)]),512),[[V,o.value.deliveryTime]])])]),a("div",_e,[a("label",xe,[i(a("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.requestCallback=t),class:"checkbox-input"},null,512),[[H,o.value.requestCallback]]),e[25]||(e[25]=a("span",{class:"checkbox-content"},[a("strong",{class:"checkbox-title"},"Request a callback from our delivery team"),a("small",{class:"checkbox-subtitle"},"We'll call you to confirm the delivery details")],-1))])]),a("div",Ce,[e[26]||(e[26]=a("label",{for:"notes",class:"form-label"},"Notes",-1)),i(a("textarea",{id:"notes","onUpdate:modelValue":e[9]||(e[9]=t=>o.value.notes=t),rows:"4",placeholder:"Your message here...",maxlength:"500",class:"form-textarea"},null,512),[[v,o.value.notes]]),a("div",Ne,p(o.value.notes.length)+"/500",1)]),a("button",{type:"submit",class:"submit-button",disabled:g.value,style:{"background-color":"#2563eb",color:"white",padding:"0.75rem 1.5rem","border-radius":"0.5rem",border:"none","font-weight":"600"}},[g.value?(r(),n("span",Se,[(r(),n("svg",De,e[27]||(e[27]=[a("circle",{class:"spinner-track",cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none"},null,-1),a("path",{class:"spinner-head",fill:"white",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))),e[28]||(e[28]=m(" Submitting... "))])):(r(),n("span",Me,"Submit"))],8,Pe),e[30]||(e[30]=a("p",{class:"help-text"},[m(" Need help? Call us at "),a("a",{href:"tel:+254700000000",class:"help-link"},"+254 700 000 000")],-1))],32),(r(),j(G,{to:"body"},[P(Y,{name:"modal"},{default:J(()=>[_.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:C},[a("div",{class:"modal-content",onClick:e[10]||(e[10]=S(()=>{},["stop"]))},[e[31]||(e[31]=a("div",{class:"success-icon-wrapper"},[a("svg",{class:"success-icon",width:"60",height:"60",viewBox:"0 0 60 60",fill:"none"},[a("circle",{cx:"30",cy:"30",r:"28",stroke:"#10b981","stroke-width":"4"}),a("path",{d:"M20 30l8 8 12-16",stroke:"#10b981","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[32]||(e[32]=a("h3",{class:"modal-title"},"Success!",-1)),e[33]||(e[33]=a("p",{class:"modal-text"},"We've received your updated delivery information. Our team will contact you soon. ",-1)),a("p",Ve,"Reference: "+p(o.value.orderNo),1),a("button",{onClick:C,class:"modal-button"},"Close")])])):y("",!0)]),_:1})]))])])],64))}},Oe=Q(Te,[["__scopeId","data-v-a57706be"]]);export{Oe as default};
