import{r as U,Q as te,j as b,l as s,c as $,o as g,w as a,b as l,a as r,u as _,f as u,t as C,y as re,d as z,e as Q,F as ne,g as se,R as ie}from"./app-UF4J_52Y.js";import{u as ue}from"./orderStore-DbQmJkUM.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"text-h6"},ve={class:"mb-6"},ce={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},fe={class:"mb-6"},_e={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},be={class:"mb-6"},Ve={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},ye={key:0},ke={key:1},ge={class:"mb-6"},we={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},Ue={__name:"OrderForm",emits:["order-saved","dialog-closed"],setup(Ce,{emit:j}){const E=j,v=ue(),R=U(null),N=U(!1),{dialog:A,isCreateMode:c}=te(v),O=U(!1),V=U("customer"),n={required:m=>!!m||"This field is required",phone:m=>m?/^[\d\s\-\+\(\)]+$/.test(m)||"Invalid phone number format":!0},H=[{title:"API",value:"api"},{title:"Web",value:"web"},{title:"Mobile App",value:"mobile"},{title:"WhatsApp",value:"whatsapp"},{title:"Facebook",value:"facebook"},{title:"Instagram",value:"instagram"}],K=[{title:"Vendor API",value:"vendor_api"},{title:"Customer Web",value:"customer_web"},{title:"Customer Mobile",value:"customer_mobile"},{title:"Agent",value:"agent"},{title:"Call Center",value:"call_center"}],L=b(()=>v.vendorOptions);b(()=>v.categoryOptions);const P=b(()=>v.cityOptions),F=b(()=>v.zoneOptions),G=b(()=>v.warehouseOptions),J=b(()=>v.statusOptions),M=b(()=>v.selectedOrder),d=U({id:null,order_no:"",reference:"",customer_id:null,vendor_id:null,warehouse_id:null,country_id:null,source:"vendor_api",platform:"api",currency:"KSH",sub_total:"0.00",total_price:"0.00",shipping_charges:"0.00",amount_paid:"0.00",weight:"",paid:!1,tracking_no:null,waybill_no:null,distance:"",geocoded:0,archived_at:null,delivery_date:"",status_id:"",customer_notes:"",order_items:[],customer_address:{full_name:"",phone:"",city:"",zone_id:null,address:"",region:"",zipcode:"",email:""},pickup_address:{full_name:"",phone:"",city:"",zone_id:null,address:"",region:"",zipcode:"",email:""},dropoff_address:{full_name:"",phone:"",city:"",zone_id:null,address:"",region:"",zipcode:"",email:""}}),X=m=>{m&&v.fetchDropdownOptions(m)},Y=m=>{m==="customer"?(d.value.from_warehouse_id=null,d.value.to_warehouse_id=null,d.value.from_address={city:""},d.value.to_address={city:""}):d.value.customer_address={full_name:"",phone:"",city:"",zone_id:null,address:""}},D=()=>{v.closeDialog(),E("dialog-closed")},B=async()=>{var m,e;if(await((m=R.value)==null?void 0:m.validate())){O.value=!0;try{let t={...d.value};if(V.value==="customer"?(t.customer={...t.customer_address},delete t.customer_address,delete t.pickup_address,delete t.dropoff_address):V.value==="pickup_dropoff"&&(t.pickup_address={...t.pickup_address},t.dropoff_address={...t.dropoff_address},t.addresses=[{type:"pickup",...t.pickup_address},{type:"shipping",...t.dropoff_address}],delete t.customer_address),Array.isArray(t.order_items)&&(t.order_items=t.order_items.map(y=>({...y,quantity:Number(y.quantity)||1,unit_price:Number(y.unit_price)||0}))),c.value)await v.createOrder(t);else if((e=M.value)!=null&&e.id)await v.updateOrder(M.value.id,t);else throw new Error("No order selected for editing.");E("order-saved"),D()}catch(t){console.error("Error saving order:",t)}finally{O.value=!1}}};return(m,e)=>{const t=s("v-icon"),y=s("v-spacer"),w=s("v-btn"),I=s("v-card-title"),T=s("v-divider"),i=s("v-text-field"),p=s("v-col"),f=s("v-select"),x=s("v-row"),q=s("v-textarea"),W=s("v-radio"),h=s("v-radio-group"),S=s("v-card"),ee=s("v-table"),le=s("v-form"),oe=s("v-card-text"),de=s("v-card-actions"),ae=s("v-dialog");return g(),$(ae,{modelValue:_(A),"onUpdate:modelValue":e[31]||(e[31]=o=>ie(A)?A.value=o:null),"max-width":"800",persistent:""},{default:a(()=>[l(S,null,{default:a(()=>[l(I,{class:"d-flex align-center"},{default:a(()=>[l(t,{class:"mr-2",color:_(c)?"success":"primary"},{default:a(()=>[u(C(_(c)?"mdi-plus-circle":"mdi-pencil"),1)]),_:1},8,["color"]),r("span",pe,C(_(c)?"Create New Order":"Edit Order"),1),l(y),l(w,{icon:"mdi-close",variant:"text",onClick:D})]),_:1}),l(T),l(oe,{class:"pa-6"},{default:a(()=>[l(le,{ref_key:"formRef",ref:R,modelValue:N.value,"onUpdate:modelValue":e[30]||(e[30]=o=>N.value=o),onSubmit:re(B,["prevent"])},{default:a(()=>[r("div",ve,[r("h3",ce,[l(t,{class:"mr-1",size:"small"},{default:a(()=>e[32]||(e[32]=[u("mdi-information")])),_:1,__:[32]}),e[33]||(e[33]=u(" Basic Information "))]),l(x,null,{default:a(()=>[l(p,{cols:"12",md:"6"},{default:a(()=>[l(i,{modelValue:d.value.order_no,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value.order_no=o),label:"Order Number",placeholder:"Enter order number"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.status_id,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value.status_id=o),items:J.value,"item-title":"name","item-value":"id",label:"Status","prepend-inner-icon":"mdi-flag",variant:"outlined",density:"comfortable",rules:[n.required],clearable:"",placeholder:"Select status"},null,8,["modelValue","items","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.platform,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.platform=o),items:H,label:"Platform","prepend-inner-icon":"mdi-devices",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.source,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.source=o),items:K,label:"Order Source","prepend-inner-icon":"mdi-source-branch",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(i,{modelValue:d.value.delivery_date,"onUpdate:modelValue":e[4]||(e[4]=o=>d.value.delivery_date=o),label:"Delivery Date",type:"datetime-local","prepend-inner-icon":"mdi-calendar-clock",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{cols:"12"},{default:a(()=>[l(q,{modelValue:d.value.customer_notes,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value.customer_notes=o),label:"Customer Notes",placeholder:"Enter any special instructions or notes",rows:"4",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),r("div",fe,[r("h3",_e,[l(t,{class:"mr-1",size:"small"},{default:a(()=>e[34]||(e[34]=[u("mdi-store")])),_:1,__:[34]}),e[35]||(e[35]=u(" Vendor & Warehouse "))]),l(x,null,{default:a(()=>[l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.vendor_id,"onUpdate:modelValue":[e[6]||(e[6]=o=>d.value.vendor_id=o),X],items:L.value,"item-title":"name","item-value":"id",label:"Vendor","prepend-inner-icon":"mdi-domain",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","items","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.warehouse_id,"onUpdate:modelValue":e[7]||(e[7]=o=>d.value.warehouse_id=o),items:G.value,"item-title":"name","item-value":"id",label:"Warehouse","prepend-inner-icon":"mdi-warehouse",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),r("div",be,[r("h3",Ve,[l(t,{class:"mr-1",size:"small"},{default:a(()=>e[36]||(e[36]=[u("mdi-map-marker")])),_:1,__:[36]}),e[37]||(e[37]=u(" Address Information "))]),l(h,{modelValue:V.value,"onUpdate:modelValue":[e[8]||(e[8]=o=>V.value=o),Y],inline:"",class:"mb-4"},{default:a(()=>[l(W,{label:"Pickup & Drop-off",value:"pickup_dropoff",color:"primary"}),l(W,{label:"Customer Delivery",value:"customer",color:"primary"})]),_:1},8,["modelValue"]),V.value==="pickup_dropoff"?(g(),z("div",ye,[l(x,null,{default:a(()=>[l(p,{cols:"12",md:"6"},{default:a(()=>[l(S,{variant:"outlined",class:"pa-4"},{default:a(()=>[l(I,{class:"text-subtitle-2 pa-0 mb-3"},{default:a(()=>[l(t,{class:"mr-1",color:"orange"},{default:a(()=>e[38]||(e[38]=[u("mdi-map-marker-up")])),_:1,__:[38]}),e[39]||(e[39]=u(" Pickup Address "))]),_:1,__:[39]}),l(i,{modelValue:d.value.pickup_address.full_name,"onUpdate:modelValue":e[9]||(e[9]=o=>d.value.pickup_address.full_name=o),label:"Full Name","prepend-inner-icon":"mdi-account",variant:"outlined",density:"comfortable",rules:[n.required],class:"mb-3"},null,8,["modelValue","rules"]),l(i,{modelValue:d.value.pickup_address.phone,"onUpdate:modelValue":e[10]||(e[10]=o=>d.value.pickup_address.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",rules:[n.required,n.phone],class:"mb-3"},null,8,["modelValue","rules"]),l(i,{modelValue:d.value.pickup_address.email,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.pickup_address.email=o),label:"Email","prepend-inner-icon":"mdi-email",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(f,{modelValue:d.value.pickup_address.city,"onUpdate:modelValue":e[12]||(e[12]=o=>d.value.pickup_address.city=o),items:P.value,"item-title":"name","item-value":"name",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[n.required],class:"mb-3"},null,8,["modelValue","items","rules"]),l(f,{modelValue:d.value.pickup_address.zone_id,"onUpdate:modelValue":e[13]||(e[13]=o=>d.value.pickup_address.zone_id=o),items:F.value,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","items"]),l(i,{modelValue:d.value.pickup_address.region,"onUpdate:modelValue":e[14]||(e[14]=o=>d.value.pickup_address.region=o),label:"Region","prepend-inner-icon":"mdi-map",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(i,{modelValue:d.value.pickup_address.zipcode,"onUpdate:modelValue":e[15]||(e[15]=o=>d.value.pickup_address.zipcode=o),label:"Zip Code","prepend-inner-icon":"mdi-numeric",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(q,{modelValue:d.value.pickup_address.address,"onUpdate:modelValue":e[16]||(e[16]=o=>d.value.pickup_address.address=o),label:"Full Address","prepend-inner-icon":"mdi-home",variant:"outlined",density:"comfortable",rows:"2",rules:[n.required]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(S,{variant:"outlined",class:"pa-4"},{default:a(()=>[l(I,{class:"text-subtitle-2 pa-0 mb-3"},{default:a(()=>[l(t,{class:"mr-1",color:"green"},{default:a(()=>e[40]||(e[40]=[u("mdi-map-marker-down")])),_:1,__:[40]}),e[41]||(e[41]=u(" Drop-off Address "))]),_:1,__:[41]}),l(i,{modelValue:d.value.dropoff_address.full_name,"onUpdate:modelValue":e[17]||(e[17]=o=>d.value.dropoff_address.full_name=o),label:"Full Name","prepend-inner-icon":"mdi-account",variant:"outlined",density:"comfortable",rules:[n.required],class:"mb-3"},null,8,["modelValue","rules"]),l(i,{modelValue:d.value.dropoff_address.phone,"onUpdate:modelValue":e[18]||(e[18]=o=>d.value.dropoff_address.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",rules:[n.required,n.phone],class:"mb-3"},null,8,["modelValue","rules"]),l(i,{modelValue:d.value.dropoff_address.email,"onUpdate:modelValue":e[19]||(e[19]=o=>d.value.dropoff_address.email=o),label:"Email","prepend-inner-icon":"mdi-email",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(f,{modelValue:d.value.dropoff_address.city,"onUpdate:modelValue":e[20]||(e[20]=o=>d.value.dropoff_address.city=o),items:P.value,"item-title":"name","item-value":"name",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[n.required],class:"mb-3"},null,8,["modelValue","items","rules"]),l(f,{modelValue:d.value.dropoff_address.zone_id,"onUpdate:modelValue":e[21]||(e[21]=o=>d.value.dropoff_address.zone_id=o),items:F.value,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","items"]),l(i,{modelValue:d.value.dropoff_address.region,"onUpdate:modelValue":e[22]||(e[22]=o=>d.value.dropoff_address.region=o),label:"Region","prepend-inner-icon":"mdi-map",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(i,{modelValue:d.value.dropoff_address.zipcode,"onUpdate:modelValue":e[23]||(e[23]=o=>d.value.dropoff_address.zipcode=o),label:"Zip Code","prepend-inner-icon":"mdi-numeric",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"]),l(q,{modelValue:d.value.dropoff_address.address,"onUpdate:modelValue":e[24]||(e[24]=o=>d.value.dropoff_address.address=o),label:"Full Address","prepend-inner-icon":"mdi-home",variant:"outlined",density:"comfortable",rows:"2",rules:[n.required]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})])):V.value==="customer"?(g(),z("div",ke,[l(x,null,{default:a(()=>[l(p,{cols:"12",md:"6"},{default:a(()=>[l(i,{modelValue:d.value.customer_address.full_name,"onUpdate:modelValue":e[25]||(e[25]=o=>d.value.customer_address.full_name=o),label:"Customer Name","prepend-inner-icon":"mdi-account",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(i,{modelValue:d.value.customer_address.phone,"onUpdate:modelValue":e[26]||(e[26]=o=>d.value.customer_address.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",rules:[n.required,n.phone]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.customer_address.city,"onUpdate:modelValue":e[27]||(e[27]=o=>d.value.customer_address.city=o),items:P.value,"item-title":"name","item-value":"name",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[n.required]},null,8,["modelValue","items","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:d.value.customer_address.zone_id,"onUpdate:modelValue":e[28]||(e[28]=o=>d.value.customer_address.zone_id=o),items:F.value,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])]),_:1}),l(p,{cols:"12"},{default:a(()=>[l(q,{modelValue:d.value.customer_address.address,"onUpdate:modelValue":e[29]||(e[29]=o=>d.value.customer_address.address=o),label:"Full Address","prepend-inner-icon":"mdi-home",variant:"outlined",density:"comfortable",rows:"2",rules:[n.required]},null,8,["modelValue","rules"])]),_:1})]),_:1})])):Q("",!0)]),r("div",ge,[r("h3",we,[l(t,{class:"mr-1",size:"small"},{default:a(()=>e[42]||(e[42]=[u("mdi-package-variant")])),_:1,__:[42]}),e[43]||(e[43]=u(" Order Items "))]),l(ee,{density:"comfortable",class:"mb-2"},{default:a(()=>[e[44]||(e[44]=r("thead",null,[r("tr",null,[r("th",{style:{width:"30%"}},"Product"),r("th",{style:{width:"15%"}},"Quantity"),r("th",{style:{width:"15%"}},"Unit Price"),r("th",{style:{width:"15%"}},"Total"),r("th",{style:{width:"10%"}})])],-1)),r("tbody",null,[(g(!0),z(ne,null,se(d.value.order_items||[],(o,Z)=>(g(),z("tr",{key:o.id||Z},[r("td",null,[l(i,{modelValue:o.product_name,"onUpdate:modelValue":k=>o.product_name=k,placeholder:"Product name",density:"compact","hide-details":"",variant:"outlined",readonly:!_(c)&&!o.editable},null,8,["modelValue","onUpdate:modelValue","readonly"])]),r("td",null,[l(i,{modelValue:o.quantity,"onUpdate:modelValue":k=>o.quantity=k,modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined",readonly:!_(c)&&!o.editable},null,8,["modelValue","onUpdate:modelValue","readonly"])]),r("td",null,[l(i,{modelValue:o.unit_price,"onUpdate:modelValue":k=>o.unit_price=k,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",prefix:"$",readonly:!_(c)&&!o.editable},null,8,["modelValue","onUpdate:modelValue","readonly"])]),r("td",null," $"+C((o.quantity*o.unit_price).toFixed(2)),1),r("td",null,[_(c)||o.editable!==!1?(g(),$(w,{key:0,icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:k=>m.removeOrderItem(Z)},null,8,["onClick"])):Q("",!0)])]))),128))])]),_:1,__:[44]}),l(w,{color:"primary",variant:"text","prepend-icon":"mdi-plus",onClick:m.addOrderItem,class:"mt-2"},{default:a(()=>e[45]||(e[45]=[u(" Add Item ")])),_:1,__:[45]},8,["onClick"])])]),_:1},8,["modelValue"])]),_:1}),l(T),l(de,{class:"pa-4"},{default:a(()=>[l(y),l(w,{variant:"outlined",onClick:D,disabled:O.value},{default:a(()=>e[46]||(e[46]=[u(" Cancel ")])),_:1,__:[46]},8,["disabled"]),l(w,{color:_(c)?"success":"primary",variant:"flat",onClick:B,loading:O.value,disabled:!N.value},{default:a(()=>[l(t,{class:"mr-1"},{default:a(()=>[u(C(_(c)?"mdi-plus":"mdi-content-save"),1)]),_:1}),u(" "+C(_(c)?"Create Order":"Save Changes"),1)]),_:1},8,["color","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},ze=me(Ue,[["__scopeId","data-v-7dfcea4d"]]);export{ze as default};
