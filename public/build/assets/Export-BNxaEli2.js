import{_ as A}from"./AppLayout-Da9RKtEk.js";import{D as z}from"./DualDatePicker-W2SP3Toh.js";import{u as T}from"./orderStore-DWILlLxv.js";import{E,r as _,j as F,i as P,k as M,l as B,c as Z,o as a,w as L,a as o,d as s,e as c,b as g,f as D,u as t,F as h,t as R,g as S,n as I}from"./app-CBv0IuCw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-BD9ZglgP.js";import"./africastalking-Cw3_wxI2.js";import"./IncomingCallDialog-BZb8C49a.js";/* empty css                                                                           */import"./toast-z3PBESwk.js";const $=E("orderReport",()=>{const m=T(),l=[{id:"merchant",name:"Merchant Report"}],n={delivery:["zone","city","rider","deliveryDate","shippingStatus"],returns:["zone","city","rider","deliveryDate","shippingStatus"],dispatch:["merchant","zone","city","orderDate"],out_scan:["zone","city","rider","deliveryDate"],undispatched:["merchant","product","zone","city","orderDate"],merchant:["merchant","product","zone","city","confirmationStatus","shippingStatus","orderDate","statusDate"],product:["merchant","product","category","zone","city","orderDate"],product_performance:["merchant","product","category","orderDate"],city:["city","zone","orderDate","shippingStatus"],zone:["zone","city","orderDate","shippingStatus"]},p={delivery:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"}],merchant:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"special_instructions",label:"Special Instructions"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"},{key:"agent",label:"Agent"}],default:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_phone",label:"Receiver Phone"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"city",label:"City"},{key:"zone",label:"Zone"}]},y=_(null),x=_({merchant:null,product:null,category:null,zone:null,city:null,rider:null,agent:null,confirmationStatus:null,shippingStatus:null,orderDate:null,deliveryDate:null}),b=_({merchants:[],products:[],categories:[],zones:[],cities:[],riders:[],agents:[],confirmationStatuses:[]}),w=_([]),f=_({page:1,perPage:25,total:0}),u=_({generate:!1,download:!1,options:!1}),e=_(null),d=F(()=>y.value?n[y.value]??[]:[]),r=F(()=>y.value?p[y.value]??p.default:[]);function V(){y.value=null,Object.keys(x.value).forEach(i=>x.value[i]=null),w.value=[],e.value=null,f.value={page:1,perPage:25,total:0}}function C(){const i={report_type:y.value,page:f.value.page,per_page:f.value.perPage,merchant:m.orderFilterVendor,product:m.orderFilterProduct,category:m.orderFilterCategory,zone:m.orderFilterZone,city:m.orderFilterCity,rider:m.orderFilterRider,agent:m.orderFilterAgent,confirmationStatus:m.orderFilterStatus,statusDate:m.statusDateRange,deliveryDate:m.deliveryDateRange,orderDate:m.createdDateRange};return d.value.forEach(v=>{x.value[v]!==null&&x.value[v]!==""&&(i[v]=x.value[v])}),i}async function U(){u.value.options=!0;try{const{data:i}=await P.get("/api/v1/reports/options");b.value.merchants=i.merchants??[],b.value.products=i.products??[],b.value.categories=i.categories??[],b.value.zones=i.zones??[],b.value.cities=i.cities??[],b.value.riders=i.riders??[],b.value.agents=i.agents??[]}catch(i){console.error("Failed to load report options",i)}finally{u.value.options=!1}}async function O(){var i,v;if(y.value){e.value=null,u.value.generate=!0,f.value.page=1;try{const{data:k}=await P.get("/api/v1/reports/generate",{params:C()});w.value=k.data??[],f.value.total=k.total??0}catch(k){e.value=((v=(i=k.response)==null?void 0:i.data)==null?void 0:v.message)??"Failed to generate report.",w.value=[]}finally{u.value.generate=!1}}}async function j(i){f.value.page=i,await O()}async function N(){if(y.value){u.value.download=!0;try{const i=await P.get("/api/v1/reports/download",{params:{...C(),format:"xlsx"},responseType:"blob"}),v=URL.createObjectURL(new Blob([i.data])),k=document.createElement("a");k.href=v,k.setAttribute("download",`${y.value}_report_${Date.now()}.xlsx`),document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(v)}catch{e.value="Failed to download Excel file."}finally{u.value.download=!1}}}return{reportTypes:l,selectedReportType:y,filters:x,options:b,results:w,pagination:f,loading:u,error:e,activeFilterFields:d,activeColumns:r,fetchOptions:U,generateReport:O,changePage:j,downloadExcel:N,resetFilters:V}}),H={class:"p-6 max-w-screen-2xl mx-auto"},q={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6"},Q={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4"},G={key:0},J={key:1},K={key:2},W={key:3},X={key:4},Y={key:5},ee={key:6},te={key:7},re={key:8},le={key:9},oe={class:"flex flex-wrap justify-end gap-3 pt-2 border-t border-gray-100"},ae=["disabled"],se={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ne={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ie=["disabled"],de={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ue={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm flex items-center gap-2"},pe={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},me={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between"},ye={class:"text-sm text-gray-500"},ge={key:0,class:"p-6 space-y-3"},be={key:1,class:"overflow-x-auto"},ve={class:"w-full text-sm"},ke={class:"bg-blue-600 text-white"},fe={class:"divide-y divide-gray-100"},xe={key:1},he=["colspan"],we={key:2,class:"px-6 py-4 border-t border-gray-100 flex items-center justify-center gap-1"},_e=["onClick"],Ue={__name:"Export",setup(m){const l=$(),n=T();function p(u){return l.activeFilterFields.includes(u)}function y(){l.results=[],l.error=null}async function x(){await l.generateReport()}function b(){l.resetFilters()}const w=F(()=>Math.ceil(l.pagination.total/l.pagination.perPage)),f=F(()=>{const u=w.value,e=l.pagination.page;if(u<=7)return Array.from({length:u},(r,V)=>V+1);const d=[];e>3&&(d.push(1),e>4&&d.push("..."));for(let r=Math.max(1,e-2);r<=Math.min(u,e+2);r++)d.push(r);return e<u-3&&d.push("..."),e<u-2&&d.push(u),d});return M(async()=>{await n.initialize(),l.fetchOptions()}),(u,e)=>{const d=B("v-autocomplete");return a(),Z(A,null,{default:L(()=>[o("div",H,[e[30]||(e[30]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6 tracking-wide uppercase"}," Reports ",-1)),o("div",q,[o("div",Q,[o("div",null,[e[12]||(e[12]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},[D(" Report Type "),o("span",{class:"text-red-500"},"*")],-1)),g(d,{modelValue:t(l).selectedReportType,"onUpdate:modelValue":[e[0]||(e[0]=r=>t(l).selectedReportType=r),y],items:t(l).reportTypes,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select report type...",class:"w-full"},null,8,["modelValue","items"])]),t(l).selectedReportType?(a(),s(h,{key:0},[p("merchant")?(a(),s("div",G,[e[13]||(e[13]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Merchant",-1)),g(d,{modelValue:t(n).orderFilterVendor,"onUpdate:modelValue":e[1]||(e[1]=r=>t(n).orderFilterVendor=r),items:t(n).vendorOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select merchant...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("product")?(a(),s("div",J,[e[14]||(e[14]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Product",-1)),g(d,{modelValue:t(n).orderFilterProduct,"onUpdate:modelValue":e[2]||(e[2]=r=>t(n).orderFilterProduct=r),items:t(n).productOptions,"item-title":"product_name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select product...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("category")?(a(),s("div",K,[e[15]||(e[15]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Category",-1)),g(d,{modelValue:t(n).orderFilterCategory,"onUpdate:modelValue":e[3]||(e[3]=r=>t(n).orderFilterCategory=r),items:t(n).categoryOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select category...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("zone")?(a(),s("div",W,[e[16]||(e[16]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Zone",-1)),g(d,{modelValue:t(n).orderFilterZone,"onUpdate:modelValue":e[4]||(e[4]=r=>t(n).orderFilterZone=r),items:t(n).zoneOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select zone...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("city")?(a(),s("div",X,[e[17]||(e[17]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"City",-1)),g(d,{modelValue:t(n).orderFilterCity,"onUpdate:modelValue":e[5]||(e[5]=r=>t(n).orderFilterCity=r),items:t(n).cityOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select city...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("rider")?(a(),s("div",Y,[e[18]||(e[18]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Person",-1)),g(d,{modelValue:t(n).orderFilterRider,"onUpdate:modelValue":e[6]||(e[6]=r=>t(n).orderFilterRider=r),items:t(n).riderOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select rider...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("confirmationStatus")?(a(),s("div",ee,[e[19]||(e[19]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Confirmation Status",-1)),g(d,{modelValue:t(n).orderFilterStatus,"onUpdate:modelValue":e[7]||(e[7]=r=>t(n).orderFilterStatus=r),items:t(n).statusOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select status...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("statusDate")?(a(),s("div",te,[e[20]||(e[20]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Status Date",-1)),g(z,{modelValue:t(n).statusDateRange,"onUpdate:modelValue":e[8]||(e[8]=r=>t(n).statusDateRange=r)},null,8,["modelValue"])])):c("",!0),p("orderDate")?(a(),s("div",re,[e[21]||(e[21]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Created Date",-1)),g(z,{modelValue:t(n).createdDateRange,"onUpdate:modelValue":e[9]||(e[9]=r=>t(n).createdDateRange=r)},null,8,["modelValue"])])):c("",!0),p("deliveryDate")?(a(),s("div",le,[e[22]||(e[22]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Date",-1)),g(z,{modelValue:t(n).filters.deliveryDate,"onUpdate:modelValue":e[10]||(e[10]=r=>t(n).filters.deliveryDate=r)},null,8,["modelValue"])])):c("",!0)],64)):c("",!0)]),o("div",oe,[o("button",{onClick:x,disabled:!t(l).selectedReportType||t(l).loading.generate,class:"inline-flex items-center gap-2 px-6 py-2 bg-red-600 text-white text-sm font-semibold rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(l).loading.generate?(a(),s("span",se)):(a(),s("svg",ne,e[23]||(e[23]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))),e[24]||(e[24]=D(" Generate Report "))],8,ae),o("button",{onClick:e[11]||(e[11]=(...r)=>t(l).downloadExcel&&t(l).downloadExcel(...r)),disabled:!t(l).results.length||t(l).loading.download,class:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white text-sm font-semibold rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(l).loading.download?(a(),s("span",de)):(a(),s("svg",ue,e[25]||(e[25]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)]))),e[26]||(e[26]=D(" Download Excel "))],8,ie),o("button",{onClick:b,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors"},e[27]||(e[27]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),D(" Reset ")]))]),t(l).error?(a(),s("div",ce,[e[28]||(e[28]=o("svg",{class:"w-4 h-4 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),D(" "+R(t(l).error),1)])):c("",!0)]),t(l).selectedReportType?(a(),s("div",pe,[o("div",me,[e[29]||(e[29]=o("h2",{class:"text-lg font-semibold text-gray-800"}," Report Results ",-1)),o("span",ye,[t(l).pagination.total>0?(a(),s(h,{key:0},[D(" Showing "+R((t(l).pagination.page-1)*t(l).pagination.perPage+1)+"–"+R(Math.min(t(l).pagination.page*t(l).pagination.perPage,t(l).pagination.total))+" of "+R(t(l).pagination.total)+" records ",1)],64)):t(l).loading.generate?c("",!0):(a(),s(h,{key:1},[D(" No results yet ")],64))])]),t(l).loading.generate?(a(),s("div",ge,[(a(),s(h,null,S(8,r=>o("div",{key:r,class:"h-8 bg-gray-100 rounded animate-pulse"})),64))])):t(l).activeColumns.length?(a(),s("div",be,[o("table",ve,[o("thead",null,[o("tr",ke,[(a(!0),s(h,null,S(t(l).activeColumns,r=>(a(),s("th",{key:r.key,class:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider whitespace-nowrap"},R(r.label),1))),128))])]),o("tbody",fe,[t(l).results.length?(a(!0),s(h,{key:0},S(t(l).results,(r,V)=>(a(),s("tr",{key:V,class:"hover:bg-gray-50 transition-colors"},[(a(!0),s(h,null,S(t(l).activeColumns,C=>(a(),s("td",{key:C.key,class:"px-4 py-3 text-gray-700 whitespace-nowrap"},R(r[C.key]??"—"),1))),128))]))),128)):(a(),s("tr",xe,[o("td",{colspan:t(l).activeColumns.length,class:"px-4 py-10 text-center text-gray-400"}," No items found. Adjust filters and generate the report. ",8,he)]))])])])):c("",!0),w.value>1?(a(),s("div",we,[(a(!0),s(h,null,S(f.value,r=>(a(),s("button",{key:r,onClick:V=>r!=="..."&&t(l).changePage(r),class:I(["w-8 h-8 rounded flex items-center justify-center text-sm font-medium transition-colors",r===t(l).pagination.page?"bg-blue-600 text-white":r==="..."?"text-gray-400 cursor-default":"text-gray-600 hover:bg-gray-100"])},R(r),11,_e))),128))])):c("",!0)])):c("",!0)])]),_:1})}}};export{Ue as default};
