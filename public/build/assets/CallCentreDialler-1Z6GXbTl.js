import{E as pt,r as u,j as O,Q as _t,s as ft,l as i,c as xe,o as x,w as l,b as a,a as r,f as s,t as _,u as h,d as U,e as Y,F as $e,g as He,p as Qe,q as Ye}from"./app-BorYhYvE.js";import{u as gt}from"./orderStore-CqTCRlb1.js";import{u as yt}from"./callCenter-CbsThL-7.js";import{u as bt}from"./whatsappStore-BdYAshGt.js";import{u as Ct}from"./webrtc-BmLTgSq6.js";import{u as wt}from"./auth-CVEmNjhR.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xt=pt("callCentreDialler",()=>{const b=u(null),te=u(!1),ae=u("call"),m=u({active:!1,calling:!1,muted:!1,onHold:!1,duration:0,startTime:null,recordCall:!0,autoLog:!0}),D=u([]),F=u(null),p=u({type:"whatsapp",selectedTemplate:null,sending:!1,content:"",subject:"",attachments:[]}),ve=u([{id:1,name:"Order Confirmation",description:"Confirm order details",content:"Dear {customer_name}, your order #{order_no} has been confirmed and will be delivered on {delivery_date}.",type:"all"},{id:2,name:"Delivery Update",description:"Update on delivery status",content:"Hi {customer_name}, your order #{order_no} is out for delivery and will arrive on {delivery_date}.",type:"all"},{id:3,name:"Payment Reminder",description:"Remind about pending payment",content:"Hello {customer_name}, please complete payment of KSH {total_price} for order #{order_no}. Thank you!",type:"all"},{id:4,name:"Order Cancellation",description:"Notify order cancellation",content:"Dear {customer_name}, we regret to inform you that order #{order_no} has been cancelled. Please contact us for more details.",type:"all"},{id:5,name:"Feedback Request",description:"Request customer feedback",content:"Hi {customer_name}, thank you for your order #{order_no}. We would love to hear your feedback!",type:"all"}]),P=u({updating:!1,formData:{status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}),N=u([{id:1,name:"Pending",color:"orange",description:"Order awaiting confirmation"},{id:2,name:"Confirmed",color:"green",description:"Order confirmed by customer"},{id:3,name:"Processing",color:"blue",description:"Order being prepared"},{id:4,name:"Shipped",color:"purple",description:"Order dispatched for delivery"},{id:5,name:"Delivered",color:"teal",description:"Order delivered to customer"},{id:6,name:"Follow Up",color:"amber",description:"Requires follow up"},{id:7,name:"Cancelled",color:"red",description:"Order cancelled"},{id:8,name:"On Hold",color:"grey",description:"Order temporarily on hold"}]),z=u([{id:1,name:"Standard",status_id:1,description:"Standard processing"},{id:2,name:"Expedited",status_id:2,description:"Fast-track processing"},{id:3,name:"Follow Up",status_id:6,description:"Requires callback",requiresRecall:!0},{id:4,name:"Customer Request",status_id:8,description:"Customer requested hold"},{id:5,name:"Payment Issue",status_id:6,description:"Payment verification needed",requiresRecall:!0}]),le=u([]),w=u({saving:!1,formData:{type:"General",content:"",pinned:!1}}),Ve=u([{value:"General",text:"General Note",color:"blue-grey"},{value:"Call Summary",text:"Call Summary",color:"blue"},{value:"Customer Request",text:"Customer Request",color:"purple"},{value:"Issue",text:"Issue/Problem",color:"red"},{value:"Follow Up",text:"Follow Up Required",color:"orange"},{value:"Payment",text:"Payment Related",color:"green"}]),k=u([]),K=u([]),I=u({order:!1,statuses:!1,notes:!1}),q=O(()=>b.value?b.value.customer||b.value.customer_address||b.value.shipping_address||{}:null),G=O(()=>P.value.formData.status_id?z.value.filter(t=>t.status_id===P.value.formData.status_id):[]),d=O(()=>{const t=z.value.find(e=>e.id===P.value.formData.status_category_id);return(t==null?void 0:t.requiresRecall)||!1}),T=O(()=>{const t=m.value.duration,e=Math.floor(t/60),n=t%60;return`${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}`}),L=O(()=>k.value.filter(t=>t.pinned)),oe=O(()=>k.value.filter(t=>!t.pinned)),Z=(t,e=null)=>{console.log("Opening call dialog for phone number:",t),e&&(b.value=e),te.value=!0};function E(){te.value=!1,ae.value="call",ze(),m.value.active&&pe()}function X(t){ae.value=t}function J(){var t;if(!((t=q.value)!=null&&t.phone)){f("No phone number available","error");return}m.value.calling=!0,setTimeout(()=>{m.value.calling=!1,m.value.active=!0,m.value.startTime=Date.now(),ne(),f("Call connected successfully","success")},2e3)}function ne(){F.value=setInterval(()=>{m.value.active&&m.value.duration++},1e3)}function B(){F.value&&(clearInterval(F.value),F.value=null)}function se(){m.value.muted=!m.value.muted,f(m.value.muted?"Microphone muted":"Microphone unmuted","info")}function c(){m.value.onHold=!m.value.onHold,f(m.value.onHold?"Call on hold":"Call resumed","info")}function pe(){var e,n,v;const t=m.value.duration;D.value.unshift({id:Date.now(),order_id:(e=b.value)==null?void 0:e.id,customer_name:(n=q.value)==null?void 0:n.full_name,phone:(v=q.value)==null?void 0:v.phone,type:"outgoing",duration:T.value,timestamp:new Date().toISOString(),recorded:m.value.recordCall,notes:m.value.autoLog?"Auto-logged call":null}),m.value.active=!1,m.value.calling=!1,m.value.muted=!1,m.value.onHold=!1,m.value.duration=0,m.value.startTime=null,B(),f("Call ended","info"),m.value.autoLog&&A(t)}async function A(t){const e={id:Date.now(),type:"Call Summary",content:`Called customer. Duration: ${ue(t)}. ${m.value.recordCall?"Call was recorded.":""}`,pinned:!1,created_at:new Date().toISOString(),user_name:"Current User",auto_generated:!0};k.value.unshift(e)}function ee(t){p.value.type=t,p.value.attachments=[]}function _e(t){const e=ve.value.find(n=>n.id===t);e&&(p.value.content=re(e.content),p.value.type==="email"&&(p.value.subject=e.name),p.value.selectedTemplate=t)}function re(t){return!b.value||!q.value?t:t.replace(/{customer_name}/g,q.value.full_name||"Customer").replace(/{order_no}/g,b.value.order_no||"N/A").replace(/{delivery_date}/g,Ce(b.value.delivery_date)||"N/A").replace(/{total_price}/g,b.value.total_price||"0.00")}function ie(t){p.value.content+=t}function De(t){p.value.attachments.push(t)}function he(t){p.value.attachments.splice(t,1)}async function ke(){var t;if(!p.value.content.trim())return f("Please enter a message","error"),!1;p.value.sending=!0;try{await new Promise(n=>setTimeout(n,1500));const e={id:Date.now(),order_id:(t=b.value)==null?void 0:t.id,type:p.value.type,content:p.value.content,subject:p.value.subject,sent_at:new Date().toISOString(),status:"sent"};return f(`${p.value.type.toUpperCase()} sent successfully`,"success"),W(),!0}catch{return f("Failed to send message","error"),!1}finally{p.value.sending=!1}}async function fe(){var e;const t=P.value.formData;if(!t.status_id||!t.status_notes)return f("Please fill in all required fields","error"),!1;if(d.value&&!t.recall_date)return f("Recall date is required for this status","error"),!1;P.value.updating=!0;try{await new Promise(g=>setTimeout(g,1500));const n=N.value.find(g=>g.id===t.status_id),v={id:Date.now(),order_id:(e=b.value)==null?void 0:e.id,status_id:t.status_id,status_name:n.name,status_category_id:t.status_category_id,notes:t.status_notes,recall_date:t.recall_date,created_at:new Date().toISOString(),user:"Current User",color:n.color};return le.value.unshift(v),b.value&&(b.value.status=n.name,b.value.latest_status=v),f("Status updated successfully","success"),t.notifyCustomer&&await Te(t.notificationMethod,v),ye(),!0}catch{return f("Failed to update status","error"),!1}finally{P.value.updating=!1}}async function Te(t,e){console.log(`Sending ${t} notification for status update:`,e)}async function ge(){var e;const t=w.value.formData;if(!t.content.trim())return f("Please enter note content","error"),!1;w.value.saving=!0;try{await new Promise(v=>setTimeout(v,1e3));const n={id:Date.now(),order_id:(e=b.value)==null?void 0:e.id,type:t.type,content:t.content,pinned:t.pinned,created_at:new Date().toISOString(),user_name:"Current User"};return k.value.unshift(n),f("Note saved successfully","success"),be(),!0}catch{return f("Failed to save note","error"),!1}finally{w.value.saving=!1}}async function Oe(t){const e=k.value.findIndex(n=>n.id===t);e!==-1&&(k.value.splice(e,1),f("Note deleted","success"))}async function S(t){const e=k.value.find(n=>n.id===t);e&&(e.pinned=!e.pinned,f(e.pinned?"Note pinned":"Note unpinned","success"))}async function Ue(t){I.value.order=!0;try{await Pe(t),await Me(t),await Ne(t)}catch(e){console.error("Error loading order data:",e),f("Failed to load order data","error")}finally{I.value.order=!1}}async function Pe(t){I.value.statuses=!0;try{await new Promise(e=>setTimeout(e,500)),le.value=[{id:1,status_name:"Order Placed",notes:"Customer placed order online",created_at:new Date(Date.now()-864e5).toISOString(),user:"System",color:"blue"},{id:2,status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:new Date(Date.now()-828e5).toISOString(),user:"John Doe",color:"green"}]}finally{I.value.statuses=!1}}async function Me(t){I.value.notes=!0;try{await new Promise(e=>setTimeout(e,500)),k.value=[{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:new Date(Date.now()-36e5).toISOString(),user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:new Date(Date.now()-18e5).toISOString(),user_name:"Jane Smith"}]}finally{I.value.notes=!1}}async function Ne(t){await new Promise(e=>setTimeout(e,500)),D.value=[{id:1,type:"outgoing",duration:"5:23",timestamp:new Date(Date.now()-72e5).toISOString()},{id:2,type:"incoming",duration:"3:45",timestamp:new Date(Date.now()-864e5).toISOString()}]}function ze(){W(),ye(),be()}function W(){p.value.content="",p.value.subject="",p.value.attachments=[],p.value.selectedTemplate=null}function ye(){P.value.formData={status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}function be(){w.value.formData={type:"General",content:"",pinned:!1}}function f(t,e="info"){const n={id:Date.now(),message:t,type:e,timestamp:new Date().toISOString()};K.value.push(n),setTimeout(()=>{const v=K.value.findIndex(g=>g.id===n.id);v!==-1&&K.value.splice(v,1)},5e3)}function Ce(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function Ie(t){return t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function ue(t){const e=Math.floor(t/60),n=t%60;return`${e}m ${n}s`}return{activeOrder:b,dialogOpen:te,activeTab:ae,callState:m,callHistory:D,messageState:p,messageTemplates:ve,statusState:P,statusOptions:N,statusCategories:z,statusHistory:le,notesState:w,noteTypes:Ve,notes:k,notifications:K,loading:I,customer:q,filteredStatusCategories:G,shouldShowRecallDate:d,formattedCallDuration:T,pinnedNotes:L,unpinnedNotes:oe,openDialog:Z,closeDialog:E,setActiveTab:X,initiateCall:J,toggleMute:se,holdCall:c,endCall:pe,setMessageType:ee,loadTemplate:_e,insertVariable:ie,addAttachment:De,removeAttachment:he,sendMessage:ke,updateOrderStatus:fe,saveNote:ge,deleteNote:Oe,toggleNotePin:S,loadOrderData:Ue,addNotification:f,formatDate:Ce,formatDateTime:Ie,replaceVariables:re}}),Vt={class:"d-flex align-center w-100"},Dt={class:"flex-grow-1"},ht={class:"text-caption text-grey-lighten-1"},kt={class:"pa-4"},Tt={class:"info-row"},Ot={class:"font-weight-medium"},Ut={class:"info-row"},Pt={key:0,class:"info-row"},Mt={class:"text-truncate"},Nt={key:1,class:"info-row"},zt={class:"text-truncate"},It={key:2,class:"info-row"},Ft={class:"text-truncate"},qt={class:"mb-6"},At={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},Rt={class:"mt-4"},$t={key:0,class:"text-center"},Ht={key:1,class:"call-controls text-center"},jt={class:"call-status mb-4"},Gt={class:"text-caption text-grey"},Lt={class:"d-flex justify-center gap-3"},Et={class:"mb-3"},Jt={class:"preview-content"},Bt={class:"text-body-2"},Wt={key:0,class:"text-caption"},Qt={key:0,class:"ml-8 mb-3"},Yt={class:"text-subtitle-1 font-weight-medium mb-3"},Kt={class:"text-body-2 font-weight-medium"},Zt={class:"text-caption text-grey"},Xt={class:"text-caption text-grey"},ea={key:0},ta={__name:"CallCentreDialler",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","status-updated","note-added"],setup(b,{emit:te}){const ae=wt(),m=O(()=>{var t;return(t=ae.user)==null?void 0:t.id}),D=b,F=Ct(),p=te,ve={required:t=>!!t||"This field is required",phone:t=>t?/^[\d\s\-\+\(\)]+$/.test(t)||"Invalid phone number format":!0},P=O({get:()=>D.modelValue,set:t=>p("update:modelValue",t)}),N=xt(),z=gt(),le=yt(),w=bt();w.onTemplateSelect;const Ve=t=>{d.value.order_items.splice(t,1),k()},k=()=>{orderEdit.value.total_price=ee(),orderEdit.value.sub_total=ee()},K=()=>{d.value.order_items.push({sku:"",quantity:1,unit_price:0,editable:!0}),k()},I=O({get:()=>D.modelValue,set:t=>p("update:modelValue",t)}),q=t=>{p("update:modelValue",t),t||N.closeDialog()},G=u("call"),d=_t(D,"order"),T=O(()=>{var t,e,n;return((t=D.order)==null?void 0:t.customer)||((e=D.order)==null?void 0:e.customer_address)||((n=D.order)==null?void 0:n.shipping_address)||{}}),L=u(!1),oe=u(!1),Z=u("00:00"),E=u(!1),X=u({phone:"",recordCall:!0,autoLog:!0}),J=u("whatsapp");u(null);const ne=u(!1),B=u({subject:"",content:"",attachments:[]}),se=u(!1),c=u({status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"});u(!1);const pe=u({type:"General",content:"",pinned:!1}),A=u({show:!1,message:"",color:"success"}),ee=()=>!d.value.order_items||d.value.order_items.length===0?"0.00":d.value.order_items.reduce((e,n)=>e+Number(n.quantity)*Number(n.unit_price),0).toFixed(2),_e=u([]);u(["General","Call Summary","Customer Request","Issue","Follow Up"]);const re=u([{id:1,type:"outgoing",duration:"5:23",timestamp:"2 hours ago"},{id:2,type:"incoming",duration:"3:45",timestamp:"Yesterday"}]),ie=u([{status_name:"Order Placed",notes:"Customer placed order online",created_at:"2024-01-15T10:30:00",user:"System",color:"blue"},{status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:"2024-01-15T10:35:00",user:"John Doe",color:"green"}]);u([{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:"2024-01-15T14:20:00",user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:"2024-01-15T14:25:00",user_name:"Jane Smith"}]);const De=O(()=>c.value.status_id?_e.value.filter(t=>t.status_id===c.value.status_id):[]),he=O(()=>{const t=_e.value.find(e=>e.id===c.value.status_category_id);return(t==null?void 0:t.name)==="Follow Up"}),ke=O(()=>{var e,n,v;let t=B.value.content||"Your message will appear here...";return t=t.replace("{customer_name}",T.value.full_name||"Customer"),t=t.replace("{order_no}",((e=D.order)==null?void 0:e.order_no)||"N/A"),t=t.replace("{delivery_date}",Te((n=D.order)==null?void 0:n.delivery_date)||"N/A"),t=t.replace("{total_price}",((v=D.order)==null?void 0:v.total_price)||"0.00"),t});ft(()=>D.order,t=>{t&&(X.value.phone=T.value.phone||"",t.order_statuses&&t.order_statuses.length>0&&(ie.value=t.order_statuses.map(e=>{var n,v,g;return{status_name:((n=e.status)==null?void 0:n.name)||"Unknown",notes:e.status_notes||"No notes",created_at:e.created_at,user:((v=e.user)==null?void 0:v.name)||"System",color:fe((g=e.status)==null?void 0:g.name)}})))},{immediate:!0,deep:!0});const fe=t=>({Pending:"orange",Confirmed:"green",Processing:"blue",Shipped:"purple",Delivered:"teal",Cancelled:"red","Follow Up":"amber"})[t]||"grey",Te=t=>t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ge=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Oe=async t=>{try{await navigator.clipboard.writeText(t),S("Phone number copied to clipboard","success")}catch{S("Failed to copy","error")}},S=(t,e="success")=>{A.value={show:!0,message:t,color:e}},Ue=t=>{oe.value=!0,le.callClient(t),console.log("Initiating call to:",t),setTimeout(()=>{oe.value=!1,L.value=!0,Pe(),S("Call connected","success")},2e3)},Pe=()=>{let t=0;const e=setInterval(()=>{if(!L.value){clearInterval(e);return}t++;const n=Math.floor(t/60),v=t%60;Z.value=`${String(n).padStart(2,"0")}:${String(v).padStart(2,"0")}`},1e3)},Me=()=>{E.value=!E.value,S(E.value?"Microphone muted":"Microphone unmuted","info")},Ne=()=>{S("Call on hold","info")},ze=()=>{L.value=!1,F.afClient.hangup(),Z.value="00:00",S("Call ended","info"),re.value.unshift({id:Date.now(),type:"outgoing",duration:Z.value,timestamp:"Just now"})},W=t=>{const e=document.querySelector("textarea");if(e){const n=e.selectionStart,v=e.selectionEnd,g=B.value.content;B.value.content=g.substring(0,n)+t+g.substring(v)}else B.value.content+=t},ye=async()=>{var t,e,n,v,g,y;if(!N.messageText.trim()){S("Please enter a message","error");return}ne.value=!0;try{const M={id:T.value.id||((t=d.value.customer)==null?void 0:t.id),name:T.value.full_name||((e=d.value.customer)==null?void 0:e.full_name),phone:T.value.phone||((n=d.value.customer)==null?void 0:n.phone_number),orderId:d.value.id,orderData:d.value,orderOid:d.value.order_no};console.log("ðŸ“¤ Sending message with context:",M),(await w.sendSingleMessage(m.value,M,N.messageText,(v=w.selectedTemplate)==null?void 0:v.id)).success&&(S(`${J.value.toUpperCase()} sent successfully`,"success"),N.messageText="",w.selectedTemplate=null)}catch(M){console.error("âŒ Send message error:",M),S(((y=(g=M.response)==null?void 0:g.data)==null?void 0:y.message)||"Failed to send message","error")}finally{ne.value=!1}},be=async()=>{if(!c.value.status_id||!c.value.status_notes){S("Please fill in all required fields","error");return}se.value=!0,setTimeout(()=>{se.value=!1,S("Status updated successfully","success");const t=statusOptions.value.find(e=>e.id===c.value.status_id);ie.value.unshift({status_name:t.name,notes:c.value.status_notes,created_at:new Date().toISOString(),user:"Current User",color:t.color}),p("status-updated",c.value),c.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"}},1500)},f=()=>{S("Opening order history...","info")},Ce=()=>{S("Opening customer orders...","info")},Ie=()=>{S("Order marked as complete","success"),ue(),z.updateOrder(d)},ue=()=>{P.value=!1,G.value="call",L.value=!1,B.value={subject:"",content:"",attachments:[]},c.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"},pe.value={type:"General",content:"",pinned:!1}};return(t,e)=>{const n=i("v-icon"),v=i("v-avatar"),g=i("v-chip"),y=i("v-btn"),M=i("v-card-title"),de=i("v-divider"),we=i("v-autocomplete"),R=i("v-card-text"),$=i("v-card"),Q=i("v-text-field"),Ke=i("v-table"),me=i("v-col"),je=i("v-row"),Fe=i("v-tab"),Ze=i("v-tabs"),Ge=i("v-list-item-title"),Le=i("v-list-item-subtitle"),qe=i("v-list-item"),Xe=i("v-list"),Ae=i("v-window-item"),et=i("v-btn-toggle"),Ee=i("v-textarea"),tt=i("v-chip-group"),at=i("v-alert"),Je=i("v-select"),lt=i("v-checkbox"),Re=i("v-radio"),ot=i("v-radio-group"),nt=i("v-expand-transition"),st=i("v-form"),rt=i("v-timeline-item"),it=i("v-timeline"),ut=i("v-window"),dt=i("v-spacer"),mt=i("v-card-actions"),ct=i("v-snackbar"),vt=i("v-dialog");return x(),xe(vt,{"model-value":I.value,"onUpdate:modelValue":q,"max-width":"1200px",persistent:"",scrollable:""},{default:l(()=>[a($,{class:"call-center-dialog"},{default:l(()=>[a(M,{class:"dialog-header pa-4"},{default:l(()=>{var o,C,V;return[r("div",Vt,[a(v,{color:"primary",size:"48",class:"mr-3"},{default:l(()=>[a(n,{color:"white",size:"28"},{default:l(()=>e[25]||(e[25]=[s("mdi-headset")])),_:1,__:[25]})]),_:1}),r("div",Dt,[e[26]||(e[26]=r("div",{class:"text-h5 font-weight-bold"},"CallCenter",-1)),r("div",ht," Order #"+_(((o=d.value)==null?void 0:o.order_no)||"N/A")+" - "+_(((C=T.value)==null?void 0:C.full_name)||"Unknown Customer"),1)]),a(g,{color:fe((V=d.value)==null?void 0:V.status),variant:"flat",class:"mr-2"},{default:l(()=>{var H,j,ce;return[s(_(((ce=(j=(H=d.value)==null?void 0:H.latest_status)==null?void 0:j.status)==null?void 0:ce.name)||"Pending"),1)]}),_:1},8,["color"]),a(g,{color:h(F).connectionStatusColor,small:"",class:"white--text px-2"},{default:l(()=>[a(n,{left:"",small:""},{default:l(()=>e[27]||(e[27]=[s("mdi-circle")])),_:1,__:[27]}),s(" "+_(h(F).connectionStatusText),1)]),_:1},8,["color"]),a(y,{icon:"",variant:"text",onClick:ue},{default:l(()=>[a(n,null,{default:l(()=>e[28]||(e[28]=[s("mdi-close")])),_:1,__:[28]})]),_:1})])]}),_:1}),a(de),a(R,{class:"pa-0",style:{height:"70vh"}},{default:l(()=>[a(je,{"no-gutters":"",style:{height:"100%"}},{default:l(()=>[a(me,{cols:"12",md:"6",class:"left-panel"},{default:l(()=>[r("div",kt,[a($,{variant:"outlined",class:"mb-4"},{default:l(()=>[a(M,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[a(n,{size:"small",class:"mr-2"},{default:l(()=>e[29]||(e[29]=[s("mdi-account")])),_:1,__:[29]}),e[30]||(e[30]=s(" Customer Information "))]),_:1,__:[30]}),a(R,{class:"pa-3"},{default:l(()=>{var o,C,V,H,j,ce,Be;return[r("div",Tt,[a(n,{size:"20",class:"mr-2"},{default:l(()=>e[31]||(e[31]=[s("mdi-account-circle")])),_:1,__:[31]}),r("span",Ot,_(((o=d.value.customer)==null?void 0:o.full_name)||"N/A"),1)]),r("div",Ut,[a(n,{size:"20",class:"mr-2"},{default:l(()=>e[32]||(e[32]=[s("mdi-phone")])),_:1,__:[32]}),r("span",null,_(((C=T.value)==null?void 0:C.phone)||"N/A"),1),a(y,{icon:"",size:"x-small",variant:"text",onClick:e[0]||(e[0]=Se=>{var We;return Oe((We=T.value)==null?void 0:We.phone)}),class:"ml-1"},{default:l(()=>[a(n,{size:"14"},{default:l(()=>e[33]||(e[33]=[s("mdi-content-copy")])),_:1,__:[33]})]),_:1})]),(V=d.value.Booleancustomer)!=null&&V.email?(x(),U("div",Pt,[a(n,{size:"20",class:"mr-2"},{default:l(()=>e[34]||(e[34]=[s("mdi-email")])),_:1,__:[34]}),r("span",Mt,_(d.value.customer.email),1)])):Y("",!0),a(we,{modelValue:d.value.customer.city_id,"onUpdate:modelValue":e[1]||(e[1]=Se=>d.value.customer.city_id=Se),items:h(z).cityOptions,"item-title":"name","item-value":"id",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[ve.required],clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items","rules"]),a(we,{modelValue:d.value.customer.zone_id,"onUpdate:modelValue":e[2]||(e[2]=Se=>d.value.customer.zone_id=Se),items:h(z).zoneOptions,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items"]),(H=T.value)!=null&&H.address?(x(),U("div",Nt,[a(n,{size:"20",class:"mr-2"},{default:l(()=>e[35]||(e[35]=[s("mdi-map-marker")])),_:1,__:[35]}),r("span",zt,_(T.value.address),1)])):Y("",!0),(j=d.value)!=null&&j.customer_notes||(Be=(ce=d.value)==null?void 0:ce.latest_status)!=null&&Be.status_notes?(x(),U("div",It,[a(n,{size:"20",class:"mr-2"},{default:l(()=>e[36]||(e[36]=[s("mdi-note-text")])),_:1,__:[36]}),r("span",Ft,_(d.value.customer_notes),1)])):Y("",!0)]}),_:1})]),_:1}),r("div",qt,[r("h3",At,[a(n,{class:"mr-1",size:"small"},{default:l(()=>e[37]||(e[37]=[s("mdi-package-variant")])),_:1,__:[37]}),e[38]||(e[38]=s(" Order Items "))]),a(Ke,{density:"comfortable",class:"mb-2"},{default:l(()=>[e[39]||(e[39]=r("thead",null,[r("tr",null,[r("th",{style:{width:"30%"}},"Product"),r("th",{style:{width:"15%"}},"Quantity"),r("th",{style:{width:"30%"}}," Unit Price "),r("th",{style:{width:"15%"}},"Total"),r("th",{style:{width:"10%"}})])],-1)),r("tbody",null,[(x(!0),U($e,null,He(d.value.order_items||[],(o,C)=>(x(),U("tr",{key:o.id||C},[r("td",null,[a(we,{modelValue:o.product.product_name,"onUpdate:modelValue":V=>o.product.product_name=V,items:h(z).productOptions,"item-title":"product_name","item-value":"sku",placeholder:"Product name",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),r("td",null,[a(Q,{modelValue:o.quantity,"onUpdate:modelValue":V=>o.quantity=V,modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[a(Q,{modelValue:o.unit_price,"onUpdate:modelValue":V=>o.unit_price=V,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,_((o.quantity*o.unit_price).toFixed(2)),1),r("td",null,[a(y,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:V=>Ve(C)},null,8,["onClick"])])]))),128))])]),_:1,__:[39]}),a(y,{color:"primary",variant:"text","prepend-icon":"mdi-plus",onClick:K,class:"mt-2"},{default:l(()=>e[40]||(e[40]=[s(" Add Item ")])),_:1,__:[40]})]),r("div",Rt,[a(je,null,{default:l(()=>[a(me,{cols:"12",md:"4"},{default:l(()=>[a(Q,{"model-value":ee(),"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.total_price=o),label:"Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1}),a(me,{cols:"12",md:"4"},{default:l(()=>[a(Q,{modelValue:d.value.shipping_charges,"onUpdate:modelValue":[e[4]||(e[4]=o=>d.value.shipping_charges=o),e[5]||(e[5]=o=>k())],label:"Shipping Charges",type:"number",min:"0",step:"0.01",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),a(me,{cols:"12",md:"4"},{default:l(()=>[a(Q,{"model-value":(parseFloat(ee())+parseFloat(d.value.shipping_charges||0)).toFixed(2),label:"Grand Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),a($,{variant:"outlined"},{default:l(()=>[a(M,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[a(n,{size:"small",class:"mr-2"},{default:l(()=>e[41]||(e[41]=[s("mdi-lightning-bolt")])),_:1,__:[41]}),e[42]||(e[42]=s(" Quick Actions "))]),_:1,__:[42]}),a(R,{class:"pa-2"},{default:l(()=>[a(y,{block:"",variant:"outlined",color:"primary",size:"small",class:"mb-2",onClick:f},{default:l(()=>[a(n,{size:"18",class:"mr-2"},{default:l(()=>e[43]||(e[43]=[s("mdi-history")])),_:1,__:[43]}),e[44]||(e[44]=s(" Order History "))]),_:1,__:[44]}),a(y,{block:"",variant:"outlined",color:"orange",size:"small",onClick:Ce},{default:l(()=>[a(n,{size:"18",class:"mr-2"},{default:l(()=>e[45]||(e[45]=[s("mdi-cart")])),_:1,__:[45]}),e[46]||(e[46]=s(" Customer Orders "))]),_:1,__:[46]})]),_:1})]),_:1})])]),_:1}),a(de,{vertical:""}),a(me,{cols:"12",md:"6",class:"right-panel"},{default:l(()=>[a(Ze,{modelValue:G.value,"onUpdate:modelValue":e[6]||(e[6]=o=>G.value=o),"bg-color":"blue-grey-lighten-5",height:"48"},{default:l(()=>[a(Fe,{value:"call"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[47]||(e[47]=[s("mdi-phone")])),_:1,__:[47]}),e[48]||(e[48]=s(" Call "))]),_:1,__:[48]}),a(Fe,{value:"message"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[49]||(e[49]=[s("mdi-message")])),_:1,__:[49]}),e[50]||(e[50]=s(" Message "))]),_:1,__:[50]}),a(Fe,{value:"status"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[51]||(e[51]=[s("mdi-update")])),_:1,__:[51]}),e[52]||(e[52]=s(" Update Status "))]),_:1,__:[52]})]),_:1},8,["modelValue"]),a(ut,{modelValue:G.value,"onUpdate:modelValue":e[22]||(e[22]=o=>G.value=o),class:"tab-content"},{default:l(()=>[a(Ae,{value:"call",class:"pa-4"},{default:l(()=>[a($,{variant:"outlined",class:"mb-4"},{default:l(()=>[a(R,null,{default:l(()=>[e[59]||(e[59]=r("div",{class:"text-h6 mb-4"}," Make a Call ",-1)),a(Q,{modelValue:X.value.phone,"onUpdate:modelValue":e[7]||(e[7]=o=>X.value.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",readonly:"",class:"mb-3"},null,8,["modelValue"]),L.value?(x(),U("div",Ht,[r("div",jt,[a(v,{color:"green",size:"80",class:"pulse-animation"},{default:l(()=>[a(n,{size:"40",color:"white"},{default:l(()=>e[55]||(e[55]=[s("mdi-phone-in-talk")])),_:1,__:[55]})]),_:1}),e[56]||(e[56]=r("div",{class:"text-h6 mt-3"}," Call in Progress ",-1)),r("div",Gt,_(Z.value),1)]),r("div",Lt,[a(y,{icon:"",size:"large",color:E.value?"error":"grey",variant:"outlined",onClick:Me},{default:l(()=>[a(n,null,{default:l(()=>[s(_(E.value?"mdi-microphone-off":"mdi-microphone"),1)]),_:1})]),_:1},8,["color"]),a(y,{icon:"",size:"large",color:"grey",variant:"outlined",onClick:Ne},{default:l(()=>[a(n,null,{default:l(()=>e[57]||(e[57]=[s("mdi-pause")])),_:1,__:[57]})]),_:1}),a(y,{icon:"",size:"large",color:"red",variant:"flat",onClick:ze},{default:l(()=>[a(n,null,{default:l(()=>e[58]||(e[58]=[s("mdi-phone-hangup")])),_:1,__:[58]})]),_:1})])])):(x(),U("div",$t,[a(y,{color:"green",size:"x-large",rounded:"pill",elevation:"4",onClick:e[8]||(e[8]=o=>Ue(X.value.phone)),loading:oe.value,class:"call-button"},{default:l(()=>[a(n,{size:"32",class:"mr-2"},{default:l(()=>e[53]||(e[53]=[s("mdi-phone")])),_:1,__:[53]}),e[54]||(e[54]=s(" Call Customer "))]),_:1,__:[54]},8,["loading"])]))]),_:1,__:[59]})]),_:1}),a($,{variant:"outlined"},{default:l(()=>[a(M,{class:"text-subtitle-1"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[60]||(e[60]=[s("mdi-history")])),_:1,__:[60]}),e[61]||(e[61]=s(" Recent Calls "))]),_:1,__:[61]}),a(R,null,{default:l(()=>[a(Xe,{density:"compact"},{default:l(()=>[(x(!0),U($e,null,He(re.value,o=>(x(),xe(qe,{key:o.id,class:"mb-1"},{prepend:l(()=>[a(n,{color:o.type==="incoming"?"blue":"green"},{default:l(()=>[s(_(o.type==="incoming"?"mdi-phone-incoming":"mdi-phone-outgoing"),1)]),_:2},1032,["color"])]),append:l(()=>[a(y,{icon:"",size:"x-small",variant:"text"},{default:l(()=>[a(n,null,{default:l(()=>e[62]||(e[62]=[s("mdi-play")])),_:1,__:[62]})]),_:1})]),default:l(()=>[a(Ge,null,{default:l(()=>[s(_(o.duration),1)]),_:2},1024),a(Le,null,{default:l(()=>[s(_(o.timestamp),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),a(Ae,{value:"message",class:"pa-4"},{default:l(()=>[a($,{variant:"outlined"},{default:l(()=>[a(R,null,{item:l(({props:o,item:C})=>[a(qe,Qe(Ye(o)),{prepend:l(()=>[a(n,null,{default:l(()=>e[67]||(e[67]=[s("mdi-file-document-outline")])),_:1,__:[67]})]),default:l(()=>[a(Ge,null,{default:l(()=>[s(_(C.raw.name),1)]),_:2},1024),a(Le,null,{default:l(()=>[s(_(C.raw.description),1)]),_:2},1024)]),_:2},1040)]),default:l(()=>[e[75]||(e[75]=r("div",{class:"text-h6 mb-4"}," Send Message ",-1)),a(et,{modelValue:J.value,"onUpdate:modelValue":e[9]||(e[9]=o=>J.value=o),mandatory:"",divided:"",variant:"outlined",class:"mb-4"},{default:l(()=>[a(y,{value:"whatsapp"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[63]||(e[63]=[s("mdi-whatsapp")])),_:1,__:[63]}),e[64]||(e[64]=s(" WhatsApp "))]),_:1,__:[64]}),a(y,{value:"sms"},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[65]||(e[65]=[s("mdi-message-text")])),_:1,__:[65]}),e[66]||(e[66]=s(" SMS "))]),_:1,__:[66]})]),_:1},8,["modelValue"]),a(we,{modelValue:h(w).selectedTemplate,"onUpdate:modelValue":[e[10]||(e[10]=o=>h(w).selectedTemplate=o),h(w).onTemplateSelect],items:h(w).allTemplates,"item-title":"name","item-value":"id",label:"Select Template","return-object":"",disabled:h(w).loading.templates,loading:h(w).loading.templates,clearable:"",class:"mt-3","hide-no-data":"",dense:""},null,8,["modelValue","items","disabled","loading","onUpdate:modelValue"]),a(Ee,{modelValue:h(N).messageText,"onUpdate:modelValue":e[11]||(e[11]=o=>h(N).messageText=o),label:"Message",variant:"outlined",rows:"8",counter:"",maxlength:J.value==="sms"?160:1e3,class:"mb-3"},null,8,["modelValue","maxlength"]),r("div",Et,[e[72]||(e[72]=r("div",{class:"text-caption text-grey mb-2"}," Insert Variables: ",-1)),a(tt,null,{default:l(()=>[a(g,{size:"small",onClick:e[12]||(e[12]=o=>W("{customer_name}"))},{default:l(()=>e[68]||(e[68]=[s(" Customer Name ")])),_:1,__:[68]}),a(g,{size:"small",onClick:e[13]||(e[13]=o=>W("{order_no}"))},{default:l(()=>e[69]||(e[69]=[s(" Order Number ")])),_:1,__:[69]}),a(g,{size:"small",onClick:e[14]||(e[14]=o=>W("{delivery_date}"))},{default:l(()=>e[70]||(e[70]=[s(" Delivery Date ")])),_:1,__:[70]}),a(g,{size:"small",onClick:e[15]||(e[15]=o=>W("{total_price}"))},{default:l(()=>e[71]||(e[71]=[s(" Total Price ")])),_:1,__:[71]})]),_:1})]),a($,{variant:"tonal",color:"blue-grey-lighten-5",class:"mb-3"},{default:l(()=>[a(R,{class:"text-body-2"},{default:l(()=>[e[73]||(e[73]=r("div",{class:"font-weight-bold mb-2"}," Preview: ",-1)),r("div",Jt,_(ke.value),1)]),_:1,__:[73]})]),_:1}),a(y,{block:"",color:"primary",size:"large",loading:ne.value,onClick:ye},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[74]||(e[74]=[s("mdi-send")])),_:1,__:[74]}),s(" Send "+_(J.value.toUpperCase()),1)]),_:1},8,["loading"])]),_:1,__:[75]})]),_:1})]),_:1}),a(Ae,{value:"status",class:"pa-4"},{default:l(()=>[a($,{variant:"outlined"},{default:l(()=>[a(R,null,{default:l(()=>[e[82]||(e[82]=r("div",{class:"text-h6 mb-4"}," Update Order Status ",-1)),a(st,{ref_key:"statusForm",ref:c},{default:l(()=>[a(at,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:l(()=>{var o,C,V,H,j;return[r("div",Bt,[e[76]||(e[76]=r("strong",null,"Current Status:",-1)),s(" "+_(((V=(C=(o=d.value)==null?void 0:o.latest_status)==null?void 0:C.status)==null?void 0:V.name)||"Pending"),1)]),(j=(H=d.value)==null?void 0:H.latest_status)!=null&&j.created_at?(x(),U("div",Wt," Updated "+_(ge(d.value.latest_status.created_at)),1)):Y("",!0)]}),_:1}),a(Je,{modelValue:c.value.status_id,"onUpdate:modelValue":e[16]||(e[16]=o=>c.value.status_id=o),items:h(z).statusOptions,"item-title":"name","item-value":"id",label:"New Status",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Status is required"],class:"mb-3"},{item:l(({props:o,item:C})=>[a(qe,Qe(Ye(o)),{prepend:l(()=>[a(n,{color:C.raw.color},{default:l(()=>e[77]||(e[77]=[s("mdi-circle")])),_:2,__:[77]},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),a(Je,{modelValue:c.value.status_category_id,"onUpdate:modelValue":e[17]||(e[17]=o=>c.value.status_category_id=o),items:De.value,"item-title":"name","item-value":"id",label:"Status Category",variant:"outlined",density:"comfortable",disabled:!c.value.status_id,class:"mb-3"},null,8,["modelValue","items","disabled"]),he.value?(x(),xe(Q,{key:0,modelValue:c.value.recall_date,"onUpdate:modelValue":e[18]||(e[18]=o=>c.value.recall_date=o),label:"Recall Date & Time",type:"datetime-local",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Recall date is required"],class:"mb-3"},null,8,["modelValue","rules"])):Y("",!0),a(Ee,{modelValue:c.value.status_notes,"onUpdate:modelValue":e[19]||(e[19]=o=>c.value.status_notes=o),label:"Status Notes",variant:"outlined",rows:"4",rules:[o=>!!o||"Notes are required"],hint:"Add any relevant information about this status change",class:"mb-3"},null,8,["modelValue","rules"]),a(lt,{modelValue:c.value.notifyCustomer,"onUpdate:modelValue":e[20]||(e[20]=o=>c.value.notifyCustomer=o),label:"Notify customer of status change",density:"compact",class:"mb-3"},null,8,["modelValue"]),a(nt,null,{default:l(()=>[c.value.notifyCustomer?(x(),U("div",Qt,[a(ot,{modelValue:c.value.notificationMethod,"onUpdate:modelValue":e[21]||(e[21]=o=>c.value.notificationMethod=o),density:"compact",inline:""},{default:l(()=>[a(Re,{label:"SMS",value:"sms"}),a(Re,{label:"WhatsApp",value:"whatsapp"}),a(Re,{label:"Email",value:"email"})]),_:1},8,["modelValue"])])):Y("",!0)]),_:1}),a(y,{block:"",color:"primary",size:"large",loading:se.value,onClick:be},{default:l(()=>[a(n,{class:"mr-2"},{default:l(()=>e[78]||(e[78]=[s("mdi-update")])),_:1,__:[78]}),e[79]||(e[79]=s(" Update Status "))]),_:1,__:[79]},8,["loading"])]),_:1},512),a(de,{class:"my-4"}),r("div",Yt,[a(n,{class:"mr-2"},{default:l(()=>e[80]||(e[80]=[s("mdi-timeline")])),_:1,__:[80]}),e[81]||(e[81]=s(" Status History "))]),a(it,{density:"compact",side:"end",align:"start"},{default:l(()=>[(x(!0),U($e,null,He(ie.value,(o,C)=>(x(),xe(rt,{key:C,"dot-color":o.color,size:"small"},{default:l(()=>[r("div",Kt,_(o.status_name),1),r("div",Zt,_(o.notes),1),r("div",Xt,[s(_(ge(o.created_at))+" ",1),o.user?(x(),U("span",ea," by "+_(o.user),1)):Y("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})]),_:1,__:[82]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(de),a(mt,{class:"pa-4"},{default:l(()=>[a(y,{variant:"outlined",onClick:ue},{default:l(()=>e[83]||(e[83]=[s(" Close ")])),_:1,__:[83]}),a(dt),a(y,{color:"success",variant:"flat","prepend-icon":"mdi-check-circle",onClick:Ie},{default:l(()=>e[84]||(e[84]=[s(" Mark Complete & Close ")])),_:1,__:[84]})]),_:1})]),_:1}),a(ct,{modelValue:A.value.show,"onUpdate:modelValue":e[24]||(e[24]=o=>A.value.show=o),color:A.value.color,timeout:3e3},{actions:l(()=>[a(y,{variant:"text",onClick:e[23]||(e[23]=o=>A.value.show=!1)},{default:l(()=>e[85]||(e[85]=[s(" Close ")])),_:1,__:[85]})]),default:l(()=>[s(_(A.value.message)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["model-value"])}}},aa=St(ta,[["__scopeId","data-v-6e399eac"]]),da=Object.freeze(Object.defineProperty({__proto__:null,default:aa},Symbol.toStringTag,{value:"Module"}));export{aa as C,da as a,xt as u};
