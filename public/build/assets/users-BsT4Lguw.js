import{E as C,r as g,j as d}from"./app-B4TPmpLH.js";const F=C("users",()=>{const u=g([]),n=g(!1),o=g(null),f=g({current_page:1,last_page:1,per_page:15,total:0}),i="/api/v1/admin",m=d(()=>u.value.filter(s=>s.status==="active"||s.status==="Active")),w=d(()=>m.value.length),v=d(()=>s=>u.value.find(r=>r.id==s)),h=d(()=>s=>u.value.filter(r=>{var t;return((t=r.roles)==null?void 0:t.some(e=>e.name===s))||r.role===s})),U=d(()=>(s,r=null)=>{let t=u.value;return r&&(t=t.filter(e=>{var a;return((a=e.roles)==null?void 0:a.some(l=>l.name===r))||e.role===r})),s&&(t=t.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()))),t}),$=async(s=1,r={})=>{var t,e;try{n.value=!0,o.value=null;const a={page:s,...r},c=(await axios.get(`${i}/users`,{params:a})).data;return c.data?(u.value=c.data,f.value={current_page:c.current_page,last_page:c.last_page,per_page:c.per_page,total:c.total}):u.value=c,c}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}},x=async s=>{var r,t;try{n.value=!0,o.value=null;const e=await axios.post(`${i}/users`,s),a=e.data.data||e.data;return u.value.push(a),a}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}},_=async(s,r)=>{var t,e;try{n.value=!0,o.value=null;const a=await axios.put(`${i}/users/${s}`,r),l=a.data.data||a.data,c=u.value.findIndex(p=>p.id==s);return c!==-1&&(u.value[c]=l),l}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}},P=async s=>{var r,t;try{return n.value=!0,o.value=null,await axios.delete(`${i}/users/${s}`),u.value=u.value.filter(e=>e.id!=s),!0}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}},R=async s=>{var r,t;try{n.value=!0,o.value=null;const e=await axios.get(`${i}/users/${s}`);return e.data.data||e.data}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}},y=async(s,r)=>{var t,e;try{n.value=!0,o.value=null;const a=await axios.post(`${i}/users/${s}/assign-role`,{role:r}),l=v.value(s);return l&&a.data.data&&Object.assign(l,a.data.data),a.data}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}};return{users:u,loading:n,error:o,pagination:f,activeUsers:m,activeUsersCount:w,getUserById:v,getUsersByRole:h,searchUsers:U,fetchUsers:$,createUser:x,updateUser:_,deleteUser:P,showUser:R,assignRoleToUser:y,removeRoleFromUser:async(s,r)=>{var t,e;try{n.value=!0,o.value=null;const a=await axios.post(`${i}/users/${s}/remove-role`,{role_id:r}),l=v.value(s);return l&&a.data.data&&Object.assign(l,a.data.data),a.data}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}},assignPermissionToUser:async(s,r)=>{var t,e;try{n.value=!0,o.value=null;const a=await axios.post(`${i}/users/${s}/assign-permission`,{permission_id:r}),l=v.value(s);return l&&a.data.data&&Object.assign(l,a.data.data),a.data}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}},removePermissionFromUser:async(s,r)=>{var t,e;try{n.value=!0,o.value=null;const a=await axios.post(`${i}/users/${s}/remove-permission`,{permission_id:r}),l=v.value(s);return l&&a.data.data&&Object.assign(l,a.data.data),a.data}catch(a){throw o.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}finally{n.value=!1}},updateUserRole:async(s,r)=>await y(s,r),toggleUserStatus:async s=>{var r,t;try{n.value=!0,o.value=null;const e=v.value(s);if(!e)throw new Error("User not found");const a=e.status==="active"?"inactive":"active",l=await axios.post(`${i}/${s}/toggle-status`),c=l.data.data||l.data,p=u.value.findIndex(S=>S.id==s);return p!==-1&&(u.value[p]=c),c}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}},resetState:()=>{u.value=[],n.value=!1,o.value=null,f.value={current_page:1,last_page:1,per_page:15,total:0}},forcePasswordChange:async s=>{var r,t;try{n.value=!0,o.value=null;const e=await axios.post(`${i}/${s}/force-password`),a=v.value(s);return a&&e.data.data&&Object.assign(a,e.data.data),e.data}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}},sendPasswordResetLink:async s=>{var r,t;try{return n.value=!0,o.value=null,(await axios.post(`${i}/reset-link`,{email:s})).data}catch(e){throw o.value=((t=(r=e.response)==null?void 0:r.data)==null?void 0:t.message)||e.message,e}finally{n.value=!1}}}});export{F as u};
