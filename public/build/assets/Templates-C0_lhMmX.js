import{_ as H}from"./AppLayout-CKFuJb_d.js";import{l as o,c as D,o as _,w as l,b as t,a as d,f as n,H as J,m as C,t as m,e as Q,d as V,F as j,g as q,i as x}from"./app-DT4IHj4t.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CaVcl8ol.js";import"./africastalking-B1rV5jLD.js";import"./IncomingCallDialog-DhX-6MZF.js";/* empty css                                                                           */const R={components:{AppLayout:H},data(){return{branches:[],users:[],dialog:!1,dialogPreview:!1,loading:!1,saving:!1,deleting:!1,isFormValid:!1,dialogDelete:!1,filterChannel:null,filterModule:null,searchQuery:"",headers:[{title:"Template Name",align:"start",key:"name"},{title:"Content",key:"content"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],templates:[],originalTemplates:[],placeholders:[],placeholderValues:{},editedIndex:-1,editedItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null},previewItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:""},defaultItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null}}},computed:{formTitle(){return this.editedIndex===-1?"Create New Template":"Edit Template"},filteredTemplates(){let s=[...this.templates];return this.filterChannel&&this.filterChannel!=="All"&&(s=s.filter(e=>e.channel===this.filterChannel)),this.filterModule&&this.filterModule!=="All"&&(s=s.filter(e=>e.module===this.filterModule)),s},processedContent(){let s=this.previewItem.content;return this.previewItem.placeholders&&this.extractPlaceholders(this.previewItem.placeholders).forEach(p=>{const S=this.placeholderValues[p]||`[${p}]`;s=s.replace(new RegExp(`{${p}}`,"g"),S)}),s}},watch:{dialog(s){s?this.fetchUsers():this.close()},dialogDelete(s){!s&&this.closeDelete()},"editedItem.placeholders":{handler(s){if(typeof s=="string"&&s)try{this.placeholders=JSON.parse(s)}catch{}},immediate:!0}},created(){this.initialize()},methods:{getChannelColor(s){switch(s.toLowerCase()){case"email":return"primary";case"sms":return"success";case"push":return"warning";case"in-app":return"info";default:return"grey"}},fetchUsers(){x.get("/api/v1/admin/users").then(s=>{this.users=s.data}).catch(s=>{console.error("API Error:",s),this.$toastr.error("Failed to load users")})},initialize(){this.loading=!0,x.get("/api/v1/templates").then(s=>{this.templates=s.data.data,this.originalTemplates=[...this.templates],this.loading=!1}).catch(s=>{console.error("API Error:",s),this.$toastr.error("Failed to load templates"),this.loading=!1})},editItem(s){if(this.editedIndex=this.templates.indexOf(s),this.editedItem={...s},typeof this.editedItem.placeholders=="string")try{this.placeholders=JSON.parse(this.editedItem.placeholders)}catch{this.placeholders=[]}else Array.isArray(this.editedItem.placeholders)?this.placeholders=[...this.editedItem.placeholders]:this.placeholders=[];this.dialog=!0},deleteItem(s){this.editedIndex=this.templates.indexOf(s),this.editedItem={...s},this.dialogDelete=!0},deleteItemConfirm(){this.deleting=!0,x.delete(`/api/v1/templates/${this.editedItem.id}`).then(()=>{this.templates.splice(this.editedIndex,1),this.$toastr.success("Template deleted successfully"),this.closeDelete()}).catch(s=>{console.error("Deletion error:",s),this.$toastr.error("Failed to delete template")}).finally(()=>{this.deleting=!1})},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.$nextTick(()=>{this.$refs.form&&this.$refs.form.reset(),this.editedItem={...this.defaultItem},this.editedIndex=-1,this.placeholders=[]})},cloneTemplate(s){const e={...s};if(delete e.id,e.name=`${e.name} (Copy)`,this.editedItem=e,this.editedIndex=-1,typeof e.placeholders=="string")try{this.placeholders=JSON.parse(e.placeholders)}catch{this.placeholders=[]}else Array.isArray(e.placeholders)?this.placeholders=[...e.placeholders]:this.placeholders=[];this.dialog=!0},previewTemplate(s){this.previewItem={...s},this.placeholderValues={},this.previewItem.placeholders&&this.extractPlaceholders(this.previewItem.placeholders).forEach(p=>{this.placeholderValues[p]=""}),this.dialogPreview=!0},extractPlaceholders(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return[]}else if(Array.isArray(s))return s;return[]},updatePreview(){},save(){if(!this.isFormValid)return;this.saving=!0;const s={...this.editedItem,placeholders:JSON.stringify(this.placeholders)};let e;this.editedIndex>-1?e=x.put(`/api/v1/templates/${this.editedItem.id}`,s):e=x.post("/api/v1/templates",s),e.then(()=>{this.initialize(),this.close(),this.$toastr.success(`Template ${this.editedIndex===-1?"created":"updated"} successfully`)}).catch(p=>{console.error("Save error:",p),this.$toastr.error(`Failed to ${this.editedIndex===-1?"create":"update"} template`)}).finally(()=>{this.saving=!1})},performSearch(){this.searchQuery.trim()===""?this.templates=[...this.originalTemplates]:(this.loading=!0,x.get("v1/templates",{params:{search:this.searchQuery}}).then(s=>{this.templates=s.data,this.loading=!1}).catch(s=>{console.error("Search error:",s),this.$toastr.error("Search failed"),this.loading=!1}))},filterByChannel(){},filterByModule(){}}},G={class:"text-truncate d-inline-block",style:{"max-width":"200px"}},W={class:"d-flex align-center"},X={class:"d-flex flex-column align-center py-6"},Y={class:"text-h5 font-weight-bold"},Z=["innerHTML"],$={key:0,class:"email-preview"},ee={class:"email-header pa-4 rounded-t-lg bg-grey-lighten-4 border-b"},te={class:"text-subtitle-1 font-weight-bold"},le={class:"text-caption text-grey"},se=["innerHTML"],ie={key:1,class:"sms-preview"},ae={class:"text-body-1"},oe={key:2,class:"generic-preview"},ne={class:"text-subtitle-2 mb-2"},re={class:"text-body-2"};function de(s,e,p,S,a,r){const c=o("v-btn"),y=o("v-card-title"),k=o("v-text-field"),v=o("v-col"),T=o("v-row"),w=o("v-card-text"),N=o("v-progress-linear"),F=o("v-chip"),f=o("v-icon"),I=o("v-tooltip"),U=o("v-data-table"),h=o("v-card"),M=o("v-container"),g=o("v-divider"),E=o("v-textarea"),L=o("v-combobox"),O=o("v-form"),P=o("v-spacer"),z=o("v-card-actions"),A=o("v-dialog"),B=o("AppLayout");return _(),D(B,null,{default:l(()=>[t(M,{fluid:"",class:"pa-0"},{default:l(()=>[t(h,{class:"rounded-lg elevation-2 mb-6"},{default:l(()=>[t(y,{class:"d-flex justify-space-between align-center py-4 px-6 bg-surface"},{default:l(()=>[e[12]||(e[12]=d("span",{class:"text-h5 font-weight-bold"},"Template Management",-1)),t(c,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>a.dialog=!0),size:"large",variant:"elevated",rounded:"pill"},{default:l(()=>e[11]||(e[11]=[n(" New Template ")])),_:1,__:[11]})]),_:1,__:[12]}),t(w,{class:"pa-6"},{default:l(()=>[t(T,null,{default:l(()=>[t(v,{cols:"12",md:"6",lg:"4"},{default:l(()=>[t(k,{modelValue:a.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=i=>a.searchQuery=i),label:"Search templates","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",onKeyup:J(r.performSearch,["enter"]),"onClick:clear":r.initialize,class:"rounded-lg"},null,8,["modelValue","onKeyup","onClick:clear"])]),_:1})]),_:1})]),_:1}),t(U,{headers:a.headers,loading:a.loading,items:r.filteredTemplates,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"loading-text":"Loading templates...",class:"rounded-b-lg"},{loader:l(()=>[t(N,{indeterminate:"",color:"primary",height:"2"})]),"item.channel":l(({item:i})=>[t(F,{color:r.getChannelColor(i.channel),variant:"flat",size:"small",class:"font-weight-medium"},{default:l(()=>[n(m(i.channel),1)]),_:2},1032,["color"])]),"item.module":l(({item:i})=>[t(F,{color:"info",variant:"flat",size:"small",class:"font-weight-medium"},{default:l(()=>[n(m(i.module),1)]),_:2},1024)]),"item.content":l(({item:i})=>[d("span",G,m(i.content),1)]),"item.actions":l(({item:i})=>[d("div",W,[t(I,{location:"top",text:"Edit"},{activator:l(({props:u})=>[t(c,C(u,{icon:"",size:"small",color:"primary",class:"me-1",variant:"text",onClick:b=>r.editItem(i)}),{default:l(()=>[t(f,null,{default:l(()=>e[13]||(e[13]=[n("mdi-pencil")])),_:1,__:[13]})]),_:2},1040,["onClick"])]),_:2},1024),t(I,{location:"top",text:"Delete"},{activator:l(({props:u})=>[t(c,C(u,{icon:"",size:"small",color:"error",class:"me-1",variant:"text",onClick:b=>r.deleteItem(i)}),{default:l(()=>[t(f,null,{default:l(()=>e[14]||(e[14]=[n("mdi-delete")])),_:1,__:[14]})]),_:2},1040,["onClick"])]),_:2},1024),t(I,{location:"top",text:"Clone"},{activator:l(({props:u})=>[t(c,C(u,{icon:"",size:"small",color:"info",class:"me-1",variant:"text",onClick:b=>r.cloneTemplate(i)}),{default:l(()=>[t(f,null,{default:l(()=>e[15]||(e[15]=[n("mdi-content-copy")])),_:1,__:[15]})]),_:2},1040,["onClick"])]),_:2},1024),t(I,{location:"top",text:"Preview"},{activator:l(({props:u})=>[t(c,C(u,{icon:"",size:"small",color:"success",variant:"text",onClick:b=>r.previewTemplate(i)}),{default:l(()=>[t(f,null,{default:l(()=>e[16]||(e[16]=[n("mdi-eye")])),_:1,__:[16]})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":l(()=>[d("div",X,[t(f,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>e[17]||(e[17]=[n("mdi-file-document-outline")])),_:1,__:[17]}),e[19]||(e[19]=d("p",{class:"text-body-1 text-medium-emphasis mb-4"},"No templates found",-1)),t(c,{color:"primary",variant:"elevated",onClick:r.initialize},{default:l(()=>e[18]||(e[18]=[n(" Refresh Data ")])),_:1,__:[18]},8,["onClick"])])]),_:1},8,["headers","loading","items"])]),_:1})]),_:1}),t(A,{modelValue:a.dialog,"onUpdate:modelValue":e[6]||(e[6]=i=>a.dialog=i),"max-width":"900px",persistent:""},{default:l(()=>[t(h,{class:"rounded-lg"},{default:l(()=>[t(y,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:l(()=>[d("span",Y,m(r.formTitle),1),t(c,{icon:"",onClick:r.close,variant:"text"},{default:l(()=>[t(f,null,{default:l(()=>e[20]||(e[20]=[n("mdi-close")])),_:1,__:[20]})]),_:1},8,["onClick"])]),_:1}),t(g),t(w,{class:"pa-6"},{default:l(()=>[t(O,{ref:"form",modelValue:a.isFormValid,"onUpdate:modelValue":e[5]||(e[5]=i=>a.isFormValid=i)},{default:l(()=>[t(T,null,{default:l(()=>[t(v,{cols:"12",md:"6"},{default:l(()=>[t(k,{modelValue:a.editedItem.name,"onUpdate:modelValue":e[2]||(e[2]=i=>a.editedItem.name=i),label:"Template Name",variant:"outlined","prepend-inner-icon":"mdi-file-document-outline",rules:[i=>!!i||"Template name is required"]},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:l(()=>[t(E,{modelValue:a.editedItem.content,"onUpdate:modelValue":e[3]||(e[3]=i=>a.editedItem.content=i),label:"Template Content",variant:"outlined","prepend-inner-icon":"mdi-card-text-outline","auto-grow":"",rows:"8",rules:[i=>!!i||"Content is required"]},null,8,["modelValue","rules"])]),_:1}),t(v,{cols:"12"},{default:l(()=>[t(L,{modelValue:a.placeholders,"onUpdate:modelValue":e[4]||(e[4]=i=>a.placeholders=i),label:"Available Placeholders",variant:"outlined","prepend-inner-icon":"mdi-code-braces",chips:"","closable-chips":"",multiple:"","small-chips":"","hide-details":""},null,8,["modelValue"]),e[21]||(e[21]=d("div",{class:"text-caption text-grey mt-2"}," Add placeholders that can be used in this template (e.g., {name}, {order_id}) ",-1))]),_:1,__:[21]}),a.editedItem.channel==="Email"?(_(),D(v,{key:0,cols:"12"},{default:l(()=>[t(h,{variant:"outlined",class:"mt-4"},{default:l(()=>[t(y,{class:"text-subtitle-1"},{default:l(()=>[t(f,{start:"",color:"info"},{default:l(()=>e[22]||(e[22]=[n("mdi-information-outline")])),_:1,__:[22]}),e[23]||(e[23]=n(" Template Preview "))]),_:1,__:[23]}),t(w,null,{default:l(()=>[d("div",{innerHTML:a.editedItem.content,class:"preview-area pa-4 rounded-lg"},null,8,Z)]),_:1})]),_:1})]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g),t(z,{class:"pa-6"},{default:l(()=>[t(P),t(c,{color:"error",variant:"text",onClick:r.close,class:"text-capitalize"},{default:l(()=>e[24]||(e[24]=[n(" Cancel ")])),_:1,__:[24]},8,["onClick"]),t(c,{color:"primary",variant:"elevated",onClick:r.save,loading:a.saving,disabled:!a.isFormValid||a.saving,class:"text-capitalize"},{default:l(()=>e[25]||(e[25]=[n(" Save ")])),_:1,__:[25]},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{modelValue:a.dialogDelete,"onUpdate:modelValue":e[7]||(e[7]=i=>a.dialogDelete=i),"max-width":"500px",persistent:""},{default:l(()=>[t(h,{class:"rounded-lg"},{default:l(()=>[t(y,{class:"text-h5 pa-6"},{default:l(()=>e[26]||(e[26]=[n("Confirm Deletion")])),_:1,__:[26]}),t(w,{class:"pa-6"},{default:l(()=>[e[27]||(e[27]=n(" Are you sure you want to delete template ")),d("strong",null,m(a.editedItem.name),1),e[28]||(e[28]=n("? This action cannot be undone. "))]),_:1,__:[27,28]}),t(g),t(z,{class:"pa-6"},{default:l(()=>[t(P),t(c,{color:"grey",variant:"text",onClick:r.closeDelete,class:"text-capitalize"},{default:l(()=>e[29]||(e[29]=[n(" Cancel ")])),_:1,__:[29]},8,["onClick"]),t(c,{color:"error",variant:"elevated",onClick:r.deleteItemConfirm,loading:a.deleting,class:"text-capitalize"},{default:l(()=>e[30]||(e[30]=[n(" Delete ")])),_:1,__:[30]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{modelValue:a.dialogPreview,"onUpdate:modelValue":e[10]||(e[10]=i=>a.dialogPreview=i),"max-width":"800px"},{default:l(()=>[t(h,{class:"rounded-lg"},{default:l(()=>[t(y,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:l(()=>[e[32]||(e[32]=d("span",{class:"text-h5 font-weight-bold"},"Template Preview",-1)),t(c,{icon:"",onClick:e[8]||(e[8]=i=>a.dialogPreview=!1),variant:"text"},{default:l(()=>[t(f,null,{default:l(()=>e[31]||(e[31]=[n("mdi-close")])),_:1,__:[31]})]),_:1})]),_:1,__:[32]}),t(g),t(w,{class:"pa-6"},{default:l(()=>[a.previewItem.channel==="Email"?(_(),V("div",$,[d("div",ee,[d("div",te,m(a.previewItem.name),1),d("div",le,m(a.previewItem.module)+" Template",1)]),d("div",{class:"email-body pa-6",innerHTML:r.processedContent},null,8,se)])):a.previewItem.channel==="SMS"?(_(),V("div",ie,[t(h,{variant:"outlined",class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[d("div",ae,m(r.processedContent),1)]),_:1})])):(_(),V("div",oe,[t(h,{variant:"outlined",class:"pa-4"},{default:l(()=>[d("div",ne,m(a.previewItem.channel)+" Template: "+m(a.previewItem.name),1),d("div",re,m(r.processedContent),1)]),_:1})])),t(g,{class:"my-6"}),d("div",null,[e[33]||(e[33]=d("div",{class:"text-subtitle-1 mb-3"},"Replace Placeholders:",-1)),t(T,null,{default:l(()=>[(_(!0),V(j,null,q(r.extractPlaceholders(a.previewItem.placeholders),(i,u)=>(_(),D(v,{cols:"12",md:"6",key:u},{default:l(()=>[t(k,{modelValue:a.placeholderValues[i],"onUpdate:modelValue":b=>a.placeholderValues[i]=b,label:i,variant:"outlined",density:"comfortable",onInput:r.updatePreview},null,8,["modelValue","onUpdate:modelValue","label","onInput"])]),_:2},1024))),128))]),_:1})])]),_:1}),t(g),t(z,{class:"pa-6"},{default:l(()=>[t(P),t(c,{color:"primary",variant:"text",onClick:e[9]||(e[9]=i=>a.dialogPreview=!1),class:"text-capitalize"},{default:l(()=>e[34]||(e[34]=[n(" Close ")])),_:1,__:[34]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ve=K(R,[["render",de]]);export{ve as default};
