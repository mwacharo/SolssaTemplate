import{_ as Q}from"./AppLayout-Dv23vhgn.js";import R from"./ChannelForm-DTprmJUZ.js";import{r as f,i as C,l as d,c as P,o as V,w as o,b as s,e as M,f as w,d as U,F as z,g as N,t as E,j as H,s as K,k as W}from"./app-CUXQfuet.js";import{n as S}from"./toast-DcvLF-S-.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CXezN7iC.js";import"./africastalking-BVNgbNpx.js";import"./IncomingCallDialog-al1PK4B6.js";/* empty css                                                                           */function G(){const m=f([]),r=f([]),v=f([]),e=f(!1),i=f(null),p="/api/v1",b=async()=>{try{e.value=!0,i.value=null;const t=await C.get(`${p}/credentialable-types`);return m.value=t.data.types||[],m.value}catch(t){throw i.value="Failed to load owner types",console.error("Error loading owner types:",t),t}finally{e.value=!1}},y=async t=>{if(!t)return r.value=[],[];try{e.value=!0,i.value=null;const a=await C.get(`${p}/credentialables`,{params:{type:t}});return r.value=a.data.owners||[],r.value}catch(a){throw i.value="Failed to load owners",console.error("Error loading owners:",a),a}finally{e.value=!1}},A=async(t,a)=>{if(!t||!a)return v.value=[],[];try{e.value=!0,i.value=null;const u=await C.get(`${p}/channel-credentials`,{params:{credentialable_type:t,credentialable_id:a}});return v.value=u.data.credentials||[],v.value}catch(u){throw i.value="Failed to load credentials",console.error("Error loading credentials:",u),u}finally{e.value=!1}},g=async t=>{try{e.value=!0,i.value=null;const a=v.value.find(_=>_.channel===t.channel&&_.credentialable_type===t.credentialable_type&&_.credentialable_id===t.credentialable_id);let u;return a?u=await C.put(`${p}/channel-credentials/${a.id}`,t):u=await C.post(`${p}/channel-credentials`,t),u.data}catch(a){throw i.value="Failed to save credential",console.error("Error saving credential:",a),a}finally{e.value=!1}},k=async t=>{try{return e.value=!0,i.value=null,await C.delete(`${p}/channel-credentials/${t}`),v.value=v.value.filter(a=>a.id!==t),!0}catch(a){throw i.value="Failed to delete credential",console.error("Error deleting credential:",a),a}finally{e.value=!1}},T=async t=>{try{return e.value=!0,i.value=null,(await C.post(`${p}/channel-credentials/${t}/test`)).data}catch(a){throw i.value="Failed to test credential",console.error("Error testing credential:",a),a}finally{e.value=!1}},h=async(t,a)=>{try{e.value=!0,i.value=null;const u=await C.patch(`${p}/channel-credentials/bulk-status`,{credential_ids:t,status:a});return v.value=v.value.map(_=>t.includes(_.id)?{..._,status:a}:_),u.data}catch(u){throw i.value="Failed to update credentials status",console.error("Error updating credentials status:",u),u}finally{e.value=!1}},F=t=>v.value.filter(a=>a.channel===t),x=()=>v.value.filter(t=>t.status==="active"),O=t=>{const a=[];switch(t.channel||a.push("Channel is required"),t.provider||a.push("Provider is required"),t.channel){case"email":t.from_address||a.push("From address is required for email"),t.mail_mailer==="smtp"&&!t.smtp_host&&a.push("SMTP host is required for SMTP mailer");break;case"voice":case"sms":t.provider==="Twilio"&&!t.account_sid&&a.push("Account SID is required for Twilio");break;case"whatsapp":!t.api_key&&!t.access_token&&a.push("API Key or Access Token is required for WhatsApp");break;case"telegram":t.access_token||a.push("Bot token is required for Telegram");break;case"twitter":(!t.api_key||!t.api_secret)&&a.push("API Key and Secret are required for Twitter");break;case"facebook":(!t.app_id||!t.app_secret)&&a.push("App ID and Secret are required for Facebook");break}return{isValid:a.length===0,errors:a}};return b(),{ownerTypes:m,owners:r,credentials:v,loading:e,error:i,loadOwnerTypes:b,loadOwners:y,loadCredentials:A,saveCredential:g,deleteCredential:k,testCredential:T,bulkUpdateStatus:h,getCredentialsByChannel:F,getActiveCredentials:x,validateCredential:O}}const Z={name:"ChannelCredentials",components:{AppLayout:Q,ChannelForm:R},setup(){const m=f(null),r=f(null),v=f("voice"),e=f(""),i=f(!1),{ownerTypes:p,owners:b,credentials:y,loadOwners:A,loadCredentials:g,saveCredential:k,deleteCredential:T}=G(),h=[{value:"voice",icon:"mdi-headset",title:"Voice/Call Center"},{value:"whatsapp",icon:"mdi-whatsapp",title:"WhatsApp"},{value:"email",icon:"mdi-email-outline",title:"Email"},{value:"sms",icon:"mdi-message-text-outline",title:"SMS"},{value:"telegram",icon:"mdi-telegram",title:"Telegram"},{value:"twitter",icon:"mdi-twitter",title:"Twitter"},{value:"facebook",icon:"mdi-facebook",title:"Facebook"}],F={voice:["Twilio","Vonage","Advanta","Africa's Talking","Amazon Connect","Plivo"],email:["SendGrid","Mailgun","SMTP","Amazon SES","Postmark","Zoho"],sms:["Twilio","Vonage","Advanta","MessageBird","Plivo"],whatsapp:["Meta","Twilio"],telegram:["Telegram"],twitter:["Twitter"],facebook:["Facebook"]},x=[{title:"Channel",key:"channel",sortable:!0},{title:"Provider",key:"provider",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Updated",key:"updated_at",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],O=H(()=>{if(!e.value)return y.value;const n=e.value.toLowerCase();return y.value.filter(c=>c.channel.toLowerCase().includes(n)||c.provider&&c.provider.toLowerCase().includes(n)||c.status.toLowerCase().includes(n))}),t=n=>y.value.find(c=>c.channel===n)||a(n),a=n=>{var c;return{channel:n,provider:((c=F[n])==null?void 0:c[0])||"",status:"inactive",api_key:"",api_secret:"",access_token:"",auth_token:"",user_name:"",password:"",account_sid:"",phone_number:"",webhook:"",from_name:"",from_address:"",smtp_host:"",smtp_port:587,encryption:"tls",mail_mailer:"smtp"}},u=n=>F[n]||[],_=n=>({voice:"indigo",whatsapp:"green",email:"blue",sms:"purple",telegram:"cyan",twitter:"light-blue",facebook:"blue-darken-2"})[n]||"grey",B=n=>({voice:"mdi-headset",whatsapp:"mdi-whatsapp",email:"mdi-email-outline",sms:"mdi-message-text-outline",telegram:"mdi-telegram",twitter:"mdi-twitter",facebook:"mdi-facebook"})[n]||"mdi-help-circle",I=async n=>{if(!m.value||!r.value){S.error("Please select an owner first");return}i.value=!0;try{await k({...n,credentialable_type:m.value,credentialable_id:r.value}),S.success("Credential saved successfully"),await g(m.value,r.value)}catch(c){S.error("Failed to save credential"),console.error(c)}finally{i.value=!1}},q=n=>{v.value=n.channel},L=async n=>{if(confirm(`Delete ${n.channel} credential?`)){i.value=!0;try{await T(n.id),S.success("Credential deleted successfully"),await g(m.value,r.value)}catch(c){S.error("Failed to delete credential"),console.error(c)}finally{i.value=!1}}},l=n=>{console.log(`Resetting ${n} credential`)};return K([m,r],async([n,c])=>{if(n&&c){i.value=!0;try{await g(n,c)}catch{S.error("Failed to load credentials")}finally{i.value=!1}}}),W(()=>{}),{selectedOwnerType:m,selectedOwnerId:r,activeTab:v,searchQuery:e,loading:i,ownerTypes:p,owners:b,loadOwners:A,channels:h,tableHeaders:x,filteredCredentials:O,getCredentialByChannel:t,getProvidersByChannel:u,getChannelColor:_,getChannelIcon:B,saveCredential:I,editCredential:q,deleteCredential:L,resetCredential:l}}};function J(m,r,v,e,i,p){const b=d("v-card-title"),y=d("v-autocomplete"),A=d("v-col"),g=d("v-row"),k=d("v-card-text"),T=d("VCard"),h=d("v-icon"),F=d("v-tab"),x=d("v-tabs"),O=d("ChannelForm"),t=d("v-window-item"),a=d("v-window"),u=d("v-spacer"),_=d("v-text-field"),B=d("v-chip"),I=d("v-btn"),q=d("v-data-table"),L=d("AppLayout");return V(),P(L,null,{default:o(()=>[s(T,{class:"mb-4"},{default:o(()=>[s(b,null,{default:o(()=>r[5]||(r[5]=[w("Select Owner")])),_:1,__:[5]}),s(k,null,{default:o(()=>[s(g,null,{default:o(()=>[s(A,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:e.selectedOwnerType,"onUpdate:modelValue":[r[0]||(r[0]=l=>e.selectedOwnerType=l),e.loadOwners],items:e.ownerTypes,label:"Owner Type",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(A,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:e.selectedOwnerId,"onUpdate:modelValue":r[1]||(r[1]=l=>e.selectedOwnerId=l),items:e.owners,"item-title":"name","item-value":"id",label:"Owner",variant:"outlined",disabled:!e.selectedOwnerType},null,8,["modelValue","items","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e.selectedOwnerId?(V(),P(T,{key:0},{default:o(()=>[s(x,{modelValue:e.activeTab,"onUpdate:modelValue":r[2]||(r[2]=l=>e.activeTab=l),"bg-color":"primary"},{default:o(()=>[(V(!0),U(z,null,N(e.channels,l=>(V(),P(F,{key:l.value,value:l.value},{default:o(()=>[s(h,{start:""},{default:o(()=>[w(E(l.icon),1)]),_:2},1024),w(" "+E(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(k,null,{default:o(()=>[s(a,{modelValue:e.activeTab,"onUpdate:modelValue":r[3]||(r[3]=l=>e.activeTab=l)},{default:o(()=>[(V(!0),U(z,null,N(e.channels,l=>(V(),P(t,{key:l.value,value:l.value},{default:o(()=>[s(O,{channel:l.value,credential:e.getCredentialByChannel(l.value),providers:e.getProvidersByChannel(l.value),onSave:e.saveCredential,onReset:e.resetCredential},null,8,["channel","credential","providers","onSave","onReset"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):M("",!0),e.selectedOwnerId?(V(),P(T,{key:1,class:"mt-4"},{default:o(()=>[s(b,null,{default:o(()=>[r[6]||(r[6]=w(" Existing Credentials ")),s(u),s(_,{modelValue:e.searchQuery,"onUpdate:modelValue":r[4]||(r[4]=l=>e.searchQuery=l),label:"Search","prepend-inner-icon":"mdi-magnify",clearable:"",variant:"outlined",density:"compact",style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1,__:[6]}),s(k,null,{default:o(()=>[s(q,{headers:e.tableHeaders,items:e.filteredCredentials,loading:e.loading,class:"elevation-1"},{"item.channel":o(({item:l})=>[s(B,{color:e.getChannelColor(l.channel)},{default:o(()=>[s(h,{start:""},{default:o(()=>[w(E(e.getChannelIcon(l.channel)),1)]),_:2},1024),w(" "+E(l.channel),1)]),_:2},1032,["color"])]),"item.status":o(({item:l})=>[s(B,{color:l.status==="active"?"success":"error"},{default:o(()=>[w(E(l.status==="active"?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":o(({item:l})=>[s(I,{icon:"",variant:"text",size:"small",color:"primary",onClick:n=>e.editCredential(l)},{default:o(()=>[s(h,null,{default:o(()=>r[7]||(r[7]=[w("mdi-pencil")])),_:1,__:[7]})]),_:2},1032,["onClick"]),s(I,{icon:"",variant:"text",size:"small",color:"error",onClick:n=>e.deleteCredential(l)},{default:o(()=>[s(h,null,{default:o(()=>r[8]||(r[8]=[w("mdi-delete")])),_:1,__:[8]})]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})):M("",!0)]),_:1})}const oe=j(Z,[["render",J],["__scopeId","data-v-7530199c"]]);export{oe as default};
