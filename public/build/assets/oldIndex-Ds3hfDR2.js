import{u as lt,a as st,b as ot,U as at}from"./UserPermissionDialog-DC2qXUKb.js";import{u as it}from"./users-B2waOsmN.js";import{_ as nt}from"./AppLayout-D-QxGsMo.js";import rt from"./RoleDialog-BllWQWsM.js";import dt from"./ManageUserDialog-BZ8Uusdy.js";import{n as P}from"./toast-BFuClKPn.js";import{r as p,j as D,k as ut,s as mt,l as d,c as _,o as m,w as t,b as l,d as k,F as z,g as $,a,t as n,f as i,n as pe,m as W,e as V,u as v}from"./app-C6VbMVsS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CGrCd9Ft.js";import"./africastalking-N6h57nqa.js";import"./IncomingCallDialog-BGguFHld.js";/* empty css                                                                           */import"./countries-3JQRlYZm.js";const ct={class:"d-flex align-center justify-space-between"},vt={class:"d-flex gap-2"},pt={class:"flex-grow-1"},ft={class:"text-h4 font-weight-bold text-primary mb-1"},_t={class:"text-body-2 text-medium-emphasis"},gt={class:"d-flex align-center justify-space-between mb-6"},yt={class:"d-flex align-center"},bt={class:"font-weight-medium"},wt={class:"text-caption text-medium-emphasis"},xt={class:"text-body-2 text-medium-emphasis mb-4"},kt={class:"mb-4"},Vt={class:"d-flex align-center justify-space-between"},Ct={class:"d-flex align-center justify-space-between mb-6"},Ut={class:"text-h6"},Pt={class:"d-flex align-center justify-space-between mb-6"},Dt={class:"d-flex align-center py-2"},At={class:"font-weight-medium"},Lt={class:"text-caption text-medium-emphasis"},Rt={class:"text-body-2"},Ft={class:"d-flex align-center justify-space-between mb-6"},ht={class:"d-flex gap-2"},St={key:0,class:"text-center py-8"},zt={class:"d-flex align-center justify-space-between mb-2"},$t={class:"d-flex align-center"},jt={class:"font-weight-medium"},Nt={class:"text-caption text-medium-emphasis"},Tt={class:"d-flex align-center"},Mt={class:"text-body-2"},Et={key:4,class:"text-center py-8"},Bt={class:"text-body-2"},It={class:"text-body-2"},qt={class:"d-flex align-center"},Ht={key:0},Ot={key:1,class:"mt-3"},il={__name:"oldIndex",setup(Gt){const A=lt(),g=st(),U=it(),u=ot(),q=p("roles"),X=p(""),H=p(""),O=p(""),Y=p(null);p(null);const Z=p(!1);p("");const ee=p([]),j=p(!1),L=p(!1),te=p(!1),G=p(!1),R=p(null),N=p(null),T=p(!1),y=p({id:null,name:"",description:""}),fe=D(()=>g.roles),_e=D(()=>[{title:"Total Roles",value:g.rolesCount,icon:"mdi-account-group",color:"primary"},{title:"Active Users",value:U.activeUsersCount,icon:"mdi-account-check",color:"success"},{title:"Permissions",value:A.permissionsCount,icon:"mdi-key",color:"warning"},{title:"Recent Changes",value:"8",icon:"mdi-history",color:"info"}]),ge=D(()=>g.searchRoles(X.value)),ye=D(()=>A.searchPermissions(H.value)),be=D(()=>U.searchUsers(O.value,Y.value)),we=D(()=>g.roleNames),xe=D(()=>u.uniqueActions.map(o=>({title:o,value:o}))),ke=o=>{u.setFilters({action:o})},Ve=p([{title:"Name",key:"name",sortable:!0},{title:"Description",key:"description",sortable:!1},{title:"Actions",key:"actions",sortable:!1,align:"end",width:"120px"}]),Ce=p([{title:"User",key:"user",sortable:!0,width:"25%"},{title:"Role",key:"role",sortable:!0,width:"20%"},{title:"Status",key:"status",sortable:!0,width:"15%"},{title:"Last Login",key:"lastLogin",sortable:!0,width:"20%"},{title:"Actions",key:"actions",sortable:!1,width:"20%"}]),Ue=()=>{R.value=null,j.value=!0},Pe=o=>{R.value={...o},j.value=!0},De=async o=>{try{await g.duplicateRole(o.id)}catch(e){console.error("Failed to duplicate role:",e)}},Ae=async o=>{if(confirm(`Delete role "${o.name}"?`))try{await g.deleteRole(o.id)}catch(e){console.error("Failed to delete role:",e)}},Le=async o=>{try{await g.toggleRoleStatus(o.id)}catch(e){console.error("Failed to toggle role status:",e)}},Re=o=>{console.log("View role details:",o)},Fe=async o=>{try{R.value&&R.value.id?await g.updateRole(R.value.id,o):await g.createRole(o),j.value=!1}catch(e){console.error("Failed to save role:",e)}},he=()=>{T.value=!1,y.value={id:null,name:"",description:""},L.value=!0},Se=o=>{T.value=!0,y.value={...o},L.value=!0},ze=async()=>{if(y.value.name)try{T.value?(await A.updatePermission(y.value.id,y.value),P.updated("Permission")):(await A.createPermission(y.value),P.created("Permission")),L.value=!1}catch(o){P.failed("save permission"),console.error("Failed to save permission:",o)}},$e=async o=>{if(confirm(`Delete permission "${o.name}"?`))try{await A.deletePermission(o.id)}catch(e){console.error("Failed to delete permission:",e)}},re=async(o,e)=>{try{const f=g.roles.find(c=>c.name===e);f&&await U.assignRoleToUser(o.id,f.name)}catch(f){console.error("Failed to update user role:",f)}},je=o=>{N.value=o,te.value=!0},Ne=()=>{N.value=null,G.value=!0},Te=o=>{N.value=o,G.value=!0},Me=async o=>{try{await U.toggleUserStatus(o.id)}catch(e){console.error("Failed to toggle user status:",e)}},Ee=async o=>{try{await U.forcePasswordChange(o.id),P.success("Password change forced for user")}catch(e){console.error("Failed to force password change:",e),P.failed("Failed to force password change")}},Be=async o=>{try{await U.sendPasswordResetLink(o.email),P.success("Password reset link sent to user")}catch(e){console.error("Failed to send password reset link:",e),P.failed("Failed to send password reset link")}},Ie=()=>{console.log("Export permissions")},qe=o=>{o&&o.length===2?u.setFilters({startDate:o[0],endDate:o[1]}):u.setFilters({startDate:null,endDate:null}),Z.value=!1},He=o=>new Date(o).toLocaleDateString(),de=o=>new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),Oe=()=>{selectedAction.value=null,ee.value=[],u.clearFilters()},Ge=o=>{selectedLog.value=o,detailsDialog.value=!0};return ut(async()=>{try{await Promise.all([A.fetchPermissions(),g.fetchRoles(),U.fetchUsers(),u.fetchAuditLogs()])}catch(o){console.error("Failed to fetch initial data:",o)}}),mt(()=>u.filters,async()=>{try{await u.fetchAuditLogs()}catch(o){console.error("Failed to refetch audit logs:",o)}},{deep:!0}),(o,e)=>{const f=d("v-btn"),c=d("v-icon"),M=d("v-avatar"),F=d("v-card-text"),h=d("v-card"),b=d("v-col"),E=d("v-row"),J=d("v-tab"),Je=d("v-tabs"),B=d("v-divider"),S=d("v-text-field"),w=d("v-list-item-title"),x=d("v-list-item"),le=d("v-list"),K=d("v-menu"),se=d("v-card-title"),C=d("v-chip"),Ke=d("v-chip-group"),Qe=d("v-switch"),Q=d("v-window-item"),ue=d("v-data-table"),oe=d("v-spacer"),me=d("v-card-actions"),ce=d("v-dialog"),ae=d("v-select"),ve=d("v-container"),ie=d("v-img"),We=d("v-date-picker"),Xe=d("v-progress-circular"),Ye=d("v-alert"),Ze=d("v-timeline-item"),et=d("v-timeline"),tt=d("v-window");return m(),_(nt,{title:"Permissions Management"},{header:t(()=>[a("div",ct,[e[22]||(e[22]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold text-primary mb-2"}," Permissions Management "),a("p",{class:"text-body-1 text-medium-emphasis mb-0"}," Manage user roles, permissions, and access controls across your organization ")],-1)),a("div",vt,[l(f,{color:"primary",variant:"outlined","prepend-icon":"mdi-download",onClick:Ie},{default:t(()=>e[20]||(e[20]=[i(" Export ")])),_:1,__:[20]}),l(f,{color:"primary","prepend-icon":"mdi-plus",onClick:Ue},{default:t(()=>e[21]||(e[21]=[i(" Create Role ")])),_:1,__:[21]})])])]),default:t(()=>[l(ve,{fluid:"",class:"pa-0"},{default:t(()=>[l(E,{class:"mb-6"},{default:t(()=>[(m(!0),k(z,null,$(_e.value,s=>(m(),_(b,{cols:"12",sm:"6",md:"3",key:s.title},{default:t(()=>[l(h,{elevation:"2",class:"h-100"},{default:t(()=>[l(F,{class:"d-flex align-center"},{default:t(()=>[a("div",pt,[a("div",ft,n(s.value),1),a("div",_t,n(s.title),1)]),l(M,{size:"48",color:s.color,variant:"tonal"},{default:t(()=>[l(c,{size:"24",color:s.color},{default:t(()=>[i(n(s.icon),1)]),_:2},1032,["color"])]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(h,{elevation:"2"},{default:t(()=>[l(Je,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=s=>q.value=s),"bg-color":"transparent",class:"px-4"},{default:t(()=>[l(J,{value:"permissions"},{default:t(()=>[l(c,{start:""},{default:t(()=>e[23]||(e[23]=[i("mdi-key")])),_:1,__:[23]}),e[24]||(e[24]=i(" Permissions "))]),_:1,__:[24]}),l(J,{value:"roles"},{default:t(()=>[l(c,{start:""},{default:t(()=>e[25]||(e[25]=[i("mdi-account-group")])),_:1,__:[25]}),e[26]||(e[26]=i(" Roles & Permissions "))]),_:1,__:[26]}),l(J,{value:"users"},{default:t(()=>[l(c,{start:""},{default:t(()=>e[27]||(e[27]=[i("mdi-account-multiple")])),_:1,__:[27]}),e[28]||(e[28]=i(" User Assignments "))]),_:1,__:[28]}),l(J,{value:"audit"},{default:t(()=>[l(c,{start:""},{default:t(()=>e[29]||(e[29]=[i("mdi-history")])),_:1,__:[29]}),e[30]||(e[30]=i(" Audit Log "))]),_:1,__:[30]})]),_:1},8,["modelValue"]),l(B),l(F,{class:"pa-6"},{default:t(()=>[l(tt,{modelValue:q.value,"onUpdate:modelValue":e[16]||(e[16]=s=>q.value=s)},{default:t(()=>[l(Q,{value:"roles"},{default:t(()=>[a("div",gt,[e[31]||(e[31]=a("div",null,[a("p",{class:"text-body-2 text-medium-emphasis mb-0"})],-1)),l(S,{modelValue:X.value,"onUpdate:modelValue":e[1]||(e[1]=s=>X.value=s),"prepend-inner-icon":"mdi-magnify",placeholder:"Search roles...",variant:"outlined",density:"compact","single-line":"","hide-details":"",class:"search-field",style:{"max-width":"300px"}},null,8,["modelValue"])]),l(E,null,{default:t(()=>[(m(!0),k(z,null,$(ge.value,s=>(m(),_(b,{cols:"12",md:"6",lg:"4",key:s.id},{default:t(()=>[l(h,{elevation:"1",class:pe([{"border-primary":s.active},"h-100"])},{default:t(()=>[l(se,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",yt,[l(M,{color:s.color,size:"32",class:"mr-3"},{default:t(()=>[l(c,{color:"white",size:"16"},{default:t(()=>[i(n(s.icon),1)]),_:2},1024)]),_:2},1032,["color"]),a("div",null,[a("div",bt,n(s.name),1),a("div",wt,n(s.users_count)+" "+n(s.users_count===1?"user":"users"),1)])]),l(K,null,{activator:t(({props:r})=>[l(f,W({icon:"mdi-dots-vertical",size:"small",variant:"text",ref_for:!0},r),null,16)]),default:t(()=>[l(le,null,{default:t(()=>[l(x,{onClick:r=>Pe(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[32]||(e[32]=[i("mdi-pencil")])),_:1,__:[32]})]),default:t(()=>[l(w,null,{default:t(()=>e[33]||(e[33]=[i("Edit Role")])),_:1,__:[33]})]),_:2},1032,["onClick"]),l(x,{onClick:r=>De(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[34]||(e[34]=[i("mdi-content-copy")])),_:1,__:[34]})]),default:t(()=>[l(w,null,{default:t(()=>e[35]||(e[35]=[i("Duplicate")])),_:1,__:[35]})]),_:2},1032,["onClick"]),l(B),l(x,{onClick:r=>Ae(s),class:"text-error"},{prepend:t(()=>[l(c,{color:"error"},{default:t(()=>e[36]||(e[36]=[i("mdi-delete")])),_:1,__:[36]})]),default:t(()=>[l(w,null,{default:t(()=>e[37]||(e[37]=[i("Delete Role")])),_:1,__:[37]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l(F,null,{default:t(()=>[a("p",xt,n(s.description),1),a("div",kt,[e[38]||(e[38]=a("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Permissions",-1)),l(Ke,null,{default:t(()=>[(m(!0),k(z,null,$(s.permissions.slice(0,3),r=>(m(),_(C,{key:r,size:"small",color:"primary",variant:"tonal"},{default:t(()=>[i(n(r),1)]),_:2},1024))),128)),s.permissions.length>3?(m(),_(C,{key:0,size:"small",variant:"outlined"},{default:t(()=>[i(" +"+n(s.permissions.length-3)+" more ",1)]),_:2},1024)):V("",!0)]),_:2},1024)]),a("div",Vt,[l(Qe,{modelValue:s.active,"onUpdate:modelValue":r=>s.active=r,label:s.active?"Active":"Inactive",color:"success",density:"compact","hide-details":"",onChange:r=>Le(s)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]),l(f,{variant:"outlined",size:"small",onClick:r=>Re(s)},{default:t(()=>e[39]||(e[39]=[i(" View Details ")])),_:2,__:[39]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}),l(Q,{value:"permissions"},{default:t(()=>[a("div",Ct,[e[40]||(e[40]=a("div",null,[a("h2",{class:"text-h5 font-weight-medium mb-1"},"Permissions Management"),a("p",{class:"text-body-2 text-medium-emphasis mb-0"}," Create, edit, and delete permissions for your organization ")],-1)),l(S,{modelValue:H.value,"onUpdate:modelValue":e[2]||(e[2]=s=>H.value=s),"prepend-inner-icon":"mdi-magnify",placeholder:"Search permissions...",variant:"outlined",density:"compact","single-line":"","hide-details":"",class:"search-field",style:{"max-width":"300px"}},null,8,["modelValue"])]),l(E,null,{default:t(()=>[l(b,{cols:"12"},{default:t(()=>[l(f,{color:"primary","prepend-icon":"mdi-plus",class:"mb-4",onClick:he},{default:t(()=>e[41]||(e[41]=[i(" Create Permission ")])),_:1,__:[41]}),l(ue,{headers:Ve.value,items:ye.value,search:H.value,class:"elevation-1","items-per-page":10},{top:t(()=>e[42]||(e[42]=[])),"item.actions":t(({item:s})=>[l(K,null,{activator:t(({props:r})=>[l(f,W({icon:"mdi-dots-vertical",size:"small",variant:"text"},r),null,16)]),default:t(()=>[l(le,null,{default:t(()=>[l(x,{onClick:r=>Se(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[43]||(e[43]=[i("mdi-pencil")])),_:1,__:[43]})]),default:t(()=>[l(w,null,{default:t(()=>e[44]||(e[44]=[i("Edit")])),_:1,__:[44]})]),_:2},1032,["onClick"]),l(B),l(x,{onClick:r=>$e(s),class:"text-error"},{prepend:t(()=>[l(c,{color:"error"},{default:t(()=>e[45]||(e[45]=[i("mdi-delete")])),_:1,__:[45]})]),default:t(()=>[l(w,null,{default:t(()=>e[46]||(e[46]=[i("Delete")])),_:1,__:[46]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items","search"])]),_:1})]),_:1}),l(ce,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=s=>L.value=s),"max-width":"500"},{default:t(()=>[l(h,null,{default:t(()=>[l(se,null,{default:t(()=>[a("span",Ut,n(T.value?"Edit Permission":"Create Permission"),1)]),_:1}),l(F,null,{default:t(()=>[l(S,{modelValue:y.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value.name=s),label:"Permission Name",required:"",autofocus:""},null,8,["modelValue"]),l(S,{modelValue:y.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>y.value.description=s),label:"Description"},null,8,["modelValue"])]),_:1}),l(me,null,{default:t(()=>[l(oe),l(f,{text:"",onClick:e[5]||(e[5]=s=>L.value=!1)},{default:t(()=>e[47]||(e[47]=[i("Cancel")])),_:1,__:[47]}),l(f,{color:"primary",onClick:ze},{default:t(()=>[i(n(T.value?"Save":"Create"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(Q,{value:"users"},{default:t(()=>[a("div",Pt,[e[49]||(e[49]=a("div",null,[a("h2",{class:"text-h5 font-weight-medium mb-1"},"User Role Assignments"),a("p",{class:"text-booptdy-2 text-medium-emphasis mb-0"}," Manage user role assignments and permissions ")],-1)),l(ve,{fluid:""},{default:t(()=>[l(E,{justify:"center",class:"mb-2"},{default:t(()=>[l(b,{cols:"12",md:"4"},{default:t(()=>[l(ae,{modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=s=>Y.value=s),items:we.value,placeholder:"Filter by role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),l(b,{cols:"12",md:"4"},{default:t(()=>[l(S,{modelValue:O.value,"onUpdate:modelValue":e[8]||(e[8]=s=>O.value=s),"prepend-inner-icon":"mdi-magnify",placeholder:"Search users...",variant:"outlined",density:"compact","single-line":"","hide-details":""},null,8,["modelValue"])]),_:1}),l(b,{cols:"12",md:"4"},{default:t(()=>[l(f,{color:"primary","prepend-icon":"mdi-account-plus",onClick:Ne},{default:t(()=>e[48]||(e[48]=[i(" Add User ")])),_:1,__:[48]})]),_:1})]),_:1})]),_:1})]),l(ue,{headers:Ce.value,items:be.value,search:O.value,class:"elevation-1","items-per-page":10},{"item.user":t(({item:s})=>[a("div",Dt,[l(M,{size:"40",class:"mr-3"},{default:t(()=>[l(ie,{src:s.avatar,alt:s.name},null,8,["src","alt"])]),_:2},1024),a("div",null,[a("div",At,n(s.name),1),a("div",Lt,n(s.email),1)])])]),"item.role":t(({item:s})=>[l(ae,{"model-value":s.roles[0],items:fe.value.map(r=>({title:r.name,value:r.name})),variant:"outlined",density:"compact","onUpdate:modelValue":r=>re(s,r)},null,8,["model-value","items","onUpdate:modelValue"])]),"item.status":t(({item:s})=>[l(C,{color:s.status==="Active"?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[i(n(s.status),1)]),_:2},1032,["color"])]),"item.lastLogin":t(({item:s})=>[a("div",Rt,n(He(s.lastLogin)),1)]),"item.actions":t(({item:s})=>[l(K,null,{activator:t(({props:r})=>[l(f,W({icon:"mdi-dots-vertical",size:"small",variant:"text"},r),null,16)]),default:t(()=>[l(le,null,{default:t(()=>[l(x,{onClick:r=>je(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[50]||(e[50]=[i("mdi-eye")])),_:1,__:[50]})]),default:t(()=>[l(w,null,{default:t(()=>e[51]||(e[51]=[i("View Permissions")])),_:1,__:[51]})]),_:2},1032,["onClick"]),l(x,{onClick:r=>Te(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[52]||(e[52]=[i("mdi-pencil")])),_:1,__:[52]})]),default:t(()=>[l(w,null,{default:t(()=>e[53]||(e[53]=[i("Edit User")])),_:1,__:[53]})]),_:2},1032,["onClick"]),l(B),l(x,{onClick:r=>Me(s),class:pe({"text-error":s.status==="Active"})},{prepend:t(()=>[l(c,{color:s.status==="Active"?"error":"success"},{default:t(()=>[i(n(s.status==="Active"?"mdi-account-cancel":"mdi-account-check"),1)]),_:2},1032,["color"])]),default:t(()=>[l(w,null,{default:t(()=>[i(n(s.status==="Active"?"Suspend User":"Activate User"),1)]),_:2},1024)]),_:2},1032,["onClick","class"]),l(x,{onClick:r=>Ee(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[54]||(e[54]=[i("mdi-lock-reset")])),_:1,__:[54]})]),default:t(()=>[l(w,null,{default:t(()=>e[55]||(e[55]=[i("Force Password Change")])),_:1,__:[55]})]),_:2},1032,["onClick"]),l(x,{onClick:r=>Be(s)},{prepend:t(()=>[l(c,null,{default:t(()=>e[56]||(e[56]=[i("mdi-email-send")])),_:1,__:[56]})]),default:t(()=>[l(w,null,{default:t(()=>e[57]||(e[57]=[i("Send Reset Link")])),_:1,__:[57]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items","search"])]),_:1}),l(Q,{value:"audit"},{default:t(()=>[a("div",Ft,[e[58]||(e[58]=a("div",null,[a("h2",{class:"text-h5 font-weight-medium mb-1"},"Audit Log"),a("p",{class:"text-body-2 text-medium-emphasis mb-0"}," Track all permission and role changes ")],-1)),a("div",ht,[l(ae,{modelValue:o.selectedAction,"onUpdate:modelValue":[e[9]||(e[9]=s=>o.selectedAction=s),ke],items:xe.value,placeholder:"Filter by action",variant:"outlined",density:"compact",clearable:"",style:{"min-width":"200px"}},null,8,["modelValue","items"]),l(K,{modelValue:Z.value,"onUpdate:modelValue":e[12]||(e[12]=s=>Z.value=s)},{activator:t(({props:s})=>[l(S,W({modelValue:o.dateRangeText,"onUpdate:modelValue":e[10]||(e[10]=r=>o.dateRangeText=r),"prepend-inner-icon":"mdi-calendar",placeholder:"Select date range",variant:"outlined",density:"compact",readonly:""},s,{style:{"min-width":"200px"}}),null,16,["modelValue"])]),default:t(()=>[l(We,{modelValue:ee.value,"onUpdate:modelValue":[e[11]||(e[11]=s=>ee.value=s),qe],range:""},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),v(u).loading?(m(),k("div",St,[l(Xe,{indeterminate:"",color:"primary"}),e[59]||(e[59]=a("p",{class:"mt-4 text-body-2"},"Loading audit logs...",-1))])):V("",!0),v(u).error?(m(),_(Ye,{key:1,type:"error",class:"mb-4",closable:"","onClick:close":e[13]||(e[13]=s=>v(u).error=null)},{default:t(()=>[i(n(v(u).error),1)]),_:1})):V("",!0),v(u).recentChangesCount>0?(m(),_(C,{key:2,color:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[i(n(v(u).recentChangesCount)+" changes in the last 24 hours ",1)]),_:1})):V("",!0),!v(u).loading&&v(u).filteredAuditLogs.length>0?(m(),_(et,{key:3,side:"end",class:"audit-timeline"},{default:t(()=>[(m(!0),k(z,null,$(v(u).filteredAuditLogs,s=>(m(),_(Ze,{key:s.id,"dot-color":v(u).getAuditColor(s.action),size:"small"},{icon:t(()=>[l(c,{size:"16"},{default:t(()=>[i(n(v(u).getAuditIcon(s.action)),1)]),_:2},1024)]),default:t(()=>[l(h,{elevation:"1",class:"mb-4"},{default:t(()=>[l(F,null,{default:t(()=>[a("div",zt,[a("div",$t,[l(C,{color:v(u).getAuditColor(s.action),size:"small",variant:"tonal",class:"mr-2"},{default:t(()=>[i(n(s.action),1)]),_:2},1032,["color"]),a("span",jt,n(s.description),1)]),a("div",Nt,n(de(s.timestamp)),1)]),a("div",Tt,[l(M,{size:"24",class:"mr-2"},{default:t(()=>[l(ie,{src:s.user.avatar,alt:s.user.name},null,8,["src","alt"])]),_:2},1024),a("span",Mt,n(s.user.name),1),l(oe),l(f,{variant:"text",size:"small",onClick:r=>Ge(s)},{default:t(()=>e[60]||(e[60]=[i(" View Details ")])),_:2,__:[60]},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1})):!v(u).loading&&v(u).filteredAuditLogs.length===0?(m(),k("div",Et,[l(c,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[61]||(e[61]=[i("mdi-file-document-outline")])),_:1,__:[61]}),e[63]||(e[63]=a("h3",{class:"text-h6 mt-4 mb-2"},"No audit logs found",-1)),v(u).filters.action||v(u).filters.startDate||v(u).filters.endDate?(m(),_(f,{key:0,variant:"outlined",onClick:Oe,class:"mt-4"},{default:t(()=>e[62]||(e[62]=[i(" Clear Filters ")])),_:1,__:[62]})):V("",!0)])):V("",!0),l(ce,{modelValue:o.detailsDialog,"onUpdate:modelValue":e[15]||(e[15]=s=>o.detailsDialog=s),"max-width":"600"},{default:t(()=>[o.selectedLog?(m(),_(h,{key:0},{default:t(()=>[l(se,{class:"d-flex align-center"},{default:t(()=>[l(c,{color:v(u).getAuditColor(o.selectedLog.action),class:"mr-2"},{default:t(()=>[i(n(v(u).getAuditIcon(o.selectedLog.action)),1)]),_:1},8,["color"]),e[64]||(e[64]=i(" Audit Log Details "))]),_:1,__:[64]}),l(F,null,{default:t(()=>{var s,r;return[l(E,null,{default:t(()=>[l(b,{cols:"12",sm:"6"},{default:t(()=>[e[65]||(e[65]=a("div",{class:"text-caption text-medium-emphasis"},"Action",-1)),l(C,{color:v(u).getAuditColor(o.selectedLog.action),size:"small",variant:"tonal"},{default:t(()=>[i(n(o.selectedLog.action),1)]),_:1},8,["color"])]),_:1,__:[65]}),l(b,{cols:"12",sm:"6"},{default:t(()=>[e[66]||(e[66]=a("div",{class:"text-caption text-medium-emphasis"},"Timestamp",-1)),a("div",Bt,n(de(o.selectedLog.timestamp)),1)]),_:1,__:[66]}),l(b,{cols:"12"},{default:t(()=>[e[67]||(e[67]=a("div",{class:"text-caption text-medium-emphasis"},"Description",-1)),a("div",It,n(o.selectedLog.description),1)]),_:1,__:[67]}),l(b,{cols:"12"},{default:t(()=>[e[68]||(e[68]=a("div",{class:"text-caption text-medium-emphasis"},"User",-1)),a("div",qt,[l(M,{size:"32",class:"mr-2"},{default:t(()=>[l(ie,{src:o.selectedLog.user.avatar,alt:o.selectedLog.user.name},null,8,["src","alt"])]),_:1}),a("div",null,n(o.selectedLog.user.name),1)])]),_:1,__:[68]})]),_:1}),l(B,{class:"my-4"}),e[71]||(e[71]=a("div",{class:"text-caption text-medium-emphasis mb-2"},"Change Details",-1)),(s=o.selectedLog.details)!=null&&s.attributes?(m(),k("div",Ht,[e[69]||(e[69]=a("div",{class:"text-body-2 font-weight-medium mb-2"},"New Values:",-1)),(m(!0),k(z,null,$(o.selectedLog.details.attributes,(ne,I)=>(m(),_(C,{key:I,size:"small",variant:"outlined",class:"mr-1 mb-1"},{default:t(()=>[i(n(I)+": "+n(ne),1)]),_:2},1024))),128))])):V("",!0),(r=o.selectedLog.details)!=null&&r.old?(m(),k("div",Ot,[e[70]||(e[70]=a("div",{class:"text-body-2 font-weight-medium mb-2"},"Previous Values:",-1)),(m(!0),k(z,null,$(o.selectedLog.details.old,(ne,I)=>(m(),_(C,{key:I,size:"small",variant:"outlined",color:"orange",class:"mr-1 mb-1"},{default:t(()=>[i(n(I)+": "+n(ne),1)]),_:2},1024))),128))])):V("",!0)]}),_:1,__:[71]}),l(me,null,{default:t(()=>[l(oe),l(f,{text:"",onClick:e[14]||(e[14]=s=>o.detailsDialog=!1)},{default:t(()=>e[72]||(e[72]=[i("Close")])),_:1,__:[72]})]),_:1})]),_:1})):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(rt,{modelValue:j.value,"onUpdate:modelValue":e[17]||(e[17]=s=>j.value=s),role:R.value,onSave:Fe},null,8,["modelValue","role"]),l(at,{modelValue:te.value,"onUpdate:modelValue":e[18]||(e[18]=s=>te.value=s),user:N.value},null,8,["modelValue","user"]),l(dt,{modelValue:G.value,"onUpdate:modelValue":e[19]||(e[19]=s=>G.value=s),user:N.value,onUpdate:re},null,8,["modelValue","user"])]),_:1})}}};export{il as default};
