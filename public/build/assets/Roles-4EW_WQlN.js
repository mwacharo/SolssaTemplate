import{_ as xe}from"./AppLayout-CzWgUn4f.js";import{r as u,j as q,k as ke,l as o,c as b,o as p,w as n,b as e,a as we,f as i,d as O,e as Q,F as G,g as H,t as _,i as k}from"./app-DqFy7JPp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CVMuOJM1.js";import"./africastalking-BWG0fu3Q.js";import"./IncomingCallDialog-y-hmzpsN.js";/* empty css                                                                           */const Le={__name:"Roles",setup(Ve){const r=u([]),R=u([]),$=u(!1),g=u(!1),L=u(!1),D=u(""),y=u(""),w=u(!1),P=u(!1),V=u(!1),v=u({name:""}),C=u(null),f=u(null),d=u([]),x=u(null),J=[{title:"Role Name",value:"name"},{title:"Permissions",value:"permissions"},{title:"Actions",value:"actions",sortable:!1,width:"150px"}],K={required:l=>!!l||"Required"},z=q(()=>C.value!==null),W=q(()=>D.value?r.value.filter(l=>l.name.toLowerCase().includes(D.value.toLowerCase())):r.value),X=q(()=>y.value?R.value.filter(l=>l.name.toLowerCase().includes(y.value.toLowerCase())||l.description.toLowerCase().includes(y.value.toLowerCase())):R.value);async function Y(){$.value=!0;try{const{data:l}=await k.get("/api/v1/admin/roles");r.value=l}catch(l){console.error("Error fetching roles:",l)}finally{$.value=!1}}async function Z(){try{const{data:l}=await k.get("/api/v1/admin/permissions");R.value=l}catch(l){console.error("Error fetching permissions:",l)}}async function ee(){if(v.value.name){g.value=!0;try{if(z.value){const{data:l}=await k.put(`/api/v1/admin/roles/${C.value}`,{name:v.value.name}),a=r.value.findIndex(c=>c.id===C.value);a!==-1&&(r.value[a]=l)}else{const{data:l}=await k.post("/api/v1/admin/roles",{name:v.value.name,permissions:[]});r.value.push(l)}I()}catch(l){console.error("Error saving role:",l)}finally{g.value=!1}}}async function le(){if(f.value){g.value=!0;try{const{data:l}=await k.put(`/api/v1/admin/roles/${f.value.id}`,{name:f.value.name,permissions:d.value}),a=r.value.findIndex(c=>c.id===f.value.id);a!==-1&&(r.value[a]=l),M()}catch(l){console.error("Error updating permissions:",l)}finally{g.value=!1}}}async function ae(){if(x.value){L.value=!0;try{await k.delete(`/api/v1/admin/roles/${x.value.id}`),r.value=r.value.filter(l=>l.id!==x.value.id),V.value=!1,x.value=null}catch(l){console.error("Error deleting role:",l)}finally{L.value=!1}}}function ne(){v.value={name:""},C.value=null,w.value=!0}function te(l){v.value={name:l.name},C.value=l.id,w.value=!0}function F(l){f.value=l,d.value=[...l.permissions||[]],P.value=!0}function oe(l){x.value=l,V.value=!0}function I(){w.value=!1,v.value={name:""},C.value=null}function M(){P.value=!1,f.value=null,d.value=[],y.value=""}function ie(l,a){if(a)d.value.includes(l)||d.value.push(l);else{const c=d.value.indexOf(l);c>-1&&d.value.splice(c,1)}}function ue(){d.value=R.value.map(l=>l.name)}function se(){d.value=[]}function T(l){return l.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}return ke(async()=>{await Promise.all([Y(),Z()])}),(l,a)=>{const c=o("v-col"),s=o("v-btn"),re=o("v-row"),A=o("v-text-field"),U=o("v-card-text"),E=o("v-card"),de=o("v-skeleton-loader"),j=o("v-chip"),ce=o("v-chip-group"),ve=o("v-data-table"),me=o("v-container"),S=o("v-card-title"),B=o("v-spacer"),N=o("v-card-actions"),h=o("v-dialog"),_e=o("v-checkbox"),fe=o("v-icon"),pe=o("v-list-item-title"),ge=o("v-list-item-subtitle"),ye=o("v-list-item"),Ce=o("v-list");return p(),b(xe,null,{default:n(()=>[e(me,null,{default:n(()=>[e(re,{class:"mb-4 align-center"},{default:n(()=>[e(c,null,{default:n(()=>a[7]||(a[7]=[we("h2",{class:"text-h4"},"Roles Management",-1)])),_:1,__:[7]}),e(c,{class:"text-right"},{default:n(()=>[e(s,{color:"primary",onClick:ne,"prepend-icon":"mdi-plus"},{default:n(()=>a[8]||(a[8]=[i(" Create Role ")])),_:1,__:[8]})]),_:1})]),_:1}),e(E,{class:"mb-4",variant:"outlined"},{default:n(()=>[e(U,null,{default:n(()=>[e(A,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=t=>D.value=t),label:"Search roles...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(ve,{headers:J,items:W.value,loading:$.value,"item-key":"id",class:"elevation-1"},{loading:n(()=>[e(de,{type:"table-row@5"})]),"item.permissions":n(({item:t})=>[e(ce,null,{default:n(()=>[(p(!0),O(G,null,H((t.permissions||[]).slice(0,2),m=>(p(),b(j,{key:m,size:"small",color:"primary",variant:"tonal"},{default:n(()=>[i(_(T(m)),1)]),_:2},1024))),128)),t.permissions&&t.permissions.length>2?(p(),b(j,{key:0,size:"small",variant:"outlined",onClick:m=>F(t),style:{cursor:"pointer"}},{default:n(()=>[i(" +"+_(t.permissions.length-2)+" more ",1)]),_:2},1032,["onClick"])):Q("",!0)]),_:2},1024)]),"item.actions":n(({item:t})=>[e(s,{icon:"mdi-shield-edit",size:"small",variant:"text",onClick:m=>F(t)},null,8,["onClick"]),e(s,{icon:"mdi-pencil",size:"small",variant:"text",onClick:m=>te(t)},null,8,["onClick"]),e(s,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:m=>oe(t)},null,8,["onClick"])]),_:1},8,["items","loading"])]),_:1}),e(h,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=t=>w.value=t),"max-width":"500px"},{default:n(()=>[e(E,null,{default:n(()=>[e(S,null,{default:n(()=>[i(_(z.value?"Edit Role":"Create Role"),1)]),_:1}),e(U,null,{default:n(()=>[e(A,{modelValue:v.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value.name=t),label:"Role Name",rules:[K.required],variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(N,null,{default:n(()=>[e(B),e(s,{variant:"outlined",onClick:I},{default:n(()=>a[9]||(a[9]=[i("Cancel")])),_:1,__:[9]}),e(s,{color:"primary",loading:g.value,onClick:ee},{default:n(()=>[i(_(z.value?"Update":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=t=>P.value=t),"max-width":"600px"},{default:n(()=>[e(E,null,{default:n(()=>[e(S,null,{default:n(()=>{var t;return[i(" Manage Permissions - "+_((t=f.value)==null?void 0:t.name),1)]}),_:1}),e(U,{style:{"max-height":"400px","overflow-y":"auto"}},{default:n(()=>[e(A,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),label:"Search permissions...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-4"},null,8,["modelValue"]),e(Ce,{density:"compact"},{default:n(()=>[(p(!0),O(G,null,H(X.value,t=>(p(),b(ye,{key:t.id},{prepend:n(()=>[e(_e,{"model-value":d.value.includes(t.name),"onUpdate:modelValue":m=>ie(t.name,m),color:"primary"},null,8,["model-value","onUpdate:modelValue"])]),default:n(()=>[e(pe,{class:"d-flex align-center"},{default:n(()=>[e(fe,{icon:t.icon,color:t.color,class:"mr-3",size:"small"},null,8,["icon","color"]),i(" "+_(T(t.name)),1)]),_:2},1024),t.description?(p(),b(ge,{key:0},{default:n(()=>[i(_(t.description),1)]),_:2},1024)):Q("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),e(N,null,{default:n(()=>[e(s,{variant:"outlined",onClick:ue},{default:n(()=>a[10]||(a[10]=[i("Select All")])),_:1,__:[10]}),e(s,{variant:"outlined",onClick:se},{default:n(()=>a[11]||(a[11]=[i("Clear All")])),_:1,__:[11]}),e(B),e(s,{variant:"outlined",onClick:M},{default:n(()=>a[12]||(a[12]=[i("Cancel")])),_:1,__:[12]}),e(s,{color:"primary",loading:g.value,onClick:le},{default:n(()=>a[13]||(a[13]=[i(" Update ")])),_:1,__:[13]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=t=>V.value=t),"max-width":"400px"},{default:n(()=>[e(E,null,{default:n(()=>[e(S,null,{default:n(()=>a[14]||(a[14]=[i("Confirm Delete")])),_:1,__:[14]}),e(U,null,{default:n(()=>{var t;return[i(' Are you sure you want to delete "'+_((t=x.value)==null?void 0:t.name)+'"? ',1)]}),_:1}),e(N,null,{default:n(()=>[e(B),e(s,{variant:"outlined",onClick:a[5]||(a[5]=t=>V.value=!1)},{default:n(()=>a[15]||(a[15]=[i("Cancel")])),_:1,__:[15]}),e(s,{color:"error",loading:L.value,onClick:ae},{default:n(()=>a[16]||(a[16]=[i(" Delete ")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Le as default};
