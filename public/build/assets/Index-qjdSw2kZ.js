import{_ as be}from"./AppLayout-B2tFeSvb.js";import{r as v,j as P,k as ke,l as s,c as y,o as m,w as o,a as e,b as n,e as le,u as $,f as i,d as g,F as ne,g as oe,t as a,W as ae}from"./app-BfTUaguK.js";import{u as we}from"./orderStore-CI0ablow.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-R5zbbFb9.js";import"./africastalking-DlNsz1fk.js";import"./IncomingCallDialog-BHAiMNLZ.js";/* empty css                                                                           */import"./toast-RzEVnAJt.js";const Ve={class:"pa-4"},Ce={key:1,class:"text-center py-8"},ze={__name:"Index",props:{invoices:{type:Array,default:()=>[]}},setup(U){const d=we(),b=v(!1),k=v(!1),S=v(!1),D=v(!1),F=v(""),L=v("success"),u=v({from:"",to:""}),p=v(100),c=v([]),T=P(()=>u.value.from&&u.value.to&&d.vendor),j=P(()=>d.vendorOptions.find(r=>r.id===d.vendor)),B=P(()=>c.value.length*p.value),re=async()=>{if(!T.value){w("Please select date range and vendor","error");return}b.value=!0,k.value=!0;try{const t=await(await fetch(`/api/v1/orders/vendor/${d.vendor}?from=${u.value.from}&to=${u.value.to}`)).json();if(t.success)c.value=t.data||[];else throw new Error(t.message||"Failed to fetch orders")}catch(r){console.error("Error fetching orders:",r),w("Error loading orders","error"),c.value=[]}finally{k.value=!1}},I=()=>{b.value=!1,c.value=[]},se=async()=>{S.value=!0;try{await ae.post("/vendor-invoices",{vendor_id:d.vendor,from:u.value.from,to:u.value.to,rate:p.value,orders:c.value.map(r=>r.id),total_commission:B.value},{onSuccess:()=>{w("Invoice generated successfully","success"),I(),u.value={from:"",to:""},d.vendor=null},onError:r=>{w("Error generating invoice","error"),console.error(r)}})}finally{S.value=!1}},ue=r=>{ae.visit(`/vendor-invoices/${r.id}`)},de=r=>{window.open(`/vendor-invoices/${r.id}/download`,"_blank")},w=(r,t="success")=>{F.value=r,L.value=t,D.value=!0},V=r=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(r),h=r=>r?new Date(r).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}):"N/A",ie=r=>({pending:"warning",paid:"success",cancelled:"error",processing:"info"})[r==null?void 0:r.toLowerCase()]||"default";return ke(async()=>{d.initialized?await d.fetchDropdownOptions():await d.initialize()}),(r,t)=>{const A=s("v-text-field"),_=s("v-col"),me=s("v-autocomplete"),f=s("v-btn"),E=s("v-row"),G=s("v-card-title"),ce=s("v-chip"),K=s("v-table"),O=s("v-card-text"),z=s("v-card"),M=s("v-alert"),ve=s("v-progress-circular"),_e=s("v-divider"),fe=s("v-spacer"),pe=s("v-card-actions"),ye=s("v-dialog"),ge=s("v-snackbar");return m(),y(be,null,{default:o(()=>[e("div",Ve,[t[9]||(t[9]=e("h2",{class:"text-h4 mb-6"},"Vendor Payments",-1)),n(E,null,{default:o(()=>[n(_,{cols:"12",md:"4"},{default:o(()=>[n(A,{modelValue:u.value.from,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value.from=l),label:"Date From",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",md:"4"},{default:o(()=>[n(A,{modelValue:u.value.to,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value.to=l),label:"Date To",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",md:"4"},{default:o(()=>[n(me,{modelValue:$(d).vendor,"onUpdate:modelValue":t[2]||(t[2]=l=>$(d).vendor=l),items:$(d).vendorOptions,"item-title":"name","item-value":"id",clearable:"",label:"Search sellers...",variant:"outlined",density:"comfortable",class:"w-full"},null,8,["modelValue","items"])]),_:1}),n(_,{cols:"12"},{default:o(()=>[n(f,{color:"primary",onClick:re,disabled:!T.value,size:"large"},{default:o(()=>t[6]||(t[6]=[i(" Generate Invoice ")])),_:1,__:[6]},8,["disabled"])]),_:1})]),_:1}),U.invoices.length>0?(m(),y(z,{key:0,class:"mt-6"},{default:o(()=>[n(G,null,{default:o(()=>t[7]||(t[7]=[i("Recent Invoices")])),_:1,__:[7]}),n(O,null,{default:o(()=>[n(K,null,{default:o(()=>[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"Invoice No"),e("th",null,"Vendor"),e("th",null,"Period"),e("th",null,"Orders"),e("th",null,"Commission"),e("th",null,"Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(m(!0),g(ne,null,oe(U.invoices,l=>(m(),g("tr",{key:l.id},[e("td",null,a(l.invoice_no),1),e("td",null,a(l.vendor_name),1),e("td",null,a(l.period),1),e("td",null,a(l.order_count),1),e("td",null,a(V(l.total_commission)),1),e("td",null,[n(ce,{color:ie(l.status),size:"small"},{default:o(()=>[i(a(l.status),1)]),_:2},1032,["color"])]),e("td",null,[n(f,{icon:"mdi-eye",size:"small",variant:"text",onClick:C=>ue(l)},null,8,["onClick"]),n(f,{icon:"mdi-download",size:"small",variant:"text",onClick:C=>de(l)},null,8,["onClick"])])]))),128))])]),_:1,__:[8]})]),_:1})]),_:1})):le("",!0)]),n(ye,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=l=>b.value=l),"max-width":"1000",persistent:""},{default:o(()=>[n(z,null,{default:o(()=>[n(G,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[10]||(t[10]=e("span",null,"Generate Vendor Invoice",-1)),n(f,{icon:"mdi-close",variant:"text",onClick:I})]),_:1,__:[10]}),n(O,null,{default:o(()=>[j.value?(m(),y(M,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:o(()=>[t[11]||(t[11]=e("strong",null,"Vendor:",-1)),i(" "+a(j.value.name)+" ",1),t[12]||(t[12]=e("br",null,null,-1)),t[13]||(t[13]=e("strong",null,"Period:",-1)),i(" "+a(h(u.value.from))+" to "+a(h(u.value.to)),1)]),_:1,__:[11,12,13]})):le("",!0),n(E,{class:"mb-4"},{default:o(()=>[n(_,{cols:"12",md:"6"},{default:o(()=>[n(A,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=l=>p.value=l),modelModifiers:{number:!0},label:"Commission Rate (per order)",type:"number",prefix:"KES",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),k.value?(m(),g("div",Ce,[n(ve,{indeterminate:"",color:"primary",size:"64"}),t[14]||(t[14]=e("p",{class:"mt-4"},"Loading orders...",-1))])):c.value.length>0?(m(),y(K,{key:2,class:"mt-4"},{default:o(()=>[t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",null,"Order No"),e("th",null,"Customer"),e("th",null,"Phone"),e("th",null,"COD"),e("th",null,"Latest Status"),e("th",null,"Status Date"),e("th",null,"Quantity"),e("th",null,"Product"),e("th",null,"Address"),e("th",null,"City"),e("th",null,"Zone"),e("th",null,"Payment"),e("th",null,"Commission")])],-1)),e("tbody",null,[(m(!0),g(ne,null,oe(c.value,l=>{var C,R,W,q,Q,Z,H,J,X,Y,ee,te;return m(),g("tr",{key:l.id},[e("td",null,a(l.order_no),1),e("td",null,a(((C=l.customer)==null?void 0:C.full_name)||"N/A"),1),e("td",null,a(((R=l.customer)==null?void 0:R.phone)||"N/A"),1),e("td",null,a(V(l.cod_amount||l.total_price)),1),e("td",null,a(((q=(W=l.latest_status)==null?void 0:W.status)==null?void 0:q.name)||"N/A"),1),e("td",null,a(h((Q=l.latest_status)==null?void 0:Q.created_at)),1),e("td",null,a((l.order_items||[]).reduce((x,N)=>x+(Number(N.quantity)||0),0)),1),e("td",null,a((l.order_items||[]).map(x=>{var N;return((N=x.product)==null?void 0:N.product_name)||x.sku||"N/A"}).join(", ")),1),e("td",null,a(((Z=l.customer)==null?void 0:Z.address)||((H=l.shipping_address)==null?void 0:H.address)||"N/A"),1),e("td",null,a(((J=l.customer)==null?void 0:J.city)||((X=l.shipping_address)==null?void 0:X.city)||"N/A"),1),e("td",null,a(((Y=l.zone)==null?void 0:Y.name)||((te=(ee=l.customer)==null?void 0:ee.zone)==null?void 0:te.name)||"N/A"),1),e("td",null,a(l.payment_method||(Number(l.amount_paid||0)>0?"Prepaid":"COD")),1),e("td",null,a(V(p.value)),1)])}),128))])]),_:1,__:[15]})):(m(),y(M,{key:3,type:"warning",variant:"tonal",class:"mt-4"},{default:o(()=>t[16]||(t[16]=[i(" No orders found for the selected period and vendor. ")])),_:1,__:[16]})),n(_e,{class:"my-4"}),n(z,{variant:"tonal",color:"primary"},{default:o(()=>[n(O,null,{default:o(()=>[n(E,null,{default:o(()=>[n(_,{cols:"6"},{default:o(()=>[t[17]||(t[17]=e("strong",null,"Total Orders:",-1)),i(" "+a(c.value.length),1)]),_:1,__:[17]}),n(_,{cols:"6",class:"text-right"},{default:o(()=>[t[18]||(t[18]=e("strong",null,"Total Commission:",-1)),i(" "+a(V(B.value)),1)]),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1}),n(pe,null,{default:o(()=>[n(fe),n(f,{variant:"text",onClick:I},{default:o(()=>t[19]||(t[19]=[i("Cancel")])),_:1,__:[19]}),n(f,{color:"success",onClick:se,disabled:c.value.length===0||k.value,loading:S.value},{default:o(()=>t[20]||(t[20]=[i(" Generate Invoice ")])),_:1,__:[20]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ge,{modelValue:D.value,"onUpdate:modelValue":t[5]||(t[5]=l=>D.value=l),color:L.value,timeout:"3000"},{default:o(()=>[i(a(F.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}};export{ze as default};
