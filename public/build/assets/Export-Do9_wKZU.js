import{_ as E}from"./AppLayout-BkwEyNpr.js";import{u as U}from"./orderStore-BrvZm4c7.js";import{E as M,r as V,j as z,i as P,k as A,l as T,c as B,o as a,w as Z,a as o,d as s,e as c,b as k,f as R,u as t,F as h,t as S,g as D,n as L}from"./app-DaUcTzCd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-DSPN2aVZ.js";import"./africastalking-CJoUA7R0.js";import"./IncomingCallDialog-BZAuwMWn.js";/* empty css                                                                           */import"./toast-BwPUZlVk.js";const I=M("orderReport",()=>{const w=U(),r=[{id:"merchant",name:"Merchant Report"}],n={delivery:["zone","city","rider","deliveryDate","shippingStatus"],returns:["zone","city","rider","deliveryDate","shippingStatus"],dispatch:["merchant","zone","city","orderDate"],out_scan:["zone","city","rider","deliveryDate"],undispatched:["merchant","product","zone","city","orderDate"],merchant:["merchant","product","zone","city","confirmationStatus","shippingStatus","orderDate"],product:["merchant","product","category","zone","city","orderDate"],product_performance:["merchant","product","category","orderDate"],city:["city","zone","orderDate","shippingStatus"],zone:["zone","city","orderDate","shippingStatus"]},p={delivery:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"}],merchant:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"special_instructions",label:"Special Instructions"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"},{key:"agent",label:"Agent"}],default:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_phone",label:"Receiver Phone"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"city",label:"City"},{key:"zone",label:"Zone"}]},m=V(null),y=V({merchant:null,product:null,category:null,zone:null,city:null,rider:null,agent:null,confirmationStatus:null,shippingStatus:null,orderDate:null,deliveryDate:null}),v=V({merchants:[],products:[],categories:[],zones:[],cities:[],riders:[],agents:[],confirmationStatuses:[],shippingStatuses:[]}),_=V([]),f=V({page:1,perPage:25,total:0}),u=V({generate:!1,download:!1,options:!1}),e=V(null),d=z(()=>m.value?n[m.value]??[]:[]),x=z(()=>m.value?p[m.value]??p.default:[]);function l(){m.value=null,Object.keys(y.value).forEach(i=>y.value[i]=null),_.value=[],e.value=null,f.value={page:1,perPage:25,total:0}}function C(){const i={report_type:m.value,page:f.value.page,per_page:f.value.perPage,merchant:w.orderFilterVendor,product:w.orderFilterProduct,category:w.orderFilterCategory,zone:w.orderFilterZone,city:w.orderFilterCity,rider:w.orderFilterRider,confirmationStatus:y.value.confirmationStatus,shippingStatus:y.value.shippingStatus,orderDate:y.value.orderDate,deliveryDate:y.value.deliveryDate};return d.value.forEach(b=>{y.value[b]!==null&&y.value[b]!==""&&(i[b]=y.value[b])}),i}async function F(){u.value.options=!0;try{const{data:i}=await P.get("/api/v1/reports/options");v.value.merchants=i.merchants??[],v.value.products=i.products??[],v.value.categories=i.categories??[],v.value.zones=i.zones??[],v.value.cities=i.cities??[],v.value.riders=i.riders??[],v.value.agents=i.agents??[]}catch(i){console.error("Failed to load report options",i)}finally{u.value.options=!1}}async function O(){var i,b;if(m.value){e.value=null,u.value.generate=!0,f.value.page=1;try{const{data:g}=await P.get("/api/v1/reports/generate",{params:C()});_.value=g.data??[],f.value.total=g.total??0}catch(g){e.value=((b=(i=g.response)==null?void 0:i.data)==null?void 0:b.message)??"Failed to generate report.",_.value=[]}finally{u.value.generate=!1}}}async function j(i){f.value.page=i,await O()}async function N(){if(m.value){u.value.download=!0;try{const i=await P.get("/api/v1/reports/download",{params:{...C(),format:"xlsx"},responseType:"blob"}),b=URL.createObjectURL(new Blob([i.data])),g=document.createElement("a");g.href=b,g.setAttribute("download",`${m.value}_report_${Date.now()}.xlsx`),document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(b)}catch{e.value="Failed to download Excel file."}finally{u.value.download=!1}}}return{reportTypes:r,selectedReportType:m,filters:y,options:v,results:_,pagination:f,loading:u,error:e,activeFilterFields:d,activeColumns:x,fetchOptions:F,generateReport:O,changePage:j,downloadExcel:N,resetFilters:l}}),$={class:"p-6 max-w-screen-2xl mx-auto"},H={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6"},q={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4"},Q={key:0},G={key:1},J={key:2},K={key:3},W={key:4},X={key:5},Y={key:6},ee={key:7},te={key:8},re={class:"flex flex-wrap justify-end gap-3 pt-2 border-t border-gray-100"},le=["disabled"],oe={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ae={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},se=["disabled"],ne={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ie={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},de={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm flex items-center gap-2"},ue={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},ce={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between"},pe={class:"text-sm text-gray-500"},me={key:0,class:"p-6 space-y-3"},ye={key:1,class:"overflow-x-auto"},ve={class:"w-full text-sm"},be={class:"bg-blue-600 text-white"},ge={class:"divide-y divide-gray-100"},ke={key:1},fe=["colspan"],xe={key:2,class:"px-6 py-4 border-t border-gray-100 flex items-center justify-center gap-1"},he=["onClick"],Pe={__name:"Export",setup(w){const r=I(),n=U();function p(u){return r.activeFilterFields.includes(u)}function m(){r.results=[],r.error=null}async function y(){await r.generateReport()}function v(){r.resetFilters()}const _=z(()=>Math.ceil(r.pagination.total/r.pagination.perPage)),f=z(()=>{const u=_.value,e=r.pagination.page;if(u<=7)return Array.from({length:u},(x,l)=>l+1);const d=[];e>3&&(d.push(1),e>4&&d.push("..."));for(let x=Math.max(1,e-2);x<=Math.min(u,e+2);x++)d.push(x);return e<u-3&&d.push("..."),e<u-2&&d.push(u),d});return A(async()=>{await n.initialize(),r.fetchOptions()}),(u,e)=>{const d=T("v-autocomplete"),x=T("DateRangePicker");return a(),B(E,null,{default:Z(()=>[o("div",$,[e[28]||(e[28]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6 tracking-wide uppercase"}," Reports ",-1)),o("div",H,[o("div",q,[o("div",null,[e[11]||(e[11]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},[R(" Report Type "),o("span",{class:"text-red-500"},"*")],-1)),k(d,{modelValue:t(r).selectedReportType,"onUpdate:modelValue":[e[0]||(e[0]=l=>t(r).selectedReportType=l),m],items:t(r).reportTypes,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select report type...",class:"w-full"},null,8,["modelValue","items"])]),t(r).selectedReportType?(a(),s(h,{key:0},[p("merchant")?(a(),s("div",Q,[e[12]||(e[12]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Merchant",-1)),k(d,{modelValue:t(n).orderFilterVendor,"onUpdate:modelValue":e[1]||(e[1]=l=>t(n).orderFilterVendor=l),items:t(n).vendorOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select merchant...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("product")?(a(),s("div",G,[e[13]||(e[13]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Product",-1)),k(d,{modelValue:t(n).orderFilterProduct,"onUpdate:modelValue":e[2]||(e[2]=l=>t(n).orderFilterProduct=l),items:t(n).productOptions,"item-title":"product_name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select product...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("category")?(a(),s("div",J,[e[14]||(e[14]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Category",-1)),k(d,{modelValue:t(n).orderFilterCategory,"onUpdate:modelValue":e[3]||(e[3]=l=>t(n).orderFilterCategory=l),items:t(n).categoryOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select category...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("zone")?(a(),s("div",K,[e[15]||(e[15]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Zone",-1)),k(d,{modelValue:t(n).orderFilterZone,"onUpdate:modelValue":e[4]||(e[4]=l=>t(n).orderFilterZone=l),items:t(n).zoneOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select zone...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("city")?(a(),s("div",W,[e[16]||(e[16]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"City",-1)),k(d,{modelValue:t(n).orderFilterCity,"onUpdate:modelValue":e[5]||(e[5]=l=>t(n).orderFilterCity=l),items:t(n).cityOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select city...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("rider")?(a(),s("div",X,[e[17]||(e[17]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Person",-1)),k(d,{modelValue:t(n).orderFilterRider,"onUpdate:modelValue":e[6]||(e[6]=l=>t(n).orderFilterRider=l),items:t(n).riderOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select rider...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("confirmationStatus")?(a(),s("div",Y,[e[18]||(e[18]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Confirmation Status",-1)),k(d,{modelValue:t(n).orderFilterStatus,"onUpdate:modelValue":e[7]||(e[7]=l=>t(n).orderFilterStatus=l),items:t(n).statusOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select status...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),p("orderDate")?(a(),s("div",ee,[e[19]||(e[19]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Order Date",-1)),k(x,{modelValue:t(r).filters.orderDate,"onUpdate:modelValue":e[8]||(e[8]=l=>t(r).filters.orderDate=l)},null,8,["modelValue"])])):c("",!0),p("deliveryDate")?(a(),s("div",te,[e[20]||(e[20]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Date",-1)),k(x,{modelValue:t(r).filters.deliveryDate,"onUpdate:modelValue":e[9]||(e[9]=l=>t(r).filters.deliveryDate=l)},null,8,["modelValue"])])):c("",!0)],64)):c("",!0)]),o("div",re,[o("button",{onClick:y,disabled:!t(r).selectedReportType||t(r).loading.generate,class:"inline-flex items-center gap-2 px-6 py-2 bg-red-600 text-white text-sm font-semibold rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(r).loading.generate?(a(),s("span",oe)):(a(),s("svg",ae,e[21]||(e[21]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))),e[22]||(e[22]=R(" Generate Report "))],8,le),o("button",{onClick:e[10]||(e[10]=(...l)=>t(r).downloadExcel&&t(r).downloadExcel(...l)),disabled:!t(r).results.length||t(r).loading.download,class:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white text-sm font-semibold rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(r).loading.download?(a(),s("span",ne)):(a(),s("svg",ie,e[23]||(e[23]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)]))),e[24]||(e[24]=R(" Download Excel "))],8,se),o("button",{onClick:v,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors"},e[25]||(e[25]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),R(" Reset ")]))]),t(r).error?(a(),s("div",de,[e[26]||(e[26]=o("svg",{class:"w-4 h-4 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),R(" "+S(t(r).error),1)])):c("",!0)]),t(r).selectedReportType?(a(),s("div",ue,[o("div",ce,[e[27]||(e[27]=o("h2",{class:"text-lg font-semibold text-gray-800"}," Report Results ",-1)),o("span",pe,[t(r).pagination.total>0?(a(),s(h,{key:0},[R(" Showing "+S((t(r).pagination.page-1)*t(r).pagination.perPage+1)+"–"+S(Math.min(t(r).pagination.page*t(r).pagination.perPage,t(r).pagination.total))+" of "+S(t(r).pagination.total)+" records ",1)],64)):t(r).loading.generate?c("",!0):(a(),s(h,{key:1},[R(" No results yet ")],64))])]),t(r).loading.generate?(a(),s("div",me,[(a(),s(h,null,D(8,l=>o("div",{key:l,class:"h-8 bg-gray-100 rounded animate-pulse"})),64))])):t(r).activeColumns.length?(a(),s("div",ye,[o("table",ve,[o("thead",null,[o("tr",be,[(a(!0),s(h,null,D(t(r).activeColumns,l=>(a(),s("th",{key:l.key,class:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider whitespace-nowrap"},S(l.label),1))),128))])]),o("tbody",ge,[t(r).results.length?(a(!0),s(h,{key:0},D(t(r).results,(l,C)=>(a(),s("tr",{key:C,class:"hover:bg-gray-50 transition-colors"},[(a(!0),s(h,null,D(t(r).activeColumns,F=>(a(),s("td",{key:F.key,class:"px-4 py-3 text-gray-700 whitespace-nowrap"},S(l[F.key]??"—"),1))),128))]))),128)):(a(),s("tr",ke,[o("td",{colspan:t(r).activeColumns.length,class:"px-4 py-10 text-center text-gray-400"}," No items found. Adjust filters and generate the report. ",8,fe)]))])])])):c("",!0),_.value>1?(a(),s("div",xe,[(a(!0),s(h,null,D(f.value,l=>(a(),s("button",{key:l,onClick:C=>l!=="..."&&t(r).changePage(l),class:L(["w-8 h-8 rounded flex items-center justify-center text-sm font-medium transition-colors",l===t(r).pagination.page?"bg-blue-600 text-white":l==="..."?"text-gray-400 cursor-default":"text-gray-600 hover:bg-gray-100"])},S(l),11,he))),128))])):c("",!0)])):c("",!0)])]),_:1})}}};export{Pe as default};
