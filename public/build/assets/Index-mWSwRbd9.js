import{_ as ke}from"./AppLayout-DfWnhRmF.js";import{r as v,j as z,k as we,l as r,c as p,o as c,w as o,a as e,b as n,e as ne,u as E,f as i,d as y,F as oe,g as ae,t as s,W as se}from"./app-nkozdOV_.js";import{u as Ve}from"./orderStore-BJrhtNI_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CXeea0g_.js";import"./africastalking-8mnCQvzc.js";import"./IncomingCallDialog-FBzf5KVi.js";/* empty css                                                                           */import"./toast-DY9z4fBv.js";const Ce={class:"pa-4"},xe={key:1,class:"text-center py-8"},$e={__name:"Index",props:{invoices:{type:Array,default:()=>[]}},setup(O){const d=Ve(),g=v(!1),b=v(!1),x=v(!1),N=v(!1),$=v(""),P=v("success"),u=v({from:"",to:""}),F=v(100),m=v([]),L=z(()=>u.value.from&&u.value.to&&d.vendor),T=z(()=>d.vendorOptions.find(a=>a.id===d.vendor)),U=z(()=>m.value.length*F.value),re=async()=>{if(!L.value){k("Please select date range and vendor","error");return}g.value=!0,b.value=!0;try{const t=await(await fetch(`/api/v1/orders/vendor/${d.vendor}?from=${u.value.from}&to=${u.value.to}`)).json();if(t.success)m.value=t.data.data||[];else throw new Error(t.message||"Failed to fetch orders")}catch(a){console.error("Error fetching orders:",a),k("Error loading orders","error"),m.value=[]}finally{b.value=!1}},S=()=>{g.value=!1,m.value=[]},ue=async()=>{x.value=!0;try{await se.post("/vendor-invoices",{vendor_id:d.vendor,from:u.value.from,to:u.value.to,rate:F.value,orders:m.value.map(a=>a.id),total_commission:U.value},{onSuccess:()=>{k("Invoice generated successfully","success"),S(),u.value={from:"",to:""},d.vendor=null},onError:a=>{k("Error generating invoice","error"),console.error(a)}})}finally{x.value=!1}},de=a=>{se.visit(`/vendor-invoices/${a.id}`)},ie=a=>{window.open(`/vendor-invoices/${a.id}/download`,"_blank")},k=(a,t="success")=>{$.value=a,P.value=t,N.value=!0},A=a=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(a),I=a=>a?new Date(a).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}):"N/A",ce=a=>({pending:"warning",paid:"success",cancelled:"error",processing:"info"})[a==null?void 0:a.toLowerCase()]||"default";return we(async()=>{d.initialized?await d.fetchDropdownOptions():await d.initialize()}),(a,t)=>{const j=r("v-text-field"),_=r("v-col"),me=r("v-autocomplete"),f=r("v-btn"),B=r("v-row"),G=r("v-card-title"),ve=r("v-chip"),K=r("v-table"),h=r("v-card-text"),D=r("v-card"),R=r("v-alert"),_e=r("v-progress-circular"),fe=r("v-divider"),pe=r("v-spacer"),ye=r("v-card-actions"),ge=r("v-dialog"),be=r("v-snackbar");return c(),p(ke,null,{default:o(()=>[e("div",Ce,[t[8]||(t[8]=e("h2",{class:"text-h4 mb-6"},"Vendor Payments",-1)),n(B,null,{default:o(()=>[n(_,{cols:"12",md:"4"},{default:o(()=>[n(j,{modelValue:u.value.from,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value.from=l),label:"Date From",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",md:"4"},{default:o(()=>[n(j,{modelValue:u.value.to,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value.to=l),label:"Date To",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",md:"4"},{default:o(()=>[n(me,{modelValue:E(d).vendor,"onUpdate:modelValue":t[2]||(t[2]=l=>E(d).vendor=l),items:E(d).vendorOptions,"item-title":"name","item-value":"id",clearable:"",label:"Search sellers...",variant:"outlined",density:"comfortable",class:"w-full"},null,8,["modelValue","items"])]),_:1}),n(_,{cols:"12"},{default:o(()=>[n(f,{color:"primary",onClick:re,disabled:!L.value,size:"large"},{default:o(()=>t[5]||(t[5]=[i(" Generate Invoice ")])),_:1,__:[5]},8,["disabled"])]),_:1})]),_:1}),O.invoices.length>0?(c(),p(D,{key:0,class:"mt-6"},{default:o(()=>[n(G,null,{default:o(()=>t[6]||(t[6]=[i("Recent Invoices")])),_:1,__:[6]}),n(h,null,{default:o(()=>[n(K,null,{default:o(()=>[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"Invoice No"),e("th",null,"Vendor"),e("th",null,"Period"),e("th",null,"Orders"),e("th",null,"Commission"),e("th",null,"Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(c(!0),y(oe,null,ae(O.invoices,l=>(c(),y("tr",{key:l.id},[e("td",null,s(l.invoice_no),1),e("td",null,s(l.vendor_name),1),e("td",null,s(l.period),1),e("td",null,s(l.order_count),1),e("td",null,s(A(l.total_commission)),1),e("td",null,[n(ve,{color:ce(l.status),size:"small"},{default:o(()=>[i(s(l.status),1)]),_:2},1032,["color"])]),e("td",null,[n(f,{icon:"mdi-eye",size:"small",variant:"text",onClick:w=>de(l)},null,8,["onClick"]),n(f,{icon:"mdi-download",size:"small",variant:"text",onClick:w=>ie(l)},null,8,["onClick"])])]))),128))])]),_:1,__:[7]})]),_:1})]),_:1})):ne("",!0)]),n(ge,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=l=>g.value=l),"max-width":"1000",persistent:""},{default:o(()=>[n(D,null,{default:o(()=>[n(G,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[9]||(t[9]=e("span",null,"Generate Vendor Invoice",-1)),n(f,{icon:"mdi-close",variant:"text",onClick:S})]),_:1,__:[9]}),n(h,null,{default:o(()=>[T.value?(c(),p(R,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:o(()=>[t[10]||(t[10]=e("strong",null,"Vendor:",-1)),i(" "+s(T.value.name)+" ",1),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("strong",null,"Period:",-1)),i(" "+s(I(u.value.from))+" to "+s(I(u.value.to)),1)]),_:1,__:[10,11,12]})):ne("",!0),b.value?(c(),y("div",xe,[n(_e,{indeterminate:"",color:"primary",size:"64"}),t[13]||(t[13]=e("p",{class:"mt-4"},"Loading orders...",-1))])):m.value.length>0?(c(),p(K,{key:2,class:"mt-4"},{default:o(()=>[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"Order No"),e("th",null,"Customer"),e("th",null,"Phone"),e("th",null,"COD"),e("th",null,"Latest Status"),e("th",null,"Status Date"),e("th",null,"Quantity"),e("th",null,"Product"),e("th",null,"Address"),e("th",null,"City"),e("th",null,"Zone"),e("th",null,"Status Notes")])],-1)),e("tbody",null,[(c(!0),y(oe,null,ae(m.value,l=>{var w,W,q,M,Q,Z,H,J,X,Y,ee,te,le;return c(),y("tr",{key:l.id},[e("td",null,s(l.order_no),1),e("td",null,s(((w=l.customer)==null?void 0:w.full_name)||"N/A"),1),e("td",null,s(((W=l.customer)==null?void 0:W.phone)||"N/A"),1),e("td",null,s(A(l.cod_amount||l.total_price)),1),e("td",null,s(((M=(q=l.latest_status)==null?void 0:q.status)==null?void 0:M.name)||"N/A"),1),e("td",null,s(I((Q=l.latest_status)==null?void 0:Q.created_at)),1),e("td",null,s((l.order_items||[]).reduce((V,C)=>V+(Number(C.quantity)||0),0)),1),e("td",null,s((l.order_items||[]).map(V=>{var C;return((C=V.product)==null?void 0:C.product_name)||V.sku||"N/A"}).join(", ")),1),e("td",null,s(((Z=l.customer)==null?void 0:Z.address)||((H=l.shipping_address)==null?void 0:H.address)||"N/A"),1),e("td",null,s(((J=l.customer)==null?void 0:J.city)||((X=l.shipping_address)==null?void 0:X.city)||"N/A"),1),e("td",null,s(((Y=l.zone)==null?void 0:Y.name)||((te=(ee=l.customer)==null?void 0:ee.zone)==null?void 0:te.name)||"N/A"),1),e("td",null,s(((le=l.latest_status)==null?void 0:le.status_notes)||"N/A"),1)])}),128))])]),_:1,__:[14]})):(c(),p(R,{key:3,type:"warning",variant:"tonal",class:"mt-4"},{default:o(()=>t[15]||(t[15]=[i(" No orders found for the selected period and vendor. ")])),_:1,__:[15]})),n(fe,{class:"my-4"}),n(D,{variant:"tonal",color:"primary"},{default:o(()=>[n(h,null,{default:o(()=>[n(B,null,{default:o(()=>[n(_,{cols:"6"},{default:o(()=>[t[16]||(t[16]=e("strong",null,"Total Orders:",-1)),i(" "+s(m.value.length),1)]),_:1,__:[16]}),n(_,{cols:"6",class:"text-right"},{default:o(()=>[t[17]||(t[17]=e("strong",null,"Total Remmitance:",-1)),i(" "+s(A(U.value)),1)]),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1}),n(ye,null,{default:o(()=>[n(pe),n(f,{variant:"text",onClick:S},{default:o(()=>t[18]||(t[18]=[i("Cancel")])),_:1,__:[18]}),n(f,{color:"success",onClick:ue,disabled:m.value.length===0||b.value,loading:x.value},{default:o(()=>t[19]||(t[19]=[i(" Generate Invoice ")])),_:1,__:[19]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(be,{modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=l=>N.value=l),color:P.value,timeout:"3000"},{default:o(()=>[i(s($.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}};export{$e as default};
