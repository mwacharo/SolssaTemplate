import{E as I,r,i as O,j as C,Q as z,k as N,l,c as D,o as h,w as d,b as o,a as Q,e as q,u as a,f as T,t as G,R as V}from"./app-DpQa9nWQ.js";import{u as H}from"./whatsappStore-CzL0ggIG.js";import{u as J}from"./WhatsAppConversation.vue_vue_type_style_index_0_scoped_ad86ab47_lang-CRuEv0Nu.js";import"./africastalking-CNTy7erV.js";/* empty css                                                                           *//* empty css                                                                     */const K=I("sms",()=>{const b=r(!1),u=r([]),n=r(null),c=r(""),y=r([]),x=r(null),g=r(""),m=r({contacts:!1,templates:!1,sending:!1}),p=(e=null)=>{if(console.log("openDialog called with phoneNumber:",e),e){x.value=e;let S=y.value.find(s=>{var t;return s.phone_number===e||((t=s.client)==null?void 0:t.phone_number)===e});S||(S={id:e,name:e,phone_number:e}),u.value=[S]}else u.value=[];b.value=!0,g.value=""},v=()=>{b.value=!1,_()},_=()=>{u.value=[],n.value=null,c.value="",x.value=null,g.value=""};return{showNewMessageDialog:b,selectedContacts:u,selectedTemplate:n,messageText:c,validWhatsappContacts:y,selectedContactId:x,errorMessage:g,loading:m,openDialog:p,closeDialog:v,resetForm:_,onTemplateSelect:e=>{e&&(c.value=e.content)},sendSmsMessage:async()=>{m.value.sending=!0;try{const e=await O.post("/api/v1/sms/send",{contacts:u.value,message:c.value,template:n.value});return v(),e.data}catch(e){throw console.error("Send message error:",e),g.value="Failed to send message. Please try again.",e}finally{m.value.sending=!1}}}}),L={__name:"Sms",setup(b){const u=J();C(()=>{var s;return(s=u.user)==null?void 0:s.id});const n=K(),c=H(),y=C(()=>c.allTemplates),{validWhatsappContacts:x,selectedContacts:g,selectedTemplate:m,messageText:p,showNewMessageDialog:v,selectedContactId:_,errorMessage:w,loading:f}=z(n),e=async()=>{try{await n.sendSmsMessage(),console.log("Message sent successfully")}catch(s){console.error("Failed to send message:",s)}},S=()=>{n.closeDialog()};return N(async()=>{try{console.log("Fetching templates..."),await c.loadTemplates(),console.log("Templates fetched:",c.templates)}catch(s){console.error("Failed to fetch templates:",s)}}),(s,t)=>{const k=l("v-card-title"),F=l("v-alert"),U=l("v-text-field"),j=l("v-select"),R=l("v-textarea"),B=l("v-card-text"),P=l("v-spacer"),M=l("v-btn"),W=l("v-card-actions"),A=l("v-card"),E=l("v-dialog");return h(),D(E,{modelValue:a(v),"onUpdate:modelValue":t[3]||(t[3]=i=>V(v)?v.value=i:null),"max-width":"600"},{default:d(()=>[o(A,null,{default:d(()=>[o(k,null,{default:d(()=>t[4]||(t[4]=[Q("span",{class:"text-h6"},"Send SMS Message",-1)])),_:1,__:[4]}),o(B,null,{default:d(()=>[a(w)?(h(),D(F,{key:0,type:"error",class:"mb-3"},{default:d(()=>[T(G(a(w)),1)]),_:1})):q("",!0),o(U,{modelValue:a(_),"onUpdate:modelValue":t[0]||(t[0]=i=>V(_)?_.value=i:null),label:"Recipient Phone Number",type:"text",placeholder:"Enter phone number",disabled:a(f).contacts,class:"mb-3"},null,8,["modelValue","disabled"]),o(j,{modelValue:a(m),"onUpdate:modelValue":[t[1]||(t[1]=i=>V(m)?m.value=i:null),a(n).onTemplateSelect],items:y.value,"item-title":"name","item-value":"id",label:"Select Template","return-object":"",disabled:a(f).templates,loading:a(f).templates,class:"mt-3",clearable:""},null,8,["modelValue","items","disabled","loading","onUpdate:modelValue"]),o(R,{modelValue:a(p),"onUpdate:modelValue":t[2]||(t[2]=i=>V(p)?p.value=i:null),label:"Message",rows:"4","auto-grow":"",class:"mt-3",placeholder:"Type your message or select a template above"},null,8,["modelValue"])]),_:1}),o(W,null,{default:d(()=>[o(P),o(M,{color:"primary",loading:a(f).sending,onClick:e,disabled:!a(p).trim()},{default:d(()=>t[5]||(t[5]=[T(" Send ")])),_:1,__:[5]},8,["loading","disabled"]),o(M,{text:"",onClick:S},{default:d(()=>t[6]||(t[6]=[T("Cancel")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},ae=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{ae as S,L as _,K as u};
