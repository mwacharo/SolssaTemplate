import{_ as N}from"./AppLayout-TtLL2SqS.js";import{u as T}from"./orderStore-u2wTOlDZ.js";import{E,r as w,j as F,i as z,k as M,l as O,c as A,o as a,w as B,a as o,d as s,e as p,b as g,f as _,u as t,F as h,t as V,g as S,n as Z}from"./app-D54q1eq3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-BOVMfqF6.js";import"./africastalking-BAKA4Gad.js";import"./IncomingCallDialog-DFltmG4W.js";/* empty css                                                                           */import"./toast-0pCG2kEO.js";const L=E("orderReport",()=>{T();const P=[{id:"merchant",name:"Merchant Report"}],r={delivery:["zone","city","rider","deliveryDate","shippingStatus"],returns:["zone","city","rider","deliveryDate","shippingStatus"],dispatch:["merchant","zone","city","orderDate"],out_scan:["zone","city","rider","deliveryDate"],undispatched:["merchant","product","zone","city","orderDate"],merchant:["merchant","product","zone","city","confirmationStatus","shippingStatus","orderDate"],product:["merchant","product","category","zone","city","orderDate"],product_performance:["merchant","product","category","orderDate"],city:["city","zone","orderDate","shippingStatus"],zone:["zone","city","orderDate","shippingStatus"]},n={delivery:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"}],merchant:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"special_instructions",label:"Special Instructions"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"},{key:"agent",label:"Agent"}],default:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_phone",label:"Receiver Phone"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"city",label:"City"},{key:"zone",label:"Zone"}]},d=w(null),k=w({merchant:null,product:null,category:null,zone:null,city:null,rider:null,agent:null,confirmationStatus:null,shippingStatus:null,orderDate:null,deliveryDate:null}),m=w({merchants:[],products:[],categories:[],zones:[],cities:[],riders:[],agents:[],confirmationStatuses:[],shippingStatuses:[]}),R=w([]),y=w({page:1,perPage:25,total:0}),f=w({generate:!1,download:!1,options:!1}),c=w(null),e=F(()=>d.value?r[d.value]??[]:[]),u=F(()=>d.value?n[d.value]??n.default:[]);function x(){d.value=null,Object.keys(k.value).forEach(i=>k.value[i]=null),R.value=[],c.value=null,y.value={page:1,perPage:25,total:0}}function l(){const i={report_type:d.value,page:y.value.page,per_page:y.value.perPage,merchant:orderFilterVendor.value,product:orderFilterProduct.value,category:orderFilterCategory.value,zone:orderFilterZone.value,city:orderFilterCity.value,rider:orderFilterRider.value,confirmationStatus:k.value.confirmationStatus};return e.value.forEach(v=>{k.value[v]!==null&&k.value[v]!==""&&(i[v]=k.value[v])}),i}async function D(){f.value.options=!0;try{const{data:i}=await z.get("/api/v1/reports/options");m.value.merchants=i.merchants??[],m.value.products=i.products??[],m.value.categories=i.categories??[],m.value.zones=i.zones??[],m.value.cities=i.cities??[],m.value.riders=i.riders??[],m.value.agents=i.agents??[]}catch(i){console.error("Failed to load report options",i)}finally{f.value.options=!1}}async function C(){var i,v;if(d.value){c.value=null,f.value.generate=!0,y.value.page=1;try{const{data:b}=await z.get("/api/v1/reports/generate",{params:l()});R.value=b.data??[],y.value.total=b.total??0}catch(b){c.value=((v=(i=b.response)==null?void 0:i.data)==null?void 0:v.message)??"Failed to generate report.",R.value=[]}finally{f.value.generate=!1}}}async function U(i){y.value.page=i,await C()}async function j(){if(d.value){f.value.download=!0;try{const i=await z.get("/api/v1/reports/download",{params:{...l(),format:"xlsx"},responseType:"blob"}),v=URL.createObjectURL(new Blob([i.data])),b=document.createElement("a");b.href=v,b.setAttribute("download",`${d.value}_report_${Date.now()}.xlsx`),document.body.appendChild(b),b.click(),b.remove(),URL.revokeObjectURL(v)}catch{c.value="Failed to download Excel file."}finally{f.value.download=!1}}}return{reportTypes:P,selectedReportType:d,filters:k,options:m,results:R,pagination:y,loading:f,error:c,activeFilterFields:e,activeColumns:u,fetchOptions:D,generateReport:C,changePage:U,downloadExcel:j,resetFilters:x}}),I={class:"p-6 max-w-screen-2xl mx-auto"},$={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6"},H={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4"},q={key:0},Q={key:1},G={key:2},J={key:3},K={key:4},W={key:5},X={key:6},Y={key:7},ee={key:8},te={class:"flex flex-wrap justify-end gap-3 pt-2 border-t border-gray-100"},re=["disabled"],le={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},oe={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ae=["disabled"],se={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ne={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ie={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm flex items-center gap-2"},de={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},ue={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between"},ce={class:"text-sm text-gray-500"},pe={key:0,class:"p-6 space-y-3"},me={key:1,class:"overflow-x-auto"},ye={class:"w-full text-sm"},ve={class:"bg-blue-600 text-white"},be={class:"divide-y divide-gray-100"},ge={key:1},ke=["colspan"],fe={key:2,class:"px-6 py-4 border-t border-gray-100 flex items-center justify-center gap-1"},xe=["onClick"],ze={__name:"Export",setup(P){const r=L(),n=T();function d(c){return r.activeFilterFields.includes(c)}function k(){r.results=[],r.error=null}async function m(){await r.generateReport()}function R(){r.resetFilters()}const y=F(()=>Math.ceil(r.pagination.total/r.pagination.perPage)),f=F(()=>{const c=y.value,e=r.pagination.page;if(c<=7)return Array.from({length:c},(x,l)=>l+1);const u=[];e>3&&(u.push(1),e>4&&u.push("..."));for(let x=Math.max(1,e-2);x<=Math.min(c,e+2);x++)u.push(x);return e<c-3&&u.push("..."),e<c-2&&u.push(c),u});return M(async()=>{await n.initialize(),r.fetchOptions()}),(c,e)=>{const u=O("v-autocomplete"),x=O("DateRangePicker");return a(),A(N,null,{default:B(()=>[o("div",I,[e[28]||(e[28]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6 tracking-wide uppercase"}," Reports ",-1)),o("div",$,[o("div",H,[o("div",null,[e[11]||(e[11]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},[_(" Report Type "),o("span",{class:"text-red-500"},"*")],-1)),g(u,{modelValue:t(r).selectedReportType,"onUpdate:modelValue":[e[0]||(e[0]=l=>t(r).selectedReportType=l),k],items:t(r).reportTypes,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select report type...",class:"w-full"},null,8,["modelValue","items"])]),t(r).selectedReportType?(a(),s(h,{key:0},[d("merchant")?(a(),s("div",q,[e[12]||(e[12]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Merchant",-1)),g(u,{modelValue:t(n).orderFilterVendor,"onUpdate:modelValue":e[1]||(e[1]=l=>t(n).orderFilterVendor=l),items:t(n).vendorOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select merchant...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("product")?(a(),s("div",Q,[e[13]||(e[13]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Product",-1)),g(u,{modelValue:t(n).orderFilterProduct,"onUpdate:modelValue":e[2]||(e[2]=l=>t(n).orderFilterProduct=l),items:t(n).productOptions,"item-title":"product_name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select product...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("category")?(a(),s("div",G,[e[14]||(e[14]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Category",-1)),g(u,{modelValue:t(n).orderFilterCategory,"onUpdate:modelValue":e[3]||(e[3]=l=>t(n).orderFilterCategory=l),items:t(n).categoryOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select category...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("zone")?(a(),s("div",J,[e[15]||(e[15]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Zone",-1)),g(u,{modelValue:t(n).orderFilterZone,"onUpdate:modelValue":e[4]||(e[4]=l=>t(n).orderFilterZone=l),items:t(n).zoneOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select zone...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("city")?(a(),s("div",K,[e[16]||(e[16]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"City",-1)),g(u,{modelValue:t(n).orderFilterCity,"onUpdate:modelValue":e[5]||(e[5]=l=>t(n).orderFilterCity=l),items:t(n).cityOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select city...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("rider")?(a(),s("div",W,[e[17]||(e[17]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Person",-1)),g(u,{modelValue:t(n).orderFilterRider,"onUpdate:modelValue":e[6]||(e[6]=l=>t(n).orderFilterRider=l),items:t(n).riderOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select rider...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("confirmationStatus")?(a(),s("div",X,[e[18]||(e[18]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Confirmation Status",-1)),g(u,{modelValue:t(n).orderFilterStatus,"onUpdate:modelValue":e[7]||(e[7]=l=>t(n).orderFilterStatus=l),items:t(n).statusOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select status...",class:"w-full"},null,8,["modelValue","items"])])):p("",!0),d("orderDate")?(a(),s("div",Y,[e[19]||(e[19]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Order Date",-1)),g(x,{modelValue:t(r).filters.orderDate,"onUpdate:modelValue":e[8]||(e[8]=l=>t(r).filters.orderDate=l)},null,8,["modelValue"])])):p("",!0),d("deliveryDate")?(a(),s("div",ee,[e[20]||(e[20]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Date",-1)),g(x,{modelValue:t(r).filters.deliveryDate,"onUpdate:modelValue":e[9]||(e[9]=l=>t(r).filters.deliveryDate=l)},null,8,["modelValue"])])):p("",!0)],64)):p("",!0)]),o("div",te,[o("button",{onClick:m,disabled:!t(r).selectedReportType||t(r).loading.generate,class:"inline-flex items-center gap-2 px-6 py-2 bg-red-600 text-white text-sm font-semibold rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(r).loading.generate?(a(),s("span",le)):(a(),s("svg",oe,e[21]||(e[21]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))),e[22]||(e[22]=_(" Generate Report "))],8,re),o("button",{onClick:e[10]||(e[10]=(...l)=>t(r).downloadExcel&&t(r).downloadExcel(...l)),disabled:!t(r).results.length||t(r).loading.download,class:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white text-sm font-semibold rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(r).loading.download?(a(),s("span",se)):(a(),s("svg",ne,e[23]||(e[23]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)]))),e[24]||(e[24]=_(" Download Excel "))],8,ae),o("button",{onClick:R,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors"},e[25]||(e[25]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),_(" Reset ")]))]),t(r).error?(a(),s("div",ie,[e[26]||(e[26]=o("svg",{class:"w-4 h-4 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),_(" "+V(t(r).error),1)])):p("",!0)]),t(r).selectedReportType?(a(),s("div",de,[o("div",ue,[e[27]||(e[27]=o("h2",{class:"text-lg font-semibold text-gray-800"}," Report Results ",-1)),o("span",ce,[t(r).pagination.total>0?(a(),s(h,{key:0},[_(" Showing "+V((t(r).pagination.page-1)*t(r).pagination.perPage+1)+"–"+V(Math.min(t(r).pagination.page*t(r).pagination.perPage,t(r).pagination.total))+" of "+V(t(r).pagination.total)+" records ",1)],64)):t(r).loading.generate?p("",!0):(a(),s(h,{key:1},[_(" No results yet ")],64))])]),t(r).loading.generate?(a(),s("div",pe,[(a(),s(h,null,S(8,l=>o("div",{key:l,class:"h-8 bg-gray-100 rounded animate-pulse"})),64))])):t(r).activeColumns.length?(a(),s("div",me,[o("table",ye,[o("thead",null,[o("tr",ve,[(a(!0),s(h,null,S(t(r).activeColumns,l=>(a(),s("th",{key:l.key,class:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider whitespace-nowrap"},V(l.label),1))),128))])]),o("tbody",be,[t(r).results.length?(a(!0),s(h,{key:0},S(t(r).results,(l,D)=>(a(),s("tr",{key:D,class:"hover:bg-gray-50 transition-colors"},[(a(!0),s(h,null,S(t(r).activeColumns,C=>(a(),s("td",{key:C.key,class:"px-4 py-3 text-gray-700 whitespace-nowrap"},V(l[C.key]??"—"),1))),128))]))),128)):(a(),s("tr",ge,[o("td",{colspan:t(r).activeColumns.length,class:"px-4 py-10 text-center text-gray-400"}," No items found. Adjust filters and generate the report. ",8,ke)]))])])])):p("",!0),y.value>1?(a(),s("div",fe,[(a(!0),s(h,null,S(f.value,l=>(a(),s("button",{key:l,onClick:D=>l!=="..."&&t(r).changePage(l),class:Z(["w-8 h-8 rounded flex items-center justify-center text-sm font-medium transition-colors",l===c.reportStore.pagination.page?"bg-blue-600 text-white":l==="..."?"text-gray-400 cursor-default":"text-gray-600 hover:bg-gray-100"])},V(l),11,xe))),128))])):p("",!0)])):p("",!0)])]),_:1})}}};export{ze as default};
