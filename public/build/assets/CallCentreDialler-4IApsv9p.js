import{E as dt,r as m,j as O,Q as mt,s as We,l as c,c as Z,o as D,w as l,b as t,a as d,f as r,t as g,u as I,d as A,e as X,F as Ae,g as He,p as Qe,q as Ke}from"./app-DaUcTzCd.js";import{u as ct}from"./orderStore-BrvZm4c7.js";import{u as pt}from"./callCenter-M3oUZVDt.js";import{u as vt}from"./whatsappStore-B7b7xI5c.js";import{u as _t}from"./webrtc-DSPN2aVZ.js";import{u as ft}from"./auth-BQlSJ7sq.js";import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const yt=dt("callCentreDialler",()=>{const C=m(null),ne=m(!1),se=m("call"),_=m({active:!1,calling:!1,muted:!1,onHold:!1,duration:0,startTime:null,recordCall:!0,autoLog:!0}),N=m([]),H=m(null),f=m({type:"whatsapp",selectedTemplate:null,sending:!1,content:"",subject:"",attachments:[]}),Y=m([{id:1,name:"Order Confirmation",description:"Confirm order details",content:"Dear {customer_name}, your order #{order_no} has been confirmed and will be delivered on {delivery_date}.",type:"all"},{id:2,name:"Delivery Update",description:"Update on delivery status",content:"Hi {customer_name}, your order #{order_no} is out for delivery and will arrive on {delivery_date}.",type:"all"},{id:3,name:"Payment Reminder",description:"Remind about pending payment",content:"Hello {customer_name}, please complete payment of KSH {total_price} for order #{order_no}. Thank you!",type:"all"},{id:4,name:"Order Cancellation",description:"Notify order cancellation",content:"Dear {customer_name}, we regret to inform you that order #{order_no} has been cancelled. Please contact us for more details.",type:"all"},{id:5,name:"Feedback Request",description:"Request customer feedback",content:"Hi {customer_name}, thank you for your order #{order_no}. We would love to hear your feedback!",type:"all"}]),z=m({updating:!1,formData:{status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}),_e=m([{id:1,name:"Pending",color:"orange",description:"Order awaiting confirmation"},{id:2,name:"Confirmed",color:"green",description:"Order confirmed by customer"},{id:3,name:"Processing",color:"blue",description:"Order being prepared"},{id:4,name:"Shipped",color:"purple",description:"Order dispatched for delivery"},{id:5,name:"Delivered",color:"teal",description:"Order delivered to customer"},{id:6,name:"Follow Up",color:"amber",description:"Requires follow up"},{id:7,name:"Cancelled",color:"red",description:"Order cancelled"},{id:8,name:"On Hold",color:"grey",description:"Order temporarily on hold"}]),q=m([{id:1,name:"Standard",status_id:1,description:"Standard processing"},{id:2,name:"Expedited",status_id:2,description:"Fast-track processing"},{id:3,name:"Follow Up",status_id:6,description:"Requires callback",requiresRecall:!0},{id:4,name:"Customer Request",status_id:8,description:"Customer requested hold"},{id:5,name:"Payment Issue",status_id:6,description:"Payment verification needed",requiresRecall:!0}]),P=m([]),E=m({saving:!1,formData:{type:"General",content:"",pinned:!1}}),k=m([{value:"General",text:"General Note",color:"blue-grey"},{value:"Call Summary",text:"Call Summary",color:"blue"},{value:"Customer Request",text:"Customer Request",color:"purple"},{value:"Issue",text:"Issue/Problem",color:"red"},{value:"Follow Up",text:"Follow Up Required",color:"orange"},{value:"Payment",text:"Payment Related",color:"green"}]),M=m([]),F=m([]),R=m({order:!1,statuses:!1,notes:!1}),j=O(()=>C.value?C.value.customer||C.value.customer_address||C.value.shipping_address||{}:null),De=O(()=>z.value.formData.status_id?q.value.filter(n=>n.status_id===z.value.formData.status_id):[]),L=O(()=>{const n=q.value.find(u=>u.id===z.value.formData.status_category_id);return(n==null?void 0:n.requiresRecall)||!1}),fe=O(()=>{const n=_.value.duration,u=Math.floor(n/60),a=n%60;return`${String(u).padStart(2,"0")}:${String(a).padStart(2,"0")}`}),V=O(()=>M.value.filter(n=>n.pinned)),i=O(()=>M.value.filter(n=>!n.pinned)),J=(n,u=null)=>{console.log("Opening call dialog for phone number:",n),u&&(C.value=u),ne.value=!0};function re(){ne.value=!1,se.value="call",Fe(),_.value.active&&ue()}function ee(n){se.value=n}function W(){var n;if(!((n=j.value)!=null&&n.phone)){y("No phone number available","error");return}_.value.calling=!0,setTimeout(()=>{_.value.calling=!1,_.value.active=!0,_.value.startTime=Date.now(),te(),y("Call connected successfully","success")},2e3)}function te(){H.value=setInterval(()=>{_.value.active&&_.value.duration++},1e3)}function Q(){H.value&&(clearInterval(H.value),H.value=null)}function ie(){_.value.muted=!_.value.muted,y(_.value.muted?"Microphone muted":"Microphone unmuted","info")}function he(){_.value.onHold=!_.value.onHold,y(_.value.onHold?"Call on hold":"Call resumed","info")}function ue(){var u,a,e;const n=_.value.duration;N.value.unshift({id:Date.now(),order_id:(u=C.value)==null?void 0:u.id,customer_name:(a=j.value)==null?void 0:a.full_name,phone:(e=j.value)==null?void 0:e.phone,type:"outgoing",duration:fe.value,timestamp:new Date().toISOString(),recorded:_.value.recordCall,notes:_.value.autoLog?"Auto-logged call":null}),_.value.active=!1,_.value.calling=!1,_.value.muted=!1,_.value.onHold=!1,_.value.duration=0,_.value.startTime=null,Q(),y("Call ended","info"),_.value.autoLog&&de(n)}async function de(n){const u={id:Date.now(),type:"Call Summary",content:`Called customer. Duration: ${ze(n)}. ${_.value.recordCall?"Call was recorded.":""}`,pinned:!1,created_at:new Date().toISOString(),user_name:"Current User",auto_generated:!0};M.value.unshift(u)}function ke(n){f.value.type=n,f.value.attachments=[]}function G(n){const u=Y.value.find(a=>a.id===n);u&&(f.value.content=ae(u.content),f.value.type==="email"&&(f.value.subject=u.name),f.value.selectedTemplate=n)}function ae(n){return!C.value||!j.value?n:n.replace(/{customer_name}/g,j.value.full_name||"Customer").replace(/{order_no}/g,C.value.order_no||"N/A").replace(/{delivery_date}/g,we(C.value.delivery_date)||"N/A").replace(/{total_price}/g,C.value.total_price||"0.00")}function ge(n){f.value.content+=n}function K(n){f.value.attachments.push(n)}function me(n){f.value.attachments.splice(n,1)}async function Te(){var n;if(!f.value.content.trim())return y("Please enter a message","error"),!1;f.value.sending=!0;try{await new Promise(a=>setTimeout(a,1500));const u={id:Date.now(),order_id:(n=C.value)==null?void 0:n.id,type:f.value.type,content:f.value.content,subject:f.value.subject,sent_at:new Date().toISOString(),status:"sent"};return y(`${f.value.type.toUpperCase()} sent successfully`,"success"),be(),!0}catch{return y("Failed to send message","error"),!1}finally{f.value.sending=!1}}async function Ue(){var u;const n=z.value.formData;if(!n.status_id||!n.status_notes)return y("Please fill in all required fields","error"),!1;if(L.value&&!n.recall_date)return y("Recall date is required for this status","error"),!1;z.value.updating=!0;try{await new Promise(s=>setTimeout(s,1500));const a=_e.value.find(s=>s.id===n.status_id),e={id:Date.now(),order_id:(u=C.value)==null?void 0:u.id,status_id:n.status_id,status_name:a.name,status_category_id:n.status_category_id,notes:n.status_notes,recall_date:n.recall_date,created_at:new Date().toISOString(),user:"Current User",color:a.color};return P.value.unshift(e),C.value&&(C.value.status=a.name,C.value.latest_status=e),y("Status updated successfully","success"),n.notifyCustomer&&await Oe(n.notificationMethod,e),Se(),!0}catch{return y("Failed to update status","error"),!1}finally{z.value.updating=!1}}async function Oe(n,u){console.log(`Sending ${n} notification for status update:`,u)}async function ye(){var u;const n=E.value.formData;if(!n.content.trim())return y("Please enter note content","error"),!1;E.value.saving=!0;try{await new Promise(e=>setTimeout(e,1e3));const a={id:Date.now(),order_id:(u=C.value)==null?void 0:u.id,type:n.type,content:n.content,pinned:n.pinned,created_at:new Date().toISOString(),user_name:"Current User"};return M.value.unshift(a),y("Note saved successfully","success"),Ce(),!0}catch{return y("Failed to save note","error"),!1}finally{E.value.saving=!1}}async function le(n){const u=M.value.findIndex(a=>a.id===n);u!==-1&&(M.value.splice(u,1),y("Note deleted","success"))}async function Pe(n){const u=M.value.find(a=>a.id===n);u&&(u.pinned=!u.pinned,y(u.pinned?"Note pinned":"Note unpinned","success"))}async function x(n){R.value.order=!0;try{await Ie(n),await Ne(n),await Me(n)}catch(u){console.error("Error loading order data:",u),y("Failed to load order data","error")}finally{R.value.order=!1}}async function Ie(n){R.value.statuses=!0;try{await new Promise(u=>setTimeout(u,500)),P.value=[{id:1,status_name:"Order Placed",notes:"Customer placed order online",created_at:new Date(Date.now()-864e5).toISOString(),user:"System",color:"blue"},{id:2,status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:new Date(Date.now()-828e5).toISOString(),user:"John Doe",color:"green"}]}finally{R.value.statuses=!1}}async function Ne(n){R.value.notes=!0;try{await new Promise(u=>setTimeout(u,500)),M.value=[{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:new Date(Date.now()-36e5).toISOString(),user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:new Date(Date.now()-18e5).toISOString(),user_name:"Jane Smith"}]}finally{R.value.notes=!1}}async function Me(n){await new Promise(u=>setTimeout(u,500)),N.value=[{id:1,type:"outgoing",duration:"5:23",timestamp:new Date(Date.now()-72e5).toISOString()},{id:2,type:"incoming",duration:"3:45",timestamp:new Date(Date.now()-864e5).toISOString()}]}function Fe(){be(),Se(),Ce()}function be(){f.value.content="",f.value.subject="",f.value.attachments=[],f.value.selectedTemplate=null}function Se(){z.value.formData={status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}function Ce(){E.value.formData={type:"General",content:"",pinned:!1}}function y(n,u="info"){const a={id:Date.now(),message:n,type:u,timestamp:new Date().toISOString()};F.value.push(a),setTimeout(()=>{const e=F.value.findIndex(s=>s.id===a.id);e!==-1&&F.value.splice(e,1)},5e3)}function we(n){return n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function xe(n){return n?new Date(n).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function ze(n){const u=Math.floor(n/60),a=n%60;return`${u}m ${a}s`}return{activeOrder:C,dialogOpen:ne,activeTab:se,callState:_,callHistory:N,messageState:f,messageTemplates:Y,statusState:z,statusOptions:_e,statusCategories:q,statusHistory:P,notesState:E,noteTypes:k,notes:M,notifications:F,loading:R,customer:j,filteredStatusCategories:De,shouldShowRecallDate:L,formattedCallDuration:fe,pinnedNotes:V,unpinnedNotes:i,openDialog:J,closeDialog:re,setActiveTab:ee,initiateCall:W,toggleMute:ie,holdCall:he,endCall:ue,setMessageType:ke,loadTemplate:G,insertVariable:ge,addAttachment:K,removeAttachment:me,sendMessage:Te,updateOrderStatus:Ue,saveNote:ye,deleteNote:le,toggleNotePin:Pe,loadOrderData:x,addNotification:y,formatDate:we,formatDateTime:xe,replaceVariables:ae}}),bt={class:"d-flex align-center w-100"},St={class:"flex-grow-1"},Ct={class:"text-caption text-grey-lighten-1"},wt={class:"pa-4"},xt={class:"info-row"},Vt={class:"info-row"},Dt={key:0,class:"info-row"},ht={class:"text-truncate"},kt={class:"mb-6"},Tt={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},Ut={class:"mt-4"},Ot={key:0,class:"text-center"},Pt={key:1,class:"call-controls text-center"},It={class:"call-status mb-4"},Nt={class:"text-caption text-grey"},Mt={class:"d-flex justify-center gap-3"},Ft={class:"text-caption grey--text ml-2"},zt={class:"text-caption grey--text"},qt={class:"text-caption"},Rt={class:"text-caption"},$t={class:"text-body-2"},At={key:0,class:"text-caption"},Ht={class:"text-subtitle-1 font-weight-medium mb-3"},jt={class:"text-body-2 font-weight-medium"},Lt={class:"text-caption text-grey"},Gt={class:"text-caption text-grey"},Bt={key:0},Et={__name:"CallCentreDialler",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","status-updated","note-added"],setup(C,{emit:ne}){var u;const se=ft(),_=O(()=>{var a;return(a=se.user)==null?void 0:a.id}),N=C,H=_t(),f=ne,Y={required:a=>!!a||"This field is required",phone:a=>a?/^[\d\s\-\+\(\)]+$/.test(a)||"Invalid phone number format":!0},z=O({get:()=>N.modelValue,set:a=>f("update:modelValue",a)}),_e=O(()=>P.statusOptions),q=yt(),P=ct(),E=pt(),k=vt();k.onTemplateSelect;const M=a=>{i.value.order_items.splice(a,1),F()};P.statusOptions.find(a=>a.id===i.value.status_id);const F=()=>{const a=ae();i.value.total_price=a,i.value.sub_total=a},R=()=>{i.value.order_items||(i.value.order_items=[]),i.value.order_items.push({product_id:null,product:{},sku:"",quantity:1,unit_price:0,editable:!0}),F()},j=O({get:()=>N.modelValue,set:a=>f("update:modelValue",a)}),De=a=>{f("update:modelValue",a),a||q.closeDialog()},L=m("call"),fe=m(null),V=mt(N,"order"),i=m({id:null,customer:{id:null,full_name:"",phone:"",phone_number:"",email:"",city_id:null,zone_id:null,address:""},order_items:[],shipping_charges:0,total_price:0,sub_total:0,order_no:"",status_id:"",status_category_id:null,status_notes:"",recall_date:"",delivery_date:""}),J=m(!1),re=m(!1),ee=m("00:00"),W=m(!1),te=m({phone:"",recordCall:!0,autoLog:!0}),Q=m("whatsapp");m(null);const ie=m(!1),he=m(""),ue=O({get:()=>k.messageText||q.messageText,set:a=>{k.messageText=a,q.messageText=a}}),de=m(!1);m(!1);const ke=m({type:"General",content:"",pinned:!1}),G=m({show:!1,message:"",color:"success"}),ae=()=>!i.value.order_items||i.value.order_items.length===0?"0.00":i.value.order_items.reduce((e,s)=>e+Number(s.quantity||0)*Number(s.unit_price||0),0).toFixed(2),ge=m([]),K=m((u=V.value)!=null&&u.call_logs?[...V.value.call_logs]:[]);We(V,a=>{K.value=a!=null&&a.call_logs?[...a.call_logs]:[]},{immediate:!0});const me=m([]);m([]);const Te=O(()=>i.value.status_id?ge.value.filter(a=>a.status_id===i.value.status_id):[]),Ue=O(()=>{const a=ge.value.find(e=>e.id===i.value.status_category_id);return(a==null?void 0:a.name)==="Follow Up"});We(()=>N.order,a=>{var e,s,h,B;a&&(i.value={...a,customer:{...a.customer},order_items:((e=a.order_items)==null?void 0:e.map(p=>({...p,product:{...p.product}})))||[],shipping_charges:a.shipping_charges||0,total_price:a.total_price||0,sub_total:a.sub_total||0},te.value.phone=((s=a.customer)==null?void 0:s.phone)||((h=a.customer)==null?void 0:h.phone_number)||"",((B=a.order_statuses)==null?void 0:B.length)>0&&(me.value=a.order_statuses.map(p=>{var b,T,w;return{status_name:((b=p.status)==null?void 0:b.name)||"Unknown",notes:p.status_notes||"No notes",created_at:p.created_at,user:((T=p.user)==null?void 0:T.name)||"System",color:ye((w=p.status)==null?void 0:w.name)}})))},{immediate:!0});const Oe=(a,e)=>{const s=P.productOptions.find(h=>h.id===e);s&&(a.product={...s},a.product_id=e,a.sku=s.sku,(!a.unit_price||a.unit_price===0)&&(a.unit_price=s.price||0),F())},ye=a=>({Pending:"orange",Confirmed:"green",Processing:"blue",Shipped:"purple",Delivered:"teal",Cancelled:"red","Follow Up":"amber"})[a]||"grey",le=a=>a?new Date(a).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Pe=async a=>{try{await navigator.clipboard.writeText(a),x("Phone number copied to clipboard","success")}catch{x("Failed to copy","error")}},x=(a,e="success")=>{G.value={show:!0,message:a,color:e}},Ie=a=>{re.value=!0,E.callClient(a),console.log("Initiating call to:",a),setTimeout(()=>{re.value=!1,J.value=!0,Ne(),x("Call connected","success")},2e3)},Ne=()=>{let a=0;const e=setInterval(()=>{if(!J.value){clearInterval(e);return}a++;const s=Math.floor(a/60),h=a%60;ee.value=`${String(s).padStart(2,"0")}:${String(h).padStart(2,"0")}`},1e3)},Me=()=>{W.value=!W.value,x(W.value?"Microphone muted":"Microphone unmuted","info")},Fe=()=>{x("Call on hold","info")},be=()=>{J.value=!1,H.afClient.hangup(),ee.value="00:00",x("Call ended","info"),K.value.unshift({id:Date.now(),type:"outgoing",duration:ee.value,timestamp:"Just now"})},Se=async()=>{var a,e,s,h,B,p;ie.value=!0;try{const b=xe.value||{},T=V.value||{},w={id:b.id||((a=T.customer)==null?void 0:a.id)||null,name:b.full_name||((e=T.customer)==null?void 0:e.full_name)||"Unknown",phone:b.phone||b.phone_number||((s=T.customer)==null?void 0:s.phone_number)||"",orderId:T.id||null,orderData:T,orderOid:T.order_no||"N/A"};console.log("ðŸ“¤ Sending message with context:",w);const oe=((h=k.selectedTemplate)==null?void 0:h.id)||null,U=await k.sendSingleMessage(_.value,w,q.messageText,oe);if(U&&U.success)x(`${Q.value.toUpperCase()} sent successfully`,"success"),q.messageText="",k.selectedTemplate=null;else{console.warn("Send message returned unexpected result:",U);const $=U&&(U.message||U.error)||"Failed to send message";x($,"error")}}catch(b){console.error("âŒ Send message error:",b),x(((p=(B=b==null?void 0:b.response)==null?void 0:B.data)==null?void 0:p.message)||(b==null?void 0:b.message)||"Failed to send message","error")}finally{ie.value=!1}},Ce=async()=>{de.value=!0,setTimeout(()=>{de.value=!1,x("Status updated successfully","success");const a=_e.value.find(e=>e.id===i.value.status_id);me.value.unshift({status_name:a.name,notes:i.value.status_notes,created_at:new Date().toISOString(),user:"Current User",color:a.color}),f("status-updated",i.value),i.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"}},1500)},y=()=>{x("Opening order history...","info")},we=()=>{x("Opening customer orders...","info")},xe=O(()=>{var a,e,s,h;return((a=i.value)==null?void 0:a.customer)||((e=N.order)==null?void 0:e.customer)||((s=N.order)==null?void 0:s.customer_address)||((h=N.order)==null?void 0:h.shipping_address)||{}}),ze=async()=>{try{const a=i.value.id,{id:e,...s}=i.value;await P.updateOrder(a,s),x("Order updated and marked as complete","success"),n()}catch(a){console.error("Failed to update order:",a),x("Failed to update order","error")}},n=()=>{z.value=!1,L.value="call",J.value=!1,he.value={subject:"",content:"",attachments:[]},i.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"},ke.value={type:"General",content:"",pinned:!1}};return(a,e)=>{const s=c("v-icon"),h=c("v-avatar"),B=c("v-chip"),p=c("v-btn"),b=c("v-card-title"),T=c("v-divider"),w=c("v-text-field"),oe=c("v-autocomplete"),U=c("v-card-text"),$=c("v-card"),Ze=c("v-table"),ce=c("v-col"),je=c("v-row"),qe=c("v-tab"),Xe=c("v-tabs"),Re=c("v-list-item-title"),Le=c("v-list-item-subtitle"),Ge=c("v-list-item-content"),Ve=c("v-list-item"),Ye=c("v-list"),$e=c("v-window-item"),et=c("v-btn-toggle"),Be=c("v-textarea"),tt=c("v-alert"),Ee=c("v-select"),at=c("v-form"),lt=c("v-timeline-item"),ot=c("v-timeline"),nt=c("v-window"),st=c("v-spacer"),rt=c("v-card-actions"),it=c("v-snackbar"),ut=c("v-dialog");return D(),Z(ut,{"model-value":j.value,"onUpdate:modelValue":De,"max-width":"1200px",persistent:"",scrollable:""},{default:l(()=>[t($,{class:"call-center-dialog"},{default:l(()=>[t(b,{class:"dialog-header pa-4"},{default:l(()=>{var o,S,v;return[d("div",bt,[t(h,{color:"primary",size:"48",class:"mr-3"},{default:l(()=>[t(s,{color:"white",size:"28"},{default:l(()=>e[27]||(e[27]=[r("mdi-headset")])),_:1,__:[27]})]),_:1}),d("div",St,[e[28]||(e[28]=d("div",{class:"text-h5 font-weight-bold"},"CallCenter",-1)),d("div",Ct," Order #"+g(((o=V.value)==null?void 0:o.order_no)||"N/A")+" - "+g(((S=xe.value)==null?void 0:S.full_name)||"Unknown Customer"),1)]),t(B,{color:ye((v=V.value)==null?void 0:v.status),variant:"flat",class:"mr-2"},{default:l(()=>{var pe,ve,Je;return[r(g(((Je=(ve=(pe=V.value)==null?void 0:pe.latest_status)==null?void 0:ve.status)==null?void 0:Je.name)||"Pending"),1)]}),_:1},8,["color"]),t(B,{color:I(H).connectionStatusColor,small:"",class:"white--text px-2"},{default:l(()=>[t(s,{left:"",small:""},{default:l(()=>e[29]||(e[29]=[r("mdi-circle")])),_:1,__:[29]}),r(" "+g(I(H).connectionStatusText),1)]),_:1},8,["color"]),t(p,{icon:"",variant:"text",onClick:n},{default:l(()=>[t(s,null,{default:l(()=>e[30]||(e[30]=[r("mdi-close")])),_:1,__:[30]})]),_:1})])]}),_:1}),t(T),t(U,{class:"pa-0",style:{height:"70vh"}},{default:l(()=>[t(je,{"no-gutters":"",style:{height:"100%"}},{default:l(()=>[t(ce,{cols:"12",md:"6",class:"left-panel"},{default:l(()=>[d("div",wt,[t($,{variant:"outlined",class:"mb-4"},{default:l(()=>[t(b,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[t(s,{size:"small",class:"mr-2"},{default:l(()=>e[31]||(e[31]=[r("mdi-account")])),_:1,__:[31]}),e[32]||(e[32]=r(" Customer Information "))]),_:1,__:[32]}),t(U,{class:"pa-3"},{default:l(()=>{var o,S;return[d("div",xt,[t(w,{"prepend-inner-icon":"mdi-account",modelValue:i.value.customer.full_name,"onUpdate:modelValue":e[0]||(e[0]=v=>i.value.customer.full_name=v),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[Y.required],placeholder:"N/A"},null,8,["modelValue","rules"])]),d("div",Vt,[t(w,{"prepend-inner-icon":"mdi-phone",modelValue:i.value.customer.phone,"onUpdate:modelValue":e[1]||(e[1]=v=>i.value.customer.phone=v),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[Y.phone],placeholder:"N/A"},null,8,["modelValue","rules"]),t(p,{icon:"",size:"x-small",variant:"text",onClick:e[2]||(e[2]=v=>Pe(i.value.customer.phone)),class:"ml-1"},{default:l(()=>[t(s,{size:"14"},{default:l(()=>e[33]||(e[33]=[r("mdi-content-copy")])),_:1,__:[33]})]),_:1})]),(o=i.value)!=null&&o.customer.email?(D(),A("div",Dt,[t(s,{size:"20",class:"mr-2"},{default:l(()=>e[34]||(e[34]=[r("mdi-email")])),_:1,__:[34]}),d("span",ht,g((S=i.value)==null?void 0:S.customer.email),1)])):X("",!0),t(oe,{modelValue:i.value.customer.city_id,"onUpdate:modelValue":e[3]||(e[3]=v=>i.value.customer.city_id=v),items:I(P).cityOptions,"item-title":"name","item-value":"id",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[Y.required],clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items","rules"]),t(oe,{modelValue:i.value.customer.zone_id,"onUpdate:modelValue":e[4]||(e[4]=v=>i.value.customer.zone_id=v),items:I(P).zoneOptions,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items"]),t(w,{modelValue:i.value.customer.address,"onUpdate:modelValue":e[5]||(e[5]=v=>i.value.customer.address=v),label:"Address","prepend-inner-icon":"mdi-map-marker",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"]),t(w,{modelValue:i.value.customer_notes,"onUpdate:modelValue":e[6]||(e[6]=v=>i.value.customer_notes=v),label:"Customer Notes","prepend-inner-icon":"mdi-note-text",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"])]}),_:1})]),_:1}),d("div",kt,[d("h3",Tt,[t(s,{class:"mr-1",size:"small"},{default:l(()=>e[35]||(e[35]=[r("mdi-package-variant")])),_:1,__:[35]}),e[36]||(e[36]=r(" Order Items "))]),t(Ze,{density:"comfortable",class:"mb-2"},{default:l(()=>[e[37]||(e[37]=d("thead",null,[d("tr",null,[d("th",{style:{width:"30%"}},"Product"),d("th",{style:{width:"15%"}},"Quantity"),d("th",{style:{width:"30%"}}," Unit Price "),d("th",{style:{width:"15%"}},"Total"),d("th",{style:{width:"10%"}})])],-1)),d("tbody",null,[(D(!0),A(Ae,null,He(i.value.order_items||[],(o,S)=>(D(),A("tr",{key:o.id||S},[d("td",null,[t(oe,{modelValue:o.product_id,"onUpdate:modelValue":[v=>o.product_id=v,v=>Oe(o,v)],items:I(P).productOptions,"item-title":"product_name","item-value":"id",placeholder:"Product name",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),d("td",null,[t(w,{modelValue:o.quantity,"onUpdate:modelValue":[v=>o.quantity=v,e[7]||(e[7]=v=>F())],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,[t(w,{modelValue:o.unit_price,"onUpdate:modelValue":[v=>o.unit_price=v,e[8]||(e[8]=v=>F())],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,g((o.quantity*o.unit_price).toFixed(2)),1),d("td",null,[t(p,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:v=>M(S)},null,8,["onClick"])])]))),128))])]),_:1,__:[37]}),t(p,{color:"primary",variant:"text","prepend-icon":"mdi-plus",onClick:R,class:"mt-2"},{default:l(()=>e[38]||(e[38]=[r(" Add Item ")])),_:1,__:[38]})]),d("div",Ut,[t(je,null,{default:l(()=>[t(ce,{cols:"12",md:"4"},{default:l(()=>[t(w,{"model-value":ae(),"onUpdate:modelValue":e[9]||(e[9]=o=>V.value.total_price=o),label:"Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1}),t(ce,{cols:"12",md:"4"},{default:l(()=>[t(w,{modelValue:V.value.shipping_charges,"onUpdate:modelValue":[e[10]||(e[10]=o=>V.value.shipping_charges=o),e[11]||(e[11]=o=>F())],label:"Shipping Charges",type:"number",min:"0",step:"0.01",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(ce,{cols:"12",md:"4"},{default:l(()=>[t(w,{"model-value":(parseFloat(ae())+parseFloat(V.value.shipping_charges||0)).toFixed(2),label:"Grand Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),t($,{variant:"outlined"},{default:l(()=>[t(b,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[t(s,{size:"small",class:"mr-2"},{default:l(()=>e[39]||(e[39]=[r("mdi-lightning-bolt")])),_:1,__:[39]}),e[40]||(e[40]=r(" Quick Actions "))]),_:1,__:[40]}),t(U,{class:"pa-2"},{default:l(()=>[t(p,{block:"",variant:"outlined",color:"primary",size:"small",class:"mb-2",onClick:y},{default:l(()=>[t(s,{size:"18",class:"mr-2"},{default:l(()=>e[41]||(e[41]=[r("mdi-history")])),_:1,__:[41]}),e[42]||(e[42]=r(" Order History "))]),_:1,__:[42]}),t(p,{block:"",variant:"outlined",color:"orange",size:"small",onClick:we},{default:l(()=>[t(s,{size:"18",class:"mr-2"},{default:l(()=>e[43]||(e[43]=[r("mdi-cart")])),_:1,__:[43]}),e[44]||(e[44]=r(" Customer Orders "))]),_:1,__:[44]})]),_:1})]),_:1})])]),_:1}),t(T,{vertical:""}),t(ce,{cols:"12",md:"6",class:"right-panel"},{default:l(()=>[t(Xe,{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=o=>L.value=o),"bg-color":"blue-grey-lighten-5",height:"48"},{default:l(()=>[t(qe,{value:"call"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[45]||(e[45]=[r("mdi-phone")])),_:1,__:[45]}),e[46]||(e[46]=r(" Call "))]),_:1,__:[46]}),t(qe,{value:"message"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[47]||(e[47]=[r("mdi-message")])),_:1,__:[47]}),e[48]||(e[48]=r(" Message "))]),_:1,__:[48]}),t(qe,{value:"status"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[49]||(e[49]=[r("mdi-update")])),_:1,__:[49]}),e[50]||(e[50]=r(" Update Status "))]),_:1,__:[50]})]),_:1},8,["modelValue"]),t(nt,{modelValue:L.value,"onUpdate:modelValue":e[24]||(e[24]=o=>L.value=o),class:"tab-content"},{default:l(()=>[t($e,{value:"call",class:"pa-4"},{default:l(()=>[t($,{variant:"outlined",class:"mb-4"},{default:l(()=>[t(U,null,{default:l(()=>[e[57]||(e[57]=d("div",{class:"text-h6 mb-4"}," Make a Call ",-1)),t(w,{modelValue:te.value.phone,"onUpdate:modelValue":e[13]||(e[13]=o=>te.value.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",readonly:"",class:"mb-3"},null,8,["modelValue"]),J.value?(D(),A("div",Pt,[d("div",It,[t(h,{color:"green",size:"80",class:"pulse-animation"},{default:l(()=>[t(s,{size:"40",color:"white"},{default:l(()=>e[53]||(e[53]=[r("mdi-phone-in-talk")])),_:1,__:[53]})]),_:1}),e[54]||(e[54]=d("div",{class:"text-h6 mt-3"}," Call in Progress ",-1)),d("div",Nt,g(ee.value),1)]),d("div",Mt,[t(p,{icon:"",size:"large",color:W.value?"error":"grey",variant:"outlined",onClick:Me},{default:l(()=>[t(s,null,{default:l(()=>[r(g(W.value?"mdi-microphone-off":"mdi-microphone"),1)]),_:1})]),_:1},8,["color"]),t(p,{icon:"",size:"large",color:"grey",variant:"outlined",onClick:Fe},{default:l(()=>[t(s,null,{default:l(()=>e[55]||(e[55]=[r("mdi-pause")])),_:1,__:[55]})]),_:1}),t(p,{icon:"",size:"large",color:"red",variant:"flat",onClick:be},{default:l(()=>[t(s,null,{default:l(()=>e[56]||(e[56]=[r("mdi-phone-hangup")])),_:1,__:[56]})]),_:1})])])):(D(),A("div",Ot,[t(p,{color:"green",size:"x-large",rounded:"pill",elevation:"4",onClick:e[14]||(e[14]=o=>Ie(te.value.phone)),loading:re.value,class:"call-button"},{default:l(()=>[t(s,{size:"32",class:"mr-2"},{default:l(()=>e[51]||(e[51]=[r("mdi-phone")])),_:1,__:[51]}),e[52]||(e[52]=r(" Call Customer "))]),_:1,__:[52]},8,["loading"])]))]),_:1,__:[57]})]),_:1}),t($,{variant:"outlined"},{default:l(()=>[t(b,{class:"text-subtitle-1"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[58]||(e[58]=[r("mdi-history")])),_:1,__:[58]}),e[59]||(e[59]=r(" Recent Calls "))]),_:1,__:[59]}),t(U,null,{default:l(()=>[t(Ye,{density:"compact"},{default:l(()=>[(D(!0),A(Ae,null,He(K.value,(o,S)=>(D(),Z(Ve,{key:(o==null?void 0:o.id)||S,class:"mb-1"},{prepend:l(()=>[t(s,{color:o.direction==="Inbound"?"blue":"green"},{default:l(()=>[r(g(o.direction==="Inbound"?"mdi-phone-incoming":"mdi-phone-outgoing"),1)]),_:2},1032,["color"])]),append:l(()=>[o.recordingUrl?(D(),Z(p,{key:0,href:o.recordingUrl,target:"_blank",icon:"",size:"x-small",variant:"text",title:"Play recording"},{default:l(()=>[t(s,null,{default:l(()=>e[60]||(e[60]=[r("mdi-play-circle")])),_:1,__:[60]})]),_:2},1032,["href"])):X("",!0),t(p,{icon:"",size:"x-small",variant:"text",onClick:e[15]||(e[15]=v=>x("Open call details not implemented","info"))},{default:l(()=>[t(s,null,{default:l(()=>e[61]||(e[61]=[r("mdi-dots-vertical")])),_:1,__:[61]})]),_:1})]),default:l(()=>[t(Ge,null,{default:l(()=>[t(Re,{class:"d-flex justify-space-between align-center"},{default:l(()=>[d("div",null,[d("strong",null,g(o.customer_name||o.callerNumber||o.caller_number||"Unknown"),1),d("span",Ft," â†’ "+g(o.destinationNumber||o.destination_number||"-"),1)]),d("div",zt,g(o.status||o.callSessionState||""),1)]),_:2},1024),t(Le,{class:"d-flex justify-space-between"},{default:l(()=>[d("div",qt,g(o.callStartTime?le(o.callStartTime):o.created_at?le(o.created_at):o.timestamp||""),1),d("div",Rt,g(o.durationInSeconds!==void 0&&o.durationInSeconds!==null?`${Math.floor(o.durationInSeconds/60).toString().padStart(2,"0")}:${(o.durationInSeconds%60).toString().padStart(2,"0")}`:o.duration||"00:00"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),!K.value||K.value.length===0?(D(),Z(Ve,{key:0},{default:l(()=>[t(Ge,null,{default:l(()=>[t(Re,null,{default:l(()=>e[62]||(e[62]=[r("No recent calls")])),_:1,__:[62]})]),_:1})]),_:1})):X("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t($e,{value:"message",class:"pa-4"},{default:l(()=>[t($,{variant:"outlined"},{default:l(()=>[t(U,null,{item:l(({props:o,item:S})=>[t(Ve,Qe(Ke(o)),{prepend:l(()=>[t(s,null,{default:l(()=>e[67]||(e[67]=[r("mdi-file-document-outline")])),_:1,__:[67]})]),default:l(()=>[t(Re,null,{default:l(()=>[r(g(S.raw.name),1)]),_:2},1024),t(Le,null,{default:l(()=>[r(g(S.raw.description),1)]),_:2},1024)]),_:2},1040)]),default:l(()=>[e[69]||(e[69]=d("div",{class:"text-h6 mb-4"}," Send Message ",-1)),t(et,{modelValue:Q.value,"onUpdate:modelValue":e[16]||(e[16]=o=>Q.value=o),mandatory:"",divided:"",variant:"outlined",class:"mb-4"},{default:l(()=>[t(p,{value:"whatsapp"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[63]||(e[63]=[r("mdi-whatsapp")])),_:1,__:[63]}),e[64]||(e[64]=r(" WhatsApp "))]),_:1,__:[64]}),t(p,{value:"sms"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[65]||(e[65]=[r("mdi-message-text")])),_:1,__:[65]}),e[66]||(e[66]=r(" SMS "))]),_:1,__:[66]})]),_:1},8,["modelValue"]),t(oe,{modelValue:I(k).selectedTemplate,"onUpdate:modelValue":[e[17]||(e[17]=o=>I(k).selectedTemplate=o),I(k).onTemplateSelect],items:I(k).allTemplates,"item-title":"name","item-value":"id",label:"Select Template","return-object":"",disabled:I(k).loading.templates,loading:I(k).loading.templates,clearable:"",class:"mt-3","hide-no-data":"",dense:""},null,8,["modelValue","items","disabled","loading","onUpdate:modelValue"]),t(Be,{modelValue:ue.value,"onUpdate:modelValue":e[18]||(e[18]=o=>ue.value=o),label:"Message",variant:"outlined",rows:"8",counter:"",maxlength:Q.value==="sms"?160:1e3,class:"mb-3"},null,8,["modelValue","maxlength"]),t(p,{block:"",color:"primary",size:"large",loading:ie.value,onClick:Se},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[68]||(e[68]=[r("mdi-send")])),_:1,__:[68]}),r(" Send "+g(Q.value.toUpperCase()),1)]),_:1},8,["loading"])]),_:1,__:[69]})]),_:1})]),_:1}),t($e,{value:"status",class:"pa-4"},{default:l(()=>[t($,{variant:"outlined"},{default:l(()=>[t(U,null,{default:l(()=>[e[76]||(e[76]=d("div",{class:"text-h6 mb-4"}," Update Order Status ",-1)),t(at,{ref_key:"statusForm",ref:fe},{default:l(()=>[t(tt,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:l(()=>{var o,S,v,pe,ve;return[d("div",$t,[e[70]||(e[70]=d("strong",null,"Current Status:",-1)),r(" "+g(((v=(S=(o=V.value)==null?void 0:o.latest_status)==null?void 0:S.status)==null?void 0:v.name)||"Pending"),1)]),(ve=(pe=V.value)==null?void 0:pe.latest_status)!=null&&ve.created_at?(D(),A("div",At," Updated "+g(le(V.value.latest_status.created_at)),1)):X("",!0)]}),_:1}),t(Ee,{modelValue:i.value.status_id,"onUpdate:modelValue":e[19]||(e[19]=o=>i.value.status_id=o),items:I(P).statusOptions,"item-title":"name","item-value":"id",label:"New Status",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Status is required"],class:"mb-3"},{item:l(({props:o,item:S})=>[t(Ve,Qe(Ke(o)),{prepend:l(()=>[t(s,{color:S.raw.color},{default:l(()=>e[71]||(e[71]=[r("mdi-circle")])),_:2,__:[71]},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),i.value.status_id===2?(D(),Z(w,{key:0,modelValue:i.value.delivery_date,"onUpdate:modelValue":e[20]||(e[20]=o=>i.value.delivery_date=o),label:"Delivery Date",type:"date",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Delivery date is required"],class:"mb-3"},null,8,["modelValue","rules"])):X("",!0),t(Ee,{modelValue:i.value.status_category_id,"onUpdate:modelValue":e[21]||(e[21]=o=>i.value.status_category_id=o),items:Te.value,"item-title":"name","item-value":"id",label:"Status Category",variant:"outlined",density:"comfortable",disabled:!i.value.status_id,class:"mb-3"},null,8,["modelValue","items","disabled"]),Ue.value?(D(),Z(w,{key:1,modelValue:i.value.recall_date,"onUpdate:modelValue":e[22]||(e[22]=o=>i.value.recall_date=o),label:"Recall Date & Time",type:"datetime-local",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Recall date is required"],class:"mb-3"},null,8,["modelValue","rules"])):X("",!0),t(Be,{modelValue:i.value.status_notes,"onUpdate:modelValue":e[23]||(e[23]=o=>i.value.status_notes=o),label:"Status Notes",variant:"outlined",rows:"4",hint:"Add any relevant information about this status change",class:"mb-3"},null,8,["modelValue"]),t(p,{block:"",color:"primary",size:"large",loading:de.value,onClick:Ce},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[72]||(e[72]=[r("mdi-update")])),_:1,__:[72]}),e[73]||(e[73]=r(" Update Status "))]),_:1,__:[73]},8,["loading"])]),_:1},512),t(T,{class:"my-4"}),d("div",Ht,[t(s,{class:"mr-2"},{default:l(()=>e[74]||(e[74]=[r("mdi-timeline")])),_:1,__:[74]}),e[75]||(e[75]=r(" Status History "))]),t(ot,{density:"compact",side:"end",align:"start"},{default:l(()=>[(D(!0),A(Ae,null,He(me.value,(o,S)=>(D(),Z(lt,{key:S,"dot-color":o.color,size:"small"},{default:l(()=>[d("div",jt,g(o.status_name),1),d("div",Lt,g(o.notes),1),d("div",Gt,[r(g(le(o.created_at))+" ",1),o.user?(D(),A("span",Bt," by "+g(o.user),1)):X("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})]),_:1,__:[76]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(T),t(rt,{class:"pa-4"},{default:l(()=>[t(p,{variant:"outlined",onClick:n},{default:l(()=>e[77]||(e[77]=[r(" Close ")])),_:1,__:[77]}),t(st),t(p,{color:"success",variant:"flat","prepend-icon":"mdi-check-circle",onClick:ze},{default:l(()=>e[78]||(e[78]=[r(" Mark Complete & Close ")])),_:1,__:[78]})]),_:1})]),_:1}),t(it,{modelValue:G.value.show,"onUpdate:modelValue":e[26]||(e[26]=o=>G.value.show=o),color:G.value.color,timeout:3e3},{actions:l(()=>[t(p,{variant:"text",onClick:e[25]||(e[25]=o=>G.value.show=!1)},{default:l(()=>e[79]||(e[79]=[r(" Close ")])),_:1,__:[79]})]),default:l(()=>[r(g(G.value.message)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["model-value"])}}},Jt=gt(Et,[["__scopeId","data-v-6fb453ab"]]),ta=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"}));export{Jt as C,ta as a,yt as u};
