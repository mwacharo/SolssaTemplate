import{u as Ie}from"./webrtc-B4lFWpO_.js";/* empty css                                                                           */import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as v,j as le,s as J,z as oe,k as Pe,L as Ve,l as m,d as _,o as r,b as l,c as g,e as p,w as t,n as K,a,f as s,t as i,F as W,g as Q}from"./app-DqeynRYZ.js";import"./africastalking-CR5kXXbt.js";const Fe={key:0,class:"incoming-call-content"},Ue={class:"incoming-call-header"},Ae={class:"text-h4 font-weight-bold mb-2"},Re={class:"text-h6 text-grey-darken-1 mb-2"},Me={class:"call-status"},$e={key:1,class:"client-details-content"},je={class:"d-flex align-center"},Le={class:"flex-grow-1"},qe={class:"text-h6 font-weight-bold"},Be={class:"text-body-2 opacity-80"},Ee={class:"call-timer"},He={class:"d-flex align-center"},Je={class:"text-body-2"},Ke={class:"call-controls"},We={class:"client-info"},Qe={class:"info-group mb-4"},Ge={class:"info-item"},Xe={key:0,class:"info-item"},Ye={key:1,class:"info-item"},Ze={class:"info-group mb-4"},et={key:0,class:"info-item"},tt={key:1,class:"info-item"},lt={class:"quick-actions mt-4"},ot={class:"d-flex flex-wrap gap-2"},at={key:0,class:"text-center py-8"},st={key:1,class:"text-center py-8"},nt={key:2,class:"orders-list"},it={class:"d-flex align-center"},rt={class:"flex-grow-1"},dt={class:"text-subtitle-1 font-weight-bold"},ct={class:"text-body-2 text-grey-darken-1"},ut={class:"d-flex align-center mt-1"},mt={class:"text-caption"},vt={class:"text-right"},_t={class:"text-h6 font-weight-bold"},ft={key:0,class:"text-center py-8"},gt={key:1,class:"text-center py-8"},pt={key:2,class:"tickets-list"},yt={class:"d-flex align-center"},Ct={class:"flex-grow-1"},bt={class:"text-subtitle-1 font-weight-bold"},xt={class:"text-body-2 text-grey-darken-1"},ht={class:"d-flex align-center mt-1"},wt={class:"text-caption"},kt={class:"text-right"},zt={class:"notes-section"},Dt={class:"d-flex align-center mb-4"},St={key:0,class:"previous-notes"},Nt={class:"d-flex align-center mb-1"},Tt={class:"text-body-2 font-weight-medium"},It={class:"text-caption text-grey-darken-1"},Ot={class:"text-body-2"},Pt={__name:"IncomingCallDialog",props:{},emits:["call-accepted","call-declined","call-ended"],setup(Vt,{emit:ae}){const u=Ie(),G=v(!1),j=ae,P=v(!1),V=v(!1),F=v(!0),x=v(!1),h=v(!1),U=v(null),A=v("00:00"),D=v("details"),b=v(""),S=v(""),R=v(!1),N=v(!1),T=v(!1),w=v([]),k=v([]),I=v([]),se=["Resolved","Follow-up Required","Escalated","Information Provided","Complaint Logged","Payment Arranged","Delivery Scheduled","Other"],O=le({get:()=>u.incomingCallDialog,set:o=>u.incomingCallDialog=o}),y=le(()=>u.incomingCall),d=v({name:"John Doe",phone:"+1234567890",email:"john.doe@email.com",address:"123 Main St, City, State",avatar:null,type:"Premium Customer",status:"Active",customerSince:"2020-01-15",totalOrders:24});J(()=>u.incomingCallDialog,(o,e)=>{console.log("🔄 Store incomingCallDialog changed:",{from:e,to:o}),o&&oe(()=>{console.log("✅ Dialog should be visible now")})},{immediate:!0}),J(()=>u.incomingCall,(o,e)=>{console.log("🔄 Store incomingCall changed:",{from:e,to:o})},{deep:!0,immediate:!0});const ne=async()=>{V.value=!0;try{u.afClient&&await u.afClient.answer(),P.value=!0,U.value=new Date,F.value=!1,pe(),await ue(),j("call-accepted",{from:y.value.from,caller:d.value})}catch(o){console.error("Failed to accept call:",o)}finally{V.value=!1}},ie=async()=>{try{u.afClient&&await u.afClient.hangup(),O.value=!1,L(),j("call-declined",{from:y.value.from})}catch(o){console.error("Failed to decline call:",o)}},re=async()=>{try{u.afClient&&await u.afClient.hangup(),O.value=!1,L(),j("call-ended",{from:y.value.from,duration:A.value,notes:b.value,outcome:S.value})}catch(o){console.error("Failed to hangup call:",o)}},de=async()=>{try{u.afClient&&(x.value?await u.afClient.unmute():await u.afClient.mute(),x.value=!x.value)}catch(o){console.error("Failed to toggle mute:",o)}},ce=async()=>{try{u.afClient&&(h.value?await u.afClient.unhold():await u.afClient.hold(),h.value=!h.value)}catch(o){console.error("Failed to toggle hold:",o)}},ue=async()=>{const o=y.value.from;try{await me(o),await Promise.all([ve(o),_e(o),fe(o)])}catch(e){console.error("Failed to load client data:",e)}},me=async o=>{try{const e=await fetch(`/api/v1/customers/phone/${encodeURIComponent(o)}`);if(!e.ok){console.warn("Customer not found:",o),d.value={name:"Unknown Caller",phone:o};return}const z=await e.json();d.value=z}catch(e){console.error("Failed to load client info:",e),d.value.phone=o}},ve=async o=>{N.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),w.value=[{id:1,orderNumber:"ORD-2024-001",description:"Package delivery to downtown office",status:"In Transit",amount:"$149.99",date:"2024-01-15"},{id:2,orderNumber:"ORD-2024-002",description:"Express document courier",status:"Delivered",amount:"$89.50",date:"2024-01-10"}]}catch(e){console.error("Failed to load orders:",e)}finally{N.value=!1}},_e=async o=>{T.value=!0;try{await new Promise(e=>setTimeout(e,800)),k.value=[{id:1,ticketNumber:"TKT-2024-001",subject:"Delayed package delivery inquiry",status:"Open",priority:"High",createdAt:"2024-01-14"},{id:2,ticketNumber:"TKT-2024-002",subject:"Request for delivery time change",status:"Resolved",priority:"Medium",createdAt:"2024-01-08"}]}catch(e){console.error("Failed to load tickets:",e)}finally{T.value=!1}},fe=async o=>{try{I.value=[{id:1,agent:"Sarah Johnson",date:"2024-01-10",content:"Customer called regarding delayed package. Provided tracking information and expected delivery date.",outcome:"Information Provided"},{id:2,agent:"Mike Wilson",date:"2024-01-05",content:"Scheduled delivery for next business day. Customer confirmed availability.",outcome:"Delivery Scheduled"}]}catch(e){console.error("Failed to load previous notes:",e)}},ge=async()=>{if(b.value.trim()){R.value=!0;try{await new Promise(o=>setTimeout(o,500)),I.value.unshift({id:Date.now(),agent:"Current Agent",date:new Date().toISOString().split("T")[0],content:b.value,outcome:S.value}),b.value=""}catch(o){console.error("Failed to save notes:",o)}finally{R.value=!1}}},pe=()=>{const o=setInterval(()=>{if(!U.value||!P.value){clearInterval(o);return}const e=Math.floor((new Date-U.value)/1e3),z=Math.floor(e/60),c=e%60;A.value=`${z.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},1e3)},L=()=>{P.value=!1,V.value=!1,F.value=!0,x.value=!1,h.value=!1,U.value=null,A.value="00:00",D.value="details",b.value="",S.value="",w.value=[],k.value=[],I.value=[],N.value=!1,T.value=!1,R.value=!1},X=o=>o?o.replace(/(\+\d{1,3})(\d{3})(\d{3})(\d{4})/,"$1 ($2) $3-$4"):"Unknown",q=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ye=o=>({"Premium Customer":"gold","Regular Customer":"primary","New Customer":"success",VIP:"purple"})[o]||"primary",Ce=o=>({Active:"success",Inactive:"warning",Suspended:"error",Pending:"info"})[o]||"grey",be=o=>({Delivered:"success","In Transit":"info",Processing:"warning",Cancelled:"error",Pending:"grey"})[o]||"grey",xe=o=>({Open:"error","In Progress":"warning",Resolved:"success",Closed:"grey"})[o]||"grey",he=o=>({High:"error",Medium:"warning",Low:"success"})[o]||"grey";return J(O,o=>{console.log("🔍 IncomingCallDialog watcher triggered:",o),o?(F.value=!0,y.value&&y.value.from&&(d.value.phone=y.value.from)):L()}),Pe(()=>{console.log("🚀 Component mounted"),console.log("📊 Initial store state:"),console.log("  - incomingCallDialog:",u.incomingCallDialog),console.log("  - incomingCall:",u.incomingCall),console.log("  - afClient:",u.afClient?"initialized":"not initialized"),oe(()=>{u.incomingCallDialog&&console.log("🔄 Forcing dialog to show on mount")})}),Ve(()=>{console.log("🧹 Component unmounted")}),(o,e)=>{const z=m("v-img"),c=m("v-icon"),Y=m("v-avatar"),C=m("v-chip"),Z=m("v-card-title"),f=m("v-btn"),we=m("v-card-actions"),B=m("v-spacer"),M=m("v-tab"),ke=m("v-tabs"),ee=m("v-col"),ze=m("v-row"),$=m("v-window-item"),te=m("v-progress-circular"),E=m("v-card-text"),H=m("v-card"),De=m("v-textarea"),Se=m("v-select"),Ne=m("v-window"),Te=m("v-dialog");return r(),_("div",null,[l(Te,{modelValue:O.value,"onUpdate:modelValue":e[4]||(e[4]=n=>O.value=n),"max-width":"500",persistent:"",transition:"dialog-bottom-transition","no-click-animation":"","retain-focus":!1},{default:t(()=>[l(H,{class:K(["incoming-call-card",{ringing:F.value}])},{default:t(()=>[P.value?(r(),_("div",$e,[l(Z,{class:"gradient-header"},{default:t(()=>[a("div",je,[l(Y,{size:"40",class:"mr-3"},{default:t(()=>[d.value.avatar?(r(),g(z,{key:0,src:d.value.avatar},null,8,["src"])):(r(),g(c,{key:1,color:"white"},{default:t(()=>e[11]||(e[11]=[s("mdi-account")])),_:1,__:[11]}))]),_:1}),a("div",Le,[a("h3",qe,i(d.value.name||"Unknown Caller"),1),a("p",Be,i(X(y.value.from)),1)]),a("div",Ee,[a("div",He,[l(c,{class:"recording-pulse mr-1",size:"12",color:"error"},{default:t(()=>e[12]||(e[12]=[s("mdi-circle")])),_:1,__:[12]}),a("span",Je,i(A.value),1)])])]),l(B),a("div",Ke,[l(f,{icon:"",size:"small",color:"white",variant:"text",onClick:de,class:K({active:x.value})},{default:t(()=>[l(c,null,{default:t(()=>[s(i(x.value?"mdi-microphone-off":"mdi-microphone"),1)]),_:1})]),_:1},8,["class"]),l(f,{icon:"",size:"small",color:"white",variant:"text",onClick:ce,class:K({active:h.value})},{default:t(()=>[l(c,null,{default:t(()=>[s(i(h.value?"mdi-play":"mdi-pause"),1)]),_:1})]),_:1},8,["class"]),l(f,{icon:"",size:"small",color:"error",variant:"flat",onClick:re},{default:t(()=>[l(c,null,{default:t(()=>e[13]||(e[13]=[s("mdi-phone-hangup")])),_:1,__:[13]})]),_:1})])]),_:1}),l(E,{class:"pa-0"},{default:t(()=>[l(ke,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=n=>D.value=n),class:"client-tabs"},{default:t(()=>[l(M,{value:"details"},{default:t(()=>[l(c,{left:"",size:"20"},{default:t(()=>e[14]||(e[14]=[s("mdi-account-details")])),_:1,__:[14]}),e[15]||(e[15]=s(" Details "))]),_:1,__:[15]}),l(M,{value:"orders",disabled:N.value},{default:t(()=>[l(c,{left:"",size:"20"},{default:t(()=>e[16]||(e[16]=[s("mdi-package-variant")])),_:1,__:[16]}),e[17]||(e[17]=s(" Orders ")),w.value.length?(r(),g(C,{key:0,size:"x-small",class:"ml-2"},{default:t(()=>[s(i(w.value.length),1)]),_:1})):p("",!0)]),_:1,__:[17]},8,["disabled"]),l(M,{value:"tickets",disabled:T.value},{default:t(()=>[l(c,{left:"",size:"20"},{default:t(()=>e[18]||(e[18]=[s("mdi-ticket-outline")])),_:1,__:[18]}),e[19]||(e[19]=s(" Tickets ")),k.value.length?(r(),g(C,{key:0,size:"x-small",class:"ml-2"},{default:t(()=>[s(i(k.value.length),1)]),_:1})):p("",!0)]),_:1,__:[19]},8,["disabled"]),l(M,{value:"notes"},{default:t(()=>[l(c,{left:"",size:"20"},{default:t(()=>e[20]||(e[20]=[s("mdi-note-text")])),_:1,__:[20]}),e[21]||(e[21]=s(" Notes "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),l(Ne,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=n=>D.value=n),class:"client-content"},{default:t(()=>[l($,{value:"details",class:"pa-4"},{default:t(()=>[a("div",We,[l(ze,null,{default:t(()=>[l(ee,{cols:"12",md:"6"},{default:t(()=>[a("div",Qe,[e[25]||(e[25]=a("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"Contact Information",-1)),a("div",Ge,[l(c,{left:"",size:"16"},{default:t(()=>e[22]||(e[22]=[s("mdi-phone")])),_:1,__:[22]}),a("span",null,i(d.value.phone),1)]),d.value.email?(r(),_("div",Xe,[l(c,{left:"",size:"16"},{default:t(()=>e[23]||(e[23]=[s("mdi-email")])),_:1,__:[23]}),a("span",null,i(d.value.email),1)])):p("",!0),d.value.address?(r(),_("div",Ye,[l(c,{left:"",size:"16"},{default:t(()=>e[24]||(e[24]=[s("mdi-map-marker")])),_:1,__:[24]}),a("span",null,i(d.value.address),1)])):p("",!0)])]),_:1}),l(ee,{cols:"12",md:"6"},{default:t(()=>[a("div",Ze,[e[28]||(e[28]=a("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"Account Status",-1)),l(C,{color:Ce(d.value.status),size:"small",class:"mb-2"},{default:t(()=>[s(i(d.value.status),1)]),_:1},8,["color"]),d.value.customerSince?(r(),_("div",et,[l(c,{left:"",size:"16"},{default:t(()=>e[26]||(e[26]=[s("mdi-calendar")])),_:1,__:[26]}),a("span",null,"Customer since "+i(d.value.customerSince),1)])):p("",!0),d.value.totalOrders?(r(),_("div",tt,[l(c,{left:"",size:"16"},{default:t(()=>e[27]||(e[27]=[s("mdi-package-variant")])),_:1,__:[27]}),a("span",null,i(d.value.totalOrders)+" total orders",1)])):p("",!0)])]),_:1})]),_:1}),a("div",lt,[e[32]||(e[32]=a("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"Quick Actions",-1)),a("div",ot,[l(f,{size:"small",variant:"outlined","prepend-icon":"mdi-package-variant"},{default:t(()=>e[29]||(e[29]=[s(" New Order ")])),_:1,__:[29]}),l(f,{size:"small",variant:"outlined","prepend-icon":"mdi-ticket-plus"},{default:t(()=>e[30]||(e[30]=[s(" Create Ticket ")])),_:1,__:[30]}),l(f,{size:"small",variant:"outlined","prepend-icon":"mdi-calendar-plus"},{default:t(()=>e[31]||(e[31]=[s(" Schedule Callback ")])),_:1,__:[31]})])])])]),_:1}),l($,{value:"orders",class:"pa-4"},{default:t(()=>[N.value?(r(),_("div",at,[l(te,{indeterminate:"",color:"primary"}),e[33]||(e[33]=a("p",{class:"mt-2"},"Loading orders...",-1))])):w.value.length===0?(r(),_("div",st,[l(c,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[34]||(e[34]=[s("mdi-package-variant-closed")])),_:1,__:[34]}),e[35]||(e[35]=a("p",{class:"text-body-1 mt-2"},"No orders found",-1))])):(r(),_("div",nt,[(r(!0),_(W,null,Q(w.value,n=>(r(),g(H,{key:n.id,class:"order-card mb-3",variant:"outlined",hover:""},{default:t(()=>[l(E,{class:"pa-3"},{default:t(()=>[a("div",it,[a("div",rt,[a("h4",dt," Order #"+i(n.orderNumber),1),a("p",ct,i(n.description),1),a("div",ut,[l(C,{color:be(n.status),size:"x-small",class:"mr-2"},{default:t(()=>[s(i(n.status),1)]),_:2},1032,["color"]),a("span",mt,i(q(n.date)),1)])]),a("div",vt,[a("p",_t,i(n.amount),1),l(f,{size:"x-small",variant:"text",icon:""},{default:t(()=>[l(c,null,{default:t(()=>e[36]||(e[36]=[s("mdi-chevron-right")])),_:1,__:[36]})]),_:1})])])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),l($,{value:"tickets",class:"pa-4"},{default:t(()=>[T.value?(r(),_("div",ft,[l(te,{indeterminate:"",color:"primary"}),e[37]||(e[37]=a("p",{class:"mt-2"},"Loading tickets...",-1))])):k.value.length===0?(r(),_("div",gt,[l(c,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[38]||(e[38]=[s("mdi-ticket-outline")])),_:1,__:[38]}),e[39]||(e[39]=a("p",{class:"text-body-1 mt-2"},"No support tickets found",-1))])):(r(),_("div",pt,[(r(!0),_(W,null,Q(k.value,n=>(r(),g(H,{key:n.id,class:"ticket-card mb-3",variant:"outlined",hover:""},{default:t(()=>[l(E,{class:"pa-3"},{default:t(()=>[a("div",yt,[a("div",Ct,[a("h4",bt," Ticket #"+i(n.ticketNumber),1),a("p",xt,i(n.subject),1),a("div",ht,[l(C,{color:xe(n.status),size:"x-small",class:"mr-2"},{default:t(()=>[s(i(n.status),1)]),_:2},1032,["color"]),l(C,{color:he(n.priority),size:"x-small",class:"mr-2"},{default:t(()=>[s(i(n.priority),1)]),_:2},1032,["color"]),a("span",wt,i(q(n.createdAt)),1)])]),a("div",kt,[l(f,{size:"x-small",variant:"text",icon:""},{default:t(()=>[l(c,null,{default:t(()=>e[40]||(e[40]=[s("mdi-chevron-right")])),_:1,__:[40]})]),_:1})])])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),l($,{value:"notes",class:"pa-4"},{default:t(()=>[a("div",zt,[l(De,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=n=>b.value=n),label:"Call Notes",placeholder:"Add notes about this call...",rows:"4",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a("div",Dt,[l(f,{color:"primary",variant:"flat",onClick:ge,loading:R.value},{default:t(()=>e[41]||(e[41]=[s(" Save Notes ")])),_:1,__:[41]},8,["loading"]),l(B),l(Se,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=n=>S.value=n),items:se,label:"Call Outcome",variant:"outlined",density:"compact",style:{"max-width":"200px"}},null,8,["modelValue"])]),I.value.length?(r(),_("div",St,[e[42]||(e[42]=a("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"Previous Call Notes",-1)),(r(!0),_(W,null,Q(I.value,n=>(r(),_("div",{key:n.id,class:"note-item mb-2 pa-3"},[a("div",Nt,[a("span",Tt,i(n.agent),1),l(B),a("span",It,i(q(n.date)),1)]),a("p",Ot,i(n.content),1),n.outcome?(r(),g(C,{key:0,size:"x-small",class:"mt-1"},{default:t(()=>[s(i(n.outcome),1)]),_:2},1024)):p("",!0)]))),128))])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])):(r(),_("div",Fe,[l(Z,{class:"text-center pa-6"},{default:t(()=>[a("div",Ue,[l(Y,{size:"80",class:"call-avatar mb-4"},{default:t(()=>[d.value.avatar?(r(),g(z,{key:0,src:d.value.avatar},null,8,["src"])):(r(),g(c,{key:1,size:"40",color:"white"},{default:t(()=>e[6]||(e[6]=[s("mdi-account")])),_:1,__:[6]}))]),_:1}),a("h2",Ae,i(d.value.name||"Unknown Caller"),1),a("p",Re,i(X(y.value.from)),1),d.value.type?(r(),g(C,{key:0,color:ye(d.value.type),class:"mb-4"},{default:t(()=>[s(i(d.value.type),1)]),_:1},8,["color"])):p("",!0),a("div",Me,[l(c,{class:"ringing-icon mr-2",color:"success"},{default:t(()=>e[7]||(e[7]=[s("mdi-phone-ring")])),_:1,__:[7]}),e[8]||(e[8]=a("span",{class:"text-body-1"},"Incoming Call...",-1))])])]),_:1}),l(we,{class:"justify-center pa-6"},{default:t(()=>[l(f,{onClick:ie,color:"error",size:"x-large",class:"call-action-btn decline-btn mr-4",variant:"flat"},{default:t(()=>[l(c,{size:"30"},{default:t(()=>e[9]||(e[9]=[s("mdi-phone-hangup")])),_:1,__:[9]})]),_:1}),l(f,{onClick:ne,color:"success",size:"x-large",class:"call-action-btn accept-btn",variant:"flat",loading:V.value},{default:t(()=>[l(c,{size:"30"},{default:t(()=>e[10]||(e[10]=[s("mdi-phone")])),_:1,__:[10]})]),_:1},8,["loading"])]),_:1})]))]),_:1},8,["class"])]),_:1},8,["modelValue"]),G.value?p("",!0):(r(),g(f,{key:0,onClick:e[5]||(e[5]=n=>G.value=!0),color:"warning",size:"small",style:{position:"fixed",bottom:"20px",right:"20px","z-index":"9999"}},{default:t(()=>e[43]||(e[43]=[s(" Debug ")])),_:1,__:[43]}))])}}},$t=Oe(Pt,[["__scopeId","data-v-be6102c5"]]);export{$t as default};
