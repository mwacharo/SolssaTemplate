import{A as fe,r as s,j as g,i as l}from"./app-oghUaOhr.js";const Re=fe("orders",()=>{const i=s([]),u=s({orders:!1,options:!1,creating:!1,updating:!1,deleting:!1}),n=s(null),j=s([]),A=s(!1),y=s(null),C=s(null),P=s(!1),S=s(!1),h=s(null),_=s(null),w=s(null),O=s(null),F=s(null),m=s(null),R=s(null),z=s(null),f=s([]),D=s(""),T=s([]),q=s([]),I=s([]),k=s([]),B=s([]),L=s([]),M=s([]),U=s([]),te=s([]),V=s([]),Z=s([]),b=s([]),G=s([]),x=s({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),se=g(()=>e=>i.value.find(t=>t.id===e)),re=g(()=>i.value.filter(e=>e.status===1)),le=g(()=>i.value.filter(e=>e.status===0)),oe=g(()=>i.value.filter(e=>e.status===2)),ce=g(()=>i.value.reduce((e,t)=>e+parseFloat(t.total_price||0),0)),ne=g(()=>{let e=0;return h.value&&e++,_.value&&e++,w.value&&e++,O.value&&e++,F.value&&e++,m.value&&e++,R.value&&e++,z.value&&e++,f.value&&f.value.length>0&&e++,D.value&&e++,e}),de=g(()=>({status:h.value,product:_.value,zone:w.value,agent:O.value,rider:F.value,vendor:m.value,city:R.value,category:z.value,dateRange:f.value,search:D.value})),$=async(e={})=>{var t,o;u.value.orders=!0,n.value=null;try{const a=new URLSearchParams;e.page&&a.append("page",e.page),e.per_page&&a.append("per_page",e.per_page),e.status&&a.append("status",e.status),e.vendor_id&&a.append("vendor_id",e.vendor_id),e.city&&a.append("city",e.city),e.agent_id&&a.append("agent_id",e.agent_id),e.rider_id&&a.append("rider_id",e.rider_id),e.zone_id&&a.append("zone_id",e.zone_id),e.product_id&&a.append("product_id",e.product_id),e.category_id&&a.append("category_id",e.category_id),e.search&&a.append("search",e.search),e.created_from&&a.append("created_from",e.created_from),e.created_to&&a.append("created_to",e.created_to);const d=(await l.get(`/api/v1/orders?${a.toString()}`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!d.success)throw new Error(d.message||"Failed to fetch orders");S.value=!1;const c=d.data;return i.value=c.data||[],x.value={current_page:c.current_page||1,last_page:c.last_page||1,per_page:c.per_page||15,total:c.total||0,from:c.from||0,to:c.to||0},c}catch(a){throw n.value=((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||a.message||"Failed to fetch orders",v({type:"error",message:n.value}),a}finally{u.value.orders=!1}},H=async e=>{u.value.orders=!0,n.value=null;try{const t=await J(e);return C.value=t,y.value=e,t}catch(t){throw n.value=t.message||"Failed to load order",t}finally{u.value.orders=!1}},ue=async e=>{var t,o;u.value.creating=!0,n.value=null;try{const r=(await l.post("/api/v1/orders",e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!r.success)throw new Error(r.message||"Failed to create order");return i.value.unshift(r.data),x.value.total+=1,v({type:"success",message:"Order created successfully"}),r.data}catch(a){throw n.value=((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||a.message||"Failed to create order",v({type:"error",message:n.value}),a}finally{u.value.creating=!1}},N=async(e,t)=>{var o,a;u.value.updating=!0,n.value=null;try{const d=(await l.put(`/api/v1/orders/${e}`,t,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!d.success)throw new Error(d.message||"Failed to update order");const c=i.value.findIndex(E=>E.id===e);return c!==-1&&(i.value[c]=d.data),y.value===e&&(C.value=d.data),v({type:"success",message:"Order updated successfully"}),d.data}catch(r){throw n.value=((a=(o=r.response)==null?void 0:o.data)==null?void 0:a.message)||r.message||"Failed to update order",v({type:"error",message:n.value}),r}finally{u.value.updating=!1}},ie=async e=>{var t,o;u.value.deleting=!0,n.value=null;try{const r=(await l.delete(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!r.success)throw new Error(r.message||"Failed to delete order");const d=i.value.findIndex(c=>c.id===e);d!==-1&&(i.value.splice(d,1),x.value.total-=1),v({type:"success",message:"Order deleted successfully"})}catch(a){throw n.value=((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||a.message||"Failed to delete order",v({type:"error",message:n.value}),a}finally{u.value.deleting=!1}},J=async e=>{var t,o;try{const r=(await l.get(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!r.success)throw new Error(r.message||"Failed to fetch order details");return r.data}catch(a){const r=((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||a.message||"Failed to fetch order details";throw v({type:"error",message:r}),new Error(r)}},pe=async(e,t)=>N(e,{customer:t}),ve=async(e,t)=>N(e,{order_items:t}),K=async(e=null)=>{if(u.value.options){console.log("Options already loading, skipping...");return}u.value.options=!0;try{console.log("Fetching dropdown options...");const t=[l.get("/api/v1/statuses").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/categories").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/cities").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/zones").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/agents").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/riders").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/vendors").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/countries").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/warehouses").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/delivery-statuses").catch(p=>({data:{success:!1,data:[]}})),l.get("/api/v1/users").catch(p=>({data:{success:!1,data:[]}}))];e?t.push(l.get(`/api/v1/vendors/${e}/products`).catch(p=>({data:{success:!1,data:[]}}))):t.push(l.get("/api/v1/products").catch(p=>({data:{success:!1,data:[]}})));const[o,a,r,d,c,E,Q,W,X,Y,ee,ae]=await Promise.all(t);T.value=o.data.success?o.data.data:[],q.value=ae.data.success?ae.data.data:[],I.value=a.data.success?a.data.data:[],k.value=r.data.success?r.data.data:[],B.value=d.data.success?d.data.data:[],L.value=c.data.success?c.data.data:[],M.value=E.data.success?E.data.data:[],U.value=Q.data.success?Q.data.data:[],Z.value=W.data.success?W.data.data:[],V.value=X.data.success?X.data.data:[],b.value=Y.data.success?Y.data.data:[],G.value=ee.data.success?ee.data.data:[],console.log("Dropdown options loaded successfully")}catch(t){throw console.error("Failed to fetch dropdown options:",t),v({type:"error",message:"Failed to load dropdown options"}),t}finally{u.value.options=!1}},v=e=>{j.value.push({id:Date.now(),timestamp:new Date,...e})};return{orders:i,loading:u,error:n,notifications:j,dialog:A,selectedOrderId:y,selectedOrder:C,initialized:P,isCreateMode:S,orderFilterStatus:h,orderFilterProduct:_,orderFilterZone:w,orderFilterAgent:O,orderFilterRider:F,orderFilterVendor:m,orderFilterCity:R,orderFilterCategory:z,orderDateRange:f,orderSearch:D,orderStatusOptions:T,productOptions:q,categoryOptions:I,cityOptions:k,zoneOptions:B,agentOptions:L,riderOptions:M,vendorOptions:U,clientOptions:te,warehouseOptions:V,countryOptions:Z,deliveryStatusOptions:b,userOptions:G,pagination:x,getOrderById:se,confirmedOrders:re,pendingOrders:le,cancelledOrders:oe,totalRevenue:ce,activeFilterCount:ne,currentFilters:de,fetchOrders:$,loadOrder:H,createOrder:ue,updateOrder:N,updateOrderCustomer:pe,updateOrderItems:ve,deleteOrder:ie,getOrderDetails:J,fetchDropdownOptions:K,addNotification:v,removeNotification:e=>{j.value=j.value.filter(t=>t.id!==e)},openDialog:async e=>{y.value=e,S.value=!1,A.value=!0,e&&await H(e)},openCreateDialog:()=>{A.value=!0,y.value=null,C.value=null,S.value=!0},closeDialog:()=>{A.value=!1,y.value=null,C.value=null},clearAllFilters:()=>{h.value=null,_.value=null,w.value=null,O.value=null,F.value=null,m.value=null,R.value=null,z.value=null,f.value=[],D.value=""},applyFilters:async()=>{const e={};h.value&&(e.status=h.value),_.value&&(e.product_id=_.value),w.value&&(e.zone_id=w.value),O.value&&(e.agent_id=O.value),F.value&&(e.rider_id=F.value),m.value&&(e.vendor_id=m.value),R.value&&(e.city=R.value),z.value&&(e.category_id=z.value),D.value&&(e.search=D.value),f.value&&f.value.length===2&&(e.created_from=f.value[0],e.created_to=f.value[1]),e.page=1,await $(e)},initialize:async()=>{if(!P.value)try{await Promise.all([K(),$({page:1})]),P.value=!0}catch(e){console.error("Failed to initialize order store:",e)}}}});export{Re as u};
