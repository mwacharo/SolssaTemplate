import{E as ut,r as d,j as U,Q as dt,s as Je,l as m,c as K,o as D,w as l,b as a,a as u,f as r,t as f,u as P,d as $,e as Z,F as $e,g as Ae,p as We,q as Qe}from"./app-Huo47LD8.js";import{u as mt}from"./orderStore-DqYEyUCB.js";import{u as ct}from"./callCenter-EemZTSV1.js";import{u as pt}from"./whatsappStore-Dsl0te9g.js";import{u as vt}from"./webrtc-ylgtRHIt.js";import{u as _t}from"./auth-CjgXR-MS.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";const gt=ut("callCentreDialler",()=>{const C=d(null),oe=d(!1),ne=d("call"),v=d({active:!1,calling:!1,muted:!1,onHold:!1,duration:0,startTime:null,recordCall:!0,autoLog:!0}),I=d([]),A=d(null),_=d({type:"whatsapp",selectedTemplate:null,sending:!1,content:"",subject:"",attachments:[]}),X=d([{id:1,name:"Order Confirmation",description:"Confirm order details",content:"Dear {customer_name}, your order #{order_no} has been confirmed and will be delivered on {delivery_date}.",type:"all"},{id:2,name:"Delivery Update",description:"Update on delivery status",content:"Hi {customer_name}, your order #{order_no} is out for delivery and will arrive on {delivery_date}.",type:"all"},{id:3,name:"Payment Reminder",description:"Remind about pending payment",content:"Hello {customer_name}, please complete payment of KSH {total_price} for order #{order_no}. Thank you!",type:"all"},{id:4,name:"Order Cancellation",description:"Notify order cancellation",content:"Dear {customer_name}, we regret to inform you that order #{order_no} has been cancelled. Please contact us for more details.",type:"all"},{id:5,name:"Feedback Request",description:"Request customer feedback",content:"Hi {customer_name}, thank you for your order #{order_no}. We would love to hear your feedback!",type:"all"}]),z=d({updating:!1,formData:{status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}),fe=d([{id:1,name:"Pending",color:"orange",description:"Order awaiting confirmation"},{id:2,name:"Confirmed",color:"green",description:"Order confirmed by customer"},{id:3,name:"Processing",color:"blue",description:"Order being prepared"},{id:4,name:"Shipped",color:"purple",description:"Order dispatched for delivery"},{id:5,name:"Delivered",color:"teal",description:"Order delivered to customer"},{id:6,name:"Follow Up",color:"amber",description:"Requires follow up"},{id:7,name:"Cancelled",color:"red",description:"Order cancelled"},{id:8,name:"On Hold",color:"grey",description:"Order temporarily on hold"}]),F=d([{id:1,name:"Standard",status_id:1,description:"Standard processing"},{id:2,name:"Expedited",status_id:2,description:"Fast-track processing"},{id:3,name:"Follow Up",status_id:6,description:"Requires callback",requiresRecall:!0},{id:4,name:"Customer Request",status_id:8,description:"Customer requested hold"},{id:5,name:"Payment Issue",status_id:6,description:"Payment verification needed",requiresRecall:!0}]),O=d([]),E=d({saving:!1,formData:{type:"General",content:"",pinned:!1}}),h=d([{value:"General",text:"General Note",color:"blue-grey"},{value:"Call Summary",text:"Call Summary",color:"blue"},{value:"Customer Request",text:"Customer Request",color:"purple"},{value:"Issue",text:"Issue/Problem",color:"red"},{value:"Follow Up",text:"Follow Up Required",color:"orange"},{value:"Payment",text:"Payment Related",color:"green"}]),N=d([]),M=d([]),q=d({order:!1,statuses:!1,notes:!1}),H=U(()=>C.value?C.value.customer||C.value.customer_address||C.value.shipping_address||{}:null),xe=U(()=>z.value.formData.status_id?F.value.filter(n=>n.status_id===z.value.formData.status_id):[]),j=U(()=>{const n=F.value.find(t=>t.id===z.value.formData.status_category_id);return(n==null?void 0:n.requiresRecall)||!1}),V=U(()=>{const n=v.value.duration,t=Math.floor(n/60),e=n%60;return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}),i=U(()=>N.value.filter(n=>n.pinned)),B=U(()=>N.value.filter(n=>!n.pinned)),se=(n,t=null)=>{console.log("Opening call dialog for phone number:",n),t&&(C.value=t),oe.value=!0};function Y(){oe.value=!1,ne.value="call",Me(),v.value.active&&te()}function J(n){ne.value=n}function ee(){var n;if(!((n=H.value)!=null&&n.phone)){g("No phone number available","error");return}v.value.calling=!0,setTimeout(()=>{v.value.calling=!1,v.value.active=!0,v.value.startTime=Date.now(),W(),g("Call connected successfully","success")},2e3)}function W(){A.value=setInterval(()=>{v.value.active&&v.value.duration++},1e3)}function re(){A.value&&(clearInterval(A.value),A.value=null)}function Ve(){v.value.muted=!v.value.muted,g(v.value.muted?"Microphone muted":"Microphone unmuted","info")}function ge(){v.value.onHold=!v.value.onHold,g(v.value.onHold?"Call on hold":"Call resumed","info")}function te(){var t,e,s;const n=v.value.duration;I.value.unshift({id:Date.now(),order_id:(t=C.value)==null?void 0:t.id,customer_name:(e=H.value)==null?void 0:e.full_name,phone:(s=H.value)==null?void 0:s.phone,type:"outgoing",duration:V.value,timestamp:new Date().toISOString(),recorded:v.value.recordCall,notes:v.value.autoLog?"Auto-logged call":null}),v.value.active=!1,v.value.calling=!1,v.value.muted=!1,v.value.onHold=!1,v.value.duration=0,v.value.startTime=null,re(),g("Call ended","info"),v.value.autoLog&&De(n)}async function De(n){const t={id:Date.now(),type:"Call Summary",content:`Called customer. Duration: ${ce(n)}. ${v.value.recordCall?"Call was recorded.":""}`,pinned:!1,created_at:new Date().toISOString(),user_name:"Current User",auto_generated:!0};N.value.unshift(t)}function L(n){_.value.type=n,_.value.attachments=[]}function ie(n){const t=X.value.find(e=>e.id===n);t&&(_.value.content=ue(t.content),_.value.type==="email"&&(_.value.subject=t.name),_.value.selectedTemplate=n)}function ue(n){return!C.value||!H.value?n:n.replace(/{customer_name}/g,H.value.full_name||"Customer").replace(/{order_no}/g,C.value.order_no||"N/A").replace(/{delivery_date}/g,me(C.value.delivery_date)||"N/A").replace(/{total_price}/g,C.value.total_price||"0.00")}function Q(n){_.value.content+=n}function de(n){_.value.attachments.push(n)}function he(n){_.value.attachments.splice(n,1)}async function Te(){var n;if(!_.value.content.trim())return g("Please enter a message","error"),!1;_.value.sending=!0;try{await new Promise(e=>setTimeout(e,1500));const t={id:Date.now(),order_id:(n=C.value)==null?void 0:n.id,type:_.value.type,content:_.value.content,subject:_.value.subject,sent_at:new Date().toISOString(),status:"sent"};return g(`${_.value.type.toUpperCase()} sent successfully`,"success"),be(),!0}catch{return g("Failed to send message","error"),!1}finally{_.value.sending=!1}}async function ke(){var t;const n=z.value.formData;if(!n.status_id||!n.status_notes)return g("Please fill in all required fields","error"),!1;if(j.value&&!n.recall_date)return g("Recall date is required for this status","error"),!1;z.value.updating=!0;try{await new Promise(y=>setTimeout(y,1500));const e=fe.value.find(y=>y.id===n.status_id),s={id:Date.now(),order_id:(t=C.value)==null?void 0:t.id,status_id:n.status_id,status_name:e.name,status_category_id:n.status_category_id,notes:n.status_notes,recall_date:n.recall_date,created_at:new Date().toISOString(),user:"Current User",color:e.color};return O.value.unshift(s),C.value&&(C.value.status=e.name,C.value.latest_status=s),g("Status updated successfully","success"),n.notifyCustomer&&await ye(n.notificationMethod,s),Se(),!0}catch{return g("Failed to update status","error"),!1}finally{z.value.updating=!1}}async function ye(n,t){console.log(`Sending ${n} notification for status update:`,t)}async function ae(){var t;const n=E.value.formData;if(!n.content.trim())return g("Please enter note content","error"),!1;E.value.saving=!0;try{await new Promise(s=>setTimeout(s,1e3));const e={id:Date.now(),order_id:(t=C.value)==null?void 0:t.id,type:n.type,content:n.content,pinned:n.pinned,created_at:new Date().toISOString(),user_name:"Current User"};return N.value.unshift(e),g("Note saved successfully","success"),Ce(),!0}catch{return g("Failed to save note","error"),!1}finally{E.value.saving=!1}}async function Ue(n){const t=N.value.findIndex(e=>e.id===n);t!==-1&&(N.value.splice(t,1),g("Note deleted","success"))}async function w(n){const t=N.value.find(e=>e.id===n);t&&(t.pinned=!t.pinned,g(t.pinned?"Note pinned":"Note unpinned","success"))}async function Oe(n){q.value.order=!0;try{await Pe(n),await Ie(n),await Ne(n)}catch(t){console.error("Error loading order data:",t),g("Failed to load order data","error")}finally{q.value.order=!1}}async function Pe(n){q.value.statuses=!0;try{await new Promise(t=>setTimeout(t,500)),O.value=[{id:1,status_name:"Order Placed",notes:"Customer placed order online",created_at:new Date(Date.now()-864e5).toISOString(),user:"System",color:"blue"},{id:2,status_name:"Payment Confirmed",notes:"Payment received via M-Pesa",created_at:new Date(Date.now()-828e5).toISOString(),user:"John Doe",color:"green"}]}finally{q.value.statuses=!1}}async function Ie(n){q.value.notes=!0;try{await new Promise(t=>setTimeout(t,500)),N.value=[{id:1,type:"Call Summary",content:"Customer called to confirm delivery address. Updated address in system.",pinned:!0,created_at:new Date(Date.now()-36e5).toISOString(),user_name:"Jane Smith"},{id:2,type:"General",content:"Customer prefers morning deliveries between 8-10 AM.",pinned:!1,created_at:new Date(Date.now()-18e5).toISOString(),user_name:"Jane Smith"}]}finally{q.value.notes=!1}}async function Ne(n){await new Promise(t=>setTimeout(t,500)),I.value=[{id:1,type:"outgoing",duration:"5:23",timestamp:new Date(Date.now()-72e5).toISOString()},{id:2,type:"incoming",duration:"3:45",timestamp:new Date(Date.now()-864e5).toISOString()}]}function Me(){be(),Se(),Ce()}function be(){_.value.content="",_.value.subject="",_.value.attachments=[],_.value.selectedTemplate=null}function Se(){z.value.formData={status_id:null,status_category_id:null,status_notes:"",recall_date:null,notifyCustomer:!0,notificationMethod:"sms"}}function Ce(){E.value.formData={type:"General",content:"",pinned:!1}}function g(n,t="info"){const e={id:Date.now(),message:n,type:t,timestamp:new Date().toISOString()};M.value.push(e),setTimeout(()=>{const s=M.value.findIndex(y=>y.id===e.id);s!==-1&&M.value.splice(s,1)},5e3)}function me(n){return n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function ze(n){return n?new Date(n).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function ce(n){const t=Math.floor(n/60),e=n%60;return`${t}m ${e}s`}return{activeOrder:C,dialogOpen:oe,activeTab:ne,callState:v,callHistory:I,messageState:_,messageTemplates:X,statusState:z,statusOptions:fe,statusCategories:F,statusHistory:O,notesState:E,noteTypes:h,notes:N,notifications:M,loading:q,customer:H,filteredStatusCategories:xe,shouldShowRecallDate:j,formattedCallDuration:V,pinnedNotes:i,unpinnedNotes:B,openDialog:se,closeDialog:Y,setActiveTab:J,initiateCall:ee,toggleMute:Ve,holdCall:ge,endCall:te,setMessageType:L,loadTemplate:ie,insertVariable:Q,addAttachment:de,removeAttachment:he,sendMessage:Te,updateOrderStatus:ke,saveNote:ae,deleteNote:Ue,toggleNotePin:w,loadOrderData:Oe,addNotification:g,formatDate:me,formatDateTime:ze,replaceVariables:ue}}),yt={class:"d-flex align-center w-100"},bt={class:"flex-grow-1"},St={class:"text-caption text-grey-lighten-1"},Ct={class:"pa-4"},wt={class:"info-row"},xt={class:"info-row"},Vt={key:0,class:"info-row"},Dt={class:"text-truncate"},ht={class:"mb-6"},Tt={class:"text-subtitle-1 font-weight-medium mb-3 text-primary"},kt={class:"mt-4"},Ut={key:0,class:"text-center"},Ot={key:1,class:"call-controls text-center"},Pt={class:"call-status mb-4"},It={class:"text-caption text-grey"},Nt={class:"d-flex justify-center gap-3"},Mt={class:"text-caption grey--text ml-2"},zt={class:"text-caption grey--text"},Ft={class:"text-caption"},qt={class:"text-caption"},Rt={class:"text-body-2"},$t={key:0,class:"text-caption"},At={class:"text-subtitle-1 font-weight-medium mb-3"},Ht={class:"text-body-2 font-weight-medium"},jt={class:"text-caption text-grey"},Lt={class:"text-caption text-grey"},Gt={key:0},Et={__name:"CallCentreDialler",props:{modelValue:Boolean,order:Object},emits:["update:modelValue","status-updated","note-added"],setup(C,{emit:oe}){var n;const ne=_t(),v=U(()=>{var t;return(t=ne.user)==null?void 0:t.id}),I=C,A=vt(),_=oe,X={required:t=>!!t||"This field is required",phone:t=>t?/^[\d\s\-\+\(\)]+$/.test(t)||"Invalid phone number format":!0},z=U({get:()=>I.modelValue,set:t=>_("update:modelValue",t)}),fe=U(()=>O.statusOptions),F=gt(),O=mt(),E=ct(),h=pt();h.onTemplateSelect;const N=t=>{i.value.order_items.splice(t,1),M()};O.statusOptions.find(t=>t.id===i.value.status_id);const M=()=>{const t=ie();i.value.total_price=t,i.value.sub_total=t},q=()=>{i.value.order_items||(i.value.order_items=[]),i.value.order_items.push({product_id:null,product:{},sku:"",quantity:1,unit_price:0,editable:!0}),M()},H=U({get:()=>I.modelValue,set:t=>_("update:modelValue",t)}),xe=t=>{_("update:modelValue",t),t||F.closeDialog()},j=d("call"),V=dt(I,"order"),i=d({id:null,customer:{id:null,full_name:"",phone:"",phone_number:"",email:"",city_id:null,zone_id:null,address:""},order_items:[],shipping_charges:0,total_price:0,sub_total:0,order_no:"",status_id:"",status_category_id:null,status_notes:"",recall_date:"",delivery_date:""}),B=d(!1),se=d(!1),Y=d("00:00"),J=d(!1),ee=d({phone:"",recordCall:!0,autoLog:!0}),W=d("whatsapp");d(null);const re=d(!1),Ve=d(""),ge=U({get:()=>h.messageText||F.messageText,set:t=>{h.messageText=t,F.messageText=t}}),te=d(!1);d(!1);const De=d({type:"General",content:"",pinned:!1}),L=d({show:!1,message:"",color:"success"}),ie=()=>!i.value.order_items||i.value.order_items.length===0?"0.00":i.value.order_items.reduce((e,s)=>e+Number(s.quantity||0)*Number(s.unit_price||0),0).toFixed(2),ue=d([]),Q=d((n=V.value)!=null&&n.call_logs?[...V.value.call_logs]:[]);Je(V,t=>{Q.value=t!=null&&t.call_logs?[...t.call_logs]:[]},{immediate:!0});const de=d([]);d([]);const he=U(()=>i.value.status_id?ue.value.filter(t=>t.status_id===i.value.status_id):[]),Te=U(()=>{const t=ue.value.find(e=>e.id===i.value.status_category_id);return(t==null?void 0:t.name)==="Follow Up"});Je(()=>I.order,t=>{var e,s,y,G;t&&(i.value={...t,customer:{...t.customer},order_items:((e=t.order_items)==null?void 0:e.map(c=>({...c,product:{...c.product}})))||[],shipping_charges:t.shipping_charges||0,total_price:t.total_price||0,sub_total:t.sub_total||0},ee.value.phone=((s=t.customer)==null?void 0:s.phone)||((y=t.customer)==null?void 0:y.phone_number)||"",((G=t.order_statuses)==null?void 0:G.length)>0&&(de.value=t.order_statuses.map(c=>{var b,T,x;return{status_name:((b=c.status)==null?void 0:b.name)||"Unknown",notes:c.status_notes||"No notes",created_at:c.created_at,user:((T=c.user)==null?void 0:T.name)||"System",color:ye((x=c.status)==null?void 0:x.name)}})))},{immediate:!0,deep:!0});const ke=(t,e)=>{const s=O.productOptions.find(y=>y.id===e);s&&(t.product={...s},t.product_id=e,t.sku=s.sku,(!t.unit_price||t.unit_price===0)&&(t.unit_price=s.price||0),M())},ye=t=>({Pending:"orange",Confirmed:"green",Processing:"blue",Shipped:"purple",Delivered:"teal",Cancelled:"red","Follow Up":"amber"})[t]||"grey",ae=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",Ue=async t=>{try{await navigator.clipboard.writeText(t),w("Phone number copied to clipboard","success")}catch{w("Failed to copy","error")}},w=(t,e="success")=>{L.value={show:!0,message:t,color:e}},Oe=t=>{se.value=!0,E.callClient(t),console.log("Initiating call to:",t),setTimeout(()=>{se.value=!1,B.value=!0,Pe(),w("Call connected","success")},2e3)},Pe=()=>{let t=0;const e=setInterval(()=>{if(!B.value){clearInterval(e);return}t++;const s=Math.floor(t/60),y=t%60;Y.value=`${String(s).padStart(2,"0")}:${String(y).padStart(2,"0")}`},1e3)},Ie=()=>{J.value=!J.value,w(J.value?"Microphone muted":"Microphone unmuted","info")},Ne=()=>{w("Call on hold","info")},Me=()=>{B.value=!1,A.afClient.hangup(),Y.value="00:00",w("Call ended","info"),Q.value.unshift({id:Date.now(),type:"outgoing",duration:Y.value,timestamp:"Just now"})},be=async()=>{var t,e,s,y,G,c;if(!F.messageText.trim()){w("Please enter a message","error");return}re.value=!0;try{const b=me.value||{},T=V.value||{},x={id:b.id||((t=T.customer)==null?void 0:t.id)||null,name:b.full_name||((e=T.customer)==null?void 0:e.full_name)||"Unknown",phone:b.phone||b.phone_number||((s=T.customer)==null?void 0:s.phone_number)||"",orderId:T.id||null,orderData:T,orderOid:T.order_no||"N/A"};console.log("ðŸ“¤ Sending message with context:",x);const le=((y=h.selectedTemplate)==null?void 0:y.id)||null,k=await h.sendSingleMessage(v.value,x,F.messageText,le);if(k&&k.success)w(`${W.value.toUpperCase()} sent successfully`,"success"),F.messageText="",h.selectedTemplate=null;else{console.warn("Send message returned unexpected result:",k);const R=k&&(k.message||k.error)||"Failed to send message";w(R,"error")}}catch(b){console.error("âŒ Send message error:",b),w(((c=(G=b==null?void 0:b.response)==null?void 0:G.data)==null?void 0:c.message)||(b==null?void 0:b.message)||"Failed to send message","error")}finally{re.value=!1}},Se=async()=>{te.value=!0,setTimeout(()=>{te.value=!1,w("Status updated successfully","success");const t=fe.value.find(e=>e.id===i.value.status_id);de.value.unshift({status_name:t.name,notes:i.value.status_notes,created_at:new Date().toISOString(),user:"Current User",color:t.color}),_("status-updated",i.value),i.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"}},1500)},Ce=()=>{w("Opening order history...","info")},g=()=>{w("Opening customer orders...","info")},me=U(()=>{var t,e,s,y;return((t=i.value)==null?void 0:t.customer)||((e=I.order)==null?void 0:e.customer)||((s=I.order)==null?void 0:s.customer_address)||((y=I.order)==null?void 0:y.shipping_address)||{}}),ze=async()=>{try{const t=i.value.id,{id:e,...s}=i.value;await O.updateOrder(t,s),w("Order updated and marked as complete","success"),ce()}catch(t){console.error("Failed to update order:",t),w("Failed to update order","error")}},ce=()=>{z.value=!1,j.value="call",B.value=!1,Ve.value={subject:"",content:"",attachments:[]},i.value={status_id:null,status_category_id:null,status_notes:"",recall_date:"",notifyCustomer:!0,notificationMethod:"sms"},De.value={type:"General",content:"",pinned:!1}};return(t,e)=>{const s=m("v-icon"),y=m("v-avatar"),G=m("v-chip"),c=m("v-btn"),b=m("v-card-title"),T=m("v-divider"),x=m("v-text-field"),le=m("v-autocomplete"),k=m("v-card-text"),R=m("v-card"),Ke=m("v-table"),pe=m("v-col"),He=m("v-row"),Fe=m("v-tab"),Ze=m("v-tabs"),qe=m("v-list-item-title"),je=m("v-list-item-subtitle"),Le=m("v-list-item-content"),we=m("v-list-item"),Xe=m("v-list"),Re=m("v-window-item"),Ye=m("v-btn-toggle"),Ge=m("v-textarea"),et=m("v-alert"),Ee=m("v-select"),tt=m("v-form"),at=m("v-timeline-item"),lt=m("v-timeline"),ot=m("v-window"),nt=m("v-spacer"),st=m("v-card-actions"),rt=m("v-snackbar"),it=m("v-dialog");return D(),K(it,{"model-value":H.value,"onUpdate:modelValue":xe,"max-width":"1200px",persistent:"",scrollable:""},{default:l(()=>[a(R,{class:"call-center-dialog"},{default:l(()=>[a(b,{class:"dialog-header pa-4"},{default:l(()=>{var o,S,p;return[u("div",yt,[a(y,{color:"primary",size:"48",class:"mr-3"},{default:l(()=>[a(s,{color:"white",size:"28"},{default:l(()=>e[27]||(e[27]=[r("mdi-headset")])),_:1,__:[27]})]),_:1}),u("div",bt,[e[28]||(e[28]=u("div",{class:"text-h5 font-weight-bold"},"CallCenter",-1)),u("div",St," Order #"+f(((o=V.value)==null?void 0:o.order_no)||"N/A")+" - "+f(((S=me.value)==null?void 0:S.full_name)||"Unknown Customer"),1)]),a(G,{color:ye((p=V.value)==null?void 0:p.status),variant:"flat",class:"mr-2"},{default:l(()=>{var ve,_e,Be;return[r(f(((Be=(_e=(ve=V.value)==null?void 0:ve.latest_status)==null?void 0:_e.status)==null?void 0:Be.name)||"Pending"),1)]}),_:1},8,["color"]),a(G,{color:P(A).connectionStatusColor,small:"",class:"white--text px-2"},{default:l(()=>[a(s,{left:"",small:""},{default:l(()=>e[29]||(e[29]=[r("mdi-circle")])),_:1,__:[29]}),r(" "+f(P(A).connectionStatusText),1)]),_:1},8,["color"]),a(c,{icon:"",variant:"text",onClick:ce},{default:l(()=>[a(s,null,{default:l(()=>e[30]||(e[30]=[r("mdi-close")])),_:1,__:[30]})]),_:1})])]}),_:1}),a(T),a(k,{class:"pa-0",style:{height:"70vh"}},{default:l(()=>[a(He,{"no-gutters":"",style:{height:"100%"}},{default:l(()=>[a(pe,{cols:"12",md:"6",class:"left-panel"},{default:l(()=>[u("div",Ct,[a(R,{variant:"outlined",class:"mb-4"},{default:l(()=>[a(b,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[a(s,{size:"small",class:"mr-2"},{default:l(()=>e[31]||(e[31]=[r("mdi-account")])),_:1,__:[31]}),e[32]||(e[32]=r(" Customer Information "))]),_:1,__:[32]}),a(k,{class:"pa-3"},{default:l(()=>{var o,S;return[u("div",wt,[a(x,{"prepend-inner-icon":"mdi-account",modelValue:i.value.customer.full_name,"onUpdate:modelValue":e[0]||(e[0]=p=>i.value.customer.full_name=p),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[X.required],placeholder:"N/A"},null,8,["modelValue","rules"])]),u("div",xt,[a(x,{"prepend-inner-icon":"mdi-phone",modelValue:i.value.customer.phone,"onUpdate:modelValue":e[1]||(e[1]=p=>i.value.customer.phone=p),type:"text",variant:"outlined",density:"comfortable","hide-details":"",class:"flex-grow-1",rules:[X.phone],placeholder:"N/A"},null,8,["modelValue","rules"]),a(c,{icon:"",size:"x-small",variant:"text",onClick:e[2]||(e[2]=p=>Ue(i.value.customer.phone)),class:"ml-1"},{default:l(()=>[a(s,{size:"14"},{default:l(()=>e[33]||(e[33]=[r("mdi-content-copy")])),_:1,__:[33]})]),_:1})]),(o=i.value)!=null&&o.customer.email?(D(),$("div",Vt,[a(s,{size:"20",class:"mr-2"},{default:l(()=>e[34]||(e[34]=[r("mdi-email")])),_:1,__:[34]}),u("span",Dt,f((S=i.value)==null?void 0:S.customer.email),1)])):Z("",!0),a(le,{modelValue:i.value.customer.city_id,"onUpdate:modelValue":e[3]||(e[3]=p=>i.value.customer.city_id=p),items:P(O).cityOptions,"item-title":"name","item-value":"id",label:"City","prepend-inner-icon":"mdi-city",variant:"outlined",density:"comfortable",rules:[X.required],clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items","rules"]),a(le,{modelValue:i.value.customer.zone_id,"onUpdate:modelValue":e[4]||(e[4]=p=>i.value.customer.zone_id=p),items:P(O).zoneOptions,"item-title":"name","item-value":"id",label:"Zone","prepend-inner-icon":"mdi-map-marker-radius",variant:"outlined",density:"comfortable",clearable:"","hide-no-data":"",class:"mb-3"},null,8,["modelValue","items"]),a(x,{modelValue:i.value.customer.address,"onUpdate:modelValue":e[5]||(e[5]=p=>i.value.customer.address=p),label:"Address","prepend-inner-icon":"mdi-map-marker",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"]),a(x,{modelValue:i.value.customer_notes,"onUpdate:modelValue":e[6]||(e[6]=p=>i.value.customer_notes=p),label:"Customer Notes","prepend-inner-icon":"mdi-note-text",variant:"outlined",density:"comfortable",clearable:"",class:"mb-3"},null,8,["modelValue"])]}),_:1})]),_:1}),u("div",ht,[u("h3",Tt,[a(s,{class:"mr-1",size:"small"},{default:l(()=>e[35]||(e[35]=[r("mdi-package-variant")])),_:1,__:[35]}),e[36]||(e[36]=r(" Order Items "))]),a(Ke,{density:"comfortable",class:"mb-2"},{default:l(()=>[e[37]||(e[37]=u("thead",null,[u("tr",null,[u("th",{style:{width:"30%"}},"Product"),u("th",{style:{width:"15%"}},"Quantity"),u("th",{style:{width:"30%"}}," Unit Price "),u("th",{style:{width:"15%"}},"Total"),u("th",{style:{width:"10%"}})])],-1)),u("tbody",null,[(D(!0),$($e,null,Ae(i.value.order_items||[],(o,S)=>(D(),$("tr",{key:o.id||S},[u("td",null,[a(le,{modelValue:o.product_id,"onUpdate:modelValue":[p=>o.product_id=p,p=>ke(o,p)],items:P(O).productOptions,"item-title":"product_name","item-value":"id",placeholder:"Product name",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),u("td",null,[a(x,{modelValue:o.quantity,"onUpdate:modelValue":[p=>o.quantity=p,e[7]||(e[7]=p=>M())],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),u("td",null,[a(x,{modelValue:o.unit_price,"onUpdate:modelValue":[p=>o.unit_price=p,e[8]||(e[8]=p=>M())],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),u("td",null,f((o.quantity*o.unit_price).toFixed(2)),1),u("td",null,[a(c,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:p=>N(S)},null,8,["onClick"])])]))),128))])]),_:1,__:[37]}),a(c,{color:"primary",variant:"text","prepend-icon":"mdi-plus",onClick:q,class:"mt-2"},{default:l(()=>e[38]||(e[38]=[r(" Add Item ")])),_:1,__:[38]})]),u("div",kt,[a(He,null,{default:l(()=>[a(pe,{cols:"12",md:"4"},{default:l(()=>[a(x,{"model-value":ie(),"onUpdate:modelValue":e[9]||(e[9]=o=>V.value.total_price=o),label:"Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1}),a(pe,{cols:"12",md:"4"},{default:l(()=>[a(x,{modelValue:V.value.shipping_charges,"onUpdate:modelValue":[e[10]||(e[10]=o=>V.value.shipping_charges=o),e[11]||(e[11]=o=>M())],label:"Shipping Charges",type:"number",min:"0",step:"0.01",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),a(pe,{cols:"12",md:"4"},{default:l(()=>[a(x,{"model-value":(parseFloat(ie())+parseFloat(V.value.shipping_charges||0)).toFixed(2),label:"Grand Total",variant:"outlined",density:"comfortable",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),a(R,{variant:"outlined"},{default:l(()=>[a(b,{class:"text-subtitle-1 bg-blue-grey-lighten-5 py-2"},{default:l(()=>[a(s,{size:"small",class:"mr-2"},{default:l(()=>e[39]||(e[39]=[r("mdi-lightning-bolt")])),_:1,__:[39]}),e[40]||(e[40]=r(" Quick Actions "))]),_:1,__:[40]}),a(k,{class:"pa-2"},{default:l(()=>[a(c,{block:"",variant:"outlined",color:"primary",size:"small",class:"mb-2",onClick:Ce},{default:l(()=>[a(s,{size:"18",class:"mr-2"},{default:l(()=>e[41]||(e[41]=[r("mdi-history")])),_:1,__:[41]}),e[42]||(e[42]=r(" Order History "))]),_:1,__:[42]}),a(c,{block:"",variant:"outlined",color:"orange",size:"small",onClick:g},{default:l(()=>[a(s,{size:"18",class:"mr-2"},{default:l(()=>e[43]||(e[43]=[r("mdi-cart")])),_:1,__:[43]}),e[44]||(e[44]=r(" Customer Orders "))]),_:1,__:[44]})]),_:1})]),_:1})])]),_:1}),a(T,{vertical:""}),a(pe,{cols:"12",md:"6",class:"right-panel"},{default:l(()=>[a(Ze,{modelValue:j.value,"onUpdate:modelValue":e[12]||(e[12]=o=>j.value=o),"bg-color":"blue-grey-lighten-5",height:"48"},{default:l(()=>[a(Fe,{value:"call"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[45]||(e[45]=[r("mdi-phone")])),_:1,__:[45]}),e[46]||(e[46]=r(" Call "))]),_:1,__:[46]}),a(Fe,{value:"message"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[47]||(e[47]=[r("mdi-message")])),_:1,__:[47]}),e[48]||(e[48]=r(" Message "))]),_:1,__:[48]}),a(Fe,{value:"status"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[49]||(e[49]=[r("mdi-update")])),_:1,__:[49]}),e[50]||(e[50]=r(" Update Status "))]),_:1,__:[50]})]),_:1},8,["modelValue"]),a(ot,{modelValue:j.value,"onUpdate:modelValue":e[24]||(e[24]=o=>j.value=o),class:"tab-content"},{default:l(()=>[a(Re,{value:"call",class:"pa-4"},{default:l(()=>[a(R,{variant:"outlined",class:"mb-4"},{default:l(()=>[a(k,null,{default:l(()=>[e[57]||(e[57]=u("div",{class:"text-h6 mb-4"}," Make a Call ",-1)),a(x,{modelValue:ee.value.phone,"onUpdate:modelValue":e[13]||(e[13]=o=>ee.value.phone=o),label:"Phone Number","prepend-inner-icon":"mdi-phone",variant:"outlined",density:"comfortable",readonly:"",class:"mb-3"},null,8,["modelValue"]),B.value?(D(),$("div",Ot,[u("div",Pt,[a(y,{color:"green",size:"80",class:"pulse-animation"},{default:l(()=>[a(s,{size:"40",color:"white"},{default:l(()=>e[53]||(e[53]=[r("mdi-phone-in-talk")])),_:1,__:[53]})]),_:1}),e[54]||(e[54]=u("div",{class:"text-h6 mt-3"}," Call in Progress ",-1)),u("div",It,f(Y.value),1)]),u("div",Nt,[a(c,{icon:"",size:"large",color:J.value?"error":"grey",variant:"outlined",onClick:Ie},{default:l(()=>[a(s,null,{default:l(()=>[r(f(J.value?"mdi-microphone-off":"mdi-microphone"),1)]),_:1})]),_:1},8,["color"]),a(c,{icon:"",size:"large",color:"grey",variant:"outlined",onClick:Ne},{default:l(()=>[a(s,null,{default:l(()=>e[55]||(e[55]=[r("mdi-pause")])),_:1,__:[55]})]),_:1}),a(c,{icon:"",size:"large",color:"red",variant:"flat",onClick:Me},{default:l(()=>[a(s,null,{default:l(()=>e[56]||(e[56]=[r("mdi-phone-hangup")])),_:1,__:[56]})]),_:1})])])):(D(),$("div",Ut,[a(c,{color:"green",size:"x-large",rounded:"pill",elevation:"4",onClick:e[14]||(e[14]=o=>Oe(ee.value.phone)),loading:se.value,class:"call-button"},{default:l(()=>[a(s,{size:"32",class:"mr-2"},{default:l(()=>e[51]||(e[51]=[r("mdi-phone")])),_:1,__:[51]}),e[52]||(e[52]=r(" Call Customer "))]),_:1,__:[52]},8,["loading"])]))]),_:1,__:[57]})]),_:1}),a(R,{variant:"outlined"},{default:l(()=>[a(b,{class:"text-subtitle-1"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[58]||(e[58]=[r("mdi-history")])),_:1,__:[58]}),e[59]||(e[59]=r(" Recent Calls "))]),_:1,__:[59]}),a(k,null,{default:l(()=>[a(Xe,{density:"compact"},{default:l(()=>[(D(!0),$($e,null,Ae(Q.value,(o,S)=>(D(),K(we,{key:(o==null?void 0:o.id)||S,class:"mb-1"},{prepend:l(()=>[a(s,{color:o.direction==="Inbound"?"blue":"green"},{default:l(()=>[r(f(o.direction==="Inbound"?"mdi-phone-incoming":"mdi-phone-outgoing"),1)]),_:2},1032,["color"])]),append:l(()=>[o.recordingUrl?(D(),K(c,{key:0,href:o.recordingUrl,target:"_blank",icon:"",size:"x-small",variant:"text",title:"Play recording"},{default:l(()=>[a(s,null,{default:l(()=>e[60]||(e[60]=[r("mdi-play-circle")])),_:1,__:[60]})]),_:2},1032,["href"])):Z("",!0),a(c,{icon:"",size:"x-small",variant:"text",onClick:e[15]||(e[15]=p=>w("Open call details not implemented","info"))},{default:l(()=>[a(s,null,{default:l(()=>e[61]||(e[61]=[r("mdi-dots-vertical")])),_:1,__:[61]})]),_:1})]),default:l(()=>[a(Le,null,{default:l(()=>[a(qe,{class:"d-flex justify-space-between align-center"},{default:l(()=>[u("div",null,[u("strong",null,f(o.customer_name||o.callerNumber||o.caller_number||"Unknown"),1),u("span",Mt," â†’ "+f(o.destinationNumber||o.destination_number||"-"),1)]),u("div",zt,f(o.status||o.callSessionState||""),1)]),_:2},1024),a(je,{class:"d-flex justify-space-between"},{default:l(()=>[u("div",Ft,f(o.callStartTime?ae(o.callStartTime):o.created_at?ae(o.created_at):o.timestamp||""),1),u("div",qt,f(o.durationInSeconds!==void 0&&o.durationInSeconds!==null?`${Math.floor(o.durationInSeconds/60).toString().padStart(2,"0")}:${(o.durationInSeconds%60).toString().padStart(2,"0")}`:o.duration||"00:00"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),!Q.value||Q.value.length===0?(D(),K(we,{key:0},{default:l(()=>[a(Le,null,{default:l(()=>[a(qe,null,{default:l(()=>e[62]||(e[62]=[r("No recent calls")])),_:1,__:[62]})]),_:1})]),_:1})):Z("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),a(Re,{value:"message",class:"pa-4"},{default:l(()=>[a(R,{variant:"outlined"},{default:l(()=>[a(k,null,{item:l(({props:o,item:S})=>[a(we,We(Qe(o)),{prepend:l(()=>[a(s,null,{default:l(()=>e[67]||(e[67]=[r("mdi-file-document-outline")])),_:1,__:[67]})]),default:l(()=>[a(qe,null,{default:l(()=>[r(f(S.raw.name),1)]),_:2},1024),a(je,null,{default:l(()=>[r(f(S.raw.description),1)]),_:2},1024)]),_:2},1040)]),default:l(()=>[e[69]||(e[69]=u("div",{class:"text-h6 mb-4"}," Send Message ",-1)),a(Ye,{modelValue:W.value,"onUpdate:modelValue":e[16]||(e[16]=o=>W.value=o),mandatory:"",divided:"",variant:"outlined",class:"mb-4"},{default:l(()=>[a(c,{value:"whatsapp"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[63]||(e[63]=[r("mdi-whatsapp")])),_:1,__:[63]}),e[64]||(e[64]=r(" WhatsApp "))]),_:1,__:[64]}),a(c,{value:"sms"},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[65]||(e[65]=[r("mdi-message-text")])),_:1,__:[65]}),e[66]||(e[66]=r(" SMS "))]),_:1,__:[66]})]),_:1},8,["modelValue"]),a(le,{modelValue:P(h).selectedTemplate,"onUpdate:modelValue":[e[17]||(e[17]=o=>P(h).selectedTemplate=o),P(h).onTemplateSelect],items:P(h).allTemplates,"item-title":"name","item-value":"id",label:"Select Template","return-object":"",disabled:P(h).loading.templates,loading:P(h).loading.templates,clearable:"",class:"mt-3","hide-no-data":"",dense:""},null,8,["modelValue","items","disabled","loading","onUpdate:modelValue"]),a(Ge,{modelValue:ge.value,"onUpdate:modelValue":e[18]||(e[18]=o=>ge.value=o),label:"Message",variant:"outlined",rows:"8",counter:"",maxlength:W.value==="sms"?160:1e3,class:"mb-3"},null,8,["modelValue","maxlength"]),a(c,{block:"",color:"primary",size:"large",loading:re.value,onClick:be},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[68]||(e[68]=[r("mdi-send")])),_:1,__:[68]}),r(" Send "+f(W.value.toUpperCase()),1)]),_:1},8,["loading"])]),_:1,__:[69]})]),_:1})]),_:1}),a(Re,{value:"status",class:"pa-4"},{default:l(()=>[a(R,{variant:"outlined"},{default:l(()=>[a(k,null,{default:l(()=>[e[76]||(e[76]=u("div",{class:"text-h6 mb-4"}," Update Order Status ",-1)),a(tt,{ref_key:"orderEdit",ref:i},{default:l(()=>[a(et,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:l(()=>{var o,S,p,ve,_e;return[u("div",Rt,[e[70]||(e[70]=u("strong",null,"Current Status:",-1)),r(" "+f(((p=(S=(o=V.value)==null?void 0:o.latest_status)==null?void 0:S.status)==null?void 0:p.name)||"Pending"),1)]),(_e=(ve=V.value)==null?void 0:ve.latest_status)!=null&&_e.created_at?(D(),$("div",$t," Updated "+f(ae(V.value.latest_status.created_at)),1)):Z("",!0)]}),_:1}),a(Ee,{modelValue:i.value.status_id,"onUpdate:modelValue":e[19]||(e[19]=o=>i.value.status_id=o),items:P(O).statusOptions,"item-title":"name","item-value":"id",label:"New Status",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Status is required"],class:"mb-3"},{item:l(({props:o,item:S})=>[a(we,We(Qe(o)),{prepend:l(()=>[a(s,{color:S.raw.color},{default:l(()=>e[71]||(e[71]=[r("mdi-circle")])),_:2,__:[71]},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),i.value.status_id===2?(D(),K(x,{key:0,modelValue:i.value.delivery_date,"onUpdate:modelValue":e[20]||(e[20]=o=>i.value.delivery_date=o),label:"Delivery Date",type:"date",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Delivery date is required"],class:"mb-3"},null,8,["modelValue","rules"])):Z("",!0),a(Ee,{modelValue:i.value.status_category_id,"onUpdate:modelValue":e[21]||(e[21]=o=>i.value.status_category_id=o),items:he.value,"item-title":"name","item-value":"id",label:"Status Category",variant:"outlined",density:"comfortable",disabled:!i.value.status_id,class:"mb-3"},null,8,["modelValue","items","disabled"]),Te.value?(D(),K(x,{key:1,modelValue:i.value.recall_date,"onUpdate:modelValue":e[22]||(e[22]=o=>i.value.recall_date=o),label:"Recall Date & Time",type:"datetime-local",variant:"outlined",density:"comfortable",rules:[o=>!!o||"Recall date is required"],class:"mb-3"},null,8,["modelValue","rules"])):Z("",!0),a(Ge,{modelValue:i.value.status_notes,"onUpdate:modelValue":e[23]||(e[23]=o=>i.value.status_notes=o),label:"Status Notes",variant:"outlined",rows:"4",hint:"Add any relevant information about this status change",class:"mb-3"},null,8,["modelValue"]),a(c,{block:"",color:"primary",size:"large",loading:te.value,onClick:Se},{default:l(()=>[a(s,{class:"mr-2"},{default:l(()=>e[72]||(e[72]=[r("mdi-update")])),_:1,__:[72]}),e[73]||(e[73]=r(" Update Status "))]),_:1,__:[73]},8,["loading"])]),_:1},512),a(T,{class:"my-4"}),u("div",At,[a(s,{class:"mr-2"},{default:l(()=>e[74]||(e[74]=[r("mdi-timeline")])),_:1,__:[74]}),e[75]||(e[75]=r(" Status History "))]),a(lt,{density:"compact",side:"end",align:"start"},{default:l(()=>[(D(!0),$($e,null,Ae(de.value,(o,S)=>(D(),K(at,{key:S,"dot-color":o.color,size:"small"},{default:l(()=>[u("div",Ht,f(o.status_name),1),u("div",jt,f(o.notes),1),u("div",Lt,[r(f(ae(o.created_at))+" ",1),o.user?(D(),$("span",Gt," by "+f(o.user),1)):Z("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})]),_:1,__:[76]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(T),a(st,{class:"pa-4"},{default:l(()=>[a(c,{variant:"outlined",onClick:ce},{default:l(()=>e[77]||(e[77]=[r(" Close ")])),_:1,__:[77]}),a(nt),a(c,{color:"success",variant:"flat","prepend-icon":"mdi-check-circle",onClick:ze},{default:l(()=>e[78]||(e[78]=[r(" Mark Complete & Close ")])),_:1,__:[78]})]),_:1})]),_:1}),a(rt,{modelValue:L.value.show,"onUpdate:modelValue":e[26]||(e[26]=o=>L.value.show=o),color:L.value.color,timeout:3e3},{actions:l(()=>[a(c,{variant:"text",onClick:e[25]||(e[25]=o=>L.value.show=!1)},{default:l(()=>e[79]||(e[79]=[r(" Close ")])),_:1,__:[79]})]),default:l(()=>[r(f(L.value.message)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["model-value"])}}},Bt=ft(Et,[["__scopeId","data-v-df9e99ff"]]),ea=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"}));export{Bt as C,ea as a,gt as u};
