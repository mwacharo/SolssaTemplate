import{E as ge,r,j as f,i as n}from"./app-CzEZQ13I.js";const Re=ge("orders",()=>{const u=r([]),c=r({orders:!1,options:!1,creating:!1,updating:!1,deleting:!1}),d=r(null),J=r([]),j=r(!1),g=r(null),h=r(null),D=r(!1),C=r(!1),y=r(null),_=r(null),w=r(null),O=r(null),F=r(null),m=r(null),R=r(null),A=r(null),p=r([]),z=r(""),K=r([]),P=r([]),T=r([]),$=r([]),k=r([]),L=r([]),U=r([]),q=r([]),B=r([]),M=r([]),V=r([]),N=r([]),Q=r([]),Z=r([]),b=r({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),W=f(()=>e=>u.value.find(a=>a.id===e)),X=f(()=>u.value.filter(e=>e.status===1)),Y=f(()=>u.value.filter(e=>e.status===0)),ee=f(()=>u.value.filter(e=>e.status===2)),te=f(()=>u.value.reduce((e,a)=>e+parseFloat(a.total_price||0),0)),ae=f(()=>{let e=0;return y.value&&e++,_.value&&e++,w.value&&e++,O.value&&e++,F.value&&e++,m.value&&e++,R.value&&e++,A.value&&e++,p.value&&p.value.length>0&&e++,z.value&&e++,e}),re=f(()=>({status:y.value,product:_.value,zone:w.value,agent:O.value,rider:F.value,vendor:m.value,city:R.value,category:A.value,dateRange:p.value,search:z.value})),E=async(e={})=>{var a,s;c.value.orders=!0,d.value=null;try{const t=new URLSearchParams;e.page&&t.append("page",e.page),e.per_page&&t.append("per_page",e.per_page),e.status&&t.append("status",e.status),e.vendor_id&&t.append("vendor_id",e.vendor_id),e.city&&t.append("city",e.city),e.agent_id&&t.append("agent_id",e.agent_id),e.rider_id&&t.append("rider_id",e.rider_id),e.zone_id&&t.append("zone_id",e.zone_id),e.product_id&&t.append("product_id",e.product_id),e.category_id&&t.append("category_id",e.category_id),e.search&&t.append("search",e.search),e.created_from&&t.append("created_from",e.created_from),e.created_to&&t.append("created_to",e.created_to);const l=(await n.get(`/api/v1/orders?${t.toString()}`,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!l.success)throw new Error(l.message||"Failed to fetch orders");C.value=!1;const i=l.data;return u.value=i.data||[],b.value={current_page:i.current_page||1,last_page:i.last_page||1,per_page:i.per_page||15,total:i.total||0,from:i.from||0,to:i.to||0},i}catch(t){throw d.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||t.message||"Failed to fetch orders",t}finally{c.value.orders=!1}};r([]);const se=async e=>{var a,s;if(!(!e||e.length===0))try{const t=await n.post("/api/v1/bulk-print-waybills",{order_ids:e},{headers:{Accept:"application/json","Content-Type":"application/json"},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=o,l.setAttribute("download","waybills.pdf"),document.body.appendChild(l),l.click(),l.remove()}catch(t){throw d.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||t.message||"Failed to print waybill",t}},G=async e=>{c.value.orders=!0,d.value=null;try{const a=await H(e);return h.value=a,g.value=e,a}catch(a){throw d.value=a.message||"Failed to load order",a}finally{c.value.orders=!1}},oe=async e=>{var a,s;c.value.creating=!0,d.value=null;try{const o=(await n.post("/api/v1/orders",e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to create order");return u.value.unshift(o.data),b.value.total+=1,o.data}catch(t){throw d.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||t.message||"Failed to create order",t}finally{c.value.creating=!1}},S=async(e,a)=>{var s,t;c.value.updating=!0,d.value=null;try{const l=(await n.put(`/api/v1/orders/${e}`,a,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;if(!l.success)throw new Error(l.message||"Failed to update order");const i=u.value.findIndex(x=>x.id===e);return i!==-1&&(u.value[i]=l.data),g.value===e&&(h.value=l.data),l.data}catch(o){throw d.value=((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message||"Failed to update order",o}finally{c.value.updating=!1}},le=async e=>{var a,s;c.value.deleting=!0,d.value=null;try{const o=(await n.delete(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to delete order");const l=u.value.findIndex(i=>i.id===e);l!==-1&&(u.value.splice(l,1),b.value.total-=1)}catch(t){throw d.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||t.message||"Failed to delete order",t}finally{c.value.deleting=!1}},H=async e=>{var a,s;try{const o=(await n.get(`/api/v1/orders/${e}`,{headers:{Accept:"application/json"}})).data;if(!o.success)throw new Error(o.message||"Failed to fetch order details");return o.data}catch(t){const o=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||t.message||"Failed to fetch order details";throw new Error(o)}},ne=async(e,a)=>S(e,{customer:a}),ie=async(e,a)=>S(e,{order_items:a}),I=async(e=null)=>{if(c.value.options){console.log("Options already loading, skipping...");return}c.value.options=!0;try{console.log("Fetching dropdown options...");const a=[n.get("/api/v1/statuses").catch(()=>({data:{data:[]}})),n.get("/api/v1/categories").catch(()=>({data:{data:[]}})),n.get("/api/v1/cities").catch(()=>({data:{data:[]}})),n.get("/api/v1/zones").catch(()=>({data:{data:[]}})),n.get("/api/v1/agents").catch(()=>({data:{data:[]}})),n.get("/api/v1/riders").catch(()=>({data:{data:[]}})),n.get("/api/v1/vendors").catch(()=>({data:{data:[]}})),n.get("/api/v1/countries").catch(()=>({data:{data:[]}})),n.get("/api/v1/warehouses").catch(()=>({data:{data:[]}})),n.get("/api/v1/clients").catch(()=>({data:{data:[]}}))];e?a.push(n.get(`/api/v1/vendors/${e}/products`).catch(v=>({data:{success:!1,data:[]}}))):a.push(n.get("/api/v1/products").catch(v=>({data:{success:!1,data:[]}})));const s=v=>!v||!v.data?[]:Array.isArray(v.data)?v.data:Array.isArray(v.data.data)?v.data.data:[],[t,o,l,i,x,ce,ue,de,pe,ve,fe]=await Promise.all(a);Z.value=s(t),T.value=s(o),$.value=s(l),k.value=s(i),L.value=s(x),U.value=s(ce),q.value=s(ue),V.value=s(de),M.value=s(pe),B.value=s(ve),P.value=s(fe),console.log("Dropdown options loaded successfully")}catch(a){throw console.error("Failed to fetch dropdown options:",a),a}finally{c.value.options=!1}};return{orders:u,loading:c,error:d,notifications:J,dialog:j,selectedOrderId:g,selectedOrder:h,initialized:D,isCreateMode:C,orderFilterStatus:y,orderFilterProduct:_,orderFilterZone:w,orderFilterAgent:O,orderFilterRider:F,orderFilterVendor:m,orderFilterCity:R,orderFilterCategory:A,orderDateRange:p,orderSearch:z,orderStatusOptions:K,productOptions:P,categoryOptions:T,cityOptions:$,zoneOptions:k,agentOptions:L,riderOptions:U,vendorOptions:q,clientOptions:B,warehouseOptions:M,countryOptions:V,deliveryStatusOptions:N,userOptions:Q,statusOptions:Z,pagination:b,getOrderById:W,confirmedOrders:X,pendingOrders:Y,cancelledOrders:ee,totalRevenue:te,activeFilterCount:ae,currentFilters:re,printOrders:se,fetchOrders:E,loadOrder:G,createOrder:oe,updateOrder:S,updateOrderCustomer:ne,updateOrderItems:ie,deleteOrder:le,getOrderDetails:H,fetchDropdownOptions:I,openDialog:async e=>{if(g.value=e,C.value=!1,j.value=!0,e){const a=await G(e);return h.value=a,a}},openCreateDialog:()=>{j.value=!0,g.value=null,h.value=null,C.value=!0},closeDialog:()=>{j.value=!1,g.value=null,h.value=null},clearAllFilters:()=>{y.value=null,_.value=null,w.value=null,O.value=null,F.value=null,m.value=null,R.value=null,A.value=null,p.value=[],z.value=""},applyFilters:async()=>{const e={};y.value&&(e.status=y.value),_.value&&(e.product_id=_.value),w.value&&(e.zone_id=w.value),O.value&&(e.agent_id=O.value),F.value&&(e.rider_id=F.value),m.value&&(e.vendor_id=m.value),R.value&&(e.city=R.value),A.value&&(e.category_id=A.value),z.value&&(e.search=z.value),p.value&&p.value.length===2&&(e.created_from=p.value[0],e.created_to=p.value[1]),e.page=1,await E(e)},initialize:async()=>{if(!D.value)try{await Promise.all([I(),E({page:1})]),D.value=!0}catch(e){console.error("Failed to initialize order store:",e)}}}});export{Re as u};
