import{_ as $}from"./AppLayout-DfWnhRmF.js";import{D as O}from"./DualDatePicker-5zl4c-dR.js";import{u as M}from"./orderStore-BJrhtNI_.js";import{E as L,r as _,j as P,i as T,k as I,l as H,c as q,o as a,w as Q,a as o,d as s,e as c,b as v,f as R,u as t,F as x,t as D,g as F,n as G}from"./app-nkozdOV_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CXeea0g_.js";import"./africastalking-8mnCQvzc.js";import"./IncomingCallDialog-FBzf5KVi.js";/* empty css                                                                           */import"./toast-DY9z4fBv.js";const Y=L("orderReport",()=>{const y=M(),l=[{id:"merchant",name:"Merchant Report"}],n={delivery:["zone","city","rider","deliveryDate","shippingStatus"],returns:["zone","city","rider","deliveryDate","shippingStatus"],dispatch:["merchant","zone","city","orderDate"],out_scan:["zone","city","rider","deliveryDate"],undispatched:["merchant","product","zone","city","orderDate"],merchant:["merchant","product","zone","city","confirmationStatus","orderDate","statusDate"],product:["merchant","product","category","zone","city","orderDate"],product_performance:["merchant","product","category","orderDate"],city:["city","zone","orderDate","shippingStatus"],zone:["zone","city","orderDate","shippingStatus"]},m={delivery:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"}],merchant:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_address",label:"Receiver Address"},{key:"receiver_phone",label:"Receiver Phone"},{key:"receiver_town",label:"Receiver Town"},{key:"special_instructions",label:"Special Instructions"},{key:"cash_on_delivery",label:"Cash on Delivery"},{key:"total_qty",label:"Total Qty"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"scheduled_date",label:"Scheduled Date"},{key:"delivery_date",label:"Delivery Date"},{key:"rider",label:"Rider"},{key:"city",label:"City"},{key:"zone",label:"Zone"},{key:"agent",label:"Agent"}],default:[{key:"order_no",label:"Order No"},{key:"product_items",label:"Product Items"},{key:"receiver_name",label:"Receiver Name"},{key:"receiver_phone",label:"Receiver Phone"},{key:"order_status",label:"Order Status"},{key:"created_at",label:"Created At"},{key:"city",label:"City"},{key:"zone",label:"Zone"}]},g=_(null),S=_({merchant:null,product:null,category:null,zone:null,city:null,rider:null,agent:null,confirmationStatus:null,shippingStatus:null,orderDate:null,deliveryDate:null,statusDate:null}),f=_({merchants:[],products:[],categories:[],zones:[],cities:[],riders:[],agents:[],confirmationStatuses:[]}),h=_([]),k=_({page:1,perPage:25,total:0}),d=_({generate:!1,download:!1,options:!1}),e=_(null),u=P(()=>g.value?n[g.value]??[]:[]),r=P(()=>g.value?m[g.value]??m.default:[]);function V(){g.value=null,Object.keys(S.value).forEach(i=>S.value[i]=null),h.value=[],e.value=null,k.value={page:1,perPage:25,total:0}}const C=i=>{if(!i)return null;const b=new Date(i),p=b.getFullYear(),z=String(b.getMonth()+1).padStart(2,"0"),w=String(b.getDate()).padStart(2,"0");return`${p}-${z}-${w}`};function U(){function i(w){if(!Array.isArray(w)||!w[0])return{from:null,to:null};const B=C(w[0]),Z=C(w[w.length-1]);return{from:B,to:Z}}const b=i(y.statusDateRange),p=i(y.deliveryDateRange),z=i(y.createdDateRange);return{report_type:g.value,page:k.value.page,per_page:k.value.perPage,merchant:y.orderFilterVendor,product:y.orderFilterProduct,category:y.orderFilterCategory,zone:y.orderFilterZone,city:y.orderFilterCity,rider:y.orderFilterRider,agent:y.orderFilterAgent,confirmationStatus:y.orderFilterStatus,status_from:b.from,status_to:b.to,delivery_from:p.from,delivery_to:p.to,date_from:z.from,date_to:z.to}}async function N(){d.value.options=!0;try{const{data:i}=await T.get("/api/v1/reports/options");f.value.merchants=i.merchants??[],f.value.products=i.products??[],f.value.categories=i.categories??[],f.value.zones=i.zones??[],f.value.cities=i.cities??[],f.value.riders=i.riders??[],f.value.agents=i.agents??[]}catch(i){console.error("Failed to load report options",i)}finally{d.value.options=!1}}async function j(){var i,b;if(g.value){e.value=null,d.value.generate=!0,k.value.page=1;try{const{data:p}=await T.get("/api/v1/reports/generate",{params:U()});h.value=p.data??[],k.value.total=p.total??0}catch(p){e.value=((b=(i=p.response)==null?void 0:i.data)==null?void 0:b.message)??"Failed to generate report.",h.value=[]}finally{d.value.generate=!1}}}async function E(i){k.value.page=i,await j()}async function A(){if(g.value){d.value.download=!0;try{const i=await T.get("/api/v1/reports/download",{params:{...U(),format:"xlsx"},responseType:"blob"}),b=URL.createObjectURL(new Blob([i.data])),p=document.createElement("a");p.href=b,p.setAttribute("download",`${g.value}_report_${Date.now()}.xlsx`),document.body.appendChild(p),p.click(),p.remove(),URL.revokeObjectURL(b)}catch{e.value="Failed to download Excel file."}finally{d.value.download=!1}}}return{reportTypes:l,selectedReportType:g,filters:S,options:f,results:h,pagination:k,loading:d,error:e,activeFilterFields:u,activeColumns:r,fetchOptions:N,generateReport:j,changePage:E,downloadExcel:A,resetFilters:V}}),J={class:"p-6 max-w-screen-2xl mx-auto"},K={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6"},W={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4"},X={key:0},ee={key:1},te={key:2},re={key:3},le={key:4},oe={key:5},ae={key:6},se={key:7},ne={key:8},ie={key:9},de={class:"flex flex-wrap justify-end gap-3 pt-2 border-t border-gray-100"},ue=["disabled"],ce={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},pe={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me=["disabled"],ye={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ge={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm flex items-center gap-2"},ve={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},fe={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between"},ke={class:"text-sm text-gray-500"},xe={key:0,class:"p-6 space-y-3"},he={key:1,class:"overflow-x-auto"},we={class:"w-full text-sm"},_e={class:"bg-blue-600 text-white"},Re={class:"divide-y divide-gray-100"},De={key:1},Ve=["colspan"],Se={key:2,class:"px-6 py-4 border-t border-gray-100 flex items-center justify-center gap-1"},Ce=["onClick"],Ae={__name:"Export",setup(y){const l=Y(),n=M();function m(d){return l.activeFilterFields.includes(d)}function g(){l.results=[],l.error=null}async function S(){await l.generateReport()}function f(){l.resetFilters()}const h=P(()=>Math.ceil(l.pagination.total/l.pagination.perPage)),k=P(()=>{const d=h.value,e=l.pagination.page;if(d<=7)return Array.from({length:d},(r,V)=>V+1);const u=[];e>3&&(u.push(1),e>4&&u.push("..."));for(let r=Math.max(1,e-2);r<=Math.min(d,e+2);r++)u.push(r);return e<d-3&&u.push("..."),e<d-2&&u.push(d),u});return I(async()=>{await n.initialize(),l.fetchOptions()}),(d,e)=>{const u=H("v-autocomplete");return a(),q($,null,{default:Q(()=>[o("div",J,[e[30]||(e[30]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6 tracking-wide uppercase"}," Reports ",-1)),o("div",K,[o("div",W,[o("div",null,[e[12]||(e[12]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},[R(" Report Type "),o("span",{class:"text-red-500"},"*")],-1)),v(u,{modelValue:t(l).selectedReportType,"onUpdate:modelValue":[e[0]||(e[0]=r=>t(l).selectedReportType=r),g],items:t(l).reportTypes,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select report type...",class:"w-full"},null,8,["modelValue","items"])]),t(l).selectedReportType?(a(),s(x,{key:0},[m("merchant")?(a(),s("div",X,[e[13]||(e[13]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Merchant",-1)),v(u,{modelValue:t(n).orderFilterVendor,"onUpdate:modelValue":e[1]||(e[1]=r=>t(n).orderFilterVendor=r),items:t(n).vendorOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select merchant...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("product")?(a(),s("div",ee,[e[14]||(e[14]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Product",-1)),v(u,{modelValue:t(n).orderFilterProduct,"onUpdate:modelValue":e[2]||(e[2]=r=>t(n).orderFilterProduct=r),items:t(n).productOptions,"item-title":"product_name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select product...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("category")?(a(),s("div",te,[e[15]||(e[15]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Category",-1)),v(u,{modelValue:t(n).orderFilterCategory,"onUpdate:modelValue":e[3]||(e[3]=r=>t(n).orderFilterCategory=r),items:t(n).categoryOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select category...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("zone")?(a(),s("div",re,[e[16]||(e[16]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Zone",-1)),v(u,{modelValue:t(n).orderFilterZone,"onUpdate:modelValue":e[4]||(e[4]=r=>t(n).orderFilterZone=r),items:t(n).zoneOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select zone...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("city")?(a(),s("div",le,[e[17]||(e[17]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"City",-1)),v(u,{modelValue:t(n).orderFilterCity,"onUpdate:modelValue":e[5]||(e[5]=r=>t(n).orderFilterCity=r),items:t(n).cityOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select city...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("rider")?(a(),s("div",oe,[e[18]||(e[18]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Person",-1)),v(u,{modelValue:t(n).orderFilterRider,"onUpdate:modelValue":e[6]||(e[6]=r=>t(n).orderFilterRider=r),items:t(n).riderOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select rider...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("confirmationStatus")?(a(),s("div",ae,[e[19]||(e[19]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Confirmation Status",-1)),v(u,{modelValue:t(n).orderFilterStatus,"onUpdate:modelValue":e[7]||(e[7]=r=>t(n).orderFilterStatus=r),items:t(n).statusOptions,"item-title":"name","item-value":"id",clearable:"",dense:"",outlined:"",placeholder:"Select status...",class:"w-full"},null,8,["modelValue","items"])])):c("",!0),m("statusDate")?(a(),s("div",se,[e[20]||(e[20]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Status Date",-1)),v(O,{modelValue:t(n).statusDateRange,"onUpdate:modelValue":e[8]||(e[8]=r=>t(n).statusDateRange=r)},null,8,["modelValue"])])):c("",!0),m("orderDate")?(a(),s("div",ne,[e[21]||(e[21]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Created Date",-1)),v(O,{modelValue:t(n).createdDateRange,"onUpdate:modelValue":e[9]||(e[9]=r=>t(n).createdDateRange=r)},null,8,["modelValue"])])):c("",!0),m("deliveryDate")?(a(),s("div",ie,[e[22]||(e[22]=o("label",{class:"block text-xs font-semibold text-red-600 mb-1 uppercase tracking-wider"},"Delivery Date",-1)),v(O,{modelValue:t(n).deliveryDateRange,"onUpdate:modelValue":e[10]||(e[10]=r=>t(n).deliveryDateRange=r)},null,8,["modelValue"])])):c("",!0)],64)):c("",!0)]),o("div",de,[o("button",{onClick:S,disabled:!t(l).selectedReportType||t(l).loading.generate,class:"inline-flex items-center gap-2 px-6 py-2 bg-red-600 text-white text-sm font-semibold rounded-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(l).loading.generate?(a(),s("span",ce)):(a(),s("svg",pe,e[23]||(e[23]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))),e[24]||(e[24]=R(" Generate Report "))],8,ue),o("button",{onClick:e[11]||(e[11]=(...r)=>t(l).downloadExcel&&t(l).downloadExcel(...r)),disabled:!t(l).results.length||t(l).loading.download,class:"inline-flex items-center gap-2 px-6 py-2 bg-green-600 text-white text-sm font-semibold rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[t(l).loading.download?(a(),s("span",ye)):(a(),s("svg",ge,e[25]||(e[25]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)]))),e[26]||(e[26]=R(" Download Excel "))],8,me),o("button",{onClick:f,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors"},e[27]||(e[27]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),R(" Reset ")]))]),t(l).error?(a(),s("div",be,[e[28]||(e[28]=o("svg",{class:"w-4 h-4 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),R(" "+D(t(l).error),1)])):c("",!0)]),t(l).selectedReportType?(a(),s("div",ve,[o("div",fe,[e[29]||(e[29]=o("h2",{class:"text-lg font-semibold text-gray-800"}," Report Results ",-1)),o("span",ke,[t(l).pagination.total>0?(a(),s(x,{key:0},[R(" Showing "+D((t(l).pagination.page-1)*t(l).pagination.perPage+1)+"–"+D(Math.min(t(l).pagination.page*t(l).pagination.perPage,t(l).pagination.total))+" of "+D(t(l).pagination.total)+" records ",1)],64)):t(l).loading.generate?c("",!0):(a(),s(x,{key:1},[R(" No results yet ")],64))])]),t(l).loading.generate?(a(),s("div",xe,[(a(),s(x,null,F(8,r=>o("div",{key:r,class:"h-8 bg-gray-100 rounded animate-pulse"})),64))])):t(l).activeColumns.length?(a(),s("div",he,[o("table",we,[o("thead",null,[o("tr",_e,[(a(!0),s(x,null,F(t(l).activeColumns,r=>(a(),s("th",{key:r.key,class:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider whitespace-nowrap"},D(r.label),1))),128))])]),o("tbody",Re,[t(l).results.length?(a(!0),s(x,{key:0},F(t(l).results,(r,V)=>(a(),s("tr",{key:V,class:"hover:bg-gray-50 transition-colors"},[(a(!0),s(x,null,F(t(l).activeColumns,C=>(a(),s("td",{key:C.key,class:"px-4 py-3 text-gray-700 whitespace-nowrap"},D(r[C.key]??"—"),1))),128))]))),128)):(a(),s("tr",De,[o("td",{colspan:t(l).activeColumns.length,class:"px-4 py-10 text-center text-gray-400"}," No items found. Adjust filters and generate the report. ",8,Ve)]))])])])):c("",!0),h.value>1?(a(),s("div",Se,[(a(!0),s(x,null,F(k.value,r=>(a(),s("button",{key:r,onClick:V=>r!=="..."&&t(l).changePage(r),class:G(["w-8 h-8 rounded flex items-center justify-center text-sm font-medium transition-colors",r===t(l).pagination.page?"bg-blue-600 text-white":r==="..."?"text-gray-400 cursor-default":"text-gray-600 hover:bg-gray-100"])},D(r),11,Ce))),128))])):c("",!0)])):c("",!0)])]),_:1})}}};export{Ae as default};
