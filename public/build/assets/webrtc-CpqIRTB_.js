import{A as T,r as l,B as w,j as u}from"./app-oghUaOhr.js";import{A as I}from"./africastalking-sJAXWtpj.js";const R=T("webrtc",()=>{const r=l("offline"),d=w(),i=u(()=>{var e,o;return(o=(e=d.props.auth)==null?void 0:e.user)==null?void 0:o.token}),g=u(()=>{var e,o;return(o=(e=d.props.auth)==null?void 0:e.user)==null?void 0:o.id}),f=l(null),a=l(!1),c=l(null),t=l(!1),v=u(()=>t.value?"success":"error"),m=u(()=>t.value?"Online":"Offline");function p(n){c.value=n,a.value=!0}function C(){a.value=!1,c.value=null}function y(){setInterval(()=>{(r.value==="ready"||r.value==="busy")&&axios.post("/api/v1/agent/ping").catch(()=>{})},15e3)}function b(){Echo.private("agent.status").listen(".status.updated",n=>{console.log(`üîÑ Agent ${n.agentId} is now ${n.status}`),n.agentId===g.value&&(r.value=n.status)})}async function h(){return new Promise(n=>{const e=setInterval(()=>{i.value&&(clearInterval(e),n())},300)})}async function s(n){try{r.value=n,await axios.post("/api/v1/agent/status",{status:n}),console.log(`‚úÖ Agent status updated to ${n}`)}catch(e){console.error("‚ùå Failed to update agent status:",e)}}async function k(){if(y(),b(),i.value||(console.warn("Waiting for token..."),await h()),f.value){console.log("WebRTC client already initialized.");return}const n={sounds:{ringing:"https://support.solssa.com/storage/ringtones/office_phone.mp3"}};try{const e=new I.Client(i.value,n);f.value=e,console.log("‚úÖ WebRTC client initialized for user:",g.value),e.on("ready",()=>{t.value=!0,console.log("üéß WebRTC client ready."),s("ready")}),e.on("error",o=>{console.error("‚ùå WebRTC error:",o)}),e.on("closed",()=>{t.value=!1,console.warn("üîå WebRTC connection closed."),s("closed")}),e.on("incomingcall",o=>{console.log("üìû Incoming call from",o.from),console.log("you clicked me"),s("busy"),p({from:o.from,duration:"Connecting..."})}),e.on("hangup",o=>{console.log("‚òéÔ∏è Call hung up:",o.reason),s("ready"),a.value=!1,t.value=!1})}catch(e){console.error("‚ö†Ô∏è Failed to initialize WebRTC:",e)}}return{afClient:f,userId:g,userToken:i,incomingCallDialog:a,incomingCall:c,connection_active:t,connectionStatusColor:v,connectionStatusText:m,incomingCall:c,incomingCallDialog:a,setIncomingCall:p,closeIncomingCallDialog:C,initializeAfricastalking:k,updateAgentStatus:s}});export{R as u};
