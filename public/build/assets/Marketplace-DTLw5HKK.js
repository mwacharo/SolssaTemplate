import{E as ie,i as V,r as y,j as T,k as ue,l as c,c as ce,o as me,w as s,b as a,f as p,a as g,u as S,t as x}from"./app-DT4IHj4t.js";import{n as h}from"./toast-CENzolHB.js";import{_ as pe}from"./AppLayout-CKFuJb_d.js";import{u as ve}from"./clientStore-CxF72ges.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-CaVcl8ol.js";import"./africastalking-B1rV5jLD.js";import"./IncomingCallDialog-DhX-6MZF.js";/* empty css                                                                           */const fe=ie("googleSheets",{state:()=>({sheets:{data:[]},loading:!1,error:null}),getters:{activeSheets:n=>{var l;return((l=n.sheets.data)==null?void 0:l.filter(r=>r.active===1))||[]},inactiveSheets:n=>{var l;return((l=n.sheets.data)==null?void 0:l.filter(r=>r.active===0))||[]},currentSheets:n=>{var l;return((l=n.sheets.data)==null?void 0:l.filter(r=>r.is_current===1))||[]},getSheetById:n=>l=>{var r;return(r=n.sheets.data)==null?void 0:r.find(d=>d.id===l)},getSheetsByMerchant:n=>l=>{var r;return((r=n.sheets.data)==null?void 0:r.filter(d=>{var o,u;return(u=(o=d.vendor)==null?void 0:o.name)==null?void 0:u.toLowerCase().includes(l.toLowerCase())}))||[]}},actions:{async fetchSheets(){var n,l;try{this.loading=!0;const r=await V.get("/api/v1/google-sheets");this.sheets=r.data,this.error=null}catch(r){throw console.error("Failed to fetch sheets:",r),this.error=((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||r.message,h("Failed to fetch sheets","error"),r}finally{this.loading=!1}},async addSheet(n){var l,r;try{this.loading=!0;const d={vendor_id:n.vendor,sheet_name:n.sheetName||"Sheet1",post_spreadsheet_id:n.spreadsheetId,active:1,auto_sync:1,sync_all:0,sync_interval:15},o=await V.post("/api/v1/google-sheets",d);this.sheets.data||(this.sheets.data=[]),this.sheets.data.push(o.data.data||o.data),h.success("Sheet added successfully"),this.error=null}catch(d){throw console.error("Failed to add sheet:",d),this.error=((r=(l=d.response)==null?void 0:l.data)==null?void 0:r.message)||d.message,h.error("Failed to add sheet"),d}finally{this.loading=!1}},async deleteSheet(n){var l,r;try{if(this.loading=!0,await V.delete(`/api/v1/google-sheets/${n}`),this.sheets.data){const d=this.sheets.data.findIndex(o=>o.id===n);d>-1&&this.sheets.data.splice(d,1)}h("Sheet deleted successfully","success"),this.error=null}catch(d){throw console.error("Failed to delete sheet:",d),this.error=((r=(l=d.response)==null?void 0:l.data)==null?void 0:r.message)||d.message,h("Failed to delete sheet","error"),d}finally{this.loading=!1}},async toggleStatus(n){var l,r,d;try{this.loading=!0;const o=(l=this.sheets.data)==null?void 0:l.find(k=>k.id===n);if(!o)return;const u=o.active===1?0:1,f=await V.put(`/api/v1/google-sheets/${n}`,{active:u});o.active=u,o.updated_at=new Date().toISOString(),h(`Sheet ${u===1?"activated":"deactivated"} successfully`,"success"),this.error=null}catch(o){throw console.error("Failed to toggle status:",o),this.error=((d=(r=o.response)==null?void 0:r.data)==null?void 0:d.message)||o.message,h("Failed to update sheet status","error"),o}finally{this.loading=!1}},async toggleCurrent(n){var l,r,d;try{this.loading=!0;const o=(l=this.sheets.data)==null?void 0:l.find(f=>f.id===n);if(!o)return;const u=o.is_current===1?0:1;await V.put(`/api/v1/google-sheets/${n}`,{is_current:u}),u===1&&this.sheets.data&&this.sheets.data.forEach(f=>{f.id!==n&&(f.is_current=0)}),o.is_current=u,o.updated_at=new Date().toISOString(),h.success(`Sheet ${u===1?"set as current":"removed from current"}`),this.error=null}catch(o){throw console.error("Failed to toggle current:",o),this.error=((d=(r=o.response)==null?void 0:r.data)==null?void 0:d.message)||o.message,h.error("Failed to update current setting"),o}finally{this.loading=!1}},async updateSheet(n,l){var r,d,o;try{this.loading=!0,await V.put(`/api/v1/google-sheets/${n}`,l);const u=(r=this.sheets.data)==null?void 0:r.find(f=>f.id===n);u&&(Object.assign(u,l),u.updated_at=new Date().toISOString()),h.success("Sheet updated successfully"),this.error=null}catch(u){throw console.error("Failed to update sheet:",u),this.error=((o=(d=u.response)==null?void 0:d.data)==null?void 0:o.message)||u.message,h.error("Failed to update sheet"),u}finally{this.loading=!1}},async readSheet(n){try{this.loading=!0,console.log("Reading sheet:",n);const l=await V.post(`/api/v1/google-sheets/${n}/read-sheet`);return h.success("Sheet read successfully"),this.error=null,l.data}catch(l){throw console.error("Failed to read sheet:",l),h.error("Failed to read sheet"),l}finally{this.loading=!1}},async writeSheet(n,l={}){var r,d;try{this.loading=!0,console.log("Writing to sheet:",n);const o=await V.post(`/api/v1/google-sheets/${n}/sync-products`,l);return h.success("Data written to sheet successfully"),this.error=null,o.data}catch(o){throw console.error("Failed to write to sheet:",o),this.error=((d=(r=o.response)==null?void 0:r.data)==null?void 0:d.message)||o.message,h.error("Failed to write to sheet"),o}finally{this.loading=!1}},clearError(){this.error=null}}}),_e={class:"font-weight-medium"},ge={class:"text-primary cursor-pointer"},ye={class:"text-body-2 font-mono"},Se={class:"text-body-2"},be={class:"d-flex ga-1"},we={class:"text-center py-4"},Ve={__name:"Marketplace",setup(n){const l=fe(),r=ve(),d=y("current"),o=y(""),u=y(!1),f=y(!1),k=y(!1),D=y([]),O=y(!1),b=y({vendor:"",sheetName:"",spreadsheetId:""}),v=y({}),W=async()=>{try{O.value=!0,await r.fetchVendors(),D.value=r.vendors.map(i=>({id:i.id,name:i.name}))}catch(i){console.error("Failed to load vendors:",i)}finally{O.value=!1}},K=[{title:"Merchant",key:"merchant",sortable:!0},{title:"Sheet Name",key:"sheetName",sortable:!0},{title:"Spreadsheet ID",key:"spreadsheetId",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Current",key:"isCurrent",sortable:!1},{title:"Auto Sync",key:"autoSync",sortable:!1},{title:"Last Order Synced",key:"lastOrderSynced",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],M=T(()=>{var e;return(((e=l.sheets)==null?void 0:e.data)||[]).map(m=>{var C;return{id:m.id,merchant:((C=m.vendor)==null?void 0:C.name)||`Vendor ${m.vendor_id}`,sheetName:m.sheet_name,spreadsheetId:m.post_spreadsheet_id,status:m.active===1?"Active":"Inactive",isCurrent:m.is_current===1,autoSync:m.auto_sync===1,syncAll:m.sync_all===1,syncInterval:m.sync_interval,lastOrderSynced:m.last_order_synced,lastOrderUpload:m.last_order_upload,lastProductSynced:m.last_product_synced,orderPrefix:m.order_prefix,lastUpdatedOrderNumber:m.lastUpdatedOrderNumber,created:m.created_at,updated:m.updated_at}})}),Q=T(()=>d.value==="current"?M.value.filter(i=>i.status==="Active"):M.value),X=i=>i?new Date(i).toLocaleString():"N/A",Z=async()=>{if(k.value)try{await l.addSheet(b.value),z()}catch(i){console.error("Failed to add sheet:",i)}},z=()=>{b.value={vendor:"",sheetName:"",spreadsheetId:""},u.value=!1},H=async i=>{if(confirm("Are you sure you want to delete this sheet?"))try{await l.deleteSheet(i)}catch(e){console.error("Failed to delete sheet:",e)}},J=async i=>{try{await l.toggleStatus(i)}catch(e){console.error("Failed to toggle status:",e)}},Y=async i=>{try{await l.toggleCurrent(i)}catch(e){console.error("Failed to toggle current:",e)}},ee=async i=>{try{await l.readSheet(i)}catch(e){console.error("Failed to read sheet:",e)}},te=async i=>{try{await l.writeSheet(i)}catch(e){console.error("Failed to write sheet:",e)}},ae=i=>{const e=l.sheets.data.find(m=>m.id===i.id);v.value={...e},f.value=!0},le=async()=>{try{await l.updateSheet(v.value.id,v.value),f.value=!1}catch(i){console.error("Failed to update settings:",i)}};return ue(async()=>{try{await Promise.all([l.fetchSheets(),W()])}catch(i){console.error("Failed to initialize component:",i)}}),(i,e)=>{const m=c("v-app-bar-title"),C=c("v-container"),se=c("v-app-bar"),I=c("v-card-title"),F=c("v-card-text"),A=c("v-col"),_=c("v-btn"),B=c("v-row"),N=c("v-card"),L=c("v-tab"),oe=c("v-tabs"),w=c("v-text-field"),j=c("v-icon"),E=c("v-chip"),re=c("v-switch"),ne=c("v-data-table"),de=c("v-autocomplete"),R=c("v-form"),q=c("v-spacer"),G=c("v-card-actions"),P=c("v-dialog"),$=c("v-checkbox");return me(),ce(pe,null,{default:s(()=>[a(C,{fluid:"",class:"pa-0"},{default:s(()=>[a(se,{color:"white",elevation:"1",height:"64"},{default:s(()=>[a(C,{class:"d-flex align-center"},{default:s(()=>[a(m,{class:"text-h5 font-weight-medium"},{default:s(()=>e[19]||(e[19]=[p(" Google Sheets Manager ")])),_:1,__:[19]})]),_:1})]),_:1}),a(C,{class:"py-6"},{default:s(()=>[a(N,{class:"mb-6",elevation:"1"},{default:s(()=>[a(F,{class:"pa-6"},{default:s(()=>[a(I,{class:"text-h6 pa-0 mb-4"},{default:s(()=>e[20]||(e[20]=[p("Share")])),_:1,__:[20]}),a(B,{align:"center"},{default:s(()=>[a(A,null,{default:s(()=>[a(F,{class:"pa-0"},{default:s(()=>e[21]||(e[21]=[g("p",{class:"text-body-2 text-medium-emphasis mb-0"},[p(" To connect, share your googlesheet with "),g("span",{class:"font-mono text-primary"},"google-sheets-sync@arcane-indexer-459514-h9.iam.gserviceaccount.com"),p(", then add Sheet. ")],-1)])),_:1,__:[21]})]),_:1}),a(A,{cols:"auto"},{default:s(()=>[a(_,{color:"primary",onClick:e[0]||(e[0]=t=>u.value=!0),loading:S(l).loading},{default:s(()=>e[22]||(e[22]=[p(" Add Sheet ")])),_:1,__:[22]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(N,{elevation:"1"},{default:s(()=>[a(F,{class:"pa-6 pb-0"},{default:s(()=>[a(I,{class:"text-h6 pa-0 mb-4"},{default:s(()=>e[23]||(e[23]=[p("Connected Stores")])),_:1,__:[23]}),a(B,{class:"mb-4",align:"center",justify:"space-between"},{default:s(()=>[a(A,null,{default:s(()=>[a(oe,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),color:"primary"},{default:s(()=>[a(L,{value:"current"},{default:s(()=>e[24]||(e[24]=[p("Current")])),_:1,__:[24]}),a(L,{value:"all"},{default:s(()=>e[25]||(e[25]=[p("All")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),a(A,{cols:"auto"},{default:s(()=>[a(w,{modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value=t),placeholder:"Search...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",style:{"min-width":"250px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(ne,{headers:K,items:Q.value,search:o.value,"item-key":"id",class:"elevation-0",loading:S(l).loading},{"item.merchant":s(({item:t})=>[g("span",_e,x(t.merchant),1)]),"item.sheetName":s(({item:t})=>[g("span",ge,x(t.sheetName),1)]),"item.status":s(({item:t})=>[a(E,{color:t.status==="Active"?"success":"error",size:"small",variant:"tonal"},{default:s(()=>[a(j,{icon:(t.status==="Active","mdi-circle"),size:"x-small",class:"mr-1"},null,8,["icon"]),p(" "+x(t.status),1)]),_:2},1032,["color"])]),"item.spreadsheetId":s(({item:t})=>[g("span",ye,x(t.spreadsheetId),1)]),"item.isCurrent":s(({item:t})=>[a(re,{"model-value":t.isCurrent,"onUpdate:modelValue":U=>Y(t.id),color:"success",density:"compact","hide-details":"",loading:S(l).loading},null,8,["model-value","onUpdate:modelValue","loading"])]),"item.autoSync":s(({item:t})=>[a(E,{color:t.autoSync?"success":"warning",size:"small",variant:"tonal"},{default:s(()=>[p(x(t.autoSync?"Enabled":"Disabled"),1)]),_:2},1032,["color"])]),"item.lastOrderSynced":s(({item:t})=>[g("span",Se,x(X(t.lastOrderSynced)),1)]),"item.actions":s(({item:t})=>[g("div",be,[a(_,{size:"small",color:"primary",variant:"flat",onClick:U=>ee(t.id),loading:S(l).loading},{default:s(()=>e[26]||(e[26]=[p(" Read ")])),_:2,__:[26]},1032,["onClick","loading"]),a(_,{size:"small",color:"success",variant:"flat",onClick:U=>te(t.id),loading:S(l).loading},{default:s(()=>e[27]||(e[27]=[p(" Write ")])),_:2,__:[27]},1032,["onClick","loading"]),a(_,{size:"small",color:t.status==="Active"?"error":"success",variant:"flat",onClick:U=>J(t.id),loading:S(l).loading},{default:s(()=>[p(x(t.status==="Active"?"Deactivate":"Activate"),1)]),_:2},1032,["color","onClick","loading"]),a(_,{size:"small",color:"grey-darken-1",variant:"flat",onClick:U=>ae(t)},{default:s(()=>e[28]||(e[28]=[p(" Settings ")])),_:2,__:[28]},1032,["onClick"]),a(_,{size:"small",color:"error",variant:"flat",onClick:U=>H(t.id),loading:S(l).loading},{default:s(()=>e[29]||(e[29]=[p(" Delete ")])),_:2,__:[29]},1032,["onClick","loading"])])]),"no-data":s(()=>[g("div",we,[e[31]||(e[31]=g("p",{class:"text-body-1"},"No sheets found",-1)),a(_,{color:"primary",onClick:e[3]||(e[3]=t=>u.value=!0)},{default:s(()=>e[30]||(e[30]=[p(" Add your first sheet ")])),_:1,__:[30]})])]),_:1},8,["items","search","loading"])]),_:1})]),_:1}),a(P,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value=t),"max-width":"500"},{default:s(()=>[a(N,null,{default:s(()=>[a(I,null,{default:s(()=>e[32]||(e[32]=[g("span",{class:"text-h5"},"Add Google Sheet",-1)])),_:1,__:[32]}),a(F,null,{default:s(()=>[a(R,{ref:"addSheetForm",modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t)},{default:s(()=>[a(de,{modelValue:b.value.vendor,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value.vendor=t),items:D.value,label:"Vendor",placeholder:"Select a vendor",variant:"outlined",rules:[t=>!!t||"Vendor is required"],class:"mb-3",loading:O.value,"item-title":"name","item-value":"id",clearable:"","hide-no-data":"","hide-details":"auto"},null,8,["modelValue","items","rules","loading"]),a(w,{modelValue:b.value.sheetName,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value.sheetName=t),label:"Sheet name",placeholder:"Sheet1",variant:"outlined",class:"mb-3","hide-details":"auto"},null,8,["modelValue"]),a(w,{modelValue:b.value.spreadsheetId,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value.spreadsheetId=t),label:"Spreadsheet ID",placeholder:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms",variant:"outlined",rules:[t=>!!t||"Spreadsheet ID is required"],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1},8,["modelValue"])]),_:1}),a(G,null,{default:s(()=>[a(q),a(_,{text:"",onClick:z},{default:s(()=>e[33]||(e[33]=[p(" Close ")])),_:1,__:[33]}),a(_,{color:"primary",onClick:Z,loading:S(l).loading,disabled:!k.value},{default:s(()=>e[34]||(e[34]=[p(" Save ")])),_:1,__:[34]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:f.value,"onUpdate:modelValue":e[18]||(e[18]=t=>f.value=t),"max-width":"600"},{default:s(()=>[a(N,null,{default:s(()=>[a(I,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[36]||(e[36]=g("span",{class:"text-h5"},"Settings",-1)),a(_,{icon:"",variant:"text",onClick:e[9]||(e[9]=t=>f.value=!1)},{default:s(()=>[a(j,null,{default:s(()=>e[35]||(e[35]=[p("mdi-close")])),_:1,__:[35]})]),_:1})]),_:1,__:[36]}),a(F,null,{default:s(()=>[a(R,{ref:"settingsForm"},{default:s(()=>[a(w,{modelValue:v.value.sheet_name,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value.sheet_name=t),label:"Sheet name",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a(w,{modelValue:v.value.post_spreadsheet_id,"onUpdate:modelValue":e[11]||(e[11]=t=>v.value.post_spreadsheet_id=t),label:"Spreadsheet ID",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a(w,{modelValue:v.value.order_prefix,"onUpdate:modelValue":e[12]||(e[12]=t=>v.value.order_prefix=t),label:"Order prefix",placeholder:"eg ORD-2010",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a(w,{modelValue:v.value.lastUpdatedOrderNumber,"onUpdate:modelValue":e[13]||(e[13]=t=>v.value.lastUpdatedOrderNumber=t),label:"Last updated Order Number",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a(w,{modelValue:v.value.sync_interval,"onUpdate:modelValue":e[14]||(e[14]=t=>v.value.sync_interval=t),modelModifiers:{number:!0},label:"Sync interval (minutes)",type:"number",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),a($,{modelValue:v.value.auto_sync,"onUpdate:modelValue":e[15]||(e[15]=t=>v.value.auto_sync=t),label:"Auto sync",class:"mb-3"},null,8,["modelValue"]),a($,{modelValue:v.value.sync_all,"onUpdate:modelValue":e[16]||(e[16]=t=>v.value.sync_all=t),label:"Sync all orders",class:"mb-3"},null,8,["modelValue"]),a($,{modelValue:v.value.is_current,"onUpdate:modelValue":e[17]||(e[17]=t=>v.value.is_current=t),label:"Set as current sheet",class:"mb-3"},null,8,["modelValue"])]),_:1},512)]),_:1}),a(G,null,{default:s(()=>[a(q),a(_,{color:"primary",onClick:le,loading:S(l).loading},{default:s(()=>e[37]||(e[37]=[p(" Update ")])),_:1,__:[37]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}},$e=he(Ve,[["__scopeId","data-v-589b181d"]]);export{$e as default};
