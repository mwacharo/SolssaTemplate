import{E as re,r as t,j as w,i as d}from"./app-BODwDjre.js";import{u as se}from"./webrtc-uE6SfFw6.js";import{n}from"./toast-CLui_y3j.js";const ge=re("callCenter",()=>{const r=se(),S=t(!1),M=t(null),s=t(null),o=t(null),T=t([]),C=t(!1),p=t(null),g=t(0),c=t(!1),u=t(!1),P=t(80),i=t(!1),F=t(null),D=t(""),v=t(null),m=t(null),I=t(!1),$=t({name:"",phone:"",email:"",company:""}),j=t({totalWaiting:0,averageWaitTime:0,agentsAvailable:0,agentsOnCall:0}),q=t("available"),z=t([]),l=w(()=>r.afClient),E=w(()=>r.incomingCall),W=w(()=>r.incomingCallDialog),x=w(()=>r.connection_active),H=w(()=>v.value!==null),L=w(()=>{const e=Math.floor(g.value/60),a=g.value%60;return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`});function f(e){console.log(`[Call Center]: ${e}`)}function Q(e){r.initializeAfClient(e)}function O(e){try{if(console.log(`Calling ${e} from System...`),!l.value){console.log("ðŸ“¡ AfricasTalking unavailable â€” using API provider"),d.post("/api/v1/makecall",{phoneNumber:e}).then(a=>{n.success("Call started via API"),i.value=!0,o.value={id:a.data.callId||Date.now(),phoneNumber:e,direction:"outbound",status:"connecting",startTime:new Date}}).catch(a=>{console.error("âŒ API call failed:",a),n.error("Failed to start call")});return}l.value.call(e),console.log("Call initiated successfully."),n.success("Call started."),i.value=!0,o.value={id:Date.now(),phoneNumber:e,direction:"outbound",status:"connecting",startTime:new Date},l.value.on("afClienting",()=>{f("afClient is in progress (calling)...")}),l.value.on("callaccepted",()=>{console.log("callaccepted"),n.success("Call accepted!"),f("Call accepted (bridged between caller and callee)."),C.value=!0,p.value=Date.now(),k()}),l.value.on("hangup",a=>{f(`Call hung up (${a.code} - ${a.reason}).`),n.error(`Call ended: ${a.reason}`),i.value=!1,h()}),l.value.on("mute",()=>{f("Call muted."),n.info("Call muted."),u.value=!0}),l.value.on("unmute",()=>{f("Call unmuted."),n.info("Call unmuted."),u.value=!1}),l.value.on("hold",()=>{f("Call on hold."),n.info("Call on hold."),c.value=!0}),l.value.on("unhold",()=>{f("Call resumed from hold."),n.info("Call resumed from hold."),c.value=!1})}catch(a){console.error("Call initiation error:",a),n.error("Call failed: "+a.message)}}function J(){E.value&&l.value&&(l.value.answer(),C.value=!0,p.value=Date.now(),k())}function R(e){if(i.value=!0,F.value=e,console.log("Selected agent:",e),D.value=e.phone_number,console.log("Agent phone number:",D.value),!l.value){console.error("AfricasTalking client is not initialized."),n.error("AfricasTalking client is not initialized.");return}try{console.log("Attempting to call agent..."),l.value.call(D.value),console.log("Call initiated successfully."),n.success("Call initiated successfully."),o.value={id:Date.now(),phoneNumber:D.value,direction:"outbound",status:"connecting",startTime:new Date,agent:e}}catch(a){console.error("Error while calling agent:",a),n.error("Failed to call agent: "+a.message)}}function N(){l.value&&(r.hangupCall(),console.log("call ended"),n.error("Call ended."),r.setIncomingCallDialog(!1),i.value=!1,h())}function _(){i.value&&l.value&&(u.value=!u.value,u.value?l.value.muteAudio():l.value.unmuteAudio(),console.log("Client mute property:",l.value.isAudioMuted),console.log("Our internal state:",u.value))}async function B(e,a={}){var y,b;try{return S.value=!0,s.value=null,M.value=e,l.value?(O(e),{success:!0,callId:Date.now()}):(o.value={id:response.data.callId||Date.now(),phoneNumber:e,direction:"outbound",status:"connecting",startTime:new Date},C.value=!0,p.value=Date.now(),k(),response.data)}catch(A){throw s.value=((b=(y=A==null?void 0:A.response)==null?void 0:y.data)==null?void 0:b.message)||"Failed to initiate call",A}finally{S.value=!1}}async function G(){try{if(l.value&&i.value){N();return}o.value&&(await d.post(`/api/v1/call-center/end/${o.value.id}`),T.value.unshift({...o.value,endTime:new Date,duration:g.value,status:"completed"})),h()}catch{s.value="Failed to end call",h()}}async function K(e){try{if(l.value){N();return}await d.post(`/api/v1/call-center/reject/${e.id}`),r.setIncomingCall(null)}catch{s.value="Failed to reject call"}}async function U(){var e,a,y,b;try{if(l.value&&i.value){c.value?(a=(e=l.value).unhold)==null||a.call(e):(b=(y=l.value).hold)==null||b.call(y);return}c.value=!c.value,await d.post(`/api/v1/call-center/hold/${o.value.id}`,{hold:c.value})}catch{c.value=!c.value,s.value="Failed to toggle hold"}}async function V(){try{if(l.value&&i.value){_();return}u.value=!u.value,await d.post(`/api/v1/call-center/mute/${o.value.id}`,{mute:u.value})}catch{u.value=!u.value,s.value="Failed to toggle mute"}}async function X(e){try{await d.post(`/api/v1/call-center/transfer/${o.value.id}`,{targetNumber:e}),T.value.unshift({...o.value,endTime:new Date,duration:g.value,status:"transferred",transferredTo:e}),h()}catch(a){throw s.value="Failed to transfer call",a}}function k(){const e=setInterval(()=>{if(!C.value){clearInterval(e);return}g.value=Math.floor((Date.now()-p.value)/1e3)},1e3)}function h(){o.value=null,C.value=!1,p.value=null,g.value=0,c.value=!1,u.value=!1,i.value=!1,F.value=null}function Y(){v.value="newCall",m.value=null}function Z(){v.value="callAgent",m.value=null}function ee(){v.value="queue",m.value=null}function le(){v.value="transfer"}function ae(e=null){v.value="contact",m.value=e,e&&($.value.phone=e.phoneNumber||e.callerNumber||"")}function te(e=null){v.value="sms",I.value=!0,m.value=e}function ne(){v.value=null,I.value=!1,m.value=null,$.value={name:"",phone:"",email:"",company:""}}async function oe(e){try{await d.post("/api/v1/call-center/agent/status",{status:e}),q.value=e}catch{s.value="Failed to update status"}}async function ue(){try{const e=await d.get("/api/v1/call-center/queue/status");j.value=e.data}catch(e){console.error("Failed to fetch queue status:",e)}}async function ie(){try{const e=await d.get("/api/v1/call-center/agents");z.value=e.data}catch(e){console.error("Failed to fetch agent list:",e)}}function ce(){const e={id:Date.now(),phoneNumber:"+1234567890",callerName:"John Doe",direction:"inbound",startTime:new Date};r.setIncomingCall(e)}return{makingCall:S,lastCallNumber:M,callError:s,activeCall:o,callHistory:T,isCallActive:C,callStartTime:p,callDuration:g,isOnHold:c,isMuted:u,volume:P,isCalling:i,selectedAgent:F,phone_number:D,dialogType:v,callData:m,isSmsDialog:I,contactForm:$,queueStatus:j,agentStatus:q,agentList:z,isDialogOpen:H,formattedCallDuration:L,afClient:l,incomingCall:E,incomingCallDialog:W,connection_active:x,initializeAfClient:Q,callClient:O,makeCall:B,answerCall:J,endCall:G,rejectCall:K,holdCall:U,muteCall:V,transferCall:X,resetCallState:h,handleCall:R,hangupCall:N,handleMute:_,openNewCallDialog:Y,openCallAgentDialog:Z,openQueueDialog:ee,openTransferDialog:le,openContactDialog:ae,openSmsDialog:te,closeDialog:ne,updateAgentStatus:oe,fetchQueueStatus:ue,fetchAgentList:ie,simulateIncomingCall:ce,logEvent:f}});export{ge as u};
