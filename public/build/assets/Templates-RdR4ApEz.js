import{E as ge,i as b,r as v,j as W,k as ye,s as X,l as r,c as R,o as C,w as s,b as t,a as c,f as i,H as we,u,m as D,t as f,e as xe,d as N,F as be,g as Ce}from"./app-nn7BeLPY.js";import{_ as Te}from"./AppLayout-Qw-VW5LI.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-BAqXu3xY.js";import"./africastalking-55nNn0BQ.js";import"./IncomingCallDialog-DcDwGEV3.js";/* empty css                                                                           */const ke=ge("templates",{state:()=>({templates:[],originalTemplates:[],users:[],branches:[],loading:!1,saving:!1,deleting:!1,searchQuery:"",filterChannel:null,filterModule:null,editedItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null},previewItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:""},placeholderValues:{}}),getters:{filteredTemplates:a=>{let l=[...a.templates];return a.filterChannel&&a.filterChannel!=="All"&&(l=l.filter(d=>d.channel===a.filterChannel)),a.filterModule&&a.filterModule!=="All"&&(l=l.filter(d=>d.module===a.filterModule)),l},processedPreviewContent:a=>{let l=a.previewItem.content;return a.previewItem.placeholders&&K(a.previewItem.placeholders).forEach(_=>{const w=a.placeholderValues[_]||`[${_}]`;l=l.replace(new RegExp(`{${_}}`,"g"),w)}),l},defaultItem:()=>({id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null})},actions:{async fetchTemplates(){this.loading=!0;try{const a=await b.get("/api/v1/templates");return this.templates=a.data.data,this.originalTemplates=[...this.templates],{success:!0}}catch(a){return console.error("API Error:",a),{success:!1,error:a}}finally{this.loading=!1}},async searchTemplates(a){if(this.searchQuery=a,a.trim()==="")return this.templates=[...this.originalTemplates],{success:!0};this.loading=!0;try{const l=await b.get("/api/v1/templates",{params:{search:a}});return this.templates=l.data,{success:!0}}catch(l){return console.error("Search error:",l),{success:!1,error:l}}finally{this.loading=!1}},async createTemplate(a){this.saving=!0;try{const l={...a,placeholders:typeof a.placeholders=="string"?a.placeholders:JSON.stringify(a.placeholders)};return await b.post("/api/v1/templates",l),await this.fetchTemplates(),{success:!0}}catch(l){return console.error("Create error:",l),{success:!1,error:l}}finally{this.saving=!1}},async updateTemplate(a,l){this.saving=!0;try{const d={...l,placeholders:typeof l.placeholders=="string"?l.placeholders:JSON.stringify(l.placeholders)};return await b.put(`/api/v1/templates/${a}`,d),await this.fetchTemplates(),{success:!0}}catch(d){return console.error("Update error:",d),{success:!1,error:d}}finally{this.saving=!1}},async deleteTemplate(a){this.deleting=!0;try{return await b.delete(`/api/v1/templates/${a}`),this.templates=this.templates.filter(l=>l.id!==a),this.originalTemplates=this.originalTemplates.filter(l=>l.id!==a),{success:!0}}catch(l){return console.error("Delete error:",l),{success:!1,error:l}}finally{this.deleting=!1}},async fetchUsers(){try{const a=await b.get("/api/v1/admin/users");return this.users=a.data,{success:!0}}catch(a){return console.error("API Error:",a),{success:!1,error:a}}},async fetchBranches(){try{const a=await b.get("/api/v1/branches");return this.branches=a.data,{success:!0}}catch(a){return console.error("API Error:",a),{success:!1,error:a}}},setEditedItem(a){this.editedItem={...a}},resetEditedItem(){this.editedItem={...this.defaultItem}},setPreviewItem(a){this.previewItem={...a},this.placeholderValues={},this.previewItem.placeholders&&K(this.previewItem.placeholders).forEach(d=>{this.placeholderValues[d]=""})},updatePlaceholderValue(a,l){this.placeholderValues[a]=l},setChannelFilter(a){this.filterChannel=a},setModuleFilter(a){this.filterModule=a},cloneTemplate(a){const l={...a};return delete l.id,l.name=`${l.name} (Copy)`,l},extractPlaceholders(a){return K(a)},getChannelColor(a){return{email:"primary",sms:"success",push:"warning","in-app":"info"}[a==null?void 0:a.toLowerCase()]||"grey"}}});function K(a){if(typeof a=="string")try{return JSON.parse(a)}catch{return[]}else if(Array.isArray(a))return a;return[]}const Ie={class:"text-truncate d-inline-block",style:{"max-width":"200px"}},Pe={class:"d-flex align-center"},Ee={class:"d-flex flex-column align-center py-6"},Se={class:"text-h5 font-weight-bold"},Ue=["innerHTML"],Me={key:0,class:"email-preview"},$e={class:"email-header pa-4 rounded-t-lg bg-grey-lighten-4 border-b"},ze={class:"text-subtitle-1 font-weight-bold"},De={class:"text-caption text-grey"},Ne=["innerHTML"],Ae={key:1,class:"sms-preview"},Fe={class:"text-body-1"},Le={key:2,class:"generic-preview"},He={class:"text-subtitle-2 mb-2"},Be={class:"text-body-2"},je={__name:"Templates",setup(a){const l=ke(),d=v(!1),_=v(!1),w=v(!1),S=v(!1),A=v(null),U=v(""),T=v([]),I=v(null),g=v(!1),m=v({id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null}),Y=[{title:"Template Name",align:"start",key:"name"},{title:"Content",key:"content"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],Z=W(()=>g.value?"Edit Template":"Create New Template"),ee=W(()=>l.extractPlaceholders(l.previewItem.placeholders)),F=async()=>{(await l.fetchTemplates()).success||$("Failed to load templates")},te=async()=>{(await l.searchTemplates(U.value)).success||$("Search failed")},le=async()=>{U.value="",await F()},ae=async()=>{g.value=!1,q(),await l.fetchUsers(),d.value=!0},se=async n=>{g.value=!0,m.value={...n},T.value=l.extractPlaceholders(n.placeholders),await l.fetchUsers(),d.value=!0},oe=n=>{I.value=n,_.value=!0},ne=n=>{l.setPreviewItem(n),w.value=!0},re=async n=>{const e=l.cloneTemplate(n);m.value=e,g.value=!1,T.value=l.extractPlaceholders(e.placeholders),await l.fetchUsers(),d.value=!0},ie=async()=>{if(!S.value)return;const n={...m.value,placeholders:T.value};(g.value?await l.updateTemplate(m.value.id,n):await l.createTemplate(n)).success?(G(`Template ${g.value?"updated":"created"} successfully`),M()):$(`Failed to ${g.value?"update":"create"} template`)},de=async()=>{if(!I.value)return;(await l.deleteTemplate(I.value.id)).success?(G("Template deleted successfully"),L()):$("Failed to delete template")},M=()=>{d.value=!1,q()},L=()=>{_.value=!1,I.value=null},q=()=>{A.value&&A.value.reset(),m.value={id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null},T.value=[],g.value=!1},ce=(n,e)=>{l.updatePlaceholderValue(n,e)},G=n=>{console.log("Success:",n)},$=n=>{console.error("Error:",n)};return ye(()=>{F()}),X(d,n=>{n||M()}),X(_,n=>{n||L()}),(n,e)=>{const p=r("v-btn"),P=r("v-card-title"),H=r("v-text-field"),V=r("v-col"),B=r("v-row"),E=r("v-card-text"),ue=r("v-progress-linear"),pe=r("v-chip"),y=r("v-icon"),z=r("v-tooltip"),me=r("v-data-table"),x=r("v-card"),ve=r("v-container"),k=r("v-divider"),fe=r("v-textarea"),_e=r("v-combobox"),he=r("v-form"),j=r("v-spacer"),J=r("v-card-actions"),O=r("v-dialog");return C(),R(Te,null,{default:s(()=>[t(ve,{fluid:"",class:"pa-0"},{default:s(()=>[t(x,{class:"rounded-lg elevation-2 mb-6"},{default:s(()=>[t(P,{class:"d-flex justify-space-between align-center py-4 px-6 bg-surface"},{default:s(()=>[e[11]||(e[11]=c("span",{class:"text-h5 font-weight-bold"},"Template Management",-1)),t(p,{color:"primary","prepend-icon":"mdi-plus",onClick:ae,size:"large",variant:"elevated",rounded:"pill"},{default:s(()=>e[10]||(e[10]=[i(" New Template ")])),_:1,__:[10]})]),_:1,__:[11]}),t(E,{class:"pa-6"},{default:s(()=>[t(B,null,{default:s(()=>[t(V,{cols:"12",md:"6",lg:"4"},{default:s(()=>[t(H,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=o=>U.value=o),label:"Search templates","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",onKeyup:we(te,["enter"]),"onClick:clear":le,class:"rounded-lg"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(me,{headers:Y,loading:u(l).loading,items:u(l).filteredTemplates,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"loading-text":"Loading templates...",class:"rounded-b-lg"},{loader:s(()=>[t(ue,{indeterminate:"",color:"primary",height:"2"})]),"item.channel":s(({item:o})=>[t(pe,{color:u(l).getChannelColor(o.channel),variant:"flat",size:"small",class:"font-weight-medium"},{default:s(()=>[i(f(o.channel),1)]),_:2},1032,["color"])]),"item.content":s(({item:o})=>[c("span",Ie,f(o.content),1)]),"item.actions":s(({item:o})=>[c("div",Pe,[t(z,{location:"top",text:"Edit"},{activator:s(({props:h})=>[t(p,D(h,{icon:"",size:"small",color:"primary",class:"me-1",variant:"text",onClick:Q=>se(o)}),{default:s(()=>[t(y,null,{default:s(()=>e[12]||(e[12]=[i("mdi-pencil")])),_:1,__:[12]})]),_:2},1040,["onClick"])]),_:2},1024),t(z,{location:"top",text:"Delete"},{activator:s(({props:h})=>[t(p,D(h,{icon:"",size:"small",color:"error",class:"me-1",variant:"text",onClick:Q=>oe(o)}),{default:s(()=>[t(y,null,{default:s(()=>e[13]||(e[13]=[i("mdi-delete")])),_:1,__:[13]})]),_:2},1040,["onClick"])]),_:2},1024),t(z,{location:"top",text:"Clone"},{activator:s(({props:h})=>[t(p,D(h,{icon:"",size:"small",color:"info",class:"me-1",variant:"text",onClick:Q=>re(o)}),{default:s(()=>[t(y,null,{default:s(()=>e[14]||(e[14]=[i("mdi-content-copy")])),_:1,__:[14]})]),_:2},1040,["onClick"])]),_:2},1024),t(z,{location:"top",text:"Preview"},{activator:s(({props:h})=>[t(p,D(h,{icon:"",size:"small",color:"success",variant:"text",onClick:Q=>ne(o)}),{default:s(()=>[t(y,null,{default:s(()=>e[15]||(e[15]=[i("mdi-eye")])),_:1,__:[15]})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":s(()=>[c("div",Ee,[t(y,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:s(()=>e[16]||(e[16]=[i("mdi-file-document-outline")])),_:1,__:[16]}),e[18]||(e[18]=c("p",{class:"text-body-1 text-medium-emphasis mb-4"}," No templates found ",-1)),t(p,{color:"primary",variant:"elevated",onClick:F},{default:s(()=>e[17]||(e[17]=[i(" Refresh Data ")])),_:1,__:[17]})])]),_:1},8,["loading","items"])]),_:1})]),_:1}),t(O,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value=o),"max-width":"900px",persistent:""},{default:s(()=>[t(x,{class:"rounded-lg"},{default:s(()=>[t(P,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:s(()=>[c("span",Se,f(Z.value),1),t(p,{icon:"",onClick:M,variant:"text"},{default:s(()=>[t(y,null,{default:s(()=>e[19]||(e[19]=[i("mdi-close")])),_:1,__:[19]})]),_:1})]),_:1}),t(k),t(E,{class:"pa-6"},{default:s(()=>[t(he,{ref_key:"form",ref:A,modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=o=>S.value=o)},{default:s(()=>[t(B,null,{default:s(()=>[t(V,{cols:"12",md:"6"},{default:s(()=>[t(H,{modelValue:m.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value.name=o),label:"Template Name",variant:"outlined","prepend-inner-icon":"mdi-file-document-outline",rules:[o=>!!o||"Template name is required"]},null,8,["modelValue","rules"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(fe,{modelValue:m.value.content,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value.content=o),label:"Template Content",variant:"outlined","prepend-inner-icon":"mdi-card-text-outline","auto-grow":"",rows:"8",rules:[o=>!!o||"Content is required"]},null,8,["modelValue","rules"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(_e,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=o=>T.value=o),label:"Available Placeholders",variant:"outlined","prepend-inner-icon":"mdi-code-braces",chips:"","closable-chips":"",multiple:"","small-chips":"","hide-details":""},null,8,["modelValue"]),e[20]||(e[20]=c("div",{class:"text-caption text-grey mt-2"}," Add placeholders that can be used in this template (e.g., {name}, {order_id}) ",-1))]),_:1,__:[20]}),m.value.channel==="Email"?(C(),R(V,{key:0,cols:"12"},{default:s(()=>[t(x,{variant:"outlined",class:"mt-4"},{default:s(()=>[t(P,{class:"text-subtitle-1"},{default:s(()=>[t(y,{start:"",color:"info"},{default:s(()=>e[21]||(e[21]=[i("mdi-information-outline")])),_:1,__:[21]}),e[22]||(e[22]=i(" Template Preview "))]),_:1,__:[22]}),t(E,null,{default:s(()=>[c("div",{innerHTML:m.value.content,class:"preview-area pa-4 rounded-lg"},null,8,Ue)]),_:1})]),_:1})]),_:1})):xe("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(k),t(J,{class:"pa-6"},{default:s(()=>[t(j),t(p,{color:"error",variant:"text",onClick:M,class:"text-capitalize"},{default:s(()=>e[23]||(e[23]=[i(" Cancel ")])),_:1,__:[23]}),t(p,{color:"primary",variant:"elevated",onClick:ie,loading:u(l).saving,disabled:!S.value||u(l).saving,class:"text-capitalize"},{default:s(()=>e[24]||(e[24]=[i(" Save ")])),_:1,__:[24]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value=o),"max-width":"500px",persistent:""},{default:s(()=>[t(x,{class:"rounded-lg"},{default:s(()=>[t(P,{class:"text-h5 pa-6"},{default:s(()=>e[25]||(e[25]=[i("Confirm Deletion")])),_:1,__:[25]}),t(E,{class:"pa-6"},{default:s(()=>{var o;return[e[26]||(e[26]=i(" Are you sure you want to delete template ")),c("strong",null,f((o=I.value)==null?void 0:o.name),1),e[27]||(e[27]=i("? This action cannot be undone. "))]}),_:1,__:[26,27]}),t(k),t(J,{class:"pa-6"},{default:s(()=>[t(j),t(p,{color:"grey",variant:"text",onClick:L,class:"text-capitalize"},{default:s(()=>e[28]||(e[28]=[i(" Cancel ")])),_:1,__:[28]}),t(p,{color:"error",variant:"elevated",onClick:de,loading:u(l).deleting,class:"text-capitalize"},{default:s(()=>e[29]||(e[29]=[i(" Delete ")])),_:1,__:[29]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=o=>w.value=o),"max-width":"800px"},{default:s(()=>[t(x,{class:"rounded-lg"},{default:s(()=>[t(P,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:s(()=>[e[31]||(e[31]=c("span",{class:"text-h5 font-weight-bold"},"Template Preview",-1)),t(p,{icon:"",onClick:e[7]||(e[7]=o=>w.value=!1),variant:"text"},{default:s(()=>[t(y,null,{default:s(()=>e[30]||(e[30]=[i("mdi-close")])),_:1,__:[30]})]),_:1})]),_:1,__:[31]}),t(k),t(E,{class:"pa-6"},{default:s(()=>[u(l).previewItem.channel==="Email"?(C(),N("div",Me,[c("div",$e,[c("div",ze,f(u(l).previewItem.name),1),c("div",De,f(u(l).previewItem.module)+" Template ",1)]),c("div",{class:"email-body pa-6",innerHTML:u(l).processedPreviewContent},null,8,Ne)])):u(l).previewItem.channel==="SMS"?(C(),N("div",Ae,[t(x,{variant:"outlined",class:"pa-4 bg-grey-lighten-4"},{default:s(()=>[c("div",Fe,f(u(l).processedPreviewContent),1)]),_:1})])):(C(),N("div",Le,[t(x,{variant:"outlined",class:"pa-4"},{default:s(()=>[c("div",He,f(u(l).previewItem.channel)+" Template: "+f(u(l).previewItem.name),1),c("div",Be,f(u(l).processedPreviewContent),1)]),_:1})])),t(k,{class:"my-6"}),c("div",null,[e[32]||(e[32]=c("div",{class:"text-subtitle-1 mb-3"}," Replace Placeholders: ",-1)),t(B,null,{default:s(()=>[(C(!0),N(be,null,Ce(ee.value,o=>(C(),R(V,{cols:"12",md:"6",key:o},{default:s(()=>[t(H,{"model-value":u(l).placeholderValues[o],"onUpdate:modelValue":h=>ce(o,h),label:o,variant:"outlined",density:"comfortable"},null,8,["model-value","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})])]),_:1}),t(k),t(J,{class:"pa-6"},{default:s(()=>[t(j),t(p,{color:"primary",variant:"text",onClick:e[8]||(e[8]=o=>w.value=!1),class:"text-capitalize"},{default:s(()=>e[33]||(e[33]=[i(" Close ")])),_:1,__:[33]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},We=Ve(je,[["__scopeId","data-v-3b5f612f"]]);export{We as default};
