import{_ as me}from"./AppLayout-UMGJesI-.js";import{r as c,j as z,k as ce,l as u,c as g,o as i,w as o,a as t,b as n,e as H,u as ve,f as d,d as y,F as J,g as Q,t as r,W as X}from"./app-Bb0Q1EIt.js";import{u as _e}from"./orderStore-CVpZFNxL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-JHrLhPx_.js";import"./africastalking-CcxJMV7u.js";import"./IncomingCallDialog-DOGkybrx.js";/* empty css                                                                           */import"./toast-BCuYoOuR.js";const pe={class:"pa-4"},fe={key:1,class:"text-center py-8"},Ne={__name:"AgentPayments",props:{invoices:{type:Array,default:()=>[]}},setup(P){const p=_e(),b=c(!1),k=c(!1),N=c(!1),D=c(!1),U=c(""),F=c("success"),s=c({from:"",to:"",agent:null}),f=c(100),m=c([]),T=z(()=>s.value.from&&s.value.to&&s.value.agent),j=z(()=>p.agentOptions.find(a=>a.id===s.value.agent)),B=z(()=>m.value.length*f.value),Y=async()=>{if(!T.value){C("Please select date range and agent","error");return}b.value=!0,k.value=!0;try{const e=await(await fetch(`/api/v1/orders/agent/${s.value.agent}?from=${s.value.from}&to=${s.value.to}`)).json();if(e.success)m.value=e.data||[];else throw new Error(e.message||"Failed to fetch orders")}catch(a){console.error("Error fetching orders:",a),C("Error loading orders","error"),m.value=[]}finally{k.value=!1}},I=()=>{b.value=!1,m.value=[]},Z=async()=>{N.value=!0;try{await X.post("/call-agent-invoices",{agent_id:s.value.agent,from:s.value.from,to:s.value.to,rate:f.value,orders:m.value.map(a=>a.id),total_commission:B.value},{onSuccess:()=>{C("Invoice generated successfully","success"),I(),s.value={from:"",to:"",agent:null}},onError:a=>{C("Error generating invoice","error"),console.error(a)}})}finally{N.value=!1}},ee=a=>{X.visit(`/call-agent-invoices/${a.id}`)},te=async a=>{window.open(`/call-agent-invoices/${a.id}/download`,"_blank")},C=(a,e="success")=>{U.value=a,F.value=e,D.value=!0},w=a=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(a),S=a=>a?new Date(a).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric"}):"N/A",le=a=>({pending:"warning",paid:"success",cancelled:"error",processing:"info"})[a==null?void 0:a.toLowerCase()]||"default";return ce(async()=>{p.initialized?await p.fetchDropdownOptions():await p.initialize()}),(a,e)=>{const E=u("v-text-field"),v=u("v-col"),ne=u("v-autocomplete"),_=u("v-btn"),O=u("v-row"),G=u("v-card-title"),oe=u("v-chip"),K=u("v-table"),h=u("v-card-text"),$=u("v-card"),L=u("v-alert"),ae=u("v-progress-circular"),re=u("v-divider"),se=u("v-spacer"),ue=u("v-card-actions"),de=u("v-dialog"),ie=u("v-snackbar");return i(),g(me,null,{default:o(()=>[t("div",pe,[e[9]||(e[9]=t("h2",{class:"text-h4 mb-6"},"Agent Payments",-1)),n(O,null,{default:o(()=>[n(v,{cols:"12",md:"4"},{default:o(()=>[n(E,{modelValue:s.value.from,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.from=l),label:"Date From",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(v,{cols:"12",md:"4"},{default:o(()=>[n(E,{modelValue:s.value.to,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.to=l),label:"Date To",type:"date",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),n(v,{cols:"12",md:"4"},{default:o(()=>[n(ne,{modelValue:s.value.agent,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.agent=l),items:ve(p).agentOptions,"item-title":"name","item-value":"id",label:"Call Agent",variant:"outlined",density:"comfortable",clearable:"",placeholder:"Search agents..."},null,8,["modelValue","items"])]),_:1}),n(v,{cols:"12"},{default:o(()=>[n(_,{color:"primary",onClick:Y,disabled:!T.value,size:"large"},{default:o(()=>e[6]||(e[6]=[d(" Generate Call Agent Invoice ")])),_:1,__:[6]},8,["disabled"])]),_:1})]),_:1}),P.invoices.length>0?(i(),g($,{key:0,class:"mt-6"},{default:o(()=>[n(G,null,{default:o(()=>e[7]||(e[7]=[d("Recent Invoices")])),_:1,__:[7]}),n(h,null,{default:o(()=>[n(K,null,{default:o(()=>[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"Invoice No"),t("th",null,"Agent"),t("th",null,"Period"),t("th",null,"Orders"),t("th",null,"Commission"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(i(!0),y(J,null,Q(P.invoices,l=>(i(),y("tr",{key:l.id},[t("td",null,r(l.invoice_no),1),t("td",null,r(l.agent_name),1),t("td",null,r(l.period),1),t("td",null,r(l.order_count),1),t("td",null,r(w(l.total_commission)),1),t("td",null,[n(oe,{color:le(l.status),size:"small"},{default:o(()=>[d(r(l.status),1)]),_:2},1032,["color"])]),t("td",null,[n(_,{icon:"mdi-eye",size:"small",variant:"text",onClick:V=>ee(l)},null,8,["onClick"]),n(_,{icon:"mdi-download",size:"small",variant:"text",onClick:V=>te(l)},null,8,["onClick"])])]))),128))])]),_:1,__:[8]})]),_:1})]),_:1})):H("",!0)]),n(de,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l),"max-width":"1000",persistent:""},{default:o(()=>[n($,null,{default:o(()=>[n(G,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[10]||(e[10]=t("span",null,"Generate Call Agent Invoice",-1)),n(_,{icon:"mdi-close",variant:"text",onClick:I})]),_:1,__:[10]}),n(h,null,{default:o(()=>[j.value?(i(),g(L,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:o(()=>[e[11]||(e[11]=t("strong",null,"Agent:",-1)),d(" "+r(j.value.name)+" ",1),e[12]||(e[12]=t("br",null,null,-1)),e[13]||(e[13]=t("strong",null,"Period:",-1)),d(" "+r(S(s.value.from))+" to "+r(S(s.value.to)),1)]),_:1,__:[11,12,13]})):H("",!0),n(O,{class:"mb-4"},{default:o(()=>[n(v,{cols:"12",md:"6"},{default:o(()=>[n(E,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),modelModifiers:{number:!0},label:"Commission Rate (per order)",type:"number",prefix:"KES",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),k.value?(i(),y("div",fe,[n(ae,{indeterminate:"",color:"primary",size:"64"}),e[14]||(e[14]=t("p",{class:"mt-4"},"Loading orders...",-1))])):m.value.length>0?(i(),g(K,{key:2,class:"mt-4"},{default:o(()=>[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"Order No"),t("th",null,"Customer"),t("th",null,"phone"),t("th",null,"COD"),t("th",null,"status date"),t("th",null,"quantity"),t("th",null,"product"),t("th",null,"address"),t("th",null,"Payment"),t("th",null,"Commission")])],-1)),t("tbody",null,[(i(!0),y(J,null,Q(m.value,l=>{var V,q,M,R,W;return i(),y("tr",{key:l.id},[t("td",null,r(l.order_no),1),t("td",null,r(((V=l.customer)==null?void 0:V.full_name)||"N/A"),1),t("td",null,r(((q=l.customer)==null?void 0:q.phone)||"N/A"),1),t("td",null,r(w(l.cod_amount||l.total_price)),1),t("td",null,r(S((M=l.latest_status)==null?void 0:M.created_at)),1),t("td",null,r((l.order_items||[]).reduce((x,A)=>x+(Number(A.quantity)||0),0)),1),t("td",null,r((l.order_items||[]).map(x=>{var A;return((A=x.product)==null?void 0:A.product_name)||x.sku||"N/A"}).join(", ")),1),t("td",null,r(((R=l.customer)==null?void 0:R.address)||((W=l.shipping_address)==null?void 0:W.address)||"N/A"),1),t("td",null,r(l.payment_method||(Number(l.amount_paid||0)>0?"Prepaid":"COD")),1),t("td",null,r(w(f.value)),1)])}),128))])]),_:1,__:[15]})):(i(),g(L,{key:3,type:"warning",variant:"tonal",class:"mt-4"},{default:o(()=>e[16]||(e[16]=[d(" No orders found for the selected period and agent. ")])),_:1,__:[16]})),n(re,{class:"my-4"}),n($,{variant:"tonal",color:"primary"},{default:o(()=>[n(h,null,{default:o(()=>[n(O,null,{default:o(()=>[n(v,{cols:"6"},{default:o(()=>[e[17]||(e[17]=t("strong",null,"Total Orders:",-1)),d(" "+r(m.value.length),1)]),_:1,__:[17]}),n(v,{cols:"6",class:"text-right"},{default:o(()=>[e[18]||(e[18]=t("strong",null,"Total Commission:",-1)),d(" "+r(w(B.value)),1)]),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1}),n(ue,null,{default:o(()=>[n(se),n(_,{variant:"text",onClick:I},{default:o(()=>e[19]||(e[19]=[d("Cancel")])),_:1,__:[19]}),n(_,{color:"success",onClick:Z,disabled:m.value.length===0||k.value,loading:N.value},{default:o(()=>e[20]||(e[20]=[d(" Generate Invoice ")])),_:1,__:[20]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ie,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=l=>D.value=l),color:F.value,timeout:"3000"},{default:o(()=>[d(r(U.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}};export{Ne as default};
