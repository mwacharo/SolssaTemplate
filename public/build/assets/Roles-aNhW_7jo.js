import{_ as Me}from"./AppLayout-C2XaCNWY.js";import{n as f}from"./toast-CAYTFBJP.js";import{i as b,r as i,j as ae,k as Ie,l as o,c as D,o as y,w as a,b as l,a as v,f as s,d as J,e as Te,F as Q,g as X,t as m,z as te}from"./app-BEgMutxi.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./webrtc-ChbNZa_c.js";import"./africastalking-BC5ImpZo.js";import"./IncomingCallDialog-BXyKyXBr.js";/* empty css                                                                           */const Be={class:"d-flex align-center"},Ge={class:"text-h6"},qe={class:"text-h6"},Oe={class:"mb-4"},je={class:"permission-groups",style:{"max-height":"400px","overflow-y":"auto"}},We={class:"d-flex align-center w-100"},He={class:"mb-2"},Je={class:"text-caption text-medium-emphasis"},Qe={__name:"Roles",setup(Xe){b.defaults.withCredentials=!0,b.defaults.headers.common.Accept="application/json";const p=i([]),P=i(!1),V=i(!1),M=i(!1),w=i(null),A=i(null),U=i(!1),E=i(!1),F=i(!1),k=i({name:""}),I=i(!1),x=i(null),_=i(null),c=i([]),g=i(null),C=i(""),Y=i(["User Management","Content Management"]),R=i(null),oe=[{title:"Role Name",value:"name",sortable:!0},{title:"Permissions",value:"permissions",sortable:!1},{title:"Actions",value:"actions",sortable:!1,width:"120px"}],Z={required:n=>!!n||"This field is required",minLength:n=>n&&n.length>=2||"Minimum 2 characters required"},K=[{name:"Basic Operations",icon:"mdi-cog",permissions:[{key:"create",name:"Create",description:"Create new records"},{key:"read",name:"Read",description:"View and read records"},{key:"update",name:"Update",description:"Modify existing records"},{key:"delete",name:"Delete",description:"Remove records"}]},{name:"User Management",icon:"mdi-account-multiple",permissions:[{key:"manage_users",name:"Manage Users",description:"Full user management capabilities"}]},{name:"System Administration",icon:"mdi-shield-crown",permissions:[{key:"system_config",name:"System Configuration",description:"Configure system settings"}]},{name:"Reports & Analytics",icon:"mdi-chart-line",permissions:[{key:"reports",name:"Reports",description:"Access and generate reports"}]}],T=ae(()=>x.value!==null),se=ae(()=>C.value?K.map(n=>({...n,permissions:n.permissions.filter(e=>e.name.toLowerCase().includes(C.value.toLowerCase())||e.description.toLowerCase().includes(C.value.toLowerCase())||e.key.toLowerCase().includes(C.value.toLowerCase()))})).filter(n=>n.permissions.length>0):K);async function ee(){P.value=!0;try{const{data:n}=await b.get("/api/v1/admin/roles");p.value=n}catch(n){console.error("Error fetching roles:",n),f.error("Failed to load roles","error")}finally{P.value=!1}}async function ie(){V.value=!0;try{const{data:n}=await b.post("/api/v1/admin/roles",{name:k.value.name,permissions:[]});p.value.push(n),f.success("Role created successfully","success"),L()}catch(n){console.error("Error creating role:",n),f.error("Failed to create role","error")}finally{V.value=!1}}async function re(){V.value=!0,w.value=x.value;try{const{data:n}=await b.put(`/api/v1/admin/roles/${x.value}`,{name:k.value.name}),e=p.value.findIndex(r=>r.id===x.value);e!==-1&&(p.value[e]=n),f.success("Role updated successfully","success"),L(),await ee()}catch(n){console.error("Error updating role:",n),f("Failed to update role","error")}finally{V.value=!1,w.value=null}}async function ue(){if(_.value){M.value=!0,w.value=_.value.id;try{const{data:n}=await b.put(`/api/v1/admin/roles/${_.value.id}`,{name:_.value.name,permissions:c.value}),e=p.value.findIndex(r=>r.id===_.value.id);e!==-1&&(p.value[e]=n),f.success("Permissions updated successfully","success"),N()}catch(n){console.error("Error updating permissions:",n),f.error("Failed to update permissions","error")}finally{M.value=!1,w.value=null}}}async function de(){if(g.value){A.value=g.value.id;try{await b.delete(`/api/v1/admin/roles/${g.value.id}`),p.value=p.value.filter(n=>n.id!==g.value.id),f.success("Role deleted successfully","success"),F.value=!1,g.value=null}catch(n){console.error("Error deleting role:",n),f.error("Failed to delete role","error")}finally{A.value=null}}}function ce(){k.value={name:""},x.value=null,U.value=!0,te(()=>{R.value&&R.value.resetValidation()})}function me(n){k.value={name:n.name},x.value=n.id,U.value=!0,te(()=>{R.value&&R.value.resetValidation()})}function le(n){_.value=n,c.value=[...n.permissions||[]],E.value=!0}function L(){U.value=!1,k.value={name:""},x.value=null}function N(){E.value=!1,_.value=null,c.value=[],C.value=""}function ve(n){g.value=n,F.value=!0}function pe(n,e){if(e)c.value.includes(n)||c.value.push(n);else{const r=c.value.indexOf(n);r>-1&&c.value.splice(r,1)}}function fe(n){n.permissions.forEach(e=>{c.value.includes(e.key)||c.value.push(e.key)})}function _e(n){n.permissions.forEach(e=>{const r=c.value.indexOf(e.key);r>-1&&c.value.splice(r,1)})}function ge(n){return n.permissions.filter(e=>c.value.includes(e.key)).length}function ye(){R.value.validate()&&(T.value?re():ie())}function ke(n){return n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return Ie(()=>{ee()}),(n,e)=>{const r=o("v-col"),u=o("v-btn"),B=o("v-row"),ne=o("v-icon"),S=o("v-card-title"),G=o("v-text-field"),xe=o("v-select"),$=o("v-card-text"),z=o("v-card"),q=o("v-tab"),Ce=o("v-tabs"),be=o("v-skeleton-loader"),O=o("v-chip"),Ve=o("v-chip-group"),we=o("v-data-table"),Re=o("v-container"),h=o("v-spacer"),j=o("v-divider"),he=o("v-form"),W=o("v-card-actions"),H=o("v-dialog"),Ue=o("v-expansion-panel-title"),Fe=o("v-checkbox"),De=o("v-list-item-title"),Pe=o("v-list-item-subtitle"),Ae=o("v-list-item"),Ee=o("v-list"),Le=o("v-expansion-panel-text"),Se=o("v-expansion-panel"),$e=o("v-expansion-panels");return y(),D(Me,null,{default:a(()=>[l(Re,null,{default:a(()=>[l(B,{class:"mb-4 align-center"},{default:a(()=>[l(r,null,{default:a(()=>e[11]||(e[11]=[v("h2",{class:"text-h4"},"Roles Management",-1)])),_:1,__:[11]}),l(r,{class:"text-right"},{default:a(()=>[l(u,{color:"primary",onClick:ce,loading:P.value,"prepend-icon":"mdi-plus"},{default:a(()=>e[12]||(e[12]=[s(" Create Role ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1}),l(z,{class:"mb-4",variant:"outlined"},{default:a(()=>[l(S,{class:"text-subtitle-1 pb-2"},{default:a(()=>[l(ne,{left:""},{default:a(()=>e[13]||(e[13]=[s("mdi-filter")])),_:1,__:[13]}),e[14]||(e[14]=s(" Filters "))]),_:1,__:[14]}),l($,null,{default:a(()=>[l(B,null,{default:a(()=>[l(r,{cols:"12",md:"4"},{default:a(()=>[l(G,{modelValue:n.filters.search,"onUpdate:modelValue":e[0]||(e[0]=t=>n.filters.search=t),label:"Search roles...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.debouncedSearch,hint:"Search by name","persistent-hint":""},null,8,["modelValue","onInput"])]),_:1}),l(r,{cols:"12",md:"3"},{default:a(()=>[l(xe,{modelValue:n.filters.status,"onUpdate:modelValue":[e[1]||(e[1]=t=>n.filters.status=t),n.applyFilters],items:n.statusFilterOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(r,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[l(u,{variant:"outlined",onClick:n.clearFilters,disabled:!n.hasActiveFilters},{default:a(()=>e[15]||(e[15]=[s(" Clear Filters ")])),_:1,__:[15]},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(B,{class:"mb-4"},{default:a(()=>[l(r,null,{default:a(()=>[l(Ce,{modelValue:n.searchTab,"onUpdate:modelValue":e[2]||(e[2]=t=>n.searchTab=t),"background-color":"transparent",grow:"","slider-color":"primary"},{default:a(()=>[l(q,{value:"all"},{default:a(()=>e[16]||(e[16]=[s("All Roles")])),_:1,__:[16]}),l(q,{value:"with_permissions"},{default:a(()=>e[17]||(e[17]=[s("With Permissions")])),_:1,__:[17]}),l(q,{value:"without_permissions"},{default:a(()=>e[18]||(e[18]=[s("Without Permissions")])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(we,{headers:oe,items:p.value,loading:P.value,"item-key":"id",class:"elevation-1"},{loading:a(()=>[l(be,{type:"table-row@5"})]),"item.permissions":a(({item:t})=>[v("div",Be,[l(Ve,null,{default:a(()=>[(y(!0),J(Q,null,X((t.permissions||[]).slice(0,3),d=>(y(),D(O,{key:d,size:"small",color:"primary",variant:"tonal"},{default:a(()=>[s(m(ke(d)),1)]),_:2},1024))),128)),t.permissions&&t.permissions.length>3?(y(),D(O,{key:0,size:"small",variant:"outlined",onClick:d=>le(t),style:{cursor:"pointer"}},{default:a(()=>[s(" +"+m(t.permissions.length-3)+" more ",1)]),_:2},1032,["onClick"])):Te("",!0)]),_:2},1024)])]),"item.actions":a(({item:t})=>[l(u,{icon:"mdi-shield-edit",size:"small",variant:"text",onClick:d=>le(t),loading:w.value===t.id},null,8,["onClick","loading"]),l(u,{icon:"mdi-pencil",size:"small",variant:"text",onClick:d=>me(t),loading:w.value===t.id},null,8,["onClick","loading"]),l(u,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:d=>ve(t),loading:A.value===t.id},null,8,["onClick","loading"])]),_:1},8,["items","loading"])]),_:1}),l(H,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=t=>U.value=t),"max-width":"500px",persistent:""},{default:a(()=>[l(z,null,{default:a(()=>[l(S,{class:"d-flex align-center"},{default:a(()=>[v("span",Ge,m(T.value?"Edit Role":"Create Role"),1),l(h),l(u,{icon:"mdi-close",variant:"text",onClick:L})]),_:1}),l(j),l($,{class:"pb-0"},{default:a(()=>[l(he,{ref_key:"roleForm",ref:R,modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t)},{default:a(()=>[l(G,{modelValue:k.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value.name=t),label:"Role Name",rules:[Z.required,Z.minLength],loading:V.value,variant:"outlined",class:"mb-4"},null,8,["modelValue","rules","loading"])]),_:1},8,["modelValue"])]),_:1}),l(W,null,{default:a(()=>[l(h),l(u,{variant:"outlined",onClick:L},{default:a(()=>e[19]||(e[19]=[s("Cancel")])),_:1,__:[19]}),l(u,{color:"primary",disabled:!I.value,loading:V.value,onClick:ye},{default:a(()=>[s(m(T.value?"Update":"Create"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(H,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=t=>E.value=t),"max-width":"600px",persistent:""},{default:a(()=>[l(z,null,{default:a(()=>[l(S,{class:"d-flex align-center"},{default:a(()=>{var t;return[v("span",qe,"Manage Permissions - "+m((t=_.value)==null?void 0:t.name),1),l(h),l(u,{icon:"mdi-close",variant:"text",onClick:N})]}),_:1}),l(j),l($,null,{default:a(()=>[v("div",Oe,[l(G,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t),label:"Search permissions...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),v("div",je,[l($e,{modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>Y.value=t),multiple:""},{default:a(()=>[(y(!0),J(Q,null,X(se.value,t=>(y(),D(Se,{key:t.name,value:t.name},{default:a(()=>[l(Ue,null,{default:a(()=>[v("div",We,[l(ne,{icon:t.icon,class:"mr-2"},null,8,["icon"]),v("span",null,m(t.name),1),l(h),l(O,{size:"x-small",variant:"tonal"},{default:a(()=>[s(m(ge(t))+"/"+m(t.permissions.length),1)]),_:2},1024)])]),_:2},1024),l(Le,null,{default:a(()=>[v("div",He,[l(u,{size:"small",variant:"outlined",onClick:d=>fe(t),class:"mr-2"},{default:a(()=>e[20]||(e[20]=[s(" Select All ")])),_:2,__:[20]},1032,["onClick"]),l(u,{size:"small",variant:"outlined",onClick:d=>_e(t)},{default:a(()=>e[21]||(e[21]=[s(" Deselect All ")])),_:2,__:[21]},1032,["onClick"])]),l(Ee,null,{default:a(()=>[(y(!0),J(Q,null,X(t.permissions,d=>(y(),D(Ae,{key:d.key,class:"px-0"},{prepend:a(()=>[l(Fe,{"model-value":c.value.includes(d.key),"onUpdate:modelValue":ze=>pe(d.key,ze),color:"primary"},null,8,["model-value","onUpdate:modelValue"])]),default:a(()=>[l(De,null,{default:a(()=>[s(m(d.name),1)]),_:2},1024),l(Pe,null,{default:a(()=>[s(m(d.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),l(j),l(W,null,{default:a(()=>[v("div",Je,m(c.value.length)+" permissions selected ",1),l(h),l(u,{variant:"outlined",onClick:N},{default:a(()=>e[22]||(e[22]=[s("Cancel")])),_:1,__:[22]}),l(u,{color:"primary",loading:M.value,onClick:ue},{default:a(()=>e[23]||(e[23]=[s(" Update Permissions ")])),_:1,__:[23]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(H,{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=t=>F.value=t),"max-width":"400px"},{default:a(()=>[l(z,null,{default:a(()=>[l(S,{class:"text-h6"},{default:a(()=>e[24]||(e[24]=[s("Confirm Delete")])),_:1,__:[24]}),l($,null,{default:a(()=>{var t;return[s(' Are you sure you want to delete the role "'+m((t=g.value)==null?void 0:t.name)+'"? This action cannot be undone. ',1)]}),_:1}),l(W,null,{default:a(()=>{var t;return[l(h),l(u,{variant:"outlined",onClick:e[9]||(e[9]=d=>F.value=!1)},{default:a(()=>e[25]||(e[25]=[s("Cancel")])),_:1,__:[25]}),l(u,{color:"error",loading:A.value===((t=g.value)==null?void 0:t.id),onClick:de},{default:a(()=>e[26]||(e[26]=[s(" Delete ")])),_:1,__:[26]},8,["loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ol=Ne(Qe,[["__scopeId","data-v-861f441f"]]);export{ol as default};
